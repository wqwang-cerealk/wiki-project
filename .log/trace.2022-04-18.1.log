2022-04-18 20:41:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465286631952384[0;39m 生成今日电子书快照开始
2022-04-18 20:41:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465286631952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:41:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465286631952384[0;39m ==> Parameters: 
2022-04-18 20:41:50.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465286631952384[0;39m <==    Updates: 0
2022-04-18 20:41:50.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465286631952384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 20:41:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465307599278080[0;39m 生成今日电子书快照开始
2022-04-18 20:41:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465307599278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:41:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465307599278080[0;39m ==> Parameters: 
2022-04-18 20:41:55.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465307599278080[0;39m <==    Updates: 0
2022-04-18 20:41:55.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465307599278080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 20:42:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465328579186688[0;39m 生成今日电子书快照开始
2022-04-18 20:42:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465328579186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465328579186688[0;39m ==> Parameters: 
2022-04-18 20:42:00.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465328579186688[0;39m <==    Updates: 0
2022-04-18 20:42:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465328579186688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 20:42:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465349542318080[0;39m 生成今日电子书快照开始
2022-04-18 20:42:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465349542318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465349542318080[0;39m ==> Parameters: 
2022-04-18 20:42:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465349542318080[0;39m <==    Updates: 0
2022-04-18 20:42:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465349542318080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 20:42:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171465349798170624[0;39m start updating Ebook doc
2022-04-18 20:42:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465349798170624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:42:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465349798170624[0;39m ==> Parameters: 
2022-04-18 20:42:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465349798170624[0;39m <==    Updates: 1
2022-04-18 20:42:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171465349798170624[0;39m update ends, take 38 millisecs
2022-04-18 20:42:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465370518032384[0;39m 生成今日电子书快照开始
2022-04-18 20:42:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465370518032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465370518032384[0;39m ==> Parameters: 
2022-04-18 20:42:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465370518032384[0;39m <==    Updates: 0
2022-04-18 20:42:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465370518032384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:42:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465391485358080[0;39m 生成今日电子书快照开始
2022-04-18 20:42:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465391485358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465391485358080[0;39m ==> Parameters: 
2022-04-18 20:42:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465391485358080[0;39m <==    Updates: 0
2022-04-18 20:42:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465391485358080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:42:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465412465266688[0;39m 生成今日电子书快照开始
2022-04-18 20:42:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465412465266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465412465266688[0;39m ==> Parameters: 
2022-04-18 20:42:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465412465266688[0;39m <==    Updates: 0
2022-04-18 20:42:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465412465266688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:42:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465433432592384[0;39m 生成今日电子书快照开始
2022-04-18 20:42:25.259 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465433432592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:25.260 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465433432592384[0;39m ==> Parameters: 
2022-04-18 20:42:25.300 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465433432592384[0;39m <==    Updates: 0
2022-04-18 20:42:25.300 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465433432592384[0;39m 生成今日电子书快照结束，耗时：296毫秒
2022-04-18 20:42:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465454404112384[0;39m 生成今日电子书快照开始
2022-04-18 20:42:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465454404112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465454404112384[0;39m ==> Parameters: 
2022-04-18 20:42:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465454404112384[0;39m <==    Updates: 0
2022-04-18 20:42:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465454404112384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:42:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465475371438080[0;39m 生成今日电子书快照开始
2022-04-18 20:42:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465475371438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465475371438080[0;39m ==> Parameters: 
2022-04-18 20:42:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465475371438080[0;39m <==    Updates: 0
2022-04-18 20:42:35.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465475371438080[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 20:42:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171465475665039360[0;39m start updating Ebook doc
2022-04-18 20:42:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465475665039360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:42:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465475665039360[0;39m ==> Parameters: 
2022-04-18 20:42:35.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465475665039360[0;39m <==    Updates: 1
2022-04-18 20:42:35.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171465475665039360[0;39m update ends, take 41 millisecs
2022-04-18 20:42:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465496347152384[0;39m 生成今日电子书快照开始
2022-04-18 20:42:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465496347152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465496347152384[0;39m ==> Parameters: 
2022-04-18 20:42:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465496347152384[0;39m <==    Updates: 0
2022-04-18 20:42:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465496347152384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 20:42:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465517318672384[0;39m 生成今日电子书快照开始
2022-04-18 20:42:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465517318672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465517318672384[0;39m ==> Parameters: 
2022-04-18 20:42:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465517318672384[0;39m <==    Updates: 0
2022-04-18 20:42:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465517318672384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:42:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465538290192384[0;39m 生成今日电子书快照开始
2022-04-18 20:42:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465538290192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465538290192384[0;39m ==> Parameters: 
2022-04-18 20:42:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465538290192384[0;39m <==    Updates: 0
2022-04-18 20:42:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465538290192384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:42:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465559253323776[0;39m 生成今日电子书快照开始
2022-04-18 20:42:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465559253323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:42:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465559253323776[0;39m ==> Parameters: 
2022-04-18 20:42:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465559253323776[0;39m <==    Updates: 0
2022-04-18 20:42:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465559253323776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:43:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465580233232384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465580233232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465580233232384[0;39m ==> Parameters: 
2022-04-18 20:43:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465580233232384[0;39m <==    Updates: 0
2022-04-18 20:43:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465580233232384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:43:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171465601204752384[0;39m start updating Ebook doc
2022-04-18 20:43:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465601204752384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:43:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465601204752384[0;39m ==> Parameters: 
2022-04-18 20:43:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465601204752384[0;39m <==    Updates: 1
2022-04-18 20:43:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171465601204752384[0;39m update ends, take 67 millisecs
2022-04-18 20:43:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465601485770752[0;39m 生成今日电子书快照开始
2022-04-18 20:43:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465601485770752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465601485770752[0;39m ==> Parameters: 
2022-04-18 20:43:05.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465601485770752[0;39m <==    Updates: 0
2022-04-18 20:43:05.117 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465601485770752[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 20:43:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465622176272384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465622176272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465622176272384[0;39m ==> Parameters: 
2022-04-18 20:43:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465622176272384[0;39m <==    Updates: 0
2022-04-18 20:43:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465622176272384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:43:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465643147792384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465643147792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465643147792384[0;39m ==> Parameters: 
2022-04-18 20:43:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465643147792384[0;39m <==    Updates: 0
2022-04-18 20:43:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465643147792384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:43:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465664123506688[0;39m 生成今日电子书快照开始
2022-04-18 20:43:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465664123506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465664123506688[0;39m ==> Parameters: 
2022-04-18 20:43:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465664123506688[0;39m <==    Updates: 0
2022-04-18 20:43:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465664123506688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:43:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465685086638080[0;39m 生成今日电子书快照开始
2022-04-18 20:43:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465685086638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465685086638080[0;39m ==> Parameters: 
2022-04-18 20:43:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465685086638080[0;39m <==    Updates: 0
2022-04-18 20:43:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465685086638080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:43:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465706062352384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:30.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465706062352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:30.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465706062352384[0;39m ==> Parameters: 
2022-04-18 20:43:30.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465706062352384[0;39m <==    Updates: 0
2022-04-18 20:43:30.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465706062352384[0;39m 生成今日电子书快照结束，耗时：103毫秒
2022-04-18 20:43:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171465727029678080[0;39m start updating Ebook doc
2022-04-18 20:43:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465727029678080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:43:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465727029678080[0;39m ==> Parameters: 
2022-04-18 20:43:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465727029678080[0;39m <==    Updates: 1
2022-04-18 20:43:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171465727029678080[0;39m update ends, take 56 millisecs
2022-04-18 20:43:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465727268753408[0;39m 生成今日电子书快照开始
2022-04-18 20:43:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465727268753408[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465727268753408[0;39m ==> Parameters: 
2022-04-18 20:43:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465727268753408[0;39m <==    Updates: 0
2022-04-18 20:43:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465727268753408[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 20:43:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465748005392384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465748005392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465748005392384[0;39m ==> Parameters: 
2022-04-18 20:43:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465748005392384[0;39m <==    Updates: 0
2022-04-18 20:43:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465748005392384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:43:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465768976912384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465768976912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465768976912384[0;39m ==> Parameters: 
2022-04-18 20:43:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465768976912384[0;39m <==    Updates: 0
2022-04-18 20:43:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465768976912384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:43:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465789935849472[0;39m 生成今日电子书快照开始
2022-04-18 20:43:50.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465789935849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:50.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465789935849472[0;39m ==> Parameters: 
2022-04-18 20:43:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465789935849472[0;39m <==    Updates: 0
2022-04-18 20:43:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465789935849472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:43:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465810919952384[0;39m 生成今日电子书快照开始
2022-04-18 20:43:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465810919952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:43:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465810919952384[0;39m ==> Parameters: 
2022-04-18 20:43:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465810919952384[0;39m <==    Updates: 0
2022-04-18 20:43:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465810919952384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:44:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465831887278080[0;39m 生成今日电子书快照开始
2022-04-18 20:44:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465831887278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465831887278080[0;39m ==> Parameters: 
2022-04-18 20:44:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465831887278080[0;39m <==    Updates: 0
2022-04-18 20:44:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465831887278080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:44:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171465852854603776[0;39m start updating Ebook doc
2022-04-18 20:44:05.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465852854603776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:44:05.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465852854603776[0;39m ==> Parameters: 
2022-04-18 20:44:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465852854603776[0;39m <==    Updates: 1
2022-04-18 20:44:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171465852854603776[0;39m update ends, take 55 millisecs
2022-04-18 20:44:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465853085290496[0;39m 生成今日电子书快照开始
2022-04-18 20:44:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465853085290496[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465853085290496[0;39m ==> Parameters: 
2022-04-18 20:44:05.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465853085290496[0;39m <==    Updates: 0
2022-04-18 20:44:05.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465853085290496[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 20:44:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465873830318080[0;39m 生成今日电子书快照开始
2022-04-18 20:44:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465873830318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465873830318080[0;39m ==> Parameters: 
2022-04-18 20:44:10.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465873830318080[0;39m <==    Updates: 0
2022-04-18 20:44:10.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465873830318080[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-18 20:44:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465894806032384[0;39m 生成今日电子书快照开始
2022-04-18 20:44:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465894806032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465894806032384[0;39m ==> Parameters: 
2022-04-18 20:44:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465894806032384[0;39m <==    Updates: 0
2022-04-18 20:44:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465894806032384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:44:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465915781746688[0;39m 生成今日电子书快照开始
2022-04-18 20:44:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465915781746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465915781746688[0;39m ==> Parameters: 
2022-04-18 20:44:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465915781746688[0;39m <==    Updates: 0
2022-04-18 20:44:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465915781746688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 20:44:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465936744878080[0;39m 生成今日电子书快照开始
2022-04-18 20:44:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465936744878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465936744878080[0;39m ==> Parameters: 
2022-04-18 20:44:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465936744878080[0;39m <==    Updates: 0
2022-04-18 20:44:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465936744878080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:44:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465957716398080[0;39m 生成今日电子书快照开始
2022-04-18 20:44:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465957716398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465957716398080[0;39m ==> Parameters: 
2022-04-18 20:44:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465957716398080[0;39m <==    Updates: 0
2022-04-18 20:44:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465957716398080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:44:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171465978683723776[0;39m start updating Ebook doc
2022-04-18 20:44:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465978683723776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:44:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465978683723776[0;39m ==> Parameters: 
2022-04-18 20:44:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171465978683723776[0;39m <==    Updates: 1
2022-04-18 20:44:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171465978683723776[0;39m update ends, take 60 millisecs
2022-04-18 20:44:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465978935382016[0;39m 生成今日电子书快照开始
2022-04-18 20:44:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465978935382016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465978935382016[0;39m ==> Parameters: 
2022-04-18 20:44:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465978935382016[0;39m <==    Updates: 0
2022-04-18 20:44:35.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465978935382016[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 20:44:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171465999667826688[0;39m 生成今日电子书快照开始
2022-04-18 20:44:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465999667826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465999667826688[0;39m ==> Parameters: 
2022-04-18 20:44:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171465999667826688[0;39m <==    Updates: 0
2022-04-18 20:44:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171465999667826688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:44:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466020635152384[0;39m 生成今日电子书快照开始
2022-04-18 20:44:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466020635152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466020635152384[0;39m ==> Parameters: 
2022-04-18 20:44:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466020635152384[0;39m <==    Updates: 0
2022-04-18 20:44:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466020635152384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:44:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466041606672384[0;39m 生成今日电子书快照开始
2022-04-18 20:44:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466041606672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466041606672384[0;39m ==> Parameters: 
2022-04-18 20:44:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466041606672384[0;39m <==    Updates: 0
2022-04-18 20:44:50.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466041606672384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:44:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466062578192384[0;39m 生成今日电子书快照开始
2022-04-18 20:44:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466062578192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:44:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466062578192384[0;39m ==> Parameters: 
2022-04-18 20:44:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466062578192384[0;39m <==    Updates: 0
2022-04-18 20:44:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466062578192384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:45:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466083537129472[0;39m 生成今日电子书快照开始
2022-04-18 20:45:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466083537129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466083537129472[0;39m ==> Parameters: 
2022-04-18 20:45:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466083537129472[0;39m <==    Updates: 0
2022-04-18 20:45:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466083537129472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 20:45:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466104525426688[0;39m start updating Ebook doc
2022-04-18 20:45:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466104525426688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:45:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466104525426688[0;39m ==> Parameters: 
2022-04-18 20:45:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466104525426688[0;39m <==    Updates: 1
2022-04-18 20:45:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466104525426688[0;39m update ends, take 56 millisecs
2022-04-18 20:45:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466104764502016[0;39m 生成今日电子书快照开始
2022-04-18 20:45:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466104764502016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466104764502016[0;39m ==> Parameters: 
2022-04-18 20:45:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466104764502016[0;39m <==    Updates: 0
2022-04-18 20:45:05.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466104764502016[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 20:45:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466125496946688[0;39m 生成今日电子书快照开始
2022-04-18 20:45:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466125496946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466125496946688[0;39m ==> Parameters: 
2022-04-18 20:45:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466125496946688[0;39m <==    Updates: 0
2022-04-18 20:45:10.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466125496946688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 20:45:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466146460078080[0;39m 生成今日电子书快照开始
2022-04-18 20:45:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466146460078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466146460078080[0;39m ==> Parameters: 
2022-04-18 20:45:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466146460078080[0;39m <==    Updates: 0
2022-04-18 20:45:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466146460078080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:45:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466167439986688[0;39m 生成今日电子书快照开始
2022-04-18 20:45:20.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466167439986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:20.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466167439986688[0;39m ==> Parameters: 
2022-04-18 20:45:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466167439986688[0;39m <==    Updates: 0
2022-04-18 20:45:20.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466167439986688[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 20:45:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466188411506688[0;39m 生成今日电子书快照开始
2022-04-18 20:45:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466188411506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466188411506688[0;39m ==> Parameters: 
2022-04-18 20:45:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466188411506688[0;39m <==    Updates: 0
2022-04-18 20:45:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466188411506688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:45:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466209362055168[0;39m 生成今日电子书快照开始
2022-04-18 20:45:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466209362055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466209362055168[0;39m ==> Parameters: 
2022-04-18 20:45:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466209362055168[0;39m <==    Updates: 0
2022-04-18 20:45:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466209362055168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 20:45:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466230350352384[0;39m 生成今日电子书快照开始
2022-04-18 20:45:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466230350352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466230350352384[0;39m ==> Parameters: 
2022-04-18 20:45:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466230350352384[0;39m <==    Updates: 0
2022-04-18 20:45:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466230350352384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:45:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466230589427712[0;39m start updating Ebook doc
2022-04-18 20:45:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466230589427712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:45:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466230589427712[0;39m ==> Parameters: 
2022-04-18 20:45:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466230589427712[0;39m <==    Updates: 1
2022-04-18 20:45:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466230589427712[0;39m update ends, take 43 millisecs
2022-04-18 20:45:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466251317678080[0;39m 生成今日电子书快照开始
2022-04-18 20:45:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466251317678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466251317678080[0;39m ==> Parameters: 
2022-04-18 20:45:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466251317678080[0;39m <==    Updates: 0
2022-04-18 20:45:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466251317678080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:45:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466272297586688[0;39m 生成今日电子书快照开始
2022-04-18 20:45:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466272297586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466272297586688[0;39m ==> Parameters: 
2022-04-18 20:45:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466272297586688[0;39m <==    Updates: 0
2022-04-18 20:45:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466272297586688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:45:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466293264912384[0;39m 生成今日电子书快照开始
2022-04-18 20:45:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466293264912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466293264912384[0;39m ==> Parameters: 
2022-04-18 20:45:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466293264912384[0;39m <==    Updates: 0
2022-04-18 20:45:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466293264912384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:45:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466314236432384[0;39m 生成今日电子书快照开始
2022-04-18 20:45:55.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466314236432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:45:55.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466314236432384[0;39m ==> Parameters: 
2022-04-18 20:45:55.429 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466314236432384[0;39m <==    Updates: 0
2022-04-18 20:45:55.429 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466314236432384[0;39m 生成今日电子书快照结束，耗时：425毫秒
2022-04-18 20:46:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466335212146688[0;39m 生成今日电子书快照开始
2022-04-18 20:46:00.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466335212146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:00.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466335212146688[0;39m ==> Parameters: 
2022-04-18 20:46:00.134 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466335212146688[0;39m <==    Updates: 0
2022-04-18 20:46:00.134 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466335212146688[0;39m 生成今日电子书快照结束，耗时：128毫秒
2022-04-18 20:46:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466356175278080[0;39m start updating Ebook doc
2022-04-18 20:46:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466356175278080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:46:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466356175278080[0;39m ==> Parameters: 
2022-04-18 20:46:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466356175278080[0;39m <==    Updates: 1
2022-04-18 20:46:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466356175278080[0;39m update ends, take 62 millisecs
2022-04-18 20:46:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466356439519232[0;39m 生成今日电子书快照开始
2022-04-18 20:46:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466356439519232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466356439519232[0;39m ==> Parameters: 
2022-04-18 20:46:05.190 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466356439519232[0;39m <==    Updates: 0
2022-04-18 20:46:05.190 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466356439519232[0;39m 生成今日电子书快照结束，耗时：124毫秒
2022-04-18 20:46:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466377150992384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:10.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466377150992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:10.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466377150992384[0;39m ==> Parameters: 
2022-04-18 20:46:10.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466377150992384[0;39m <==    Updates: 0
2022-04-18 20:46:10.115 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466377150992384[0;39m 生成今日电子书快照结束，耗时：109毫秒
2022-04-18 20:46:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466398122512384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466398122512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466398122512384[0;39m ==> Parameters: 
2022-04-18 20:46:15.350 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466398122512384[0;39m <==    Updates: 0
2022-04-18 20:46:15.350 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466398122512384[0;39m 生成今日电子书快照结束，耗时：345毫秒
2022-04-18 20:46:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466419094032384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466419094032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466419094032384[0;39m ==> Parameters: 
2022-04-18 20:46:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466419094032384[0;39m <==    Updates: 0
2022-04-18 20:46:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466419094032384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 20:46:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466440065552384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:25.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466440065552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:25.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466440065552384[0;39m ==> Parameters: 
2022-04-18 20:46:25.177 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466440065552384[0;39m <==    Updates: 0
2022-04-18 20:46:25.178 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466440065552384[0;39m 生成今日电子书快照结束，耗时：174毫秒
2022-04-18 20:46:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466461037072384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466461037072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466461037072384[0;39m ==> Parameters: 
2022-04-18 20:46:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466461037072384[0;39m <==    Updates: 0
2022-04-18 20:46:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466461037072384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:46:35.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466481991815168[0;39m start updating Ebook doc
2022-04-18 20:46:35.225 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466481991815168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:46:35.226 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466481991815168[0;39m ==> Parameters: 
2022-04-18 20:46:35.265 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466481991815168[0;39m <==    Updates: 1
2022-04-18 20:46:35.266 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466481991815168[0;39m update ends, take 266 millisecs
2022-04-18 20:46:35.266 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466483107500032[0;39m 生成今日电子书快照开始
2022-04-18 20:46:35.266 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466483107500032[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:35.267 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466483107500032[0;39m ==> Parameters: 
2022-04-18 20:46:35.313 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466483107500032[0;39m <==    Updates: 0
2022-04-18 20:46:35.313 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466483107500032[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 20:46:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466502975918080[0;39m 生成今日电子书快照开始
2022-04-18 20:46:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466502975918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466502975918080[0;39m ==> Parameters: 
2022-04-18 20:46:40.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466502975918080[0;39m <==    Updates: 0
2022-04-18 20:46:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466502975918080[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 20:46:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466523951632384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:45.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466523951632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466523951632384[0;39m ==> Parameters: 
2022-04-18 20:46:45.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466523951632384[0;39m <==    Updates: 0
2022-04-18 20:46:45.100 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466523951632384[0;39m 生成今日电子书快照结束，耗时：95毫秒
2022-04-18 20:46:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466544906375168[0;39m 生成今日电子书快照开始
2022-04-18 20:46:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466544906375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466544906375168[0;39m ==> Parameters: 
2022-04-18 20:46:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466544906375168[0;39m <==    Updates: 0
2022-04-18 20:46:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466544906375168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:46:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466565894672384[0;39m 生成今日电子书快照开始
2022-04-18 20:46:55.144 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466565894672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:46:55.144 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466565894672384[0;39m ==> Parameters: 
2022-04-18 20:46:55.181 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466565894672384[0;39m <==    Updates: 0
2022-04-18 20:46:55.181 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466565894672384[0;39m 生成今日电子书快照结束，耗时：176毫秒
2022-04-18 20:47:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466586870386688[0;39m 生成今日电子书快照开始
2022-04-18 20:47:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466586870386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466586870386688[0;39m ==> Parameters: 
2022-04-18 20:47:00.373 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466586870386688[0;39m <==    Updates: 0
2022-04-18 20:47:00.373 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466586870386688[0;39m 生成今日电子书快照结束，耗时：368毫秒
2022-04-18 20:47:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466607837712384[0;39m 生成今日电子书快照开始
2022-04-18 20:47:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466607837712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466607837712384[0;39m ==> Parameters: 
2022-04-18 20:47:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466607837712384[0;39m <==    Updates: 0
2022-04-18 20:47:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466607837712384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:47:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466608089370624[0;39m start updating Ebook doc
2022-04-18 20:47:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466608089370624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:47:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466608089370624[0;39m ==> Parameters: 
2022-04-18 20:47:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466608089370624[0;39m <==    Updates: 1
2022-04-18 20:47:05.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466608089370624[0;39m update ends, take 44 millisecs
2022-04-18 20:47:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466628805038080[0;39m 生成今日电子书快照开始
2022-04-18 20:47:10.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466628805038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:10.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466628805038080[0;39m ==> Parameters: 
2022-04-18 20:47:10.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466628805038080[0;39m <==    Updates: 0
2022-04-18 20:47:10.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466628805038080[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-18 20:47:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466649784946688[0;39m 生成今日电子书快照开始
2022-04-18 20:47:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466649784946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466649784946688[0;39m ==> Parameters: 
2022-04-18 20:47:15.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466649784946688[0;39m <==    Updates: 0
2022-04-18 20:47:15.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466649784946688[0;39m 生成今日电子书快照结束，耗时：99毫秒
2022-04-18 20:47:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466670752272384[0;39m 生成今日电子书快照开始
2022-04-18 20:47:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466670752272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466670752272384[0;39m ==> Parameters: 
2022-04-18 20:47:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466670752272384[0;39m <==    Updates: 0
2022-04-18 20:47:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466670752272384[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 20:47:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466691719598080[0;39m 生成今日电子书快照开始
2022-04-18 20:47:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466691719598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466691719598080[0;39m ==> Parameters: 
2022-04-18 20:47:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466691719598080[0;39m <==    Updates: 0
2022-04-18 20:47:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466691719598080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:47:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466712695312384[0;39m 生成今日电子书快照开始
2022-04-18 20:47:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466712695312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466712695312384[0;39m ==> Parameters: 
2022-04-18 20:47:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466712695312384[0;39m <==    Updates: 0
2022-04-18 20:47:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466712695312384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 20:47:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466733662638080[0;39m start updating Ebook doc
2022-04-18 20:47:35.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466733662638080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:47:35.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466733662638080[0;39m ==> Parameters: 
2022-04-18 20:47:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466733662638080[0;39m <==    Updates: 1
2022-04-18 20:47:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466733662638080[0;39m update ends, take 72 millisecs
2022-04-18 20:47:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466733968822272[0;39m 生成今日电子书快照开始
2022-04-18 20:47:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466733968822272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466733968822272[0;39m ==> Parameters: 
2022-04-18 20:47:35.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466733968822272[0;39m <==    Updates: 0
2022-04-18 20:47:35.114 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466733968822272[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 20:47:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466754642546688[0;39m 生成今日电子书快照开始
2022-04-18 20:47:40.239 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466754642546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:40.239 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466754642546688[0;39m ==> Parameters: 
2022-04-18 20:47:40.282 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466754642546688[0;39m <==    Updates: 0
2022-04-18 20:47:40.282 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466754642546688[0;39m 生成今日电子书快照结束，耗时：277毫秒
2022-04-18 20:47:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466775614066688[0;39m 生成今日电子书快照开始
2022-04-18 20:47:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466775614066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466775614066688[0;39m ==> Parameters: 
2022-04-18 20:47:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466775614066688[0;39m <==    Updates: 0
2022-04-18 20:47:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466775614066688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:47:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466796581392384[0;39m 生成今日电子书快照开始
2022-04-18 20:47:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466796581392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466796581392384[0;39m ==> Parameters: 
2022-04-18 20:47:50.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466796581392384[0;39m <==    Updates: 0
2022-04-18 20:47:50.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466796581392384[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 20:47:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466817548718080[0;39m 生成今日电子书快照开始
2022-04-18 20:47:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466817548718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:47:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466817548718080[0;39m ==> Parameters: 
2022-04-18 20:47:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466817548718080[0;39m <==    Updates: 0
2022-04-18 20:47:55.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466817548718080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 20:48:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466838520238080[0;39m 生成今日电子书快照开始
2022-04-18 20:48:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466838520238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466838520238080[0;39m ==> Parameters: 
2022-04-18 20:48:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466838520238080[0;39m <==    Updates: 0
2022-04-18 20:48:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466838520238080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:48:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466859491758080[0;39m start updating Ebook doc
2022-04-18 20:48:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466859491758080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:48:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466859491758080[0;39m ==> Parameters: 
2022-04-18 20:48:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466859491758080[0;39m <==    Updates: 1
2022-04-18 20:48:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466859491758080[0;39m update ends, take 55 millisecs
2022-04-18 20:48:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466859722444800[0;39m 生成今日电子书快照开始
2022-04-18 20:48:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466859722444800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466859722444800[0;39m ==> Parameters: 
2022-04-18 20:48:05.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466859722444800[0;39m <==    Updates: 0
2022-04-18 20:48:05.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466859722444800[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 20:48:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466880467472384[0;39m 生成今日电子书快照开始
2022-04-18 20:48:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466880467472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466880467472384[0;39m ==> Parameters: 
2022-04-18 20:48:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466880467472384[0;39m <==    Updates: 0
2022-04-18 20:48:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466880467472384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:48:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466901434798080[0;39m 生成今日电子书快照开始
2022-04-18 20:48:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466901434798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466901434798080[0;39m ==> Parameters: 
2022-04-18 20:48:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466901434798080[0;39m <==    Updates: 0
2022-04-18 20:48:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466901434798080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:48:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466922410512384[0;39m 生成今日电子书快照开始
2022-04-18 20:48:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466922410512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466922410512384[0;39m ==> Parameters: 
2022-04-18 20:48:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466922410512384[0;39m <==    Updates: 0
2022-04-18 20:48:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466922410512384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:48:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466943386226688[0;39m 生成今日电子书快照开始
2022-04-18 20:48:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466943386226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466943386226688[0;39m ==> Parameters: 
2022-04-18 20:48:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466943386226688[0;39m <==    Updates: 0
2022-04-18 20:48:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466943386226688[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:48:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466964345163776[0;39m 生成今日电子书快照开始
2022-04-18 20:48:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466964345163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466964345163776[0;39m ==> Parameters: 
2022-04-18 20:48:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466964345163776[0;39m <==    Updates: 0
2022-04-18 20:48:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466964345163776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:48:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171466985320878080[0;39m start updating Ebook doc
2022-04-18 20:48:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466985320878080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:48:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466985320878080[0;39m ==> Parameters: 
2022-04-18 20:48:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171466985320878080[0;39m <==    Updates: 1
2022-04-18 20:48:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171466985320878080[0;39m update ends, take 57 millisecs
2022-04-18 20:48:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171466985564147712[0;39m 生成今日电子书快照开始
2022-04-18 20:48:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466985564147712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466985564147712[0;39m ==> Parameters: 
2022-04-18 20:48:35.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171466985564147712[0;39m <==    Updates: 0
2022-04-18 20:48:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171466985564147712[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 20:48:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467006292398080[0;39m 生成今日电子书快照开始
2022-04-18 20:48:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467006292398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467006292398080[0;39m ==> Parameters: 
2022-04-18 20:48:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467006292398080[0;39m <==    Updates: 0
2022-04-18 20:48:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467006292398080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:48:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467027268112384[0;39m 生成今日电子书快照开始
2022-04-18 20:48:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467027268112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467027268112384[0;39m ==> Parameters: 
2022-04-18 20:48:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467027268112384[0;39m <==    Updates: 0
2022-04-18 20:48:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467027268112384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:48:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467048239632384[0;39m 生成今日电子书快照开始
2022-04-18 20:48:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467048239632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467048239632384[0;39m ==> Parameters: 
2022-04-18 20:48:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467048239632384[0;39m <==    Updates: 0
2022-04-18 20:48:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467048239632384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:48:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467069215346688[0;39m 生成今日电子书快照开始
2022-04-18 20:48:55.199 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467069215346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:48:55.199 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467069215346688[0;39m ==> Parameters: 
2022-04-18 20:48:55.249 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467069215346688[0;39m <==    Updates: 0
2022-04-18 20:48:55.249 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467069215346688[0;39m 生成今日电子书快照结束，耗时：244毫秒
2022-04-18 20:49:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467090178478080[0;39m 生成今日电子书快照开始
2022-04-18 20:49:00.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467090178478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467090178478080[0;39m ==> Parameters: 
2022-04-18 20:49:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467090178478080[0;39m <==    Updates: 0
2022-04-18 20:49:00.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467090178478080[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 20:49:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467111154192384[0;39m start updating Ebook doc
2022-04-18 20:49:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467111154192384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:49:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467111154192384[0;39m ==> Parameters: 
2022-04-18 20:49:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467111154192384[0;39m <==    Updates: 1
2022-04-18 20:49:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467111154192384[0;39m update ends, take 53 millisecs
2022-04-18 20:49:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467111380684800[0;39m 生成今日电子书快照开始
2022-04-18 20:49:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467111380684800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467111380684800[0;39m ==> Parameters: 
2022-04-18 20:49:05.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467111380684800[0;39m <==    Updates: 0
2022-04-18 20:49:05.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467111380684800[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 20:49:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467132121518080[0;39m 生成今日电子书快照开始
2022-04-18 20:49:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467132121518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467132121518080[0;39m ==> Parameters: 
2022-04-18 20:49:10.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467132121518080[0;39m <==    Updates: 0
2022-04-18 20:49:10.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467132121518080[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 20:49:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467153097232384[0;39m 生成今日电子书快照开始
2022-04-18 20:49:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467153097232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467153097232384[0;39m ==> Parameters: 
2022-04-18 20:49:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467153097232384[0;39m <==    Updates: 0
2022-04-18 20:49:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467153097232384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:49:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467174068752384[0;39m 生成今日电子书快照开始
2022-04-18 20:49:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467174068752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467174068752384[0;39m ==> Parameters: 
2022-04-18 20:49:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467174068752384[0;39m <==    Updates: 0
2022-04-18 20:49:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467174068752384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:49:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467195023495168[0;39m 生成今日电子书快照开始
2022-04-18 20:49:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467195023495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467195023495168[0;39m ==> Parameters: 
2022-04-18 20:49:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467195023495168[0;39m <==    Updates: 0
2022-04-18 20:49:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467195023495168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:49:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467216011792384[0;39m 生成今日电子书快照开始
2022-04-18 20:49:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467216011792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467216011792384[0;39m ==> Parameters: 
2022-04-18 20:49:30.225 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467216011792384[0;39m <==    Updates: 0
2022-04-18 20:49:30.226 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467216011792384[0;39m 生成今日电子书快照结束，耗时：222毫秒
2022-04-18 20:49:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467236983312384[0;39m start updating Ebook doc
2022-04-18 20:49:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467236983312384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:49:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467236983312384[0;39m ==> Parameters: 
2022-04-18 20:49:35.086 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467236983312384[0;39m <==    Updates: 1
2022-04-18 20:49:35.086 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467236983312384[0;39m update ends, take 82 millisecs
2022-04-18 20:49:35.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467237327245312[0;39m 生成今日电子书快照开始
2022-04-18 20:49:35.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467237327245312[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:35.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467237327245312[0;39m ==> Parameters: 
2022-04-18 20:49:35.157 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467237327245312[0;39m <==    Updates: 0
2022-04-18 20:49:35.157 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467237327245312[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 20:49:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467257950638080[0;39m 生成今日电子书快照开始
2022-04-18 20:49:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467257950638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467257950638080[0;39m ==> Parameters: 
2022-04-18 20:49:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467257950638080[0;39m <==    Updates: 0
2022-04-18 20:49:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467257950638080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:49:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467278922158080[0;39m 生成今日电子书快照开始
2022-04-18 20:49:45.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467278922158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467278922158080[0;39m ==> Parameters: 
2022-04-18 20:49:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467278922158080[0;39m <==    Updates: 0
2022-04-18 20:49:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467278922158080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:49:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467299902066688[0;39m 生成今日电子书快照开始
2022-04-18 20:49:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467299902066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467299902066688[0;39m ==> Parameters: 
2022-04-18 20:49:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467299902066688[0;39m <==    Updates: 0
2022-04-18 20:49:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467299902066688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:49:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467320869392384[0;39m 生成今日电子书快照开始
2022-04-18 20:49:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467320869392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:49:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467320869392384[0;39m ==> Parameters: 
2022-04-18 20:49:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467320869392384[0;39m <==    Updates: 0
2022-04-18 20:49:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467320869392384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:50:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467341836718080[0;39m 生成今日电子书快照开始
2022-04-18 20:50:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467341836718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467341836718080[0;39m ==> Parameters: 
2022-04-18 20:50:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467341836718080[0;39m <==    Updates: 0
2022-04-18 20:50:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467341836718080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:50:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467362812432384[0;39m start updating Ebook doc
2022-04-18 20:50:05.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467362812432384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:50:05.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467362812432384[0;39m ==> Parameters: 
2022-04-18 20:50:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467362812432384[0;39m <==    Updates: 1
2022-04-18 20:50:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467362812432384[0;39m update ends, take 51 millisecs
2022-04-18 20:50:05.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467363030536192[0;39m 生成今日电子书快照开始
2022-04-18 20:50:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467363030536192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467363030536192[0;39m ==> Parameters: 
2022-04-18 20:50:05.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467363030536192[0;39m <==    Updates: 0
2022-04-18 20:50:05.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467363030536192[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 20:50:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467383788146688[0;39m 生成今日电子书快照开始
2022-04-18 20:50:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467383788146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467383788146688[0;39m ==> Parameters: 
2022-04-18 20:50:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467383788146688[0;39m <==    Updates: 0
2022-04-18 20:50:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467383788146688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:50:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467404759666688[0;39m 生成今日电子书快照开始
2022-04-18 20:50:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467404759666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467404759666688[0;39m ==> Parameters: 
2022-04-18 20:50:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467404759666688[0;39m <==    Updates: 0
2022-04-18 20:50:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467404759666688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 20:50:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467425722798080[0;39m 生成今日电子书快照开始
2022-04-18 20:50:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467425722798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467425722798080[0;39m ==> Parameters: 
2022-04-18 20:50:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467425722798080[0;39m <==    Updates: 0
2022-04-18 20:50:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467425722798080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 20:50:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467446694318080[0;39m 生成今日电子书快照开始
2022-04-18 20:50:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467446694318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467446694318080[0;39m ==> Parameters: 
2022-04-18 20:50:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467446694318080[0;39m <==    Updates: 0
2022-04-18 20:50:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467446694318080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 20:50:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467467665838080[0;39m 生成今日电子书快照开始
2022-04-18 20:50:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467467665838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467467665838080[0;39m ==> Parameters: 
2022-04-18 20:50:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467467665838080[0;39m <==    Updates: 0
2022-04-18 20:50:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467467665838080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:50:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467488628969472[0;39m start updating Ebook doc
2022-04-18 20:50:35.015 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467488628969472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:50:35.015 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467488628969472[0;39m ==> Parameters: 
2022-04-18 20:50:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467488628969472[0;39m <==    Updates: 1
2022-04-18 20:50:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467488628969472[0;39m update ends, take 54 millisecs
2022-04-18 20:50:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467488855461888[0;39m 生成今日电子书快照开始
2022-04-18 20:50:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467488855461888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467488855461888[0;39m ==> Parameters: 
2022-04-18 20:50:35.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467488855461888[0;39m <==    Updates: 0
2022-04-18 20:50:35.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467488855461888[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 20:50:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467509608878080[0;39m 生成今日电子书快照开始
2022-04-18 20:50:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467509608878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467509608878080[0;39m ==> Parameters: 
2022-04-18 20:50:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467509608878080[0;39m <==    Updates: 0
2022-04-18 20:50:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467509608878080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:50:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467530584592384[0;39m 生成今日电子书快照开始
2022-04-18 20:50:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467530584592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467530584592384[0;39m ==> Parameters: 
2022-04-18 20:50:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467530584592384[0;39m <==    Updates: 0
2022-04-18 20:50:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467530584592384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:50:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467551556112384[0;39m 生成今日电子书快照开始
2022-04-18 20:50:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467551556112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467551556112384[0;39m ==> Parameters: 
2022-04-18 20:50:50.205 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467551556112384[0;39m <==    Updates: 0
2022-04-18 20:50:50.205 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467551556112384[0;39m 生成今日电子书快照结束，耗时：200毫秒
2022-04-18 20:50:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467572527632384[0;39m 生成今日电子书快照开始
2022-04-18 20:50:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467572527632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:50:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467572527632384[0;39m ==> Parameters: 
2022-04-18 20:50:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467572527632384[0;39m <==    Updates: 0
2022-04-18 20:50:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467572527632384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:51:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467593486569472[0;39m 生成今日电子书快照开始
2022-04-18 20:51:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467593486569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467593486569472[0;39m ==> Parameters: 
2022-04-18 20:51:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467593486569472[0;39m <==    Updates: 0
2022-04-18 20:51:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467593486569472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:51:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467614470672384[0;39m 生成今日电子书快照开始
2022-04-18 20:51:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467614470672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467614470672384[0;39m ==> Parameters: 
2022-04-18 20:51:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467614470672384[0;39m <==    Updates: 0
2022-04-18 20:51:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467614470672384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:51:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467614730719232[0;39m start updating Ebook doc
2022-04-18 20:51:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467614730719232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:51:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467614730719232[0;39m ==> Parameters: 
2022-04-18 20:51:05.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467614730719232[0;39m <==    Updates: 1
2022-04-18 20:51:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467614730719232[0;39m update ends, take 34 millisecs
2022-04-18 20:51:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467635446386688[0;39m 生成今日电子书快照开始
2022-04-18 20:51:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467635446386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467635446386688[0;39m ==> Parameters: 
2022-04-18 20:51:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467635446386688[0;39m <==    Updates: 0
2022-04-18 20:51:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467635446386688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:51:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467656417906688[0;39m 生成今日电子书快照开始
2022-04-18 20:51:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467656417906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467656417906688[0;39m ==> Parameters: 
2022-04-18 20:51:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467656417906688[0;39m <==    Updates: 0
2022-04-18 20:51:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467656417906688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 20:51:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467677385232384[0;39m 生成今日电子书快照开始
2022-04-18 20:51:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467677385232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467677385232384[0;39m ==> Parameters: 
2022-04-18 20:51:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467677385232384[0;39m <==    Updates: 0
2022-04-18 20:51:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467677385232384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 20:51:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467698356752384[0;39m 生成今日电子书快照开始
2022-04-18 20:51:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467698356752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467698356752384[0;39m ==> Parameters: 
2022-04-18 20:51:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467698356752384[0;39m <==    Updates: 0
2022-04-18 20:51:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467698356752384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:51:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467719328272384[0;39m 生成今日电子书快照开始
2022-04-18 20:51:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467719328272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467719328272384[0;39m ==> Parameters: 
2022-04-18 20:51:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467719328272384[0;39m <==    Updates: 0
2022-04-18 20:51:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467719328272384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:51:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467740295598080[0;39m start updating Ebook doc
2022-04-18 20:51:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467740295598080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:51:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467740295598080[0;39m ==> Parameters: 
2022-04-18 20:51:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467740295598080[0;39m <==    Updates: 1
2022-04-18 20:51:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467740295598080[0;39m update ends, take 50 millisecs
2022-04-18 20:51:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467740509507584[0;39m 生成今日电子书快照开始
2022-04-18 20:51:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467740509507584[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467740509507584[0;39m ==> Parameters: 
2022-04-18 20:51:35.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467740509507584[0;39m <==    Updates: 0
2022-04-18 20:51:35.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467740509507584[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 20:51:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467761271312384[0;39m 生成今日电子书快照开始
2022-04-18 20:51:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467761271312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467761271312384[0;39m ==> Parameters: 
2022-04-18 20:51:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467761271312384[0;39m <==    Updates: 0
2022-04-18 20:51:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467761271312384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:51:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467782242832384[0;39m 生成今日电子书快照开始
2022-04-18 20:51:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467782242832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467782242832384[0;39m ==> Parameters: 
2022-04-18 20:51:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467782242832384[0;39m <==    Updates: 0
2022-04-18 20:51:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467782242832384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 20:51:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467803218546688[0;39m 生成今日电子书快照开始
2022-04-18 20:51:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467803218546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467803218546688[0;39m ==> Parameters: 
2022-04-18 20:51:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467803218546688[0;39m <==    Updates: 0
2022-04-18 20:51:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467803218546688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:51:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467824169095168[0;39m 生成今日电子书快照开始
2022-04-18 20:51:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467824169095168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:51:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467824169095168[0;39m ==> Parameters: 
2022-04-18 20:51:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467824169095168[0;39m <==    Updates: 0
2022-04-18 20:51:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467824169095168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:52:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467845157392384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467845157392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467845157392384[0;39m ==> Parameters: 
2022-04-18 20:52:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467845157392384[0;39m <==    Updates: 0
2022-04-18 20:52:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467845157392384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 20:52:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467866128912384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467866128912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467866128912384[0;39m ==> Parameters: 
2022-04-18 20:52:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467866128912384[0;39m <==    Updates: 0
2022-04-18 20:52:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467866128912384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:52:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467866351210496[0;39m start updating Ebook doc
2022-04-18 20:52:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467866351210496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:52:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467866351210496[0;39m ==> Parameters: 
2022-04-18 20:52:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467866351210496[0;39m <==    Updates: 1
2022-04-18 20:52:05.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467866351210496[0;39m update ends, take 36 millisecs
2022-04-18 20:52:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467887096238080[0;39m 生成今日电子书快照开始
2022-04-18 20:52:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467887096238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467887096238080[0;39m ==> Parameters: 
2022-04-18 20:52:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467887096238080[0;39m <==    Updates: 0
2022-04-18 20:52:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467887096238080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:52:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467908071952384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467908071952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467908071952384[0;39m ==> Parameters: 
2022-04-18 20:52:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467908071952384[0;39m <==    Updates: 0
2022-04-18 20:52:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467908071952384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 20:52:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467929043472384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467929043472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467929043472384[0;39m ==> Parameters: 
2022-04-18 20:52:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467929043472384[0;39m <==    Updates: 0
2022-04-18 20:52:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467929043472384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:52:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467950014992384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467950014992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467950014992384[0;39m ==> Parameters: 
2022-04-18 20:52:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467950014992384[0;39m <==    Updates: 0
2022-04-18 20:52:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467950014992384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:52:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467970982318080[0;39m 生成今日电子书快照开始
2022-04-18 20:52:30.182 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467970982318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:30.182 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467970982318080[0;39m ==> Parameters: 
2022-04-18 20:52:30.221 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467970982318080[0;39m <==    Updates: 0
2022-04-18 20:52:30.221 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467970982318080[0;39m 生成今日电子书快照结束，耗时：217毫秒
2022-04-18 20:52:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171467991945449472[0;39m 生成今日电子书快照开始
2022-04-18 20:52:35.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467991945449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:35.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467991945449472[0;39m ==> Parameters: 
2022-04-18 20:52:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171467991945449472[0;39m <==    Updates: 0
2022-04-18 20:52:35.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171467991945449472[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 20:52:35.079 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171467992272605184[0;39m start updating Ebook doc
2022-04-18 20:52:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467992272605184[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:52:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467992272605184[0;39m ==> Parameters: 
2022-04-18 20:52:35.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171467992272605184[0;39m <==    Updates: 1
2022-04-18 20:52:35.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171467992272605184[0;39m update ends, take 36 millisecs
2022-04-18 20:52:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468012929552384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:40.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468012929552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:40.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468012929552384[0;39m ==> Parameters: 
2022-04-18 20:52:40.207 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468012929552384[0;39m <==    Updates: 0
2022-04-18 20:52:40.207 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468012929552384[0;39m 生成今日电子书快照结束，耗时：202毫秒
2022-04-18 20:52:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468033901072384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468033901072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468033901072384[0;39m ==> Parameters: 
2022-04-18 20:52:45.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468033901072384[0;39m <==    Updates: 0
2022-04-18 20:52:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468033901072384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 20:52:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468054872592384[0;39m 生成今日电子书快照开始
2022-04-18 20:52:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468054872592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468054872592384[0;39m ==> Parameters: 
2022-04-18 20:52:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468054872592384[0;39m <==    Updates: 0
2022-04-18 20:52:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468054872592384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:52:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468075848306688[0;39m 生成今日电子书快照开始
2022-04-18 20:52:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468075848306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:52:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468075848306688[0;39m ==> Parameters: 
2022-04-18 20:52:55.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468075848306688[0;39m <==    Updates: 0
2022-04-18 20:52:55.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468075848306688[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-18 20:53:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468096815632384[0;39m 生成今日电子书快照开始
2022-04-18 20:53:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468096815632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468096815632384[0;39m ==> Parameters: 
2022-04-18 20:53:00.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468096815632384[0;39m <==    Updates: 0
2022-04-18 20:53:00.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468096815632384[0;39m 生成今日电子书快照结束，耗时：95毫秒
2022-04-18 20:53:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468117782958080[0;39m start updating Ebook doc
2022-04-18 20:53:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468117782958080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:53:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468117782958080[0;39m ==> Parameters: 
2022-04-18 20:53:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468117782958080[0;39m <==    Updates: 1
2022-04-18 20:53:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468117782958080[0;39m update ends, take 61 millisecs
2022-04-18 20:53:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468118043004928[0;39m 生成今日电子书快照开始
2022-04-18 20:53:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468118043004928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468118043004928[0;39m ==> Parameters: 
2022-04-18 20:53:05.323 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468118043004928[0;39m <==    Updates: 0
2022-04-18 20:53:05.323 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468118043004928[0;39m 生成今日电子书快照结束，耗时：258毫秒
2022-04-18 20:53:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468138758672384[0;39m 生成今日电子书快照开始
2022-04-18 20:53:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468138758672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468138758672384[0;39m ==> Parameters: 
2022-04-18 20:53:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468138758672384[0;39m <==    Updates: 0
2022-04-18 20:53:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468138758672384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:53:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468159725998080[0;39m 生成今日电子书快照开始
2022-04-18 20:53:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468159725998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468159725998080[0;39m ==> Parameters: 
2022-04-18 20:53:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468159725998080[0;39m <==    Updates: 0
2022-04-18 20:53:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468159725998080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:53:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468180697518080[0;39m 生成今日电子书快照开始
2022-04-18 20:53:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468180697518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468180697518080[0;39m ==> Parameters: 
2022-04-18 20:53:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468180697518080[0;39m <==    Updates: 0
2022-04-18 20:53:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468180697518080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:53:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468201669038080[0;39m 生成今日电子书快照开始
2022-04-18 20:53:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468201669038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468201669038080[0;39m ==> Parameters: 
2022-04-18 20:53:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468201669038080[0;39m <==    Updates: 0
2022-04-18 20:53:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468201669038080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:53:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468222644752384[0;39m 生成今日电子书快照开始
2022-04-18 20:53:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468222644752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468222644752384[0;39m ==> Parameters: 
2022-04-18 20:53:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468222644752384[0;39m <==    Updates: 0
2022-04-18 20:53:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468222644752384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:53:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468243612078080[0;39m 生成今日电子书快照开始
2022-04-18 20:53:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468243612078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468243612078080[0;39m ==> Parameters: 
2022-04-18 20:53:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468243612078080[0;39m <==    Updates: 0
2022-04-18 20:53:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468243612078080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:53:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468243842764800[0;39m start updating Ebook doc
2022-04-18 20:53:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468243842764800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:53:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468243842764800[0;39m ==> Parameters: 
2022-04-18 20:53:35.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468243842764800[0;39m <==    Updates: 1
2022-04-18 20:53:35.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468243842764800[0;39m update ends, take 39 millisecs
2022-04-18 20:53:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468264579403776[0;39m 生成今日电子书快照开始
2022-04-18 20:53:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468264579403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468264579403776[0;39m ==> Parameters: 
2022-04-18 20:53:40.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468264579403776[0;39m <==    Updates: 0
2022-04-18 20:53:40.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468264579403776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:53:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468285559312384[0;39m 生成今日电子书快照开始
2022-04-18 20:53:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468285559312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468285559312384[0;39m ==> Parameters: 
2022-04-18 20:53:45.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468285559312384[0;39m <==    Updates: 0
2022-04-18 20:53:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468285559312384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:53:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468306530832384[0;39m 生成今日电子书快照开始
2022-04-18 20:53:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468306530832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468306530832384[0;39m ==> Parameters: 
2022-04-18 20:53:50.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468306530832384[0;39m <==    Updates: 0
2022-04-18 20:53:50.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468306530832384[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 20:53:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468327498158080[0;39m 生成今日电子书快照开始
2022-04-18 20:53:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468327498158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:53:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468327498158080[0;39m ==> Parameters: 
2022-04-18 20:53:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468327498158080[0;39m <==    Updates: 0
2022-04-18 20:53:55.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468327498158080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:54:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468348469678080[0;39m 生成今日电子书快照开始
2022-04-18 20:54:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468348469678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468348469678080[0;39m ==> Parameters: 
2022-04-18 20:54:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468348469678080[0;39m <==    Updates: 0
2022-04-18 20:54:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468348469678080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:54:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468369445392384[0;39m 生成今日电子书快照开始
2022-04-18 20:54:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468369445392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468369445392384[0;39m ==> Parameters: 
2022-04-18 20:54:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468369445392384[0;39m <==    Updates: 0
2022-04-18 20:54:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468369445392384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:54:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468369705439232[0;39m start updating Ebook doc
2022-04-18 20:54:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468369705439232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:54:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468369705439232[0;39m ==> Parameters: 
2022-04-18 20:54:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468369705439232[0;39m <==    Updates: 1
2022-04-18 20:54:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468369705439232[0;39m update ends, take 39 millisecs
2022-04-18 20:54:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468390421106688[0;39m 生成今日电子书快照开始
2022-04-18 20:54:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468390421106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468390421106688[0;39m ==> Parameters: 
2022-04-18 20:54:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468390421106688[0;39m <==    Updates: 0
2022-04-18 20:54:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468390421106688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:54:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468411388432384[0;39m 生成今日电子书快照开始
2022-04-18 20:54:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468411388432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468411388432384[0;39m ==> Parameters: 
2022-04-18 20:54:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468411388432384[0;39m <==    Updates: 0
2022-04-18 20:54:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468411388432384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 20:54:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468432359952384[0;39m 生成今日电子书快照开始
2022-04-18 20:54:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468432359952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468432359952384[0;39m ==> Parameters: 
2022-04-18 20:54:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468432359952384[0;39m <==    Updates: 0
2022-04-18 20:54:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468432359952384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:54:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468453327278080[0;39m 生成今日电子书快照开始
2022-04-18 20:54:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468453327278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468453327278080[0;39m ==> Parameters: 
2022-04-18 20:54:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468453327278080[0;39m <==    Updates: 0
2022-04-18 20:54:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468453327278080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 20:54:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468474298798080[0;39m 生成今日电子书快照开始
2022-04-18 20:54:30.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468474298798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:30.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468474298798080[0;39m ==> Parameters: 
2022-04-18 20:54:30.281 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468474298798080[0;39m <==    Updates: 0
2022-04-18 20:54:30.282 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468474298798080[0;39m 生成今日电子书快照结束，耗时：279毫秒
2022-04-18 20:54:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468495274512384[0;39m 生成今日电子书快照开始
2022-04-18 20:54:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468495274512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468495274512384[0;39m ==> Parameters: 
2022-04-18 20:54:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468495274512384[0;39m <==    Updates: 0
2022-04-18 20:54:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468495274512384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:54:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468495542947840[0;39m start updating Ebook doc
2022-04-18 20:54:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468495542947840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:54:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468495542947840[0;39m ==> Parameters: 
2022-04-18 20:54:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468495542947840[0;39m <==    Updates: 1
2022-04-18 20:54:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468495542947840[0;39m update ends, take 40 millisecs
2022-04-18 20:54:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468516246032384[0;39m 生成今日电子书快照开始
2022-04-18 20:54:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468516246032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468516246032384[0;39m ==> Parameters: 
2022-04-18 20:54:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468516246032384[0;39m <==    Updates: 0
2022-04-18 20:54:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468516246032384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 20:54:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468537221746688[0;39m 生成今日电子书快照开始
2022-04-18 20:54:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468537221746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468537221746688[0;39m ==> Parameters: 
2022-04-18 20:54:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468537221746688[0;39m <==    Updates: 0
2022-04-18 20:54:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468537221746688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:54:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468558189072384[0;39m 生成今日电子书快照开始
2022-04-18 20:54:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468558189072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468558189072384[0;39m ==> Parameters: 
2022-04-18 20:54:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468558189072384[0;39m <==    Updates: 0
2022-04-18 20:54:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468558189072384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:54:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468579156398080[0;39m 生成今日电子书快照开始
2022-04-18 20:54:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468579156398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:54:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468579156398080[0;39m ==> Parameters: 
2022-04-18 20:54:55.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468579156398080[0;39m <==    Updates: 0
2022-04-18 20:54:55.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468579156398080[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 20:55:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468600132112384[0;39m 生成今日电子书快照开始
2022-04-18 20:55:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468600132112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468600132112384[0;39m ==> Parameters: 
2022-04-18 20:55:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468600132112384[0;39m <==    Updates: 0
2022-04-18 20:55:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468600132112384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:55:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468621116215296[0;39m 生成今日电子书快照开始
2022-04-18 20:55:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468621116215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468621116215296[0;39m ==> Parameters: 
2022-04-18 20:55:05.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468621116215296[0;39m <==    Updates: 0
2022-04-18 20:55:05.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468621116215296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 20:55:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468621397233664[0;39m start updating Ebook doc
2022-04-18 20:55:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468621397233664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:55:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468621397233664[0;39m ==> Parameters: 
2022-04-18 20:55:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468621397233664[0;39m <==    Updates: 1
2022-04-18 20:55:05.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468621397233664[0;39m update ends, take 39 millisecs
2022-04-18 20:55:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468642079346688[0;39m 生成今日电子书快照开始
2022-04-18 20:55:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468642079346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468642079346688[0;39m ==> Parameters: 
2022-04-18 20:55:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468642079346688[0;39m <==    Updates: 0
2022-04-18 20:55:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468642079346688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:55:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468663038283776[0;39m 生成今日电子书快照开始
2022-04-18 20:55:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468663038283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468663038283776[0;39m ==> Parameters: 
2022-04-18 20:55:15.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468663038283776[0;39m <==    Updates: 0
2022-04-18 20:55:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468663038283776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:55:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468684009803776[0;39m 生成今日电子书快照开始
2022-04-18 20:55:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468684009803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468684009803776[0;39m ==> Parameters: 
2022-04-18 20:55:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468684009803776[0;39m <==    Updates: 0
2022-04-18 20:55:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468684009803776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:55:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468704981323776[0;39m 生成今日电子书快照开始
2022-04-18 20:55:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468704981323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468704981323776[0;39m ==> Parameters: 
2022-04-18 20:55:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468704981323776[0;39m <==    Updates: 0
2022-04-18 20:55:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468704981323776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:55:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468725957038080[0;39m 生成今日电子书快照开始
2022-04-18 20:55:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468725957038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468725957038080[0;39m ==> Parameters: 
2022-04-18 20:55:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468725957038080[0;39m <==    Updates: 0
2022-04-18 20:55:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468725957038080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 20:55:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468746932752384[0;39m start updating Ebook doc
2022-04-18 20:55:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468746932752384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:55:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468746932752384[0;39m ==> Parameters: 
2022-04-18 20:55:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468746932752384[0;39m <==    Updates: 1
2022-04-18 20:55:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468746932752384[0;39m update ends, take 59 millisecs
2022-04-18 20:55:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468747180216320[0;39m 生成今日电子书快照开始
2022-04-18 20:55:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468747180216320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468747180216320[0;39m ==> Parameters: 
2022-04-18 20:55:35.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468747180216320[0;39m <==    Updates: 0
2022-04-18 20:55:35.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468747180216320[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 20:55:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468767904272384[0;39m 生成今日电子书快照开始
2022-04-18 20:55:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468767904272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468767904272384[0;39m ==> Parameters: 
2022-04-18 20:55:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468767904272384[0;39m <==    Updates: 0
2022-04-18 20:55:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468767904272384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 20:55:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468788875792384[0;39m 生成今日电子书快照开始
2022-04-18 20:55:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468788875792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468788875792384[0;39m ==> Parameters: 
2022-04-18 20:55:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468788875792384[0;39m <==    Updates: 0
2022-04-18 20:55:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468788875792384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:55:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468809847312384[0;39m 生成今日电子书快照开始
2022-04-18 20:55:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468809847312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468809847312384[0;39m ==> Parameters: 
2022-04-18 20:55:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468809847312384[0;39m <==    Updates: 0
2022-04-18 20:55:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468809847312384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:55:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468830823026688[0;39m 生成今日电子书快照开始
2022-04-18 20:55:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468830823026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:55:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468830823026688[0;39m ==> Parameters: 
2022-04-18 20:55:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468830823026688[0;39m <==    Updates: 0
2022-04-18 20:55:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468830823026688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:56:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468851786158080[0;39m 生成今日电子书快照开始
2022-04-18 20:56:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468851786158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468851786158080[0;39m ==> Parameters: 
2022-04-18 20:56:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468851786158080[0;39m <==    Updates: 0
2022-04-18 20:56:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468851786158080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:56:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468872761872384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468872761872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468872761872384[0;39m ==> Parameters: 
2022-04-18 20:56:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468872761872384[0;39m <==    Updates: 0
2022-04-18 20:56:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468872761872384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:56:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468873026113536[0;39m start updating Ebook doc
2022-04-18 20:56:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468873026113536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:56:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468873026113536[0;39m ==> Parameters: 
2022-04-18 20:56:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468873026113536[0;39m <==    Updates: 1
2022-04-18 20:56:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468873026113536[0;39m update ends, take 37 millisecs
2022-04-18 20:56:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468893733392384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468893733392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468893733392384[0;39m ==> Parameters: 
2022-04-18 20:56:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468893733392384[0;39m <==    Updates: 0
2022-04-18 20:56:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468893733392384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 20:56:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468914704912384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468914704912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468914704912384[0;39m ==> Parameters: 
2022-04-18 20:56:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468914704912384[0;39m <==    Updates: 0
2022-04-18 20:56:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468914704912384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:56:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468935680626688[0;39m 生成今日电子书快照开始
2022-04-18 20:56:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468935680626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468935680626688[0;39m ==> Parameters: 
2022-04-18 20:56:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468935680626688[0;39m <==    Updates: 0
2022-04-18 20:56:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468935680626688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:56:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468956647952384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468956647952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468956647952384[0;39m ==> Parameters: 
2022-04-18 20:56:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468956647952384[0;39m <==    Updates: 0
2022-04-18 20:56:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468956647952384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:56:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468977615278080[0;39m 生成今日电子书快照开始
2022-04-18 20:56:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468977615278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468977615278080[0;39m ==> Parameters: 
2022-04-18 20:56:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468977615278080[0;39m <==    Updates: 0
2022-04-18 20:56:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468977615278080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:56:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171468998595186688[0;39m 生成今日电子书快照开始
2022-04-18 20:56:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468998595186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468998595186688[0;39m ==> Parameters: 
2022-04-18 20:56:35.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171468998595186688[0;39m <==    Updates: 0
2022-04-18 20:56:35.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171468998595186688[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-18 20:56:35.089 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171468998947508224[0;39m start updating Ebook doc
2022-04-18 20:56:35.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468998947508224[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:56:35.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468998947508224[0;39m ==> Parameters: 
2022-04-18 20:56:35.135 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171468998947508224[0;39m <==    Updates: 1
2022-04-18 20:56:35.135 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171468998947508224[0;39m update ends, take 46 millisecs
2022-04-18 20:56:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469019562512384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469019562512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469019562512384[0;39m ==> Parameters: 
2022-04-18 20:56:40.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469019562512384[0;39m <==    Updates: 0
2022-04-18 20:56:40.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469019562512384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:56:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469040534032384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469040534032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469040534032384[0;39m ==> Parameters: 
2022-04-18 20:56:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469040534032384[0;39m <==    Updates: 0
2022-04-18 20:56:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469040534032384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:56:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469061497163776[0;39m 生成今日电子书快照开始
2022-04-18 20:56:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469061497163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469061497163776[0;39m ==> Parameters: 
2022-04-18 20:56:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469061497163776[0;39m <==    Updates: 0
2022-04-18 20:56:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469061497163776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:56:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469082477072384[0;39m 生成今日电子书快照开始
2022-04-18 20:56:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469082477072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:56:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469082477072384[0;39m ==> Parameters: 
2022-04-18 20:56:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469082477072384[0;39m <==    Updates: 0
2022-04-18 20:56:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469082477072384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:57:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469103444398080[0;39m 生成今日电子书快照开始
2022-04-18 20:57:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469103444398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469103444398080[0;39m ==> Parameters: 
2022-04-18 20:57:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469103444398080[0;39m <==    Updates: 0
2022-04-18 20:57:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469103444398080[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 20:57:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469124415918080[0;39m 生成今日电子书快照开始
2022-04-18 20:57:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469124415918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469124415918080[0;39m ==> Parameters: 
2022-04-18 20:57:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469124415918080[0;39m <==    Updates: 0
2022-04-18 20:57:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469124415918080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:57:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469124667576320[0;39m start updating Ebook doc
2022-04-18 20:57:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469124667576320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:57:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469124667576320[0;39m ==> Parameters: 
2022-04-18 20:57:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469124667576320[0;39m <==    Updates: 1
2022-04-18 20:57:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469124667576320[0;39m update ends, take 42 millisecs
2022-04-18 20:57:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469145391632384[0;39m 生成今日电子书快照开始
2022-04-18 20:57:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469145391632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469145391632384[0;39m ==> Parameters: 
2022-04-18 20:57:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469145391632384[0;39m <==    Updates: 0
2022-04-18 20:57:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469145391632384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 20:57:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469166363152384[0;39m 生成今日电子书快照开始
2022-04-18 20:57:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469166363152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469166363152384[0;39m ==> Parameters: 
2022-04-18 20:57:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469166363152384[0;39m <==    Updates: 0
2022-04-18 20:57:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469166363152384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:57:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469187326283776[0;39m 生成今日电子书快照开始
2022-04-18 20:57:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469187326283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469187326283776[0;39m ==> Parameters: 
2022-04-18 20:57:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469187326283776[0;39m <==    Updates: 0
2022-04-18 20:57:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469187326283776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 20:57:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469208306192384[0;39m 生成今日电子书快照开始
2022-04-18 20:57:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469208306192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469208306192384[0;39m ==> Parameters: 
2022-04-18 20:57:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469208306192384[0;39m <==    Updates: 0
2022-04-18 20:57:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469208306192384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 20:57:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469229273518080[0;39m 生成今日电子书快照开始
2022-04-18 20:57:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469229273518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469229273518080[0;39m ==> Parameters: 
2022-04-18 20:57:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469229273518080[0;39m <==    Updates: 0
2022-04-18 20:57:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469229273518080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:57:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469250240843776[0;39m 生成今日电子书快照开始
2022-04-18 20:57:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469250240843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469250240843776[0;39m ==> Parameters: 
2022-04-18 20:57:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469250240843776[0;39m <==    Updates: 0
2022-04-18 20:57:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469250240843776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:57:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469250484113408[0;39m start updating Ebook doc
2022-04-18 20:57:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469250484113408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:57:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469250484113408[0;39m ==> Parameters: 
2022-04-18 20:57:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469250484113408[0;39m <==    Updates: 1
2022-04-18 20:57:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469250484113408[0;39m update ends, take 38 millisecs
2022-04-18 20:57:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469271203975168[0;39m 生成今日电子书快照开始
2022-04-18 20:57:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469271203975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469271203975168[0;39m ==> Parameters: 
2022-04-18 20:57:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469271203975168[0;39m <==    Updates: 0
2022-04-18 20:57:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469271203975168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 20:57:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469292196466688[0;39m 生成今日电子书快照开始
2022-04-18 20:57:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469292196466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469292196466688[0;39m ==> Parameters: 
2022-04-18 20:57:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469292196466688[0;39m <==    Updates: 0
2022-04-18 20:57:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469292196466688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:57:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469313163792384[0;39m 生成今日电子书快照开始
2022-04-18 20:57:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469313163792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469313163792384[0;39m ==> Parameters: 
2022-04-18 20:57:50.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469313163792384[0;39m <==    Updates: 0
2022-04-18 20:57:50.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469313163792384[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 20:57:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469334122729472[0;39m 生成今日电子书快照开始
2022-04-18 20:57:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469334122729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:57:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469334122729472[0;39m ==> Parameters: 
2022-04-18 20:57:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469334122729472[0;39m <==    Updates: 0
2022-04-18 20:57:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469334122729472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 20:58:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469355102638080[0;39m 生成今日电子书快照开始
2022-04-18 20:58:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469355102638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469355102638080[0;39m ==> Parameters: 
2022-04-18 20:58:00.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469355102638080[0;39m <==    Updates: 0
2022-04-18 20:58:00.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469355102638080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:58:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469376074158080[0;39m start updating Ebook doc
2022-04-18 20:58:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469376074158080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:58:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469376074158080[0;39m ==> Parameters: 
2022-04-18 20:58:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469376074158080[0;39m <==    Updates: 1
2022-04-18 20:58:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469376074158080[0;39m update ends, take 63 millisecs
2022-04-18 20:58:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469376338399232[0;39m 生成今日电子书快照开始
2022-04-18 20:58:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469376338399232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469376338399232[0;39m ==> Parameters: 
2022-04-18 20:58:05.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469376338399232[0;39m <==    Updates: 0
2022-04-18 20:58:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469376338399232[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 20:58:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469397049872384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469397049872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469397049872384[0;39m ==> Parameters: 
2022-04-18 20:58:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469397049872384[0;39m <==    Updates: 0
2022-04-18 20:58:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469397049872384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 20:58:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469418017198080[0;39m 生成今日电子书快照开始
2022-04-18 20:58:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469418017198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469418017198080[0;39m ==> Parameters: 
2022-04-18 20:58:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469418017198080[0;39m <==    Updates: 0
2022-04-18 20:58:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469418017198080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:58:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469438984523776[0;39m 生成今日电子书快照开始
2022-04-18 20:58:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469438984523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469438984523776[0;39m ==> Parameters: 
2022-04-18 20:58:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469438984523776[0;39m <==    Updates: 0
2022-04-18 20:58:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469438984523776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 20:58:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469459964432384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469459964432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469459964432384[0;39m ==> Parameters: 
2022-04-18 20:58:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469459964432384[0;39m <==    Updates: 0
2022-04-18 20:58:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469459964432384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:58:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469480935952384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469480935952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469480935952384[0;39m ==> Parameters: 
2022-04-18 20:58:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469480935952384[0;39m <==    Updates: 0
2022-04-18 20:58:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469480935952384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 20:58:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469501907472384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469501907472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469501907472384[0;39m ==> Parameters: 
2022-04-18 20:58:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469501907472384[0;39m <==    Updates: 0
2022-04-18 20:58:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469501907472384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 20:58:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469502209462272[0;39m start updating Ebook doc
2022-04-18 20:58:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469502209462272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:58:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469502209462272[0;39m ==> Parameters: 
2022-04-18 20:58:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469502209462272[0;39m <==    Updates: 1
2022-04-18 20:58:35.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469502209462272[0;39m update ends, take 40 millisecs
2022-04-18 20:58:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469522878992384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469522878992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469522878992384[0;39m ==> Parameters: 
2022-04-18 20:58:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469522878992384[0;39m <==    Updates: 0
2022-04-18 20:58:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469522878992384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:58:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469543850512384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469543850512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469543850512384[0;39m ==> Parameters: 
2022-04-18 20:58:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469543850512384[0;39m <==    Updates: 0
2022-04-18 20:58:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469543850512384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:58:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469564822032384[0;39m 生成今日电子书快照开始
2022-04-18 20:58:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469564822032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469564822032384[0;39m ==> Parameters: 
2022-04-18 20:58:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469564822032384[0;39m <==    Updates: 0
2022-04-18 20:58:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469564822032384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 20:58:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469585780969472[0;39m 生成今日电子书快照开始
2022-04-18 20:58:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469585780969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:58:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469585780969472[0;39m ==> Parameters: 
2022-04-18 20:58:55.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469585780969472[0;39m <==    Updates: 0
2022-04-18 20:58:55.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469585780969472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 20:59:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469606765072384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469606765072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469606765072384[0;39m ==> Parameters: 
2022-04-18 20:59:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469606765072384[0;39m <==    Updates: 0
2022-04-18 20:59:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469606765072384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 20:59:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469627732398080[0;39m start updating Ebook doc
2022-04-18 20:59:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469627732398080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:59:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469627732398080[0;39m ==> Parameters: 
2022-04-18 20:59:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469627732398080[0;39m <==    Updates: 1
2022-04-18 20:59:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469627732398080[0;39m update ends, take 60 millisecs
2022-04-18 20:59:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469627984056320[0;39m 生成今日电子书快照开始
2022-04-18 20:59:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469627984056320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469627984056320[0;39m ==> Parameters: 
2022-04-18 20:59:05.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469627984056320[0;39m <==    Updates: 0
2022-04-18 20:59:05.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469627984056320[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-18 20:59:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469648712306688[0;39m 生成今日电子书快照开始
2022-04-18 20:59:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469648712306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469648712306688[0;39m ==> Parameters: 
2022-04-18 20:59:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469648712306688[0;39m <==    Updates: 0
2022-04-18 20:59:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469648712306688[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 20:59:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469669679632384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469669679632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469669679632384[0;39m ==> Parameters: 
2022-04-18 20:59:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469669679632384[0;39m <==    Updates: 0
2022-04-18 20:59:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469669679632384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:59:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469690651152384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469690651152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469690651152384[0;39m ==> Parameters: 
2022-04-18 20:59:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469690651152384[0;39m <==    Updates: 0
2022-04-18 20:59:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469690651152384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 20:59:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469711622672384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469711622672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469711622672384[0;39m ==> Parameters: 
2022-04-18 20:59:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469711622672384[0;39m <==    Updates: 0
2022-04-18 20:59:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469711622672384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 20:59:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469732585803776[0;39m 生成今日电子书快照开始
2022-04-18 20:59:30.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469732585803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:30.136 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469732585803776[0;39m ==> Parameters: 
2022-04-18 20:59:30.304 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469732585803776[0;39m <==    Updates: 0
2022-04-18 20:59:30.305 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469732585803776[0;39m 生成今日电子书快照结束，耗时：302毫秒
2022-04-18 20:59:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469753565712384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469753565712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469753565712384[0;39m ==> Parameters: 
2022-04-18 20:59:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469753565712384[0;39m <==    Updates: 0
2022-04-18 20:59:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469753565712384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 20:59:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469753813176320[0;39m start updating Ebook doc
2022-04-18 20:59:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469753813176320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 20:59:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469753813176320[0;39m ==> Parameters: 
2022-04-18 20:59:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469753813176320[0;39m <==    Updates: 1
2022-04-18 20:59:35.121 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469753813176320[0;39m update ends, take 58 millisecs
2022-04-18 20:59:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469774541426688[0;39m 生成今日电子书快照开始
2022-04-18 20:59:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469774541426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469774541426688[0;39m ==> Parameters: 
2022-04-18 20:59:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469774541426688[0;39m <==    Updates: 0
2022-04-18 20:59:40.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469774541426688[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 20:59:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469795508752384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469795508752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469795508752384[0;39m ==> Parameters: 
2022-04-18 20:59:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469795508752384[0;39m <==    Updates: 0
2022-04-18 20:59:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469795508752384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 20:59:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469816471883776[0;39m 生成今日电子书快照开始
2022-04-18 20:59:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469816471883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469816471883776[0;39m ==> Parameters: 
2022-04-18 20:59:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469816471883776[0;39m <==    Updates: 0
2022-04-18 20:59:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469816471883776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 20:59:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469837451792384[0;39m 生成今日电子书快照开始
2022-04-18 20:59:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469837451792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 20:59:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469837451792384[0;39m ==> Parameters: 
2022-04-18 20:59:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469837451792384[0;39m <==    Updates: 0
2022-04-18 20:59:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469837451792384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:00:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469858419118080[0;39m 生成今日电子书快照开始
2022-04-18 21:00:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469858419118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469858419118080[0;39m ==> Parameters: 
2022-04-18 21:00:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469858419118080[0;39m <==    Updates: 0
2022-04-18 21:00:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469858419118080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:00:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469879390638080[0;39m 生成今日电子书快照开始
2022-04-18 21:00:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469879390638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469879390638080[0;39m ==> Parameters: 
2022-04-18 21:00:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469879390638080[0;39m <==    Updates: 0
2022-04-18 21:00:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469879390638080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:00:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171469879633907712[0;39m start updating Ebook doc
2022-04-18 21:00:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469879633907712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:00:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469879633907712[0;39m ==> Parameters: 
2022-04-18 21:00:05.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171469879633907712[0;39m <==    Updates: 1
2022-04-18 21:00:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171469879633907712[0;39m update ends, take 39 millisecs
2022-04-18 21:00:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469900353769472[0;39m 生成今日电子书快照开始
2022-04-18 21:00:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469900353769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469900353769472[0;39m ==> Parameters: 
2022-04-18 21:00:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469900353769472[0;39m <==    Updates: 0
2022-04-18 21:00:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469900353769472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:00:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469921329483776[0;39m 生成今日电子书快照开始
2022-04-18 21:00:15.118 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469921329483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:15.118 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469921329483776[0;39m ==> Parameters: 
2022-04-18 21:00:15.183 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469921329483776[0;39m <==    Updates: 0
2022-04-18 21:00:15.183 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469921329483776[0;39m 生成今日电子书快照结束，耗时：181毫秒
2022-04-18 21:00:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469942309392384[0;39m 生成今日电子书快照开始
2022-04-18 21:00:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469942309392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469942309392384[0;39m ==> Parameters: 
2022-04-18 21:00:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469942309392384[0;39m <==    Updates: 0
2022-04-18 21:00:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469942309392384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:00:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469963264135168[0;39m 生成今日电子书快照开始
2022-04-18 21:00:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469963264135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469963264135168[0;39m ==> Parameters: 
2022-04-18 21:00:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469963264135168[0;39m <==    Updates: 0
2022-04-18 21:00:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469963264135168[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:00:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171469984244043776[0;39m 生成今日电子书快照开始
2022-04-18 21:00:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469984244043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469984244043776[0;39m ==> Parameters: 
2022-04-18 21:00:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171469984244043776[0;39m <==    Updates: 0
2022-04-18 21:00:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171469984244043776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:00:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470005215563776[0;39m 生成今日电子书快照开始
2022-04-18 21:00:35.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470005215563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470005215563776[0;39m ==> Parameters: 
2022-04-18 21:00:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470005215563776[0;39m <==    Updates: 0
2022-04-18 21:00:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470005215563776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:00:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470005442056192[0;39m start updating Ebook doc
2022-04-18 21:00:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470005442056192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:00:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470005442056192[0;39m ==> Parameters: 
2022-04-18 21:00:35.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470005442056192[0;39m <==    Updates: 1
2022-04-18 21:00:35.091 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470005442056192[0;39m update ends, take 35 millisecs
2022-04-18 21:00:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470026187083776[0;39m 生成今日电子书快照开始
2022-04-18 21:00:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470026187083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470026187083776[0;39m ==> Parameters: 
2022-04-18 21:00:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470026187083776[0;39m <==    Updates: 0
2022-04-18 21:00:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470026187083776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:00:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470047166992384[0;39m 生成今日电子书快照开始
2022-04-18 21:00:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470047166992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470047166992384[0;39m ==> Parameters: 
2022-04-18 21:00:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470047166992384[0;39m <==    Updates: 0
2022-04-18 21:00:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470047166992384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:00:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470068134318080[0;39m 生成今日电子书快照开始
2022-04-18 21:00:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470068134318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470068134318080[0;39m ==> Parameters: 
2022-04-18 21:00:50.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470068134318080[0;39m <==    Updates: 0
2022-04-18 21:00:50.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470068134318080[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:00:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470089105838080[0;39m 生成今日电子书快照开始
2022-04-18 21:00:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470089105838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:00:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470089105838080[0;39m ==> Parameters: 
2022-04-18 21:00:55.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470089105838080[0;39m <==    Updates: 0
2022-04-18 21:00:55.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470089105838080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:01:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470110073163776[0;39m 生成今日电子书快照开始
2022-04-18 21:01:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470110073163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470110073163776[0;39m ==> Parameters: 
2022-04-18 21:01:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470110073163776[0;39m <==    Updates: 0
2022-04-18 21:01:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470110073163776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:01:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470131040489472[0;39m 生成今日电子书快照开始
2022-04-18 21:01:05.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470131040489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:05.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470131040489472[0;39m ==> Parameters: 
2022-04-18 21:01:05.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470131040489472[0;39m <==    Updates: 0
2022-04-18 21:01:05.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470131040489472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:01:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470131266981888[0;39m start updating Ebook doc
2022-04-18 21:01:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470131266981888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:01:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470131266981888[0;39m ==> Parameters: 
2022-04-18 21:01:05.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470131266981888[0;39m <==    Updates: 1
2022-04-18 21:01:05.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470131266981888[0;39m update ends, take 41 millisecs
2022-04-18 21:01:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470152012009472[0;39m 生成今日电子书快照开始
2022-04-18 21:01:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470152012009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470152012009472[0;39m ==> Parameters: 
2022-04-18 21:01:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470152012009472[0;39m <==    Updates: 0
2022-04-18 21:01:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470152012009472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:01:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470172983529472[0;39m 生成今日电子书快照开始
2022-04-18 21:01:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470172983529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470172983529472[0;39m ==> Parameters: 
2022-04-18 21:01:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470172983529472[0;39m <==    Updates: 0
2022-04-18 21:01:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470172983529472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:01:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470193967632384[0;39m 生成今日电子书快照开始
2022-04-18 21:01:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470193967632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470193967632384[0;39m ==> Parameters: 
2022-04-18 21:01:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470193967632384[0;39m <==    Updates: 0
2022-04-18 21:01:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470193967632384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:01:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470214939152384[0;39m 生成今日电子书快照开始
2022-04-18 21:01:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470214939152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470214939152384[0;39m ==> Parameters: 
2022-04-18 21:01:25.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470214939152384[0;39m <==    Updates: 0
2022-04-18 21:01:25.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470214939152384[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-18 21:01:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470235914866688[0;39m 生成今日电子书快照开始
2022-04-18 21:01:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470235914866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470235914866688[0;39m ==> Parameters: 
2022-04-18 21:01:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470235914866688[0;39m <==    Updates: 0
2022-04-18 21:01:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470235914866688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:01:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470256886386688[0;39m start updating Ebook doc
2022-04-18 21:01:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470256886386688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:01:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470256886386688[0;39m ==> Parameters: 
2022-04-18 21:01:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470256886386688[0;39m <==    Updates: 1
2022-04-18 21:01:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470256886386688[0;39m update ends, take 54 millisecs
2022-04-18 21:01:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470257112879104[0;39m 生成今日电子书快照开始
2022-04-18 21:01:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470257112879104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470257112879104[0;39m ==> Parameters: 
2022-04-18 21:01:35.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470257112879104[0;39m <==    Updates: 0
2022-04-18 21:01:35.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470257112879104[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-18 21:01:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470277853712384[0;39m 生成今日电子书快照开始
2022-04-18 21:01:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470277853712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470277853712384[0;39m ==> Parameters: 
2022-04-18 21:01:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470277853712384[0;39m <==    Updates: 0
2022-04-18 21:01:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470277853712384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:01:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470298825232384[0;39m 生成今日电子书快照开始
2022-04-18 21:01:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470298825232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470298825232384[0;39m ==> Parameters: 
2022-04-18 21:01:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470298825232384[0;39m <==    Updates: 0
2022-04-18 21:01:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470298825232384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:01:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470319796752384[0;39m 生成今日电子书快照开始
2022-04-18 21:01:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470319796752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470319796752384[0;39m ==> Parameters: 
2022-04-18 21:01:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470319796752384[0;39m <==    Updates: 0
2022-04-18 21:01:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470319796752384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:01:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470340768272384[0;39m 生成今日电子书快照开始
2022-04-18 21:01:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470340768272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:01:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470340768272384[0;39m ==> Parameters: 
2022-04-18 21:01:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470340768272384[0;39m <==    Updates: 0
2022-04-18 21:01:55.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470340768272384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:02:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470361739792384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470361739792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470361739792384[0;39m ==> Parameters: 
2022-04-18 21:02:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470361739792384[0;39m <==    Updates: 0
2022-04-18 21:02:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470361739792384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:02:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470382711312384[0;39m start updating Ebook doc
2022-04-18 21:02:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470382711312384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:02:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470382711312384[0;39m ==> Parameters: 
2022-04-18 21:02:05.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470382711312384[0;39m <==    Updates: 1
2022-04-18 21:02:05.054 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470382711312384[0;39m update ends, take 50 millisecs
2022-04-18 21:02:05.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470382921027584[0;39m 生成今日电子书快照开始
2022-04-18 21:02:05.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470382921027584[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:05.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470382921027584[0;39m ==> Parameters: 
2022-04-18 21:02:05.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470382921027584[0;39m <==    Updates: 0
2022-04-18 21:02:05.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470382921027584[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 21:02:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470403687026688[0;39m 生成今日电子书快照开始
2022-04-18 21:02:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470403687026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470403687026688[0;39m ==> Parameters: 
2022-04-18 21:02:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470403687026688[0;39m <==    Updates: 0
2022-04-18 21:02:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470403687026688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:02:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470424654352384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470424654352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470424654352384[0;39m ==> Parameters: 
2022-04-18 21:02:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470424654352384[0;39m <==    Updates: 0
2022-04-18 21:02:15.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470424654352384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:02:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470445625872384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470445625872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470445625872384[0;39m ==> Parameters: 
2022-04-18 21:02:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470445625872384[0;39m <==    Updates: 0
2022-04-18 21:02:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470445625872384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:02:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470466601586688[0;39m 生成今日电子书快照开始
2022-04-18 21:02:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470466601586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470466601586688[0;39m ==> Parameters: 
2022-04-18 21:02:25.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470466601586688[0;39m <==    Updates: 0
2022-04-18 21:02:25.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470466601586688[0;39m 生成今日电子书快照结束，耗时：90毫秒
2022-04-18 21:02:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470487568912384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470487568912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470487568912384[0;39m ==> Parameters: 
2022-04-18 21:02:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470487568912384[0;39m <==    Updates: 0
2022-04-18 21:02:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470487568912384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:02:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470508540432384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470508540432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470508540432384[0;39m ==> Parameters: 
2022-04-18 21:02:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470508540432384[0;39m <==    Updates: 0
2022-04-18 21:02:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470508540432384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:02:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470508842422272[0;39m start updating Ebook doc
2022-04-18 21:02:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470508842422272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:02:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470508842422272[0;39m ==> Parameters: 
2022-04-18 21:02:35.121 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470508842422272[0;39m <==    Updates: 1
2022-04-18 21:02:35.122 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470508842422272[0;39m update ends, take 46 millisecs
2022-04-18 21:02:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470529511952384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470529511952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470529511952384[0;39m ==> Parameters: 
2022-04-18 21:02:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470529511952384[0;39m <==    Updates: 0
2022-04-18 21:02:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470529511952384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:02:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470550483472384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470550483472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470550483472384[0;39m ==> Parameters: 
2022-04-18 21:02:45.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470550483472384[0;39m <==    Updates: 0
2022-04-18 21:02:45.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470550483472384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:02:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470571454992384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470571454992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470571454992384[0;39m ==> Parameters: 
2022-04-18 21:02:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470571454992384[0;39m <==    Updates: 0
2022-04-18 21:02:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470571454992384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:02:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470592426512384[0;39m 生成今日电子书快照开始
2022-04-18 21:02:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470592426512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:02:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470592426512384[0;39m ==> Parameters: 
2022-04-18 21:02:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470592426512384[0;39m <==    Updates: 0
2022-04-18 21:02:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470592426512384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:03:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470613393838080[0;39m 生成今日电子书快照开始
2022-04-18 21:03:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470613393838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470613393838080[0;39m ==> Parameters: 
2022-04-18 21:03:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470613393838080[0;39m <==    Updates: 0
2022-04-18 21:03:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470613393838080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:03:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470634369552384[0;39m start updating Ebook doc
2022-04-18 21:03:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470634369552384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:03:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470634369552384[0;39m ==> Parameters: 
2022-04-18 21:03:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470634369552384[0;39m <==    Updates: 1
2022-04-18 21:03:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470634369552384[0;39m update ends, take 59 millisecs
2022-04-18 21:03:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470634617016320[0;39m 生成今日电子书快照开始
2022-04-18 21:03:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470634617016320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470634617016320[0;39m ==> Parameters: 
2022-04-18 21:03:05.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470634617016320[0;39m <==    Updates: 0
2022-04-18 21:03:05.102 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470634617016320[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 21:03:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470655341072384[0;39m 生成今日电子书快照开始
2022-04-18 21:03:10.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470655341072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470655341072384[0;39m ==> Parameters: 
2022-04-18 21:03:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470655341072384[0;39m <==    Updates: 0
2022-04-18 21:03:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470655341072384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:03:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470676312592384[0;39m 生成今日电子书快照开始
2022-04-18 21:03:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470676312592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470676312592384[0;39m ==> Parameters: 
2022-04-18 21:03:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470676312592384[0;39m <==    Updates: 0
2022-04-18 21:03:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470676312592384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:03:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470697288306688[0;39m 生成今日电子书快照开始
2022-04-18 21:03:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470697288306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470697288306688[0;39m ==> Parameters: 
2022-04-18 21:03:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470697288306688[0;39m <==    Updates: 0
2022-04-18 21:03:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470697288306688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:03:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470718247243776[0;39m 生成今日电子书快照开始
2022-04-18 21:03:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470718247243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470718247243776[0;39m ==> Parameters: 
2022-04-18 21:03:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470718247243776[0;39m <==    Updates: 0
2022-04-18 21:03:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470718247243776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:03:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470739222958080[0;39m 生成今日电子书快照开始
2022-04-18 21:03:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470739222958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470739222958080[0;39m ==> Parameters: 
2022-04-18 21:03:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470739222958080[0;39m <==    Updates: 0
2022-04-18 21:03:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470739222958080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:03:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470760186089472[0;39m 生成今日电子书快照开始
2022-04-18 21:03:35.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470760186089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:35.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470760186089472[0;39m ==> Parameters: 
2022-04-18 21:03:35.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470760186089472[0;39m <==    Updates: 0
2022-04-18 21:03:35.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470760186089472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:03:35.051 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470760395804672[0;39m start updating Ebook doc
2022-04-18 21:03:35.051 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470760395804672[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:03:35.051 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470760395804672[0;39m ==> Parameters: 
2022-04-18 21:03:35.086 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470760395804672[0;39m <==    Updates: 1
2022-04-18 21:03:35.086 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470760395804672[0;39m update ends, take 35 millisecs
2022-04-18 21:03:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470781170192384[0;39m 生成今日电子书快照开始
2022-04-18 21:03:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470781170192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470781170192384[0;39m ==> Parameters: 
2022-04-18 21:03:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470781170192384[0;39m <==    Updates: 0
2022-04-18 21:03:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470781170192384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:03:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470802141712384[0;39m 生成今日电子书快照开始
2022-04-18 21:03:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470802141712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470802141712384[0;39m ==> Parameters: 
2022-04-18 21:03:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470802141712384[0;39m <==    Updates: 0
2022-04-18 21:03:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470802141712384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:03:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470823117426688[0;39m 生成今日电子书快照开始
2022-04-18 21:03:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470823117426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470823117426688[0;39m ==> Parameters: 
2022-04-18 21:03:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470823117426688[0;39m <==    Updates: 0
2022-04-18 21:03:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470823117426688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:03:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470844084752384[0;39m 生成今日电子书快照开始
2022-04-18 21:03:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470844084752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:03:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470844084752384[0;39m ==> Parameters: 
2022-04-18 21:03:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470844084752384[0;39m <==    Updates: 0
2022-04-18 21:03:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470844084752384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:04:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470865052078080[0;39m 生成今日电子书快照开始
2022-04-18 21:04:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470865052078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470865052078080[0;39m ==> Parameters: 
2022-04-18 21:04:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470865052078080[0;39m <==    Updates: 0
2022-04-18 21:04:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470865052078080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:04:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470886027792384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470886027792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470886027792384[0;39m ==> Parameters: 
2022-04-18 21:04:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470886027792384[0;39m <==    Updates: 0
2022-04-18 21:04:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470886027792384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:04:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171470886287839232[0;39m start updating Ebook doc
2022-04-18 21:04:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470886287839232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:04:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470886287839232[0;39m ==> Parameters: 
2022-04-18 21:04:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171470886287839232[0;39m <==    Updates: 1
2022-04-18 21:04:05.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171470886287839232[0;39m update ends, take 44 millisecs
2022-04-18 21:04:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470906999312384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470906999312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470906999312384[0;39m ==> Parameters: 
2022-04-18 21:04:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470906999312384[0;39m <==    Updates: 0
2022-04-18 21:04:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470906999312384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:04:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470927970832384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470927970832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470927970832384[0;39m ==> Parameters: 
2022-04-18 21:04:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470927970832384[0;39m <==    Updates: 0
2022-04-18 21:04:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470927970832384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:04:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470948942352384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470948942352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470948942352384[0;39m ==> Parameters: 
2022-04-18 21:04:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470948942352384[0;39m <==    Updates: 0
2022-04-18 21:04:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470948942352384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:04:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470969909678080[0;39m 生成今日电子书快照开始
2022-04-18 21:04:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470969909678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470969909678080[0;39m ==> Parameters: 
2022-04-18 21:04:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470969909678080[0;39m <==    Updates: 0
2022-04-18 21:04:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470969909678080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:04:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171470990889586688[0;39m 生成今日电子书快照开始
2022-04-18 21:04:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470990889586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470990889586688[0;39m ==> Parameters: 
2022-04-18 21:04:30.206 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171470990889586688[0;39m <==    Updates: 0
2022-04-18 21:04:30.206 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171470990889586688[0;39m 生成今日电子书快照结束，耗时：201毫秒
2022-04-18 21:04:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471011856912384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471011856912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471011856912384[0;39m ==> Parameters: 
2022-04-18 21:04:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471011856912384[0;39m <==    Updates: 0
2022-04-18 21:04:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471011856912384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:04:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471012112764928[0;39m start updating Ebook doc
2022-04-18 21:04:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471012112764928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:04:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471012112764928[0;39m ==> Parameters: 
2022-04-18 21:04:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471012112764928[0;39m <==    Updates: 1
2022-04-18 21:04:35.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471012112764928[0;39m update ends, take 44 millisecs
2022-04-18 21:04:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471032828432384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471032828432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471032828432384[0;39m ==> Parameters: 
2022-04-18 21:04:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471032828432384[0;39m <==    Updates: 0
2022-04-18 21:04:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471032828432384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:04:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471053799952384[0;39m 生成今日电子书快照开始
2022-04-18 21:04:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471053799952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471053799952384[0;39m ==> Parameters: 
2022-04-18 21:04:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471053799952384[0;39m <==    Updates: 0
2022-04-18 21:04:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471053799952384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:04:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471074775666688[0;39m 生成今日电子书快照开始
2022-04-18 21:04:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471074775666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471074775666688[0;39m ==> Parameters: 
2022-04-18 21:04:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471074775666688[0;39m <==    Updates: 0
2022-04-18 21:04:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471074775666688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:04:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471095747186688[0;39m 生成今日电子书快照开始
2022-04-18 21:04:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471095747186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:04:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471095747186688[0;39m ==> Parameters: 
2022-04-18 21:04:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471095747186688[0;39m <==    Updates: 0
2022-04-18 21:04:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471095747186688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:05:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471116718706688[0;39m 生成今日电子书快照开始
2022-04-18 21:05:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471116718706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471116718706688[0;39m ==> Parameters: 
2022-04-18 21:05:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471116718706688[0;39m <==    Updates: 0
2022-04-18 21:05:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471116718706688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:05:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471137686032384[0;39m start updating Ebook doc
2022-04-18 21:05:05.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471137686032384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:05:05.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471137686032384[0;39m ==> Parameters: 
2022-04-18 21:05:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471137686032384[0;39m <==    Updates: 1
2022-04-18 21:05:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471137686032384[0;39m update ends, take 62 millisecs
2022-04-18 21:05:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471137946079232[0;39m 生成今日电子书快照开始
2022-04-18 21:05:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471137946079232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471137946079232[0;39m ==> Parameters: 
2022-04-18 21:05:05.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471137946079232[0;39m <==    Updates: 0
2022-04-18 21:05:05.115 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471137946079232[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:05:10.012 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471158691106816[0;39m 生成今日电子书快照开始
2022-04-18 21:05:10.122 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471158691106816[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:10.122 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471158691106816[0;39m ==> Parameters: 
2022-04-18 21:05:10.162 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471158691106816[0;39m <==    Updates: 0
2022-04-18 21:05:10.162 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471158691106816[0;39m 生成今日电子书快照结束，耗时：150毫秒
2022-04-18 21:05:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471179654238208[0;39m 生成今日电子书快照开始
2022-04-18 21:05:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471179654238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471179654238208[0;39m ==> Parameters: 
2022-04-18 21:05:15.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471179654238208[0;39m <==    Updates: 0
2022-04-18 21:05:15.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471179654238208[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 21:05:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471200617369600[0;39m 生成今日电子书快照开始
2022-04-18 21:05:20.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471200617369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:20.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471200617369600[0;39m ==> Parameters: 
2022-04-18 21:05:20.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471200617369600[0;39m <==    Updates: 0
2022-04-18 21:05:20.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471200617369600[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 21:05:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471221580500992[0;39m 生成今日电子书快照开始
2022-04-18 21:05:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471221580500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471221580500992[0;39m ==> Parameters: 
2022-04-18 21:05:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471221580500992[0;39m <==    Updates: 0
2022-04-18 21:05:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471221580500992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:05:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471242547826688[0;39m 生成今日电子书快照开始
2022-04-18 21:05:30.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471242547826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:30.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471242547826688[0;39m ==> Parameters: 
2022-04-18 21:05:30.129 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471242547826688[0;39m <==    Updates: 0
2022-04-18 21:05:30.129 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471242547826688[0;39m 生成今日电子书快照结束，耗时：123毫秒
2022-04-18 21:05:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471263523540992[0;39m 生成今日电子书快照开始
2022-04-18 21:05:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471263523540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471263523540992[0;39m ==> Parameters: 
2022-04-18 21:05:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471263523540992[0;39m <==    Updates: 0
2022-04-18 21:05:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471263523540992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:05:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471263783587840[0;39m start updating Ebook doc
2022-04-18 21:05:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471263783587840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:05:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471263783587840[0;39m ==> Parameters: 
2022-04-18 21:05:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471263783587840[0;39m <==    Updates: 1
2022-04-18 21:05:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471263783587840[0;39m update ends, take 38 millisecs
2022-04-18 21:05:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471284482478080[0;39m 生成今日电子书快照开始
2022-04-18 21:05:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471284482478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471284482478080[0;39m ==> Parameters: 
2022-04-18 21:05:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471284482478080[0;39m <==    Updates: 0
2022-04-18 21:05:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471284482478080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:05:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471305462386688[0;39m 生成今日电子书快照开始
2022-04-18 21:05:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471305462386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471305462386688[0;39m ==> Parameters: 
2022-04-18 21:05:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471305462386688[0;39m <==    Updates: 0
2022-04-18 21:05:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471305462386688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:05:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471326433906688[0;39m 生成今日电子书快照开始
2022-04-18 21:05:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471326433906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471326433906688[0;39m ==> Parameters: 
2022-04-18 21:05:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471326433906688[0;39m <==    Updates: 0
2022-04-18 21:05:50.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471326433906688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:05:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471347401232384[0;39m 生成今日电子书快照开始
2022-04-18 21:05:55.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471347401232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:05:55.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471347401232384[0;39m ==> Parameters: 
2022-04-18 21:05:55.133 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471347401232384[0;39m <==    Updates: 0
2022-04-18 21:05:55.133 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471347401232384[0;39m 生成今日电子书快照结束，耗时：129毫秒
2022-04-18 21:06:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471368372752384[0;39m 生成今日电子书快照开始
2022-04-18 21:06:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471368372752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471368372752384[0;39m ==> Parameters: 
2022-04-18 21:06:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471368372752384[0;39m <==    Updates: 0
2022-04-18 21:06:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471368372752384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:06:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471389348466688[0;39m 生成今日电子书快照开始
2022-04-18 21:06:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471389348466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471389348466688[0;39m ==> Parameters: 
2022-04-18 21:06:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471389348466688[0;39m <==    Updates: 0
2022-04-18 21:06:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471389348466688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:06:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471389625290752[0;39m start updating Ebook doc
2022-04-18 21:06:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471389625290752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:06:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471389625290752[0;39m ==> Parameters: 
2022-04-18 21:06:05.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471389625290752[0;39m <==    Updates: 1
2022-04-18 21:06:05.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471389625290752[0;39m update ends, take 38 millisecs
2022-04-18 21:06:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471410299015168[0;39m 生成今日电子书快照开始
2022-04-18 21:06:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471410299015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471410299015168[0;39m ==> Parameters: 
2022-04-18 21:06:10.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471410299015168[0;39m <==    Updates: 0
2022-04-18 21:06:10.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471410299015168[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:06:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471431295700992[0;39m 生成今日电子书快照开始
2022-04-18 21:06:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471431295700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471431295700992[0;39m ==> Parameters: 
2022-04-18 21:06:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471431295700992[0;39m <==    Updates: 0
2022-04-18 21:06:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471431295700992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:06:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471452254638080[0;39m 生成今日电子书快照开始
2022-04-18 21:06:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471452254638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471452254638080[0;39m ==> Parameters: 
2022-04-18 21:06:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471452254638080[0;39m <==    Updates: 0
2022-04-18 21:06:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471452254638080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:06:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471473213575168[0;39m 生成今日电子书快照开始
2022-04-18 21:06:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471473213575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471473213575168[0;39m ==> Parameters: 
2022-04-18 21:06:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471473213575168[0;39m <==    Updates: 0
2022-04-18 21:06:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471473213575168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:06:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471494201872384[0;39m 生成今日电子书快照开始
2022-04-18 21:06:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471494201872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471494201872384[0;39m ==> Parameters: 
2022-04-18 21:06:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471494201872384[0;39m <==    Updates: 0
2022-04-18 21:06:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471494201872384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:06:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471515160809472[0;39m 生成今日电子书快照开始
2022-04-18 21:06:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471515160809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471515160809472[0;39m ==> Parameters: 
2022-04-18 21:06:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471515160809472[0;39m <==    Updates: 0
2022-04-18 21:06:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471515160809472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:06:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471515412467712[0;39m start updating Ebook doc
2022-04-18 21:06:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471515412467712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:06:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471515412467712[0;39m ==> Parameters: 
2022-04-18 21:06:35.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471515412467712[0;39m <==    Updates: 1
2022-04-18 21:06:35.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471515412467712[0;39m update ends, take 40 millisecs
2022-04-18 21:06:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471536144912384[0;39m 生成今日电子书快照开始
2022-04-18 21:06:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471536144912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471536144912384[0;39m ==> Parameters: 
2022-04-18 21:06:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471536144912384[0;39m <==    Updates: 0
2022-04-18 21:06:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471536144912384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:06:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471557112238080[0;39m 生成今日电子书快照开始
2022-04-18 21:06:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471557112238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471557112238080[0;39m ==> Parameters: 
2022-04-18 21:06:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471557112238080[0;39m <==    Updates: 0
2022-04-18 21:06:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471557112238080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:06:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471578083758080[0;39m 生成今日电子书快照开始
2022-04-18 21:06:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471578083758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471578083758080[0;39m ==> Parameters: 
2022-04-18 21:06:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471578083758080[0;39m <==    Updates: 0
2022-04-18 21:06:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471578083758080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:06:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471599063666688[0;39m 生成今日电子书快照开始
2022-04-18 21:06:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471599063666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:06:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471599063666688[0;39m ==> Parameters: 
2022-04-18 21:06:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471599063666688[0;39m <==    Updates: 0
2022-04-18 21:06:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471599063666688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:07:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471620035186688[0;39m 生成今日电子书快照开始
2022-04-18 21:07:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471620035186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471620035186688[0;39m ==> Parameters: 
2022-04-18 21:07:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471620035186688[0;39m <==    Updates: 0
2022-04-18 21:07:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471620035186688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:07:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471640998318080[0;39m 生成今日电子书快照开始
2022-04-18 21:07:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471640998318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471640998318080[0;39m ==> Parameters: 
2022-04-18 21:07:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471640998318080[0;39m <==    Updates: 0
2022-04-18 21:07:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471640998318080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:07:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471641254170624[0;39m start updating Ebook doc
2022-04-18 21:07:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471641254170624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:07:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471641254170624[0;39m ==> Parameters: 
2022-04-18 21:07:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471641254170624[0;39m <==    Updates: 1
2022-04-18 21:07:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471641254170624[0;39m update ends, take 40 millisecs
2022-04-18 21:07:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471661974032384[0;39m 生成今日电子书快照开始
2022-04-18 21:07:10.284 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471661974032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:10.285 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471661974032384[0;39m ==> Parameters: 
2022-04-18 21:07:10.321 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471661974032384[0;39m <==    Updates: 0
2022-04-18 21:07:10.322 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471661974032384[0;39m 生成今日电子书快照结束，耗时：317毫秒
2022-04-18 21:07:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471682949746688[0;39m 生成今日电子书快照开始
2022-04-18 21:07:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471682949746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471682949746688[0;39m ==> Parameters: 
2022-04-18 21:07:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471682949746688[0;39m <==    Updates: 0
2022-04-18 21:07:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471682949746688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:07:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471703900295168[0;39m 生成今日电子书快照开始
2022-04-18 21:07:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471703900295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471703900295168[0;39m ==> Parameters: 
2022-04-18 21:07:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471703900295168[0;39m <==    Updates: 0
2022-04-18 21:07:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471703900295168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:07:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471724888592384[0;39m 生成今日电子书快照开始
2022-04-18 21:07:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471724888592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471724888592384[0;39m ==> Parameters: 
2022-04-18 21:07:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471724888592384[0;39m <==    Updates: 0
2022-04-18 21:07:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471724888592384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:07:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471745855918080[0;39m 生成今日电子书快照开始
2022-04-18 21:07:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471745855918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471745855918080[0;39m ==> Parameters: 
2022-04-18 21:07:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471745855918080[0;39m <==    Updates: 0
2022-04-18 21:07:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471745855918080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:07:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471766814855168[0;39m 生成今日电子书快照开始
2022-04-18 21:07:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471766814855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471766814855168[0;39m ==> Parameters: 
2022-04-18 21:07:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471766814855168[0;39m <==    Updates: 0
2022-04-18 21:07:35.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471766814855168[0;39m 生成今日电子书快照结束，耗时：93毫秒
2022-04-18 21:07:35.094 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471767209119744[0;39m start updating Ebook doc
2022-04-18 21:07:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471767209119744[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:07:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471767209119744[0;39m ==> Parameters: 
2022-04-18 21:07:35.129 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471767209119744[0;39m <==    Updates: 1
2022-04-18 21:07:35.141 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471767209119744[0;39m update ends, take 47 millisecs
2022-04-18 21:07:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471787790569472[0;39m 生成今日电子书快照开始
2022-04-18 21:07:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471787790569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471787790569472[0;39m ==> Parameters: 
2022-04-18 21:07:40.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471787790569472[0;39m <==    Updates: 0
2022-04-18 21:07:40.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471787790569472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:07:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471808762089472[0;39m 生成今日电子书快照开始
2022-04-18 21:07:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471808762089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471808762089472[0;39m ==> Parameters: 
2022-04-18 21:07:45.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471808762089472[0;39m <==    Updates: 0
2022-04-18 21:07:45.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471808762089472[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-18 21:07:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471829729415168[0;39m 生成今日电子书快照开始
2022-04-18 21:07:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471829729415168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471829729415168[0;39m ==> Parameters: 
2022-04-18 21:07:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471829729415168[0;39m <==    Updates: 0
2022-04-18 21:07:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471829729415168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:07:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471850709323776[0;39m 生成今日电子书快照开始
2022-04-18 21:07:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471850709323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:07:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471850709323776[0;39m ==> Parameters: 
2022-04-18 21:07:55.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471850709323776[0;39m <==    Updates: 0
2022-04-18 21:07:55.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471850709323776[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:08:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471871693426688[0;39m 生成今日电子书快照开始
2022-04-18 21:08:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471871693426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471871693426688[0;39m ==> Parameters: 
2022-04-18 21:08:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471871693426688[0;39m <==    Updates: 0
2022-04-18 21:08:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471871693426688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:08:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471892660752384[0;39m 生成今日电子书快照开始
2022-04-18 21:08:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471892660752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471892660752384[0;39m ==> Parameters: 
2022-04-18 21:08:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471892660752384[0;39m <==    Updates: 0
2022-04-18 21:08:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471892660752384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:08:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171471892933382144[0;39m start updating Ebook doc
2022-04-18 21:08:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471892933382144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:08:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471892933382144[0;39m ==> Parameters: 
2022-04-18 21:08:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171471892933382144[0;39m <==    Updates: 1
2022-04-18 21:08:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171471892933382144[0;39m update ends, take 38 millisecs
2022-04-18 21:08:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471913632272384[0;39m 生成今日电子书快照开始
2022-04-18 21:08:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471913632272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471913632272384[0;39m ==> Parameters: 
2022-04-18 21:08:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471913632272384[0;39m <==    Updates: 0
2022-04-18 21:08:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471913632272384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:08:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471934591209472[0;39m 生成今日电子书快照开始
2022-04-18 21:08:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471934591209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471934591209472[0;39m ==> Parameters: 
2022-04-18 21:08:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471934591209472[0;39m <==    Updates: 0
2022-04-18 21:08:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471934591209472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:08:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471955579506688[0;39m 生成今日电子书快照开始
2022-04-18 21:08:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471955579506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471955579506688[0;39m ==> Parameters: 
2022-04-18 21:08:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471955579506688[0;39m <==    Updates: 0
2022-04-18 21:08:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471955579506688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:08:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471976546832384[0;39m 生成今日电子书快照开始
2022-04-18 21:08:25.162 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471976546832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:25.163 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471976546832384[0;39m ==> Parameters: 
2022-04-18 21:08:25.204 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471976546832384[0;39m <==    Updates: 0
2022-04-18 21:08:25.205 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471976546832384[0;39m 生成今日电子书快照结束，耗时：201毫秒
2022-04-18 21:08:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171471997509963776[0;39m 生成今日电子书快照开始
2022-04-18 21:08:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471997509963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471997509963776[0;39m ==> Parameters: 
2022-04-18 21:08:30.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171471997509963776[0;39m <==    Updates: 0
2022-04-18 21:08:30.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171471997509963776[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:08:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472018506649600[0;39m 生成今日电子书快照开始
2022-04-18 21:08:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472018506649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472018506649600[0;39m ==> Parameters: 
2022-04-18 21:08:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472018506649600[0;39m <==    Updates: 0
2022-04-18 21:08:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472018506649600[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:08:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472018728947712[0;39m start updating Ebook doc
2022-04-18 21:08:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472018728947712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:08:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472018728947712[0;39m ==> Parameters: 
2022-04-18 21:08:35.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472018728947712[0;39m <==    Updates: 1
2022-04-18 21:08:35.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472018728947712[0;39m update ends, take 40 millisecs
2022-04-18 21:08:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472039448809472[0;39m 生成今日电子书快照开始
2022-04-18 21:08:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472039448809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472039448809472[0;39m ==> Parameters: 
2022-04-18 21:08:40.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472039448809472[0;39m <==    Updates: 0
2022-04-18 21:08:40.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472039448809472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:08:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472060424523776[0;39m 生成今日电子书快照开始
2022-04-18 21:08:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472060424523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472060424523776[0;39m ==> Parameters: 
2022-04-18 21:08:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472060424523776[0;39m <==    Updates: 0
2022-04-18 21:08:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472060424523776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:08:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472081396043776[0;39m 生成今日电子书快照开始
2022-04-18 21:08:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472081396043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472081396043776[0;39m ==> Parameters: 
2022-04-18 21:08:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472081396043776[0;39m <==    Updates: 0
2022-04-18 21:08:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472081396043776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:08:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472102367563776[0;39m 生成今日电子书快照开始
2022-04-18 21:08:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472102367563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:08:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472102367563776[0;39m ==> Parameters: 
2022-04-18 21:08:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472102367563776[0;39m <==    Updates: 0
2022-04-18 21:08:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472102367563776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:09:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472123339083776[0;39m 生成今日电子书快照开始
2022-04-18 21:09:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472123339083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472123339083776[0;39m ==> Parameters: 
2022-04-18 21:09:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472123339083776[0;39m <==    Updates: 0
2022-04-18 21:09:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472123339083776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:09:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472144310603776[0;39m 生成今日电子书快照开始
2022-04-18 21:09:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472144310603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472144310603776[0;39m ==> Parameters: 
2022-04-18 21:09:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472144310603776[0;39m <==    Updates: 0
2022-04-18 21:09:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472144310603776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:09:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472144583233536[0;39m start updating Ebook doc
2022-04-18 21:09:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472144583233536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:09:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472144583233536[0;39m ==> Parameters: 
2022-04-18 21:09:05.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472144583233536[0;39m <==    Updates: 1
2022-04-18 21:09:05.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472144583233536[0;39m update ends, take 41 millisecs
2022-04-18 21:09:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472165282123776[0;39m 生成今日电子书快照开始
2022-04-18 21:09:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472165282123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472165282123776[0;39m ==> Parameters: 
2022-04-18 21:09:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472165282123776[0;39m <==    Updates: 0
2022-04-18 21:09:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472165282123776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:09:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472186253643776[0;39m 生成今日电子书快照开始
2022-04-18 21:09:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472186253643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472186253643776[0;39m ==> Parameters: 
2022-04-18 21:09:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472186253643776[0;39m <==    Updates: 0
2022-04-18 21:09:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472186253643776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:09:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472207225163776[0;39m 生成今日电子书快照开始
2022-04-18 21:09:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472207225163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472207225163776[0;39m ==> Parameters: 
2022-04-18 21:09:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472207225163776[0;39m <==    Updates: 0
2022-04-18 21:09:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472207225163776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:09:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472228209266688[0;39m 生成今日电子书快照开始
2022-04-18 21:09:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472228209266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472228209266688[0;39m ==> Parameters: 
2022-04-18 21:09:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472228209266688[0;39m <==    Updates: 0
2022-04-18 21:09:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472228209266688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:09:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472249172398080[0;39m 生成今日电子书快照开始
2022-04-18 21:09:30.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472249172398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:30.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472249172398080[0;39m ==> Parameters: 
2022-04-18 21:09:30.211 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472249172398080[0;39m <==    Updates: 0
2022-04-18 21:09:30.211 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472249172398080[0;39m 生成今日电子书快照结束，耗时：207毫秒
2022-04-18 21:09:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472270139723776[0;39m start updating Ebook doc
2022-04-18 21:09:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472270139723776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:09:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472270139723776[0;39m ==> Parameters: 
2022-04-18 21:09:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472270139723776[0;39m <==    Updates: 1
2022-04-18 21:09:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472270139723776[0;39m update ends, take 63 millisecs
2022-04-18 21:09:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472270408159232[0;39m 生成今日电子书快照开始
2022-04-18 21:09:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472270408159232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472270408159232[0;39m ==> Parameters: 
2022-04-18 21:09:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472270408159232[0;39m <==    Updates: 0
2022-04-18 21:09:35.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472270408159232[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 21:09:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472291123826688[0;39m 生成今日电子书快照开始
2022-04-18 21:09:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472291123826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472291123826688[0;39m ==> Parameters: 
2022-04-18 21:09:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472291123826688[0;39m <==    Updates: 0
2022-04-18 21:09:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472291123826688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:09:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472312078569472[0;39m 生成今日电子书快照开始
2022-04-18 21:09:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472312078569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472312078569472[0;39m ==> Parameters: 
2022-04-18 21:09:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472312078569472[0;39m <==    Updates: 0
2022-04-18 21:09:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472312078569472[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:09:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472333054283776[0;39m 生成今日电子书快照开始
2022-04-18 21:09:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472333054283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472333054283776[0;39m ==> Parameters: 
2022-04-18 21:09:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472333054283776[0;39m <==    Updates: 0
2022-04-18 21:09:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472333054283776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 21:09:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472354029998080[0;39m 生成今日电子书快照开始
2022-04-18 21:09:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472354029998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:09:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472354029998080[0;39m ==> Parameters: 
2022-04-18 21:09:55.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472354029998080[0;39m <==    Updates: 0
2022-04-18 21:09:55.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472354029998080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:10:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472375001518080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472375001518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472375001518080[0;39m ==> Parameters: 
2022-04-18 21:10:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472375001518080[0;39m <==    Updates: 0
2022-04-18 21:10:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472375001518080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:10:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472395968843776[0;39m 生成今日电子书快照开始
2022-04-18 21:10:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472395968843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472395968843776[0;39m ==> Parameters: 
2022-04-18 21:10:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472395968843776[0;39m <==    Updates: 0
2022-04-18 21:10:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472395968843776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:10:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472396233084928[0;39m start updating Ebook doc
2022-04-18 21:10:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472396233084928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:10:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472396233084928[0;39m ==> Parameters: 
2022-04-18 21:10:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472396233084928[0;39m <==    Updates: 1
2022-04-18 21:10:05.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472396233084928[0;39m update ends, take 43 millisecs
2022-04-18 21:10:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472416944558080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472416944558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472416944558080[0;39m ==> Parameters: 
2022-04-18 21:10:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472416944558080[0;39m <==    Updates: 0
2022-04-18 21:10:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472416944558080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:10:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472437916078080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472437916078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472437916078080[0;39m ==> Parameters: 
2022-04-18 21:10:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472437916078080[0;39m <==    Updates: 0
2022-04-18 21:10:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472437916078080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:10:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472458887598080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472458887598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472458887598080[0;39m ==> Parameters: 
2022-04-18 21:10:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472458887598080[0;39m <==    Updates: 0
2022-04-18 21:10:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472458887598080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:10:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472479863312384[0;39m 生成今日电子书快照开始
2022-04-18 21:10:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472479863312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472479863312384[0;39m ==> Parameters: 
2022-04-18 21:10:25.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472479863312384[0;39m <==    Updates: 0
2022-04-18 21:10:25.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472479863312384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:10:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472500830638080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472500830638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472500830638080[0;39m ==> Parameters: 
2022-04-18 21:10:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472500830638080[0;39m <==    Updates: 0
2022-04-18 21:10:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472500830638080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:10:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472521802158080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472521802158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472521802158080[0;39m ==> Parameters: 
2022-04-18 21:10:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472521802158080[0;39m <==    Updates: 0
2022-04-18 21:10:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472521802158080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:10:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472522032844800[0;39m start updating Ebook doc
2022-04-18 21:10:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472522032844800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:10:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472522032844800[0;39m ==> Parameters: 
2022-04-18 21:10:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472522032844800[0;39m <==    Updates: 1
2022-04-18 21:10:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472522032844800[0;39m update ends, take 42 millisecs
2022-04-18 21:10:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472542773678080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472542773678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472542773678080[0;39m ==> Parameters: 
2022-04-18 21:10:40.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472542773678080[0;39m <==    Updates: 0
2022-04-18 21:10:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472542773678080[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:10:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472563745198080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472563745198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472563745198080[0;39m ==> Parameters: 
2022-04-18 21:10:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472563745198080[0;39m <==    Updates: 0
2022-04-18 21:10:45.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472563745198080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:10:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472584716718080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472584716718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472584716718080[0;39m ==> Parameters: 
2022-04-18 21:10:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472584716718080[0;39m <==    Updates: 0
2022-04-18 21:10:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472584716718080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:10:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472605688238080[0;39m 生成今日电子书快照开始
2022-04-18 21:10:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472605688238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:10:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472605688238080[0;39m ==> Parameters: 
2022-04-18 21:10:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472605688238080[0;39m <==    Updates: 0
2022-04-18 21:10:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472605688238080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:11:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472626668146688[0;39m 生成今日电子书快照开始
2022-04-18 21:11:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472626668146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472626668146688[0;39m ==> Parameters: 
2022-04-18 21:11:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472626668146688[0;39m <==    Updates: 0
2022-04-18 21:11:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472626668146688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:11:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472647631278080[0;39m start updating Ebook doc
2022-04-18 21:11:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472647631278080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:11:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472647631278080[0;39m ==> Parameters: 
2022-04-18 21:11:05.087 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472647631278080[0;39m <==    Updates: 1
2022-04-18 21:11:05.087 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472647631278080[0;39m update ends, take 84 millisecs
2022-04-18 21:11:05.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472647987793920[0;39m 生成今日电子书快照开始
2022-04-18 21:11:05.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472647987793920[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:05.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472647987793920[0;39m ==> Parameters: 
2022-04-18 21:11:05.133 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472647987793920[0;39m <==    Updates: 0
2022-04-18 21:11:05.133 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472647987793920[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 21:11:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472668606992384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472668606992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472668606992384[0;39m ==> Parameters: 
2022-04-18 21:11:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472668606992384[0;39m <==    Updates: 0
2022-04-18 21:11:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472668606992384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:11:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472689578512384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472689578512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472689578512384[0;39m ==> Parameters: 
2022-04-18 21:11:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472689578512384[0;39m <==    Updates: 0
2022-04-18 21:11:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472689578512384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:11:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472710550032384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472710550032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472710550032384[0;39m ==> Parameters: 
2022-04-18 21:11:20.280 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472710550032384[0;39m <==    Updates: 0
2022-04-18 21:11:20.280 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472710550032384[0;39m 生成今日电子书快照结束，耗时：276毫秒
2022-04-18 21:11:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472731521552384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472731521552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472731521552384[0;39m ==> Parameters: 
2022-04-18 21:11:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472731521552384[0;39m <==    Updates: 0
2022-04-18 21:11:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472731521552384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:11:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472752493072384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:30.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472752493072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:30.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472752493072384[0;39m ==> Parameters: 
2022-04-18 21:11:30.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472752493072384[0;39m <==    Updates: 0
2022-04-18 21:11:30.135 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472752493072384[0;39m 生成今日电子书快照结束，耗时：131毫秒
2022-04-18 21:11:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472773460398080[0;39m start updating Ebook doc
2022-04-18 21:11:35.041 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472773460398080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:11:35.041 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472773460398080[0;39m ==> Parameters: 
2022-04-18 21:11:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472773460398080[0;39m <==    Updates: 1
2022-04-18 21:11:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472773460398080[0;39m update ends, take 73 millisecs
2022-04-18 21:11:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472773766582272[0;39m 生成今日电子书快照开始
2022-04-18 21:11:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472773766582272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472773766582272[0;39m ==> Parameters: 
2022-04-18 21:11:35.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472773766582272[0;39m <==    Updates: 0
2022-04-18 21:11:35.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472773766582272[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 21:11:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472794436112384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472794436112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472794436112384[0;39m ==> Parameters: 
2022-04-18 21:11:40.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472794436112384[0;39m <==    Updates: 0
2022-04-18 21:11:40.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472794436112384[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-18 21:11:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472815407632384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472815407632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472815407632384[0;39m ==> Parameters: 
2022-04-18 21:11:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472815407632384[0;39m <==    Updates: 0
2022-04-18 21:11:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472815407632384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:11:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472836379152384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472836379152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472836379152384[0;39m ==> Parameters: 
2022-04-18 21:11:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472836379152384[0;39m <==    Updates: 0
2022-04-18 21:11:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472836379152384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:11:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472857350672384[0;39m 生成今日电子书快照开始
2022-04-18 21:11:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472857350672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:11:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472857350672384[0;39m ==> Parameters: 
2022-04-18 21:11:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472857350672384[0;39m <==    Updates: 0
2022-04-18 21:11:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472857350672384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:12:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472878313803776[0;39m 生成今日电子书快照开始
2022-04-18 21:12:00.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472878313803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:00.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472878313803776[0;39m ==> Parameters: 
2022-04-18 21:12:00.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472878313803776[0;39m <==    Updates: 0
2022-04-18 21:12:00.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472878313803776[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-18 21:12:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472899293712384[0;39m 生成今日电子书快照开始
2022-04-18 21:12:05.194 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472899293712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:05.194 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472899293712384[0;39m ==> Parameters: 
2022-04-18 21:12:05.234 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472899293712384[0;39m <==    Updates: 0
2022-04-18 21:12:05.234 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472899293712384[0;39m 生成今日电子书快照结束，耗时：229毫秒
2022-04-18 21:12:05.235 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171472900262596608[0;39m start updating Ebook doc
2022-04-18 21:12:05.235 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472900262596608[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:12:05.235 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472900262596608[0;39m ==> Parameters: 
2022-04-18 21:12:05.274 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171472900262596608[0;39m <==    Updates: 1
2022-04-18 21:12:05.274 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171472900262596608[0;39m update ends, take 39 millisecs
2022-04-18 21:12:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472920265232384[0;39m 生成今日电子书快照开始
2022-04-18 21:12:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472920265232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472920265232384[0;39m ==> Parameters: 
2022-04-18 21:12:10.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472920265232384[0;39m <==    Updates: 0
2022-04-18 21:12:10.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472920265232384[0;39m 生成今日电子书快照结束，耗时：93毫秒
2022-04-18 21:12:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472941240946688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472941240946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472941240946688[0;39m ==> Parameters: 
2022-04-18 21:12:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472941240946688[0;39m <==    Updates: 0
2022-04-18 21:12:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472941240946688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:12:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472962212466688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472962212466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472962212466688[0;39m ==> Parameters: 
2022-04-18 21:12:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472962212466688[0;39m <==    Updates: 0
2022-04-18 21:12:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472962212466688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:12:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171472983183986688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472983183986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472983183986688[0;39m ==> Parameters: 
2022-04-18 21:12:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171472983183986688[0;39m <==    Updates: 0
2022-04-18 21:12:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171472983183986688[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:12:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473004155506688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473004155506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473004155506688[0;39m ==> Parameters: 
2022-04-18 21:12:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473004155506688[0;39m <==    Updates: 0
2022-04-18 21:12:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473004155506688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:12:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473025127026688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473025127026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473025127026688[0;39m ==> Parameters: 
2022-04-18 21:12:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473025127026688[0;39m <==    Updates: 0
2022-04-18 21:12:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473025127026688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:12:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473025370296320[0;39m start updating Ebook doc
2022-04-18 21:12:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473025370296320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:12:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473025370296320[0;39m ==> Parameters: 
2022-04-18 21:12:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473025370296320[0;39m <==    Updates: 1
2022-04-18 21:12:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473025370296320[0;39m update ends, take 45 millisecs
2022-04-18 21:12:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473046098546688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473046098546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473046098546688[0;39m ==> Parameters: 
2022-04-18 21:12:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473046098546688[0;39m <==    Updates: 0
2022-04-18 21:12:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473046098546688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:12:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473067070066688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473067070066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473067070066688[0;39m ==> Parameters: 
2022-04-18 21:12:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473067070066688[0;39m <==    Updates: 0
2022-04-18 21:12:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473067070066688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:12:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473088041586688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473088041586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473088041586688[0;39m ==> Parameters: 
2022-04-18 21:12:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473088041586688[0;39m <==    Updates: 0
2022-04-18 21:12:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473088041586688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:12:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473109013106688[0;39m 生成今日电子书快照开始
2022-04-18 21:12:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473109013106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:12:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473109013106688[0;39m ==> Parameters: 
2022-04-18 21:12:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473109013106688[0;39m <==    Updates: 0
2022-04-18 21:12:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473109013106688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:13:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473129984626688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473129984626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473129984626688[0;39m ==> Parameters: 
2022-04-18 21:13:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473129984626688[0;39m <==    Updates: 0
2022-04-18 21:13:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473129984626688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:13:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473150943563776[0;39m 生成今日电子书快照开始
2022-04-18 21:13:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473150943563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473150943563776[0;39m ==> Parameters: 
2022-04-18 21:13:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473150943563776[0;39m <==    Updates: 0
2022-04-18 21:13:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473150943563776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:13:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473151216193536[0;39m start updating Ebook doc
2022-04-18 21:13:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473151216193536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:13:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473151216193536[0;39m ==> Parameters: 
2022-04-18 21:13:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473151216193536[0;39m <==    Updates: 1
2022-04-18 21:13:05.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473151216193536[0;39m update ends, take 44 millisecs
2022-04-18 21:13:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473171919278080[0;39m 生成今日电子书快照开始
2022-04-18 21:13:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473171919278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473171919278080[0;39m ==> Parameters: 
2022-04-18 21:13:10.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473171919278080[0;39m <==    Updates: 0
2022-04-18 21:13:10.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473171919278080[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:13:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473192899186688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473192899186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473192899186688[0;39m ==> Parameters: 
2022-04-18 21:13:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473192899186688[0;39m <==    Updates: 0
2022-04-18 21:13:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473192899186688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:13:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473213870706688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473213870706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473213870706688[0;39m ==> Parameters: 
2022-04-18 21:13:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473213870706688[0;39m <==    Updates: 0
2022-04-18 21:13:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473213870706688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:13:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473234842226688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473234842226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473234842226688[0;39m ==> Parameters: 
2022-04-18 21:13:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473234842226688[0;39m <==    Updates: 0
2022-04-18 21:13:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473234842226688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:13:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473255813746688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473255813746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473255813746688[0;39m ==> Parameters: 
2022-04-18 21:13:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473255813746688[0;39m <==    Updates: 0
2022-04-18 21:13:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473255813746688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:13:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473276764295168[0;39m 生成今日电子书快照开始
2022-04-18 21:13:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473276764295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473276764295168[0;39m ==> Parameters: 
2022-04-18 21:13:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473276764295168[0;39m <==    Updates: 0
2022-04-18 21:13:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473276764295168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:13:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473277015953408[0;39m start updating Ebook doc
2022-04-18 21:13:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473277015953408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:13:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473277015953408[0;39m ==> Parameters: 
2022-04-18 21:13:35.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473277015953408[0;39m <==    Updates: 1
2022-04-18 21:13:35.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473277015953408[0;39m update ends, take 34 millisecs
2022-04-18 21:13:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473297765175296[0;39m 生成今日电子书快照开始
2022-04-18 21:13:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473297765175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473297765175296[0;39m ==> Parameters: 
2022-04-18 21:13:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473297765175296[0;39m <==    Updates: 0
2022-04-18 21:13:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473297765175296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:13:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473318736695296[0;39m 生成今日电子书快照开始
2022-04-18 21:13:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473318736695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473318736695296[0;39m ==> Parameters: 
2022-04-18 21:13:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473318736695296[0;39m <==    Updates: 0
2022-04-18 21:13:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473318736695296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:13:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473339699826688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473339699826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473339699826688[0;39m ==> Parameters: 
2022-04-18 21:13:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473339699826688[0;39m <==    Updates: 0
2022-04-18 21:13:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473339699826688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:13:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473360671346688[0;39m 生成今日电子书快照开始
2022-04-18 21:13:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473360671346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:13:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473360671346688[0;39m ==> Parameters: 
2022-04-18 21:13:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473360671346688[0;39m <==    Updates: 0
2022-04-18 21:13:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473360671346688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:14:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473381642866688[0;39m 生成今日电子书快照开始
2022-04-18 21:14:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473381642866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473381642866688[0;39m ==> Parameters: 
2022-04-18 21:14:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473381642866688[0;39m <==    Updates: 0
2022-04-18 21:14:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473381642866688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:14:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473402614386688[0;39m 生成今日电子书快照开始
2022-04-18 21:14:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473402614386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473402614386688[0;39m ==> Parameters: 
2022-04-18 21:14:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473402614386688[0;39m <==    Updates: 0
2022-04-18 21:14:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473402614386688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:14:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473402857656320[0;39m start updating Ebook doc
2022-04-18 21:14:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473402857656320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:14:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473402857656320[0;39m ==> Parameters: 
2022-04-18 21:14:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473402857656320[0;39m <==    Updates: 1
2022-04-18 21:14:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473402857656320[0;39m update ends, take 39 millisecs
2022-04-18 21:14:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473423564935168[0;39m 生成今日电子书快照开始
2022-04-18 21:14:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473423564935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473423564935168[0;39m ==> Parameters: 
2022-04-18 21:14:10.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473423564935168[0;39m <==    Updates: 0
2022-04-18 21:14:10.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473423564935168[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:14:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473444557426688[0;39m 生成今日电子书快照开始
2022-04-18 21:14:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473444557426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473444557426688[0;39m ==> Parameters: 
2022-04-18 21:14:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473444557426688[0;39m <==    Updates: 0
2022-04-18 21:14:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473444557426688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:14:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473465528946688[0;39m 生成今日电子书快照开始
2022-04-18 21:14:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473465528946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473465528946688[0;39m ==> Parameters: 
2022-04-18 21:14:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473465528946688[0;39m <==    Updates: 0
2022-04-18 21:14:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473465528946688[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:14:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473486483689472[0;39m 生成今日电子书快照开始
2022-04-18 21:14:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473486483689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473486483689472[0;39m ==> Parameters: 
2022-04-18 21:14:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473486483689472[0;39m <==    Updates: 0
2022-04-18 21:14:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473486483689472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:14:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473507476180992[0;39m 生成今日电子书快照开始
2022-04-18 21:14:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473507476180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473507476180992[0;39m ==> Parameters: 
2022-04-18 21:14:30.182 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473507476180992[0;39m <==    Updates: 0
2022-04-18 21:14:30.182 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473507476180992[0;39m 生成今日电子书快照结束，耗时：176毫秒
2022-04-18 21:14:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473528464478208[0;39m start updating Ebook doc
2022-04-18 21:14:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473528464478208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:14:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473528464478208[0;39m ==> Parameters: 
2022-04-18 21:14:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473528464478208[0;39m <==    Updates: 1
2022-04-18 21:14:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473528464478208[0;39m update ends, take 56 millisecs
2022-04-18 21:14:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473528699359232[0;39m 生成今日电子书快照开始
2022-04-18 21:14:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473528699359232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473528699359232[0;39m ==> Parameters: 
2022-04-18 21:14:35.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473528699359232[0;39m <==    Updates: 0
2022-04-18 21:14:35.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473528699359232[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 21:14:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473549419220992[0;39m 生成今日电子书快照开始
2022-04-18 21:14:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473549419220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473549419220992[0;39m ==> Parameters: 
2022-04-18 21:14:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473549419220992[0;39m <==    Updates: 0
2022-04-18 21:14:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473549419220992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:14:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473570394935296[0;39m 生成今日电子书快照开始
2022-04-18 21:14:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473570394935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473570394935296[0;39m ==> Parameters: 
2022-04-18 21:14:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473570394935296[0;39m <==    Updates: 0
2022-04-18 21:14:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473570394935296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:14:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473591370649600[0;39m 生成今日电子书快照开始
2022-04-18 21:14:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473591370649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473591370649600[0;39m ==> Parameters: 
2022-04-18 21:14:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473591370649600[0;39m <==    Updates: 0
2022-04-18 21:14:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473591370649600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:14:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473612342169600[0;39m 生成今日电子书快照开始
2022-04-18 21:14:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473612342169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:14:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473612342169600[0;39m ==> Parameters: 
2022-04-18 21:14:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473612342169600[0;39m <==    Updates: 0
2022-04-18 21:14:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473612342169600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:15:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473633309495296[0;39m 生成今日电子书快照开始
2022-04-18 21:15:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473633309495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473633309495296[0;39m ==> Parameters: 
2022-04-18 21:15:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473633309495296[0;39m <==    Updates: 0
2022-04-18 21:15:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473633309495296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:15:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473654276820992[0;39m 生成今日电子书快照开始
2022-04-18 21:15:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473654276820992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473654276820992[0;39m ==> Parameters: 
2022-04-18 21:15:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473654276820992[0;39m <==    Updates: 0
2022-04-18 21:15:05.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473654276820992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:15:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473654562033664[0;39m start updating Ebook doc
2022-04-18 21:15:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473654562033664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:15:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473654562033664[0;39m ==> Parameters: 
2022-04-18 21:15:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473654562033664[0;39m <==    Updates: 1
2022-04-18 21:15:05.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473654562033664[0;39m update ends, take 39 millisecs
2022-04-18 21:15:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473675256729600[0;39m 生成今日电子书快照开始
2022-04-18 21:15:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473675256729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473675256729600[0;39m ==> Parameters: 
2022-04-18 21:15:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473675256729600[0;39m <==    Updates: 0
2022-04-18 21:15:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473675256729600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:15:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473696228249600[0;39m 生成今日电子书快照开始
2022-04-18 21:15:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473696228249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473696228249600[0;39m ==> Parameters: 
2022-04-18 21:15:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473696228249600[0;39m <==    Updates: 0
2022-04-18 21:15:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473696228249600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:15:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473717199769600[0;39m 生成今日电子书快照开始
2022-04-18 21:15:20.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473717199769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:20.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473717199769600[0;39m ==> Parameters: 
2022-04-18 21:15:20.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473717199769600[0;39m <==    Updates: 0
2022-04-18 21:15:20.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473717199769600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 21:15:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473738171289600[0;39m 生成今日电子书快照开始
2022-04-18 21:15:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473738171289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473738171289600[0;39m ==> Parameters: 
2022-04-18 21:15:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473738171289600[0;39m <==    Updates: 0
2022-04-18 21:15:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473738171289600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:15:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473759147003904[0;39m 生成今日电子书快照开始
2022-04-18 21:15:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473759147003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473759147003904[0;39m ==> Parameters: 
2022-04-18 21:15:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473759147003904[0;39m <==    Updates: 0
2022-04-18 21:15:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473759147003904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:15:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473780118523904[0;39m start updating Ebook doc
2022-04-18 21:15:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473780118523904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:15:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473780118523904[0;39m ==> Parameters: 
2022-04-18 21:15:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473780118523904[0;39m <==    Updates: 1
2022-04-18 21:15:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473780118523904[0;39m update ends, take 57 millisecs
2022-04-18 21:15:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473780357599232[0;39m 生成今日电子书快照开始
2022-04-18 21:15:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473780357599232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473780357599232[0;39m ==> Parameters: 
2022-04-18 21:15:35.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473780357599232[0;39m <==    Updates: 0
2022-04-18 21:15:35.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473780357599232[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 21:15:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473801090043904[0;39m 生成今日电子书快照开始
2022-04-18 21:15:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473801090043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473801090043904[0;39m ==> Parameters: 
2022-04-18 21:15:40.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473801090043904[0;39m <==    Updates: 0
2022-04-18 21:15:40.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473801090043904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:15:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473822061563904[0;39m 生成今日电子书快照开始
2022-04-18 21:15:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473822061563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473822061563904[0;39m ==> Parameters: 
2022-04-18 21:15:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473822061563904[0;39m <==    Updates: 0
2022-04-18 21:15:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473822061563904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:15:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473843024695296[0;39m 生成今日电子书快照开始
2022-04-18 21:15:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473843024695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473843024695296[0;39m ==> Parameters: 
2022-04-18 21:15:50.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473843024695296[0;39m <==    Updates: 0
2022-04-18 21:15:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473843024695296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:15:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473864008798208[0;39m 生成今日电子书快照开始
2022-04-18 21:15:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473864008798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:15:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473864008798208[0;39m ==> Parameters: 
2022-04-18 21:15:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473864008798208[0;39m <==    Updates: 0
2022-04-18 21:15:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473864008798208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:16:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473884971929600[0;39m 生成今日电子书快照开始
2022-04-18 21:16:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473884971929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473884971929600[0;39m ==> Parameters: 
2022-04-18 21:16:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473884971929600[0;39m <==    Updates: 0
2022-04-18 21:16:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473884971929600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:16:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473905947643904[0;39m 生成今日电子书快照开始
2022-04-18 21:16:05.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473905947643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:05.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473905947643904[0;39m ==> Parameters: 
2022-04-18 21:16:05.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473905947643904[0;39m <==    Updates: 0
2022-04-18 21:16:05.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473905947643904[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:16:05.083 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171473906258022400[0;39m start updating Ebook doc
2022-04-18 21:16:05.084 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473906258022400[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:16:05.084 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473906258022400[0;39m ==> Parameters: 
2022-04-18 21:16:05.125 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171473906258022400[0;39m <==    Updates: 1
2022-04-18 21:16:05.125 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171473906258022400[0;39m update ends, take 42 millisecs
2022-04-18 21:16:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473926910775296[0;39m 生成今日电子书快照开始
2022-04-18 21:16:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473926910775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473926910775296[0;39m ==> Parameters: 
2022-04-18 21:16:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473926910775296[0;39m <==    Updates: 0
2022-04-18 21:16:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473926910775296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:16:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473947890683904[0;39m 生成今日电子书快照开始
2022-04-18 21:16:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473947890683904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473947890683904[0;39m ==> Parameters: 
2022-04-18 21:16:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473947890683904[0;39m <==    Updates: 0
2022-04-18 21:16:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473947890683904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:16:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473968858009600[0;39m 生成今日电子书快照开始
2022-04-18 21:16:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473968858009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473968858009600[0;39m ==> Parameters: 
2022-04-18 21:16:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473968858009600[0;39m <==    Updates: 0
2022-04-18 21:16:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473968858009600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:16:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171473989829529600[0;39m 生成今日电子书快照开始
2022-04-18 21:16:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473989829529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473989829529600[0;39m ==> Parameters: 
2022-04-18 21:16:25.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171473989829529600[0;39m <==    Updates: 0
2022-04-18 21:16:25.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171473989829529600[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 21:16:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474010801049600[0;39m 生成今日电子书快照开始
2022-04-18 21:16:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474010801049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474010801049600[0;39m ==> Parameters: 
2022-04-18 21:16:30.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474010801049600[0;39m <==    Updates: 0
2022-04-18 21:16:30.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474010801049600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:16:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474031776763904[0;39m 生成今日电子书快照开始
2022-04-18 21:16:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474031776763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474031776763904[0;39m ==> Parameters: 
2022-04-18 21:16:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474031776763904[0;39m <==    Updates: 0
2022-04-18 21:16:35.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474031776763904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:16:35.079 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474032070365184[0;39m start updating Ebook doc
2022-04-18 21:16:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474032070365184[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:16:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474032070365184[0;39m ==> Parameters: 
2022-04-18 21:16:35.129 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474032070365184[0;39m <==    Updates: 1
2022-04-18 21:16:35.129 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474032070365184[0;39m update ends, take 50 millisecs
2022-04-18 21:16:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474052748283904[0;39m 生成今日电子书快照开始
2022-04-18 21:16:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474052748283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474052748283904[0;39m ==> Parameters: 
2022-04-18 21:16:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474052748283904[0;39m <==    Updates: 0
2022-04-18 21:16:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474052748283904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:16:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474073715609600[0;39m 生成今日电子书快照开始
2022-04-18 21:16:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474073715609600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474073715609600[0;39m ==> Parameters: 
2022-04-18 21:16:45.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474073715609600[0;39m <==    Updates: 0
2022-04-18 21:16:45.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474073715609600[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:16:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474094691323904[0;39m 生成今日电子书快照开始
2022-04-18 21:16:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474094691323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474094691323904[0;39m ==> Parameters: 
2022-04-18 21:16:50.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474094691323904[0;39m <==    Updates: 0
2022-04-18 21:16:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474094691323904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:16:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474115667038208[0;39m 生成今日电子书快照开始
2022-04-18 21:16:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474115667038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:16:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474115667038208[0;39m ==> Parameters: 
2022-04-18 21:16:55.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474115667038208[0;39m <==    Updates: 0
2022-04-18 21:16:55.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474115667038208[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:17:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474136630169600[0;39m 生成今日电子书快照开始
2022-04-18 21:17:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474136630169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474136630169600[0;39m ==> Parameters: 
2022-04-18 21:17:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474136630169600[0;39m <==    Updates: 0
2022-04-18 21:17:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474136630169600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:17:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474157597495296[0;39m 生成今日电子书快照开始
2022-04-18 21:17:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474157597495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474157597495296[0;39m ==> Parameters: 
2022-04-18 21:17:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474157597495296[0;39m <==    Updates: 0
2022-04-18 21:17:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474157597495296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:17:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474157861736448[0;39m start updating Ebook doc
2022-04-18 21:17:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474157861736448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:17:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474157861736448[0;39m ==> Parameters: 
2022-04-18 21:17:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474157861736448[0;39m <==    Updates: 1
2022-04-18 21:17:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474157861736448[0;39m update ends, take 35 millisecs
2022-04-18 21:17:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474178573209600[0;39m 生成今日电子书快照开始
2022-04-18 21:17:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474178573209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474178573209600[0;39m ==> Parameters: 
2022-04-18 21:17:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474178573209600[0;39m <==    Updates: 0
2022-04-18 21:17:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474178573209600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:17:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474199540535296[0;39m 生成今日电子书快照开始
2022-04-18 21:17:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474199540535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474199540535296[0;39m ==> Parameters: 
2022-04-18 21:17:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474199540535296[0;39m <==    Updates: 0
2022-04-18 21:17:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474199540535296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:17:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474220520443904[0;39m 生成今日电子书快照开始
2022-04-18 21:17:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474220520443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474220520443904[0;39m ==> Parameters: 
2022-04-18 21:17:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474220520443904[0;39m <==    Updates: 0
2022-04-18 21:17:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474220520443904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:17:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474241496158208[0;39m 生成今日电子书快照开始
2022-04-18 21:17:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474241496158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474241496158208[0;39m ==> Parameters: 
2022-04-18 21:17:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474241496158208[0;39m <==    Updates: 0
2022-04-18 21:17:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474241496158208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:17:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474262463483904[0;39m 生成今日电子书快照开始
2022-04-18 21:17:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474262463483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474262463483904[0;39m ==> Parameters: 
2022-04-18 21:17:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474262463483904[0;39m <==    Updates: 0
2022-04-18 21:17:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474262463483904[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:17:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474283439198208[0;39m 生成今日电子书快照开始
2022-04-18 21:17:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474283439198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474283439198208[0;39m ==> Parameters: 
2022-04-18 21:17:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474283439198208[0;39m <==    Updates: 0
2022-04-18 21:17:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474283439198208[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:17:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474283678273536[0;39m start updating Ebook doc
2022-04-18 21:17:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474283678273536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:17:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474283678273536[0;39m ==> Parameters: 
2022-04-18 21:17:35.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474283678273536[0;39m <==    Updates: 1
2022-04-18 21:17:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474283678273536[0;39m update ends, take 37 millisecs
2022-04-18 21:17:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474304406523904[0;39m 生成今日电子书快照开始
2022-04-18 21:17:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474304406523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474304406523904[0;39m ==> Parameters: 
2022-04-18 21:17:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474304406523904[0;39m <==    Updates: 0
2022-04-18 21:17:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474304406523904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:17:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474325344489472[0;39m 生成今日电子书快照开始
2022-04-18 21:17:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474325344489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474325344489472[0;39m ==> Parameters: 
2022-04-18 21:17:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474325344489472[0;39m <==    Updates: 0
2022-04-18 21:17:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474325344489472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:17:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474346353758208[0;39m 生成今日电子书快照开始
2022-04-18 21:17:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474346353758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474346353758208[0;39m ==> Parameters: 
2022-04-18 21:17:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474346353758208[0;39m <==    Updates: 0
2022-04-18 21:17:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474346353758208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:17:55.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474367329472512[0;39m 生成今日电子书快照开始
2022-04-18 21:17:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474367329472512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:17:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474367329472512[0;39m ==> Parameters: 
2022-04-18 21:17:55.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474367329472512[0;39m <==    Updates: 0
2022-04-18 21:17:55.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474367329472512[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:18:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474388259049472[0;39m 生成今日电子书快照开始
2022-04-18 21:18:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474388259049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474388259049472[0;39m ==> Parameters: 
2022-04-18 21:18:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474388259049472[0;39m <==    Updates: 0
2022-04-18 21:18:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474388259049472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:18:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474409251540992[0;39m 生成今日电子书快照开始
2022-04-18 21:18:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474409251540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474409251540992[0;39m ==> Parameters: 
2022-04-18 21:18:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474409251540992[0;39m <==    Updates: 0
2022-04-18 21:18:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474409251540992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:18:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474409515782144[0;39m start updating Ebook doc
2022-04-18 21:18:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474409515782144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:18:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474409515782144[0;39m ==> Parameters: 
2022-04-18 21:18:05.115 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474409515782144[0;39m <==    Updates: 1
2022-04-18 21:18:05.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474409515782144[0;39m update ends, take 46 millisecs
2022-04-18 21:18:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474430231449600[0;39m 生成今日电子书快照开始
2022-04-18 21:18:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474430231449600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474430231449600[0;39m ==> Parameters: 
2022-04-18 21:18:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474430231449600[0;39m <==    Updates: 0
2022-04-18 21:18:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474430231449600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:18:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474451202969600[0;39m 生成今日电子书快照开始
2022-04-18 21:18:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474451202969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474451202969600[0;39m ==> Parameters: 
2022-04-18 21:18:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474451202969600[0;39m <==    Updates: 0
2022-04-18 21:18:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474451202969600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:18:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474472166100992[0;39m 生成今日电子书快照开始
2022-04-18 21:18:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474472166100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474472166100992[0;39m ==> Parameters: 
2022-04-18 21:18:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474472166100992[0;39m <==    Updates: 0
2022-04-18 21:18:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474472166100992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:18:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474493150203904[0;39m 生成今日电子书快照开始
2022-04-18 21:18:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474493150203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474493150203904[0;39m ==> Parameters: 
2022-04-18 21:18:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474493150203904[0;39m <==    Updates: 0
2022-04-18 21:18:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474493150203904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:18:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474514125918208[0;39m 生成今日电子书快照开始
2022-04-18 21:18:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474514125918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474514125918208[0;39m ==> Parameters: 
2022-04-18 21:18:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474514125918208[0;39m <==    Updates: 0
2022-04-18 21:18:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474514125918208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:18:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474535063883776[0;39m 生成今日电子书快照开始
2022-04-18 21:18:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474535063883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474535063883776[0;39m ==> Parameters: 
2022-04-18 21:18:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474535063883776[0;39m <==    Updates: 0
2022-04-18 21:18:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474535063883776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:18:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474535286181888[0;39m start updating Ebook doc
2022-04-18 21:18:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474535286181888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:18:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474535286181888[0;39m ==> Parameters: 
2022-04-18 21:18:35.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474535286181888[0;39m <==    Updates: 1
2022-04-18 21:18:35.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474535286181888[0;39m update ends, take 38 millisecs
2022-04-18 21:18:40.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474556073152512[0;39m 生成今日电子书快照开始
2022-04-18 21:18:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474556073152512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474556073152512[0;39m ==> Parameters: 
2022-04-18 21:18:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474556073152512[0;39m <==    Updates: 0
2022-04-18 21:18:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474556073152512[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:18:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474577040478208[0;39m 生成今日电子书快照开始
2022-04-18 21:18:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474577040478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474577040478208[0;39m ==> Parameters: 
2022-04-18 21:18:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474577040478208[0;39m <==    Updates: 0
2022-04-18 21:18:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474577040478208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:18:50.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474598016192512[0;39m 生成今日电子书快照开始
2022-04-18 21:18:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474598016192512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474598016192512[0;39m ==> Parameters: 
2022-04-18 21:18:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474598016192512[0;39m <==    Updates: 0
2022-04-18 21:18:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474598016192512[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:18:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474618970935296[0;39m 生成今日电子书快照开始
2022-04-18 21:18:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474618970935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:18:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474618970935296[0;39m ==> Parameters: 
2022-04-18 21:18:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474618970935296[0;39m <==    Updates: 0
2022-04-18 21:18:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474618970935296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:19:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474639950843904[0;39m 生成今日电子书快照开始
2022-04-18 21:19:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474639950843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474639950843904[0;39m ==> Parameters: 
2022-04-18 21:19:00.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474639950843904[0;39m <==    Updates: 0
2022-04-18 21:19:00.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474639950843904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:19:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474660888809472[0;39m 生成今日电子书快照开始
2022-04-18 21:19:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474660888809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:05.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474660888809472[0;39m ==> Parameters: 
2022-04-18 21:19:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474660888809472[0;39m <==    Updates: 0
2022-04-18 21:19:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474660888809472[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:19:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474661199187968[0;39m start updating Ebook doc
2022-04-18 21:19:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474661199187968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:19:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474661199187968[0;39m ==> Parameters: 
2022-04-18 21:19:05.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474661199187968[0;39m <==    Updates: 1
2022-04-18 21:19:05.118 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474661199187968[0;39m update ends, take 43 millisecs
2022-04-18 21:19:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474681893883904[0;39m 生成今日电子书快照开始
2022-04-18 21:19:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474681893883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474681893883904[0;39m ==> Parameters: 
2022-04-18 21:19:10.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474681893883904[0;39m <==    Updates: 0
2022-04-18 21:19:10.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474681893883904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:19:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474702869598208[0;39m 生成今日电子书快照开始
2022-04-18 21:19:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474702869598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474702869598208[0;39m ==> Parameters: 
2022-04-18 21:19:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474702869598208[0;39m <==    Updates: 0
2022-04-18 21:19:15.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474702869598208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:19:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474723828535296[0;39m 生成今日电子书快照开始
2022-04-18 21:19:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474723828535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474723828535296[0;39m ==> Parameters: 
2022-04-18 21:19:20.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474723828535296[0;39m <==    Updates: 0
2022-04-18 21:19:20.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474723828535296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:19:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474744795860992[0;39m 生成今日电子书快照开始
2022-04-18 21:19:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474744795860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474744795860992[0;39m ==> Parameters: 
2022-04-18 21:19:25.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474744795860992[0;39m <==    Updates: 0
2022-04-18 21:19:25.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474744795860992[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 21:19:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474765746409472[0;39m 生成今日电子书快照开始
2022-04-18 21:19:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474765746409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474765746409472[0;39m ==> Parameters: 
2022-04-18 21:19:30.240 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474765746409472[0;39m <==    Updates: 0
2022-04-18 21:19:30.241 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474765746409472[0;39m 生成今日电子书快照结束，耗时：240毫秒
2022-04-18 21:19:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474786734706688[0;39m 生成今日电子书快照开始
2022-04-18 21:19:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474786734706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474786734706688[0;39m ==> Parameters: 
2022-04-18 21:19:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474786734706688[0;39m <==    Updates: 0
2022-04-18 21:19:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474786734706688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:19:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474787028307968[0;39m start updating Ebook doc
2022-04-18 21:19:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474787028307968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:19:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474787028307968[0;39m ==> Parameters: 
2022-04-18 21:19:35.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474787028307968[0;39m <==    Updates: 1
2022-04-18 21:19:35.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474787028307968[0;39m update ends, take 44 millisecs
2022-04-18 21:19:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474807714615296[0;39m 生成今日电子书快照开始
2022-04-18 21:19:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474807714615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474807714615296[0;39m ==> Parameters: 
2022-04-18 21:19:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474807714615296[0;39m <==    Updates: 0
2022-04-18 21:19:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474807714615296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:19:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474828698718208[0;39m 生成今日电子书快照开始
2022-04-18 21:19:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474828698718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474828698718208[0;39m ==> Parameters: 
2022-04-18 21:19:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474828698718208[0;39m <==    Updates: 0
2022-04-18 21:19:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474828698718208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:19:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474849670238208[0;39m 生成今日电子书快照开始
2022-04-18 21:19:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474849670238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474849670238208[0;39m ==> Parameters: 
2022-04-18 21:19:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474849670238208[0;39m <==    Updates: 0
2022-04-18 21:19:50.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474849670238208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:19:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474870599815168[0;39m 生成今日电子书快照开始
2022-04-18 21:19:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474870599815168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:19:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474870599815168[0;39m ==> Parameters: 
2022-04-18 21:19:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474870599815168[0;39m <==    Updates: 0
2022-04-18 21:19:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474870599815168[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:20:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474891575529472[0;39m 生成今日电子书快照开始
2022-04-18 21:20:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474891575529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474891575529472[0;39m ==> Parameters: 
2022-04-18 21:20:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474891575529472[0;39m <==    Updates: 0
2022-04-18 21:20:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474891575529472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:20:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474912568020992[0;39m 生成今日电子书快照开始
2022-04-18 21:20:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474912568020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474912568020992[0;39m ==> Parameters: 
2022-04-18 21:20:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474912568020992[0;39m <==    Updates: 0
2022-04-18 21:20:05.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474912568020992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:20:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171474912853233664[0;39m start updating Ebook doc
2022-04-18 21:20:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474912853233664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:20:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474912853233664[0;39m ==> Parameters: 
2022-04-18 21:20:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171474912853233664[0;39m <==    Updates: 1
2022-04-18 21:20:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171474912853233664[0;39m update ends, take 38 millisecs
2022-04-18 21:20:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474933518569472[0;39m 生成今日电子书快照开始
2022-04-18 21:20:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474933518569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474933518569472[0;39m ==> Parameters: 
2022-04-18 21:20:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474933518569472[0;39m <==    Updates: 0
2022-04-18 21:20:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474933518569472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:20:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474954506866688[0;39m 生成今日电子书快照开始
2022-04-18 21:20:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474954506866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474954506866688[0;39m ==> Parameters: 
2022-04-18 21:20:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474954506866688[0;39m <==    Updates: 0
2022-04-18 21:20:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474954506866688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:20:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474975482580992[0;39m 生成今日电子书快照开始
2022-04-18 21:20:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474975482580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474975482580992[0;39m ==> Parameters: 
2022-04-18 21:20:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474975482580992[0;39m <==    Updates: 0
2022-04-18 21:20:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474975482580992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:20:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171474996437323776[0;39m 生成今日电子书快照开始
2022-04-18 21:20:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474996437323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474996437323776[0;39m ==> Parameters: 
2022-04-18 21:20:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171474996437323776[0;39m <==    Updates: 0
2022-04-18 21:20:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171474996437323776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:20:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475017408843776[0;39m 生成今日电子书快照开始
2022-04-18 21:20:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475017408843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475017408843776[0;39m ==> Parameters: 
2022-04-18 21:20:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475017408843776[0;39m <==    Updates: 0
2022-04-18 21:20:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475017408843776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:20:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475038401335296[0;39m 生成今日电子书快照开始
2022-04-18 21:20:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475038401335296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475038401335296[0;39m ==> Parameters: 
2022-04-18 21:20:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475038401335296[0;39m <==    Updates: 0
2022-04-18 21:20:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475038401335296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:20:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475038690742272[0;39m start updating Ebook doc
2022-04-18 21:20:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475038690742272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:20:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475038690742272[0;39m ==> Parameters: 
2022-04-18 21:20:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475038690742272[0;39m <==    Updates: 1
2022-04-18 21:20:35.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475038690742272[0;39m update ends, take 41 millisecs
2022-04-18 21:20:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475059372855296[0;39m 生成今日电子书快照开始
2022-04-18 21:20:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475059372855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475059372855296[0;39m ==> Parameters: 
2022-04-18 21:20:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475059372855296[0;39m <==    Updates: 0
2022-04-18 21:20:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475059372855296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:20:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475080356958208[0;39m 生成今日电子书快照开始
2022-04-18 21:20:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475080356958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475080356958208[0;39m ==> Parameters: 
2022-04-18 21:20:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475080356958208[0;39m <==    Updates: 0
2022-04-18 21:20:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475080356958208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:20:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475101324283904[0;39m 生成今日电子书快照开始
2022-04-18 21:20:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475101324283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475101324283904[0;39m ==> Parameters: 
2022-04-18 21:20:50.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475101324283904[0;39m <==    Updates: 0
2022-04-18 21:20:50.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475101324283904[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:20:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475122279026688[0;39m 生成今日电子书快照开始
2022-04-18 21:20:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475122279026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:20:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475122279026688[0;39m ==> Parameters: 
2022-04-18 21:20:55.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475122279026688[0;39m <==    Updates: 0
2022-04-18 21:20:55.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475122279026688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:21:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475143254740992[0;39m 生成今日电子书快照开始
2022-04-18 21:21:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475143254740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475143254740992[0;39m ==> Parameters: 
2022-04-18 21:21:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475143254740992[0;39m <==    Updates: 0
2022-04-18 21:21:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475143254740992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:21:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475164213678080[0;39m start updating Ebook doc
2022-04-18 21:21:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475164213678080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:21:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475164213678080[0;39m ==> Parameters: 
2022-04-18 21:21:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475164213678080[0;39m <==    Updates: 1
2022-04-18 21:21:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475164213678080[0;39m update ends, take 69 millisecs
2022-04-18 21:21:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475164503085056[0;39m 生成今日电子书快照开始
2022-04-18 21:21:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475164503085056[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475164503085056[0;39m ==> Parameters: 
2022-04-18 21:21:05.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475164503085056[0;39m <==    Updates: 0
2022-04-18 21:21:05.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475164503085056[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 21:21:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475185210363904[0;39m 生成今日电子书快照开始
2022-04-18 21:21:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475185210363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475185210363904[0;39m ==> Parameters: 
2022-04-18 21:21:10.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475185210363904[0;39m <==    Updates: 0
2022-04-18 21:21:10.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475185210363904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:21:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475206144135168[0;39m 生成今日电子书快照开始
2022-04-18 21:21:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475206144135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475206144135168[0;39m ==> Parameters: 
2022-04-18 21:21:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475206144135168[0;39m <==    Updates: 0
2022-04-18 21:21:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475206144135168[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:21:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475227157598208[0;39m 生成今日电子书快照开始
2022-04-18 21:21:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475227157598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475227157598208[0;39m ==> Parameters: 
2022-04-18 21:21:20.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475227157598208[0;39m <==    Updates: 0
2022-04-18 21:21:20.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475227157598208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:21:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475248120729600[0;39m 生成今日电子书快照开始
2022-04-18 21:21:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475248120729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475248120729600[0;39m ==> Parameters: 
2022-04-18 21:21:25.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475248120729600[0;39m <==    Updates: 0
2022-04-18 21:21:25.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475248120729600[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 21:21:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475269092249600[0;39m 生成今日电子书快照开始
2022-04-18 21:21:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475269092249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475269092249600[0;39m ==> Parameters: 
2022-04-18 21:21:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475269092249600[0;39m <==    Updates: 0
2022-04-18 21:21:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475269092249600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:21:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475290034409472[0;39m start updating Ebook doc
2022-04-18 21:21:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475290034409472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:21:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475290034409472[0;39m ==> Parameters: 
2022-04-18 21:21:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475290034409472[0;39m <==    Updates: 1
2022-04-18 21:21:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475290034409472[0;39m update ends, take 60 millisecs
2022-04-18 21:21:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475290286067712[0;39m 生成今日电子书快照开始
2022-04-18 21:21:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475290286067712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475290286067712[0;39m ==> Parameters: 
2022-04-18 21:21:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475290286067712[0;39m <==    Updates: 0
2022-04-18 21:21:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475290286067712[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 21:21:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475311001735168[0;39m 生成今日电子书快照开始
2022-04-18 21:21:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475311001735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475311001735168[0;39m ==> Parameters: 
2022-04-18 21:21:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475311001735168[0;39m <==    Updates: 0
2022-04-18 21:21:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475311001735168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:21:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475332015198208[0;39m 生成今日电子书快照开始
2022-04-18 21:21:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475332015198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475332015198208[0;39m ==> Parameters: 
2022-04-18 21:21:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475332015198208[0;39m <==    Updates: 0
2022-04-18 21:21:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475332015198208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:21:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475352986718208[0;39m 生成今日电子书快照开始
2022-04-18 21:21:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475352986718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475352986718208[0;39m ==> Parameters: 
2022-04-18 21:21:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475352986718208[0;39m <==    Updates: 0
2022-04-18 21:21:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475352986718208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:21:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475373933072384[0;39m 生成今日电子书快照开始
2022-04-18 21:21:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475373933072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:21:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475373933072384[0;39m ==> Parameters: 
2022-04-18 21:21:55.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475373933072384[0;39m <==    Updates: 0
2022-04-18 21:21:55.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475373933072384[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-18 21:22:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475394892009472[0;39m 生成今日电子书快照开始
2022-04-18 21:22:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475394892009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475394892009472[0;39m ==> Parameters: 
2022-04-18 21:22:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475394892009472[0;39m <==    Updates: 0
2022-04-18 21:22:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475394892009472[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:22:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475415863529472[0;39m start updating Ebook doc
2022-04-18 21:22:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475415863529472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:22:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475415863529472[0;39m ==> Parameters: 
2022-04-18 21:22:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475415863529472[0;39m <==    Updates: 1
2022-04-18 21:22:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475415863529472[0;39m update ends, take 64 millisecs
2022-04-18 21:22:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475416131964928[0;39m 生成今日电子书快照开始
2022-04-18 21:22:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475416131964928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475416131964928[0;39m ==> Parameters: 
2022-04-18 21:22:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475416131964928[0;39m <==    Updates: 0
2022-04-18 21:22:05.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475416131964928[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 21:22:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475436847632384[0;39m 生成今日电子书快照开始
2022-04-18 21:22:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475436847632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475436847632384[0;39m ==> Parameters: 
2022-04-18 21:22:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475436847632384[0;39m <==    Updates: 0
2022-04-18 21:22:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475436847632384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:22:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475457814958080[0;39m 生成今日电子书快照开始
2022-04-18 21:22:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475457814958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475457814958080[0;39m ==> Parameters: 
2022-04-18 21:22:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475457814958080[0;39m <==    Updates: 0
2022-04-18 21:22:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475457814958080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:22:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475478815838208[0;39m 生成今日电子书快照开始
2022-04-18 21:22:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475478815838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475478815838208[0;39m ==> Parameters: 
2022-04-18 21:22:20.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475478815838208[0;39m <==    Updates: 0
2022-04-18 21:22:20.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475478815838208[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:22:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475499770580992[0;39m 生成今日电子书快照开始
2022-04-18 21:22:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475499770580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475499770580992[0;39m ==> Parameters: 
2022-04-18 21:22:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475499770580992[0;39m <==    Updates: 0
2022-04-18 21:22:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475499770580992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:22:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475520721129472[0;39m 生成今日电子书快照开始
2022-04-18 21:22:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475520721129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475520721129472[0;39m ==> Parameters: 
2022-04-18 21:22:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475520721129472[0;39m <==    Updates: 0
2022-04-18 21:22:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475520721129472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:22:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475541705232384[0;39m 生成今日电子书快照开始
2022-04-18 21:22:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475541705232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475541705232384[0;39m ==> Parameters: 
2022-04-18 21:22:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475541705232384[0;39m <==    Updates: 0
2022-04-18 21:22:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475541705232384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:22:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475541948502016[0;39m start updating Ebook doc
2022-04-18 21:22:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475541948502016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:22:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475541948502016[0;39m ==> Parameters: 
2022-04-18 21:22:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475541948502016[0;39m <==    Updates: 1
2022-04-18 21:22:35.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475541948502016[0;39m update ends, take 43 millisecs
2022-04-18 21:22:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475562672558080[0;39m 生成今日电子书快照开始
2022-04-18 21:22:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475562672558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475562672558080[0;39m ==> Parameters: 
2022-04-18 21:22:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475562672558080[0;39m <==    Updates: 0
2022-04-18 21:22:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475562672558080[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 21:22:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475583648272384[0;39m 生成今日电子书快照开始
2022-04-18 21:22:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475583648272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475583648272384[0;39m ==> Parameters: 
2022-04-18 21:22:45.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475583648272384[0;39m <==    Updates: 0
2022-04-18 21:22:45.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475583648272384[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:22:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475604640763904[0;39m 生成今日电子书快照开始
2022-04-18 21:22:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475604640763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475604640763904[0;39m ==> Parameters: 
2022-04-18 21:22:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475604640763904[0;39m <==    Updates: 0
2022-04-18 21:22:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475604640763904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:22:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475625599700992[0;39m 生成今日电子书快照开始
2022-04-18 21:22:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475625599700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:22:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475625599700992[0;39m ==> Parameters: 
2022-04-18 21:22:55.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475625599700992[0;39m <==    Updates: 0
2022-04-18 21:22:55.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475625599700992[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:23:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475646571220992[0;39m 生成今日电子书快照开始
2022-04-18 21:23:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475646571220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475646571220992[0;39m ==> Parameters: 
2022-04-18 21:23:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475646571220992[0;39m <==    Updates: 0
2022-04-18 21:23:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475646571220992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:23:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475667530158080[0;39m 生成今日电子书快照开始
2022-04-18 21:23:05.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475667530158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:05.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475667530158080[0;39m ==> Parameters: 
2022-04-18 21:23:05.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475667530158080[0;39m <==    Updates: 0
2022-04-18 21:23:05.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475667530158080[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-18 21:23:05.088 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475667886673920[0;39m start updating Ebook doc
2022-04-18 21:23:05.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475667886673920[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:23:05.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475667886673920[0;39m ==> Parameters: 
2022-04-18 21:23:05.129 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475667886673920[0;39m <==    Updates: 1
2022-04-18 21:23:05.129 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475667886673920[0;39m update ends, take 41 millisecs
2022-04-18 21:23:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475688510066688[0;39m 生成今日电子书快照开始
2022-04-18 21:23:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475688510066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475688510066688[0;39m ==> Parameters: 
2022-04-18 21:23:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475688510066688[0;39m <==    Updates: 0
2022-04-18 21:23:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475688510066688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:23:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475709502558208[0;39m 生成今日电子书快照开始
2022-04-18 21:23:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475709502558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475709502558208[0;39m ==> Parameters: 
2022-04-18 21:23:15.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475709502558208[0;39m <==    Updates: 0
2022-04-18 21:23:15.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475709502558208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:23:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475730440523776[0;39m 生成今日电子书快照开始
2022-04-18 21:23:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475730440523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475730440523776[0;39m ==> Parameters: 
2022-04-18 21:23:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475730440523776[0;39m <==    Updates: 0
2022-04-18 21:23:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475730440523776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:23:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475751428820992[0;39m 生成今日电子书快照开始
2022-04-18 21:23:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475751428820992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475751428820992[0;39m ==> Parameters: 
2022-04-18 21:23:25.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475751428820992[0;39m <==    Updates: 0
2022-04-18 21:23:25.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475751428820992[0;39m 生成今日电子书快照结束，耗时：98毫秒
2022-04-18 21:23:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475772412923904[0;39m 生成今日电子书快照开始
2022-04-18 21:23:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475772412923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475772412923904[0;39m ==> Parameters: 
2022-04-18 21:23:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475772412923904[0;39m <==    Updates: 0
2022-04-18 21:23:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475772412923904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:23:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475793371860992[0;39m 生成今日电子书快照开始
2022-04-18 21:23:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475793371860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475793371860992[0;39m ==> Parameters: 
2022-04-18 21:23:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475793371860992[0;39m <==    Updates: 0
2022-04-18 21:23:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475793371860992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:23:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475793623519232[0;39m start updating Ebook doc
2022-04-18 21:23:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475793623519232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:23:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475793623519232[0;39m ==> Parameters: 
2022-04-18 21:23:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475793623519232[0;39m <==    Updates: 1
2022-04-18 21:23:35.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475793623519232[0;39m update ends, take 40 millisecs
2022-04-18 21:23:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475814355963904[0;39m 生成今日电子书快照开始
2022-04-18 21:23:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475814355963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475814355963904[0;39m ==> Parameters: 
2022-04-18 21:23:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475814355963904[0;39m <==    Updates: 0
2022-04-18 21:23:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475814355963904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:23:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475835310706688[0;39m 生成今日电子书快照开始
2022-04-18 21:23:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475835310706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475835310706688[0;39m ==> Parameters: 
2022-04-18 21:23:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475835310706688[0;39m <==    Updates: 0
2022-04-18 21:23:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475835310706688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:23:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475856261255168[0;39m 生成今日电子书快照开始
2022-04-18 21:23:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475856261255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475856261255168[0;39m ==> Parameters: 
2022-04-18 21:23:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475856261255168[0;39m <==    Updates: 0
2022-04-18 21:23:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475856261255168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:23:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475877257940992[0;39m 生成今日电子书快照开始
2022-04-18 21:23:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475877257940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:23:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475877257940992[0;39m ==> Parameters: 
2022-04-18 21:23:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475877257940992[0;39m <==    Updates: 0
2022-04-18 21:23:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475877257940992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:24:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475898208489472[0;39m 生成今日电子书快照开始
2022-04-18 21:24:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475898208489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475898208489472[0;39m ==> Parameters: 
2022-04-18 21:24:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475898208489472[0;39m <==    Updates: 0
2022-04-18 21:24:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475898208489472[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:24:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475919205175296[0;39m 生成今日电子书快照开始
2022-04-18 21:24:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475919205175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475919205175296[0;39m ==> Parameters: 
2022-04-18 21:24:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475919205175296[0;39m <==    Updates: 0
2022-04-18 21:24:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475919205175296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:24:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171475919448444928[0;39m start updating Ebook doc
2022-04-18 21:24:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475919448444928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:24:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475919448444928[0;39m ==> Parameters: 
2022-04-18 21:24:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171475919448444928[0;39m <==    Updates: 1
2022-04-18 21:24:05.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171475919448444928[0;39m update ends, take 46 millisecs
2022-04-18 21:24:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475940164112384[0;39m 生成今日电子书快照开始
2022-04-18 21:24:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475940164112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475940164112384[0;39m ==> Parameters: 
2022-04-18 21:24:10.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475940164112384[0;39m <==    Updates: 0
2022-04-18 21:24:10.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475940164112384[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 21:24:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475961139826688[0;39m 生成今日电子书快照开始
2022-04-18 21:24:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475961139826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475961139826688[0;39m ==> Parameters: 
2022-04-18 21:24:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475961139826688[0;39m <==    Updates: 0
2022-04-18 21:24:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475961139826688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:24:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171475982090375168[0;39m 生成今日电子书快照开始
2022-04-18 21:24:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475982090375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475982090375168[0;39m ==> Parameters: 
2022-04-18 21:24:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171475982090375168[0;39m <==    Updates: 0
2022-04-18 21:24:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171475982090375168[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:24:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476003103838208[0;39m 生成今日电子书快照开始
2022-04-18 21:24:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476003103838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476003103838208[0;39m ==> Parameters: 
2022-04-18 21:24:25.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476003103838208[0;39m <==    Updates: 0
2022-04-18 21:24:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476003103838208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:24:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476024037609472[0;39m 生成今日电子书快照开始
2022-04-18 21:24:30.183 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476024037609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:30.184 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476024037609472[0;39m ==> Parameters: 
2022-04-18 21:24:30.221 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476024037609472[0;39m <==    Updates: 0
2022-04-18 21:24:30.222 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476024037609472[0;39m 生成今日电子书快照结束，耗时：220毫秒
2022-04-18 21:24:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476045013323776[0;39m 生成今日电子书快照开始
2022-04-18 21:24:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476045013323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476045013323776[0;39m ==> Parameters: 
2022-04-18 21:24:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476045013323776[0;39m <==    Updates: 0
2022-04-18 21:24:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476045013323776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:24:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476045277564928[0;39m start updating Ebook doc
2022-04-18 21:24:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476045277564928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:24:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476045277564928[0;39m ==> Parameters: 
2022-04-18 21:24:35.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476045277564928[0;39m <==    Updates: 1
2022-04-18 21:24:35.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476045277564928[0;39m update ends, take 37 millisecs
2022-04-18 21:24:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476065989038080[0;39m 生成今日电子书快照开始
2022-04-18 21:24:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476065989038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476065989038080[0;39m ==> Parameters: 
2022-04-18 21:24:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476065989038080[0;39m <==    Updates: 0
2022-04-18 21:24:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476065989038080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:24:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476086952169472[0;39m 生成今日电子书快照开始
2022-04-18 21:24:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476086952169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476086952169472[0;39m ==> Parameters: 
2022-04-18 21:24:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476086952169472[0;39m <==    Updates: 0
2022-04-18 21:24:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476086952169472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:24:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476107932078080[0;39m 生成今日电子书快照开始
2022-04-18 21:24:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476107932078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476107932078080[0;39m ==> Parameters: 
2022-04-18 21:24:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476107932078080[0;39m <==    Updates: 0
2022-04-18 21:24:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476107932078080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:24:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476128907792384[0;39m 生成今日电子书快照开始
2022-04-18 21:24:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476128907792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:24:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476128907792384[0;39m ==> Parameters: 
2022-04-18 21:24:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476128907792384[0;39m <==    Updates: 0
2022-04-18 21:24:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476128907792384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:25:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476149870923776[0;39m 生成今日电子书快照开始
2022-04-18 21:25:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476149870923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476149870923776[0;39m ==> Parameters: 
2022-04-18 21:25:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476149870923776[0;39m <==    Updates: 0
2022-04-18 21:25:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476149870923776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:25:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476170863415296[0;39m 生成今日电子书快照开始
2022-04-18 21:25:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476170863415296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476170863415296[0;39m ==> Parameters: 
2022-04-18 21:25:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476170863415296[0;39m <==    Updates: 0
2022-04-18 21:25:05.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476170863415296[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:25:05.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476171140239360[0;39m start updating Ebook doc
2022-04-18 21:25:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476171140239360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:25:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476171140239360[0;39m ==> Parameters: 
2022-04-18 21:25:05.118 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476171140239360[0;39m <==    Updates: 1
2022-04-18 21:25:05.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476171140239360[0;39m update ends, take 46 millisecs
2022-04-18 21:25:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476191834935296[0;39m 生成今日电子书快照开始
2022-04-18 21:25:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476191834935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476191834935296[0;39m ==> Parameters: 
2022-04-18 21:25:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476191834935296[0;39m <==    Updates: 0
2022-04-18 21:25:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476191834935296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:25:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476212819038208[0;39m 生成今日电子书快照开始
2022-04-18 21:25:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476212819038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476212819038208[0;39m ==> Parameters: 
2022-04-18 21:25:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476212819038208[0;39m <==    Updates: 0
2022-04-18 21:25:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476212819038208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:25:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476233790558208[0;39m 生成今日电子书快照开始
2022-04-18 21:25:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476233790558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476233790558208[0;39m ==> Parameters: 
2022-04-18 21:25:20.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476233790558208[0;39m <==    Updates: 0
2022-04-18 21:25:20.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476233790558208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:25:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476254728523776[0;39m 生成今日电子书快照开始
2022-04-18 21:25:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476254728523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476254728523776[0;39m ==> Parameters: 
2022-04-18 21:25:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476254728523776[0;39m <==    Updates: 0
2022-04-18 21:25:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476254728523776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:25:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476275708432384[0;39m 生成今日电子书快照开始
2022-04-18 21:25:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476275708432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476275708432384[0;39m ==> Parameters: 
2022-04-18 21:25:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476275708432384[0;39m <==    Updates: 0
2022-04-18 21:25:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476275708432384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:25:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476296679952384[0;39m 生成今日电子书快照开始
2022-04-18 21:25:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476296679952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476296679952384[0;39m ==> Parameters: 
2022-04-18 21:25:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476296679952384[0;39m <==    Updates: 0
2022-04-18 21:25:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476296679952384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:25:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476296914833408[0;39m start updating Ebook doc
2022-04-18 21:25:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476296914833408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:25:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476296914833408[0;39m ==> Parameters: 
2022-04-18 21:25:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476296914833408[0;39m <==    Updates: 1
2022-04-18 21:25:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476296914833408[0;39m update ends, take 38 millisecs
2022-04-18 21:25:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476317659860992[0;39m 生成今日电子书快照开始
2022-04-18 21:25:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476317659860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476317659860992[0;39m ==> Parameters: 
2022-04-18 21:25:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476317659860992[0;39m <==    Updates: 0
2022-04-18 21:25:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476317659860992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:25:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476338610409472[0;39m 生成今日电子书快照开始
2022-04-18 21:25:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476338610409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476338610409472[0;39m ==> Parameters: 
2022-04-18 21:25:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476338610409472[0;39m <==    Updates: 0
2022-04-18 21:25:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476338610409472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:25:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476359611289600[0;39m 生成今日电子书快照开始
2022-04-18 21:25:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476359611289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476359611289600[0;39m ==> Parameters: 
2022-04-18 21:25:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476359611289600[0;39m <==    Updates: 0
2022-04-18 21:25:50.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476359611289600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:25:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476380591198208[0;39m 生成今日电子书快照开始
2022-04-18 21:25:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476380591198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:25:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476380591198208[0;39m ==> Parameters: 
2022-04-18 21:25:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476380591198208[0;39m <==    Updates: 0
2022-04-18 21:25:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476380591198208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:26:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476401529163776[0;39m 生成今日电子书快照开始
2022-04-18 21:26:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476401529163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476401529163776[0;39m ==> Parameters: 
2022-04-18 21:26:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476401529163776[0;39m <==    Updates: 0
2022-04-18 21:26:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476401529163776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:26:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476422530043904[0;39m 生成今日电子书快照开始
2022-04-18 21:26:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476422530043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476422530043904[0;39m ==> Parameters: 
2022-04-18 21:26:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476422530043904[0;39m <==    Updates: 0
2022-04-18 21:26:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476422530043904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:26:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476422794285056[0;39m start updating Ebook doc
2022-04-18 21:26:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476422794285056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:26:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476422794285056[0;39m ==> Parameters: 
2022-04-18 21:26:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476422794285056[0;39m <==    Updates: 1
2022-04-18 21:26:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476422794285056[0;39m update ends, take 42 millisecs
2022-04-18 21:26:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476443480592384[0;39m 生成今日电子书快照开始
2022-04-18 21:26:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476443480592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476443480592384[0;39m ==> Parameters: 
2022-04-18 21:26:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476443480592384[0;39m <==    Updates: 0
2022-04-18 21:26:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476443480592384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:26:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476464447918080[0;39m 生成今日电子书快照开始
2022-04-18 21:26:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476464447918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476464447918080[0;39m ==> Parameters: 
2022-04-18 21:26:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476464447918080[0;39m <==    Updates: 0
2022-04-18 21:26:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476464447918080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:26:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476485411049472[0;39m 生成今日电子书快照开始
2022-04-18 21:26:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476485411049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476485411049472[0;39m ==> Parameters: 
2022-04-18 21:26:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476485411049472[0;39m <==    Updates: 0
2022-04-18 21:26:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476485411049472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:26:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476506403540992[0;39m 生成今日电子书快照开始
2022-04-18 21:26:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476506403540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476506403540992[0;39m ==> Parameters: 
2022-04-18 21:26:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476506403540992[0;39m <==    Updates: 0
2022-04-18 21:26:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476506403540992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:26:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476527387643904[0;39m 生成今日电子书快照开始
2022-04-18 21:26:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476527387643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476527387643904[0;39m ==> Parameters: 
2022-04-18 21:26:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476527387643904[0;39m <==    Updates: 0
2022-04-18 21:26:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476527387643904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:26:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476548359163904[0;39m start updating Ebook doc
2022-04-18 21:26:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476548359163904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:26:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476548359163904[0;39m ==> Parameters: 
2022-04-18 21:26:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476548359163904[0;39m <==    Updates: 1
2022-04-18 21:26:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476548359163904[0;39m update ends, take 60 millisecs
2022-04-18 21:26:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476548615016448[0;39m 生成今日电子书快照开始
2022-04-18 21:26:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476548615016448[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476548615016448[0;39m ==> Parameters: 
2022-04-18 21:26:35.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476548615016448[0;39m <==    Updates: 0
2022-04-18 21:26:35.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476548615016448[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 21:26:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476569309712384[0;39m 生成今日电子书快照开始
2022-04-18 21:26:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476569309712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476569309712384[0;39m ==> Parameters: 
2022-04-18 21:26:40.118 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476569309712384[0;39m <==    Updates: 0
2022-04-18 21:26:40.118 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476569309712384[0;39m 生成今日电子书快照结束，耗时：114毫秒
2022-04-18 21:26:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476590281232384[0;39m 生成今日电子书快照开始
2022-04-18 21:26:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476590281232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476590281232384[0;39m ==> Parameters: 
2022-04-18 21:26:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476590281232384[0;39m <==    Updates: 0
2022-04-18 21:26:45.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476590281232384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 21:26:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476611261140992[0;39m 生成今日电子书快照开始
2022-04-18 21:26:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476611261140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476611261140992[0;39m ==> Parameters: 
2022-04-18 21:26:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476611261140992[0;39m <==    Updates: 0
2022-04-18 21:26:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476611261140992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:26:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476632211689472[0;39m 生成今日电子书快照开始
2022-04-18 21:26:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476632211689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:26:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476632211689472[0;39m ==> Parameters: 
2022-04-18 21:26:55.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476632211689472[0;39m <==    Updates: 0
2022-04-18 21:26:55.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476632211689472[0;39m 生成今日电子书快照结束，耗时：85毫秒
2022-04-18 21:27:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476653216763904[0;39m 生成今日电子书快照开始
2022-04-18 21:27:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476653216763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476653216763904[0;39m ==> Parameters: 
2022-04-18 21:27:00.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476653216763904[0;39m <==    Updates: 0
2022-04-18 21:27:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476653216763904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:27:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476674188283904[0;39m 生成今日电子书快照开始
2022-04-18 21:27:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476674188283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476674188283904[0;39m ==> Parameters: 
2022-04-18 21:27:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476674188283904[0;39m <==    Updates: 0
2022-04-18 21:27:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476674188283904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:27:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476674423164928[0;39m start updating Ebook doc
2022-04-18 21:27:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476674423164928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:27:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476674423164928[0;39m ==> Parameters: 
2022-04-18 21:27:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476674423164928[0;39m <==    Updates: 1
2022-04-18 21:27:05.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476674423164928[0;39m update ends, take 45 millisecs
2022-04-18 21:27:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476695134638080[0;39m 生成今日电子书快照开始
2022-04-18 21:27:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476695134638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476695134638080[0;39m ==> Parameters: 
2022-04-18 21:27:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476695134638080[0;39m <==    Updates: 0
2022-04-18 21:27:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476695134638080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:27:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476716114546688[0;39m 生成今日电子书快照开始
2022-04-18 21:27:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476716114546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476716114546688[0;39m ==> Parameters: 
2022-04-18 21:27:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476716114546688[0;39m <==    Updates: 0
2022-04-18 21:27:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476716114546688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:27:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476737098649600[0;39m 生成今日电子书快照开始
2022-04-18 21:27:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476737098649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476737098649600[0;39m ==> Parameters: 
2022-04-18 21:27:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476737098649600[0;39m <==    Updates: 0
2022-04-18 21:27:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476737098649600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:27:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476758057586688[0;39m 生成今日电子书快照开始
2022-04-18 21:27:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476758057586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476758057586688[0;39m ==> Parameters: 
2022-04-18 21:27:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476758057586688[0;39m <==    Updates: 0
2022-04-18 21:27:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476758057586688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:27:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476779033300992[0;39m 生成今日电子书快照开始
2022-04-18 21:27:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476779033300992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476779033300992[0;39m ==> Parameters: 
2022-04-18 21:27:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476779033300992[0;39m <==    Updates: 0
2022-04-18 21:27:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476779033300992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:27:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476800017403904[0;39m 生成今日电子书快照开始
2022-04-18 21:27:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476800017403904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476800017403904[0;39m ==> Parameters: 
2022-04-18 21:27:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476800017403904[0;39m <==    Updates: 0
2022-04-18 21:27:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476800017403904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:27:35.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476800290033664[0;39m start updating Ebook doc
2022-04-18 21:27:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476800290033664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:27:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476800290033664[0;39m ==> Parameters: 
2022-04-18 21:27:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476800290033664[0;39m <==    Updates: 1
2022-04-18 21:27:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476800290033664[0;39m update ends, take 38 millisecs
2022-04-18 21:27:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476820984729600[0;39m 生成今日电子书快照开始
2022-04-18 21:27:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476820984729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476820984729600[0;39m ==> Parameters: 
2022-04-18 21:27:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476820984729600[0;39m <==    Updates: 0
2022-04-18 21:27:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476820984729600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:27:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476841956249600[0;39m 生成今日电子书快照开始
2022-04-18 21:27:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476841956249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476841956249600[0;39m ==> Parameters: 
2022-04-18 21:27:45.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476841956249600[0;39m <==    Updates: 0
2022-04-18 21:27:45.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476841956249600[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 21:27:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476862927769600[0;39m 生成今日电子书快照开始
2022-04-18 21:27:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476862927769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476862927769600[0;39m ==> Parameters: 
2022-04-18 21:27:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476862927769600[0;39m <==    Updates: 0
2022-04-18 21:27:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476862927769600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:27:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476883869929472[0;39m 生成今日电子书快照开始
2022-04-18 21:27:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476883869929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:27:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476883869929472[0;39m ==> Parameters: 
2022-04-18 21:27:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476883869929472[0;39m <==    Updates: 0
2022-04-18 21:27:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476883869929472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:28:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476904862420992[0;39m 生成今日电子书快照开始
2022-04-18 21:28:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476904862420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476904862420992[0;39m ==> Parameters: 
2022-04-18 21:28:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476904862420992[0;39m <==    Updates: 0
2022-04-18 21:28:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476904862420992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:28:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476925838135296[0;39m 生成今日电子书快照开始
2022-04-18 21:28:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476925838135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476925838135296[0;39m ==> Parameters: 
2022-04-18 21:28:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476925838135296[0;39m <==    Updates: 0
2022-04-18 21:28:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476925838135296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:28:05.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171476926114959360[0;39m start updating Ebook doc
2022-04-18 21:28:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476926114959360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:28:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476926114959360[0;39m ==> Parameters: 
2022-04-18 21:28:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171476926114959360[0;39m <==    Updates: 1
2022-04-18 21:28:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171476926114959360[0;39m update ends, take 41 millisecs
2022-04-18 21:28:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476946797072384[0;39m 生成今日电子书快照开始
2022-04-18 21:28:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476946797072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476946797072384[0;39m ==> Parameters: 
2022-04-18 21:28:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476946797072384[0;39m <==    Updates: 0
2022-04-18 21:28:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476946797072384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:28:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476967793758208[0;39m 生成今日电子书快照开始
2022-04-18 21:28:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476967793758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476967793758208[0;39m ==> Parameters: 
2022-04-18 21:28:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476967793758208[0;39m <==    Updates: 0
2022-04-18 21:28:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476967793758208[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:28:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171476988744306688[0;39m 生成今日电子书快照开始
2022-04-18 21:28:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476988744306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476988744306688[0;39m ==> Parameters: 
2022-04-18 21:28:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171476988744306688[0;39m <==    Updates: 0
2022-04-18 21:28:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171476988744306688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:28:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477009707438080[0;39m 生成今日电子书快照开始
2022-04-18 21:28:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477009707438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477009707438080[0;39m ==> Parameters: 
2022-04-18 21:28:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477009707438080[0;39m <==    Updates: 0
2022-04-18 21:28:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477009707438080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:28:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477030683152384[0;39m 生成今日电子书快照开始
2022-04-18 21:28:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477030683152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477030683152384[0;39m ==> Parameters: 
2022-04-18 21:28:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477030683152384[0;39m <==    Updates: 0
2022-04-18 21:28:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477030683152384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:28:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477051658866688[0;39m 生成今日电子书快照开始
2022-04-18 21:28:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477051658866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477051658866688[0;39m ==> Parameters: 
2022-04-18 21:28:35.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477051658866688[0;39m <==    Updates: 0
2022-04-18 21:28:35.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477051658866688[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 21:28:35.081 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477051977633792[0;39m start updating Ebook doc
2022-04-18 21:28:35.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477051977633792[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:28:35.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477051977633792[0;39m ==> Parameters: 
2022-04-18 21:28:35.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477051977633792[0;39m <==    Updates: 1
2022-04-18 21:28:35.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477051977633792[0;39m update ends, take 38 millisecs
2022-04-18 21:28:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477072621998080[0;39m 生成今日电子书快照开始
2022-04-18 21:28:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477072621998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477072621998080[0;39m ==> Parameters: 
2022-04-18 21:28:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477072621998080[0;39m <==    Updates: 0
2022-04-18 21:28:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477072621998080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:28:45.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477093627072512[0;39m 生成今日电子书快照开始
2022-04-18 21:28:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477093627072512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477093627072512[0;39m ==> Parameters: 
2022-04-18 21:28:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477093627072512[0;39m <==    Updates: 0
2022-04-18 21:28:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477093627072512[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:28:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477114573426688[0;39m 生成今日电子书快照开始
2022-04-18 21:28:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477114573426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477114573426688[0;39m ==> Parameters: 
2022-04-18 21:28:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477114573426688[0;39m <==    Updates: 0
2022-04-18 21:28:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477114573426688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:28:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477135557529600[0;39m 生成今日电子书快照开始
2022-04-18 21:28:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477135557529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:28:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477135557529600[0;39m ==> Parameters: 
2022-04-18 21:28:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477135557529600[0;39m <==    Updates: 0
2022-04-18 21:28:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477135557529600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:29:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477156533243904[0;39m 生成今日电子书快照开始
2022-04-18 21:29:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477156533243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477156533243904[0;39m ==> Parameters: 
2022-04-18 21:29:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477156533243904[0;39m <==    Updates: 0
2022-04-18 21:29:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477156533243904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:29:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477177508958208[0;39m 生成今日电子书快照开始
2022-04-18 21:29:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477177508958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477177508958208[0;39m ==> Parameters: 
2022-04-18 21:29:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477177508958208[0;39m <==    Updates: 0
2022-04-18 21:29:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477177508958208[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:29:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477177748033536[0;39m start updating Ebook doc
2022-04-18 21:29:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477177748033536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:29:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477177748033536[0;39m ==> Parameters: 
2022-04-18 21:29:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477177748033536[0;39m <==    Updates: 1
2022-04-18 21:29:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477177748033536[0;39m update ends, take 37 millisecs
2022-04-18 21:29:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477198455312384[0;39m 生成今日电子书快照开始
2022-04-18 21:29:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477198455312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477198455312384[0;39m ==> Parameters: 
2022-04-18 21:29:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477198455312384[0;39m <==    Updates: 0
2022-04-18 21:29:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477198455312384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:29:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477219447803904[0;39m 生成今日电子书快照开始
2022-04-18 21:29:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477219447803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477219447803904[0;39m ==> Parameters: 
2022-04-18 21:29:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477219447803904[0;39m <==    Updates: 0
2022-04-18 21:29:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477219447803904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:29:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477240410935296[0;39m 生成今日电子书快照开始
2022-04-18 21:29:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477240410935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477240410935296[0;39m ==> Parameters: 
2022-04-18 21:29:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477240410935296[0;39m <==    Updates: 0
2022-04-18 21:29:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477240410935296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:29:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477261369872384[0;39m 生成今日电子书快照开始
2022-04-18 21:29:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477261369872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477261369872384[0;39m ==> Parameters: 
2022-04-18 21:29:25.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477261369872384[0;39m <==    Updates: 0
2022-04-18 21:29:25.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477261369872384[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:29:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477282349780992[0;39m 生成今日电子书快照开始
2022-04-18 21:29:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477282349780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477282349780992[0;39m ==> Parameters: 
2022-04-18 21:29:30.126 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477282349780992[0;39m <==    Updates: 0
2022-04-18 21:29:30.126 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477282349780992[0;39m 生成今日电子书快照结束，耗时：119毫秒
2022-04-18 21:29:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477303312912384[0;39m 生成今日电子书快照开始
2022-04-18 21:29:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477303312912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477303312912384[0;39m ==> Parameters: 
2022-04-18 21:29:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477303312912384[0;39m <==    Updates: 0
2022-04-18 21:29:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477303312912384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:29:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477303526821888[0;39m start updating Ebook doc
2022-04-18 21:29:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477303526821888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:29:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477303526821888[0;39m ==> Parameters: 
2022-04-18 21:29:35.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477303526821888[0;39m <==    Updates: 1
2022-04-18 21:29:35.089 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477303526821888[0;39m update ends, take 34 millisecs
2022-04-18 21:29:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477324288626688[0;39m 生成今日电子书快照开始
2022-04-18 21:29:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477324288626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477324288626688[0;39m ==> Parameters: 
2022-04-18 21:29:40.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477324288626688[0;39m <==    Updates: 0
2022-04-18 21:29:40.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477324288626688[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:29:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477345281118208[0;39m 生成今日电子书快照开始
2022-04-18 21:29:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477345281118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477345281118208[0;39m ==> Parameters: 
2022-04-18 21:29:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477345281118208[0;39m <==    Updates: 0
2022-04-18 21:29:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477345281118208[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:29:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477366227472384[0;39m 生成今日电子书快照开始
2022-04-18 21:29:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477366227472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477366227472384[0;39m ==> Parameters: 
2022-04-18 21:29:50.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477366227472384[0;39m <==    Updates: 0
2022-04-18 21:29:50.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477366227472384[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:29:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477387224158208[0;39m 生成今日电子书快照开始
2022-04-18 21:29:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477387224158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:29:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477387224158208[0;39m ==> Parameters: 
2022-04-18 21:29:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477387224158208[0;39m <==    Updates: 0
2022-04-18 21:29:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477387224158208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:30:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477408157929472[0;39m 生成今日电子书快照开始
2022-04-18 21:30:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477408157929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477408157929472[0;39m ==> Parameters: 
2022-04-18 21:30:00.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477408157929472[0;39m <==    Updates: 0
2022-04-18 21:30:00.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477408157929472[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 21:30:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477429129449472[0;39m 生成今日电子书快照开始
2022-04-18 21:30:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477429129449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477429129449472[0;39m ==> Parameters: 
2022-04-18 21:30:05.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477429129449472[0;39m <==    Updates: 0
2022-04-18 21:30:05.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477429129449472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:30:05.053 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477429347553280[0;39m start updating Ebook doc
2022-04-18 21:30:05.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477429347553280[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:30:05.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477429347553280[0;39m ==> Parameters: 
2022-04-18 21:30:05.085 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477429347553280[0;39m <==    Updates: 1
2022-04-18 21:30:05.085 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477429347553280[0;39m update ends, take 32 millisecs
2022-04-18 21:30:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477450121940992[0;39m 生成今日电子书快照开始
2022-04-18 21:30:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477450121940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477450121940992[0;39m ==> Parameters: 
2022-04-18 21:30:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477450121940992[0;39m <==    Updates: 0
2022-04-18 21:30:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477450121940992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:30:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477471106043904[0;39m 生成今日电子书快照开始
2022-04-18 21:30:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477471106043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477471106043904[0;39m ==> Parameters: 
2022-04-18 21:30:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477471106043904[0;39m <==    Updates: 0
2022-04-18 21:30:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477471106043904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:30:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477492077563904[0;39m 生成今日电子书快照开始
2022-04-18 21:30:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477492077563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477492077563904[0;39m ==> Parameters: 
2022-04-18 21:30:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477492077563904[0;39m <==    Updates: 0
2022-04-18 21:30:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477492077563904[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:30:25.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477513057472512[0;39m 生成今日电子书快照开始
2022-04-18 21:30:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477513057472512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477513057472512[0;39m ==> Parameters: 
2022-04-18 21:30:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477513057472512[0;39m <==    Updates: 0
2022-04-18 21:30:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477513057472512[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:30:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477534008020992[0;39m 生成今日电子书快照开始
2022-04-18 21:30:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477534008020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477534008020992[0;39m ==> Parameters: 
2022-04-18 21:30:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477534008020992[0;39m <==    Updates: 0
2022-04-18 21:30:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477534008020992[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:30:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477554958569472[0;39m 生成今日电子书快照开始
2022-04-18 21:30:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477554958569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477554958569472[0;39m ==> Parameters: 
2022-04-18 21:30:35.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477554958569472[0;39m <==    Updates: 0
2022-04-18 21:30:35.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477554958569472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:30:35.052 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477555172478976[0;39m start updating Ebook doc
2022-04-18 21:30:35.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477555172478976[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:30:35.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477555172478976[0;39m ==> Parameters: 
2022-04-18 21:30:35.084 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477555172478976[0;39m <==    Updates: 1
2022-04-18 21:30:35.084 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477555172478976[0;39m update ends, take 31 millisecs
2022-04-18 21:30:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477575938478080[0;39m 生成今日电子书快照开始
2022-04-18 21:30:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477575938478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477575938478080[0;39m ==> Parameters: 
2022-04-18 21:30:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477575938478080[0;39m <==    Updates: 0
2022-04-18 21:30:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477575938478080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:30:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477596905803776[0;39m 生成今日电子书快照开始
2022-04-18 21:30:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477596905803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477596905803776[0;39m ==> Parameters: 
2022-04-18 21:30:45.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477596905803776[0;39m <==    Updates: 0
2022-04-18 21:30:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477596905803776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:30:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477617910878208[0;39m 生成今日电子书快照开始
2022-04-18 21:30:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477617910878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477617910878208[0;39m ==> Parameters: 
2022-04-18 21:30:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477617910878208[0;39m <==    Updates: 0
2022-04-18 21:30:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477617910878208[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:30:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477638865620992[0;39m 生成今日电子书快照开始
2022-04-18 21:30:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477638865620992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:30:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477638865620992[0;39m ==> Parameters: 
2022-04-18 21:30:55.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477638865620992[0;39m <==    Updates: 0
2022-04-18 21:30:55.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477638865620992[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:31:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477659841335296[0;39m 生成今日电子书快照开始
2022-04-18 21:31:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477659841335296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477659841335296[0;39m ==> Parameters: 
2022-04-18 21:31:00.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477659841335296[0;39m <==    Updates: 0
2022-04-18 21:31:00.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477659841335296[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:31:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477680821243904[0;39m 生成今日电子书快照开始
2022-04-18 21:31:05.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477680821243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:05.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477680821243904[0;39m ==> Parameters: 
2022-04-18 21:31:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477680821243904[0;39m <==    Updates: 0
2022-04-18 21:31:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477680821243904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:31:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477681077096448[0;39m start updating Ebook doc
2022-04-18 21:31:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477681077096448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:31:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477681077096448[0;39m ==> Parameters: 
2022-04-18 21:31:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477681077096448[0;39m <==    Updates: 1
2022-04-18 21:31:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477681077096448[0;39m update ends, take 37 millisecs
2022-04-18 21:31:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477701784375296[0;39m 生成今日电子书快照开始
2022-04-18 21:31:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477701784375296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477701784375296[0;39m ==> Parameters: 
2022-04-18 21:31:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477701784375296[0;39m <==    Updates: 0
2022-04-18 21:31:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477701784375296[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:31:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477722734923776[0;39m 生成今日电子书快照开始
2022-04-18 21:31:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477722734923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477722734923776[0;39m ==> Parameters: 
2022-04-18 21:31:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477722734923776[0;39m <==    Updates: 0
2022-04-18 21:31:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477722734923776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:31:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477743727415296[0;39m 生成今日电子书快照开始
2022-04-18 21:31:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477743727415296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477743727415296[0;39m ==> Parameters: 
2022-04-18 21:31:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477743727415296[0;39m <==    Updates: 0
2022-04-18 21:31:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477743727415296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:31:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477764703129600[0;39m 生成今日电子书快照开始
2022-04-18 21:31:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477764703129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477764703129600[0;39m ==> Parameters: 
2022-04-18 21:31:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477764703129600[0;39m <==    Updates: 0
2022-04-18 21:31:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477764703129600[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:31:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477785657872384[0;39m 生成今日电子书快照开始
2022-04-18 21:31:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477785657872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477785657872384[0;39m ==> Parameters: 
2022-04-18 21:31:30.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477785657872384[0;39m <==    Updates: 0
2022-04-18 21:31:30.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477785657872384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:31:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477806621003776[0;39m 生成今日电子书快照开始
2022-04-18 21:31:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477806621003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477806621003776[0;39m ==> Parameters: 
2022-04-18 21:31:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477806621003776[0;39m <==    Updates: 0
2022-04-18 21:31:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477806621003776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:31:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477806906216448[0;39m start updating Ebook doc
2022-04-18 21:31:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477806906216448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:31:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477806906216448[0;39m ==> Parameters: 
2022-04-18 21:31:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477806906216448[0;39m <==    Updates: 1
2022-04-18 21:31:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477806906216448[0;39m update ends, take 34 millisecs
2022-04-18 21:31:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477827613495296[0;39m 生成今日电子书快照开始
2022-04-18 21:31:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477827613495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477827613495296[0;39m ==> Parameters: 
2022-04-18 21:31:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477827613495296[0;39m <==    Updates: 0
2022-04-18 21:31:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477827613495296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:31:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477848597598208[0;39m 生成今日电子书快照开始
2022-04-18 21:31:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477848597598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477848597598208[0;39m ==> Parameters: 
2022-04-18 21:31:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477848597598208[0;39m <==    Updates: 0
2022-04-18 21:31:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477848597598208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:31:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477869560729600[0;39m 生成今日电子书快照开始
2022-04-18 21:31:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477869560729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477869560729600[0;39m ==> Parameters: 
2022-04-18 21:31:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477869560729600[0;39m <==    Updates: 0
2022-04-18 21:31:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477869560729600[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:31:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477890519666688[0;39m 生成今日电子书快照开始
2022-04-18 21:31:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477890519666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:31:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477890519666688[0;39m ==> Parameters: 
2022-04-18 21:31:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477890519666688[0;39m <==    Updates: 0
2022-04-18 21:31:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477890519666688[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:32:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477911507963904[0;39m 生成今日电子书快照开始
2022-04-18 21:32:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477911507963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477911507963904[0;39m ==> Parameters: 
2022-04-18 21:32:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477911507963904[0;39m <==    Updates: 0
2022-04-18 21:32:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477911507963904[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:32:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477932479483904[0;39m 生成今日电子书快照开始
2022-04-18 21:32:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477932479483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477932479483904[0;39m ==> Parameters: 
2022-04-18 21:32:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477932479483904[0;39m <==    Updates: 0
2022-04-18 21:32:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477932479483904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:32:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171477932701782016[0;39m start updating Ebook doc
2022-04-18 21:32:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477932701782016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:32:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477932701782016[0;39m ==> Parameters: 
2022-04-18 21:32:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171477932701782016[0;39m <==    Updates: 1
2022-04-18 21:32:05.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171477932701782016[0;39m update ends, take 31 millisecs
2022-04-18 21:32:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477953438420992[0;39m 生成今日电子书快照开始
2022-04-18 21:32:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477953438420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477953438420992[0;39m ==> Parameters: 
2022-04-18 21:32:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477953438420992[0;39m <==    Updates: 0
2022-04-18 21:32:10.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477953438420992[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:32:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477974401552384[0;39m 生成今日电子书快照开始
2022-04-18 21:32:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477974401552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477974401552384[0;39m ==> Parameters: 
2022-04-18 21:32:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477974401552384[0;39m <==    Updates: 0
2022-04-18 21:32:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477974401552384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:32:20.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171477995402432512[0;39m 生成今日电子书快照开始
2022-04-18 21:32:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477995402432512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477995402432512[0;39m ==> Parameters: 
2022-04-18 21:32:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171477995402432512[0;39m <==    Updates: 0
2022-04-18 21:32:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171477995402432512[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:32:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478016348786688[0;39m 生成今日电子书快照开始
2022-04-18 21:32:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478016348786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478016348786688[0;39m ==> Parameters: 
2022-04-18 21:32:25.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478016348786688[0;39m <==    Updates: 0
2022-04-18 21:32:25.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478016348786688[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:32:30.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478037345472512[0;39m 生成今日电子书快照开始
2022-04-18 21:32:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478037345472512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478037345472512[0;39m ==> Parameters: 
2022-04-18 21:32:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478037345472512[0;39m <==    Updates: 0
2022-04-18 21:32:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478037345472512[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:32:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478058283438080[0;39m start updating Ebook doc
2022-04-18 21:32:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478058283438080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:32:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478058283438080[0;39m ==> Parameters: 
2022-04-18 21:32:35.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478058283438080[0;39m <==    Updates: 1
2022-04-18 21:32:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478058283438080[0;39m update ends, take 50 millisecs
2022-04-18 21:32:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478058497347584[0;39m 生成今日电子书快照开始
2022-04-18 21:32:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478058497347584[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478058497347584[0;39m ==> Parameters: 
2022-04-18 21:32:35.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478058497347584[0;39m <==    Updates: 0
2022-04-18 21:32:35.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478058497347584[0;39m 生成今日电子书快照结束，耗时：30毫秒
2022-04-18 21:32:40.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478079288512512[0;39m 生成今日电子书快照开始
2022-04-18 21:32:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478079288512512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478079288512512[0;39m ==> Parameters: 
2022-04-18 21:32:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478079288512512[0;39m <==    Updates: 0
2022-04-18 21:32:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478079288512512[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:32:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478100230672384[0;39m 生成今日电子书快照开始
2022-04-18 21:32:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478100230672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478100230672384[0;39m ==> Parameters: 
2022-04-18 21:32:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478100230672384[0;39m <==    Updates: 0
2022-04-18 21:32:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478100230672384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:32:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478121214775296[0;39m 生成今日电子书快照开始
2022-04-18 21:32:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478121214775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478121214775296[0;39m ==> Parameters: 
2022-04-18 21:32:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478121214775296[0;39m <==    Updates: 0
2022-04-18 21:32:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478121214775296[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:32:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478142182100992[0;39m 生成今日电子书快照开始
2022-04-18 21:32:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478142182100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:32:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478142182100992[0;39m ==> Parameters: 
2022-04-18 21:32:55.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478142182100992[0;39m <==    Updates: 0
2022-04-18 21:32:55.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478142182100992[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 21:33:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478163132649472[0;39m 生成今日电子书快照开始
2022-04-18 21:33:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478163132649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478163132649472[0;39m ==> Parameters: 
2022-04-18 21:33:00.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478163132649472[0;39m <==    Updates: 0
2022-04-18 21:33:00.044 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478163132649472[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:33:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478184133529600[0;39m 生成今日电子书快照开始
2022-04-18 21:33:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478184133529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478184133529600[0;39m ==> Parameters: 
2022-04-18 21:33:05.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478184133529600[0;39m <==    Updates: 0
2022-04-18 21:33:05.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478184133529600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 21:33:05.079 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478184431325184[0;39m start updating Ebook doc
2022-04-18 21:33:05.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478184431325184[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:33:05.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478184431325184[0;39m ==> Parameters: 
2022-04-18 21:33:05.131 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478184431325184[0;39m <==    Updates: 1
2022-04-18 21:33:05.132 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478184431325184[0;39m update ends, take 53 millisecs
2022-04-18 21:33:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478205109243904[0;39m 生成今日电子书快照开始
2022-04-18 21:33:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478205109243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478205109243904[0;39m ==> Parameters: 
2022-04-18 21:33:10.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478205109243904[0;39m <==    Updates: 0
2022-04-18 21:33:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478205109243904[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:33:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478226059792384[0;39m 生成今日电子书快照开始
2022-04-18 21:33:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478226059792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478226059792384[0;39m ==> Parameters: 
2022-04-18 21:33:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478226059792384[0;39m <==    Updates: 0
2022-04-18 21:33:15.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478226059792384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:33:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478247018729472[0;39m 生成今日电子书快照开始
2022-04-18 21:33:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478247018729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478247018729472[0;39m ==> Parameters: 
2022-04-18 21:33:20.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478247018729472[0;39m <==    Updates: 0
2022-04-18 21:33:20.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478247018729472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:33:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478267986055168[0;39m 生成今日电子书快照开始
2022-04-18 21:33:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478267986055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478267986055168[0;39m ==> Parameters: 
2022-04-18 21:33:25.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478267986055168[0;39m <==    Updates: 0
2022-04-18 21:33:25.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478267986055168[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:33:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478288999518208[0;39m 生成今日电子书快照开始
2022-04-18 21:33:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478288999518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478288999518208[0;39m ==> Parameters: 
2022-04-18 21:33:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478288999518208[0;39m <==    Updates: 0
2022-04-18 21:33:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478288999518208[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:33:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478309954260992[0;39m start updating Ebook doc
2022-04-18 21:33:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478309954260992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:33:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478309954260992[0;39m ==> Parameters: 
2022-04-18 21:33:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478309954260992[0;39m <==    Updates: 1
2022-04-18 21:33:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478309954260992[0;39m update ends, take 48 millisecs
2022-04-18 21:33:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478310159781888[0;39m 生成今日电子书快照开始
2022-04-18 21:33:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478310159781888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478310159781888[0;39m ==> Parameters: 
2022-04-18 21:33:35.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478310159781888[0;39m <==    Updates: 0
2022-04-18 21:33:35.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478310159781888[0;39m 生成今日电子书快照结束，耗时：33毫秒
2022-04-18 21:33:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478330917392384[0;39m 生成今日电子书快照开始
2022-04-18 21:33:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478330917392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478330917392384[0;39m ==> Parameters: 
2022-04-18 21:33:40.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478330917392384[0;39m <==    Updates: 0
2022-04-18 21:33:40.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478330917392384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:33:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478351914078208[0;39m 生成今日电子书快照开始
2022-04-18 21:33:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478351914078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478351914078208[0;39m ==> Parameters: 
2022-04-18 21:33:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478351914078208[0;39m <==    Updates: 0
2022-04-18 21:33:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478351914078208[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:33:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478372885598208[0;39m 生成今日电子书快照开始
2022-04-18 21:33:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478372885598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478372885598208[0;39m ==> Parameters: 
2022-04-18 21:33:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478372885598208[0;39m <==    Updates: 0
2022-04-18 21:33:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478372885598208[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:33:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478393844535296[0;39m 生成今日电子书快照开始
2022-04-18 21:33:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478393844535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:33:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478393844535296[0;39m ==> Parameters: 
2022-04-18 21:33:55.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478393844535296[0;39m <==    Updates: 0
2022-04-18 21:33:55.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478393844535296[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:34:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478414816055296[0;39m 生成今日电子书快照开始
2022-04-18 21:34:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478414816055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478414816055296[0;39m ==> Parameters: 
2022-04-18 21:34:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478414816055296[0;39m <==    Updates: 0
2022-04-18 21:34:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478414816055296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:34:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478435800158208[0;39m start updating Ebook doc
2022-04-18 21:34:05.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478435800158208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:34:05.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478435800158208[0;39m ==> Parameters: 
2022-04-18 21:34:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478435800158208[0;39m <==    Updates: 1
2022-04-18 21:34:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478435800158208[0;39m update ends, take 53 millisecs
2022-04-18 21:34:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478436026650624[0;39m 生成今日电子书快照开始
2022-04-18 21:34:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478436026650624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478436026650624[0;39m ==> Parameters: 
2022-04-18 21:34:05.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478436026650624[0;39m <==    Updates: 0
2022-04-18 21:34:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478436026650624[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:34:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478456750706688[0;39m 生成今日电子书快照开始
2022-04-18 21:34:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478456750706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478456750706688[0;39m ==> Parameters: 
2022-04-18 21:34:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478456750706688[0;39m <==    Updates: 0
2022-04-18 21:34:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478456750706688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:34:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478477726420992[0;39m 生成今日电子书快照开始
2022-04-18 21:34:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478477726420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478477726420992[0;39m ==> Parameters: 
2022-04-18 21:34:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478477726420992[0;39m <==    Updates: 0
2022-04-18 21:34:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478477726420992[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:34:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478498672775168[0;39m 生成今日电子书快照开始
2022-04-18 21:34:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478498672775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478498672775168[0;39m ==> Parameters: 
2022-04-18 21:34:20.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478498672775168[0;39m <==    Updates: 0
2022-04-18 21:34:20.044 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478498672775168[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:34:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478519673655296[0;39m 生成今日电子书快照开始
2022-04-18 21:34:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478519673655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478519673655296[0;39m ==> Parameters: 
2022-04-18 21:34:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478519673655296[0;39m <==    Updates: 0
2022-04-18 21:34:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478519673655296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:34:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478540620009472[0;39m 生成今日电子书快照开始
2022-04-18 21:34:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478540620009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478540620009472[0;39m ==> Parameters: 
2022-04-18 21:34:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478540620009472[0;39m <==    Updates: 0
2022-04-18 21:34:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478540620009472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:34:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478561616695296[0;39m 生成今日电子书快照开始
2022-04-18 21:34:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478561616695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478561616695296[0;39m ==> Parameters: 
2022-04-18 21:34:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478561616695296[0;39m <==    Updates: 0
2022-04-18 21:34:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478561616695296[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:34:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478561822216192[0;39m start updating Ebook doc
2022-04-18 21:34:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478561822216192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:34:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478561822216192[0;39m ==> Parameters: 
2022-04-18 21:34:35.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478561822216192[0;39m <==    Updates: 1
2022-04-18 21:34:35.088 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478561822216192[0;39m update ends, take 32 millisecs
2022-04-18 21:34:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478582592409600[0;39m 生成今日电子书快照开始
2022-04-18 21:34:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478582592409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478582592409600[0;39m ==> Parameters: 
2022-04-18 21:34:40.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478582592409600[0;39m <==    Updates: 0
2022-04-18 21:34:40.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478582592409600[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 21:34:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478603555540992[0;39m 生成今日电子书快照开始
2022-04-18 21:34:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478603555540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478603555540992[0;39m ==> Parameters: 
2022-04-18 21:34:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478603555540992[0;39m <==    Updates: 0
2022-04-18 21:34:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478603555540992[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:34:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478624506089472[0;39m 生成今日电子书快照开始
2022-04-18 21:34:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478624506089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478624506089472[0;39m ==> Parameters: 
2022-04-18 21:34:50.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478624506089472[0;39m <==    Updates: 0
2022-04-18 21:34:50.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478624506089472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:34:55.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478645519552512[0;39m 生成今日电子书快照开始
2022-04-18 21:34:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478645519552512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:34:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478645519552512[0;39m ==> Parameters: 
2022-04-18 21:34:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478645519552512[0;39m <==    Updates: 0
2022-04-18 21:34:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478645519552512[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:35:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478666449129472[0;39m 生成今日电子书快照开始
2022-04-18 21:35:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478666449129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478666449129472[0;39m ==> Parameters: 
2022-04-18 21:35:00.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478666449129472[0;39m <==    Updates: 0
2022-04-18 21:35:00.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478666449129472[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:35:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478687458398208[0;39m 生成今日电子书快照开始
2022-04-18 21:35:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478687458398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478687458398208[0;39m ==> Parameters: 
2022-04-18 21:35:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478687458398208[0;39m <==    Updates: 0
2022-04-18 21:35:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478687458398208[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:35:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478687672307712[0;39m start updating Ebook doc
2022-04-18 21:35:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478687672307712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:35:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478687672307712[0;39m ==> Parameters: 
2022-04-18 21:35:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478687672307712[0;39m <==    Updates: 1
2022-04-18 21:35:05.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478687672307712[0;39m update ends, take 32 millisecs
2022-04-18 21:35:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478708417335296[0;39m 生成今日电子书快照开始
2022-04-18 21:35:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478708417335296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478708417335296[0;39m ==> Parameters: 
2022-04-18 21:35:10.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478708417335296[0;39m <==    Updates: 0
2022-04-18 21:35:10.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478708417335296[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:35:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478729388855296[0;39m 生成今日电子书快照开始
2022-04-18 21:35:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478729388855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478729388855296[0;39m ==> Parameters: 
2022-04-18 21:35:15.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478729388855296[0;39m <==    Updates: 0
2022-04-18 21:35:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478729388855296[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:35:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478750351986688[0;39m 生成今日电子书快照开始
2022-04-18 21:35:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478750351986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478750351986688[0;39m ==> Parameters: 
2022-04-18 21:35:20.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478750351986688[0;39m <==    Updates: 0
2022-04-18 21:35:20.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478750351986688[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:35:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478771331895296[0;39m 生成今日电子书快照开始
2022-04-18 21:35:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478771331895296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478771331895296[0;39m ==> Parameters: 
2022-04-18 21:35:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478771331895296[0;39m <==    Updates: 0
2022-04-18 21:35:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478771331895296[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:35:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478792278249472[0;39m 生成今日电子书快照开始
2022-04-18 21:35:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478792278249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478792278249472[0;39m ==> Parameters: 
2022-04-18 21:35:30.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478792278249472[0;39m <==    Updates: 0
2022-04-18 21:35:30.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478792278249472[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:35:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478813270740992[0;39m 生成今日电子书快照开始
2022-04-18 21:35:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478813270740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478813270740992[0;39m ==> Parameters: 
2022-04-18 21:35:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478813270740992[0;39m <==    Updates: 0
2022-04-18 21:35:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478813270740992[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:35:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478813476261888[0;39m start updating Ebook doc
2022-04-18 21:35:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478813476261888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:35:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478813476261888[0;39m ==> Parameters: 
2022-04-18 21:35:35.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478813476261888[0;39m <==    Updates: 1
2022-04-18 21:35:35.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478813476261888[0;39m update ends, take 37 millisecs
2022-04-18 21:35:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478834242260992[0;39m 生成今日电子书快照开始
2022-04-18 21:35:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478834242260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478834242260992[0;39m ==> Parameters: 
2022-04-18 21:35:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478834242260992[0;39m <==    Updates: 0
2022-04-18 21:35:40.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478834242260992[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:35:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478855197003776[0;39m 生成今日电子书快照开始
2022-04-18 21:35:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478855197003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478855197003776[0;39m ==> Parameters: 
2022-04-18 21:35:45.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478855197003776[0;39m <==    Updates: 0
2022-04-18 21:35:45.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478855197003776[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:35:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478876193689600[0;39m 生成今日电子书快照开始
2022-04-18 21:35:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478876193689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478876193689600[0;39m ==> Parameters: 
2022-04-18 21:35:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478876193689600[0;39m <==    Updates: 0
2022-04-18 21:35:50.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478876193689600[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:35:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478897152626688[0;39m 生成今日电子书快照开始
2022-04-18 21:35:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478897152626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:35:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478897152626688[0;39m ==> Parameters: 
2022-04-18 21:35:55.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478897152626688[0;39m <==    Updates: 0
2022-04-18 21:35:55.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478897152626688[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 21:36:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478918107369472[0;39m 生成今日电子书快照开始
2022-04-18 21:36:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478918107369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478918107369472[0;39m ==> Parameters: 
2022-04-18 21:36:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478918107369472[0;39m <==    Updates: 0
2022-04-18 21:36:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478918107369472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:36:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478939087278080[0;39m 生成今日电子书快照开始
2022-04-18 21:36:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478939087278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478939087278080[0;39m ==> Parameters: 
2022-04-18 21:36:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478939087278080[0;39m <==    Updates: 0
2022-04-18 21:36:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478939087278080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:36:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171478939347324928[0;39m start updating Ebook doc
2022-04-18 21:36:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478939347324928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:36:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478939347324928[0;39m ==> Parameters: 
2022-04-18 21:36:05.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171478939347324928[0;39m <==    Updates: 1
2022-04-18 21:36:05.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171478939347324928[0;39m update ends, take 32 millisecs
2022-04-18 21:36:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478960079769600[0;39m 生成今日电子书快照开始
2022-04-18 21:36:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478960079769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478960079769600[0;39m ==> Parameters: 
2022-04-18 21:36:10.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478960079769600[0;39m <==    Updates: 0
2022-04-18 21:36:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478960079769600[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:36:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171478981051289600[0;39m 生成今日电子书快照开始
2022-04-18 21:36:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478981051289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478981051289600[0;39m ==> Parameters: 
2022-04-18 21:36:15.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171478981051289600[0;39m <==    Updates: 0
2022-04-18 21:36:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171478981051289600[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 21:36:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479002018615296[0;39m 生成今日电子书快照开始
2022-04-18 21:36:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479002018615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479002018615296[0;39m ==> Parameters: 
2022-04-18 21:36:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479002018615296[0;39m <==    Updates: 0
2022-04-18 21:36:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479002018615296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:36:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479022985940992[0;39m 生成今日电子书快照开始
2022-04-18 21:36:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479022985940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479022985940992[0;39m ==> Parameters: 
2022-04-18 21:36:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479022985940992[0;39m <==    Updates: 0
2022-04-18 21:36:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479022985940992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:36:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479043944878080[0;39m 生成今日电子书快照开始
2022-04-18 21:36:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479043944878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479043944878080[0;39m ==> Parameters: 
2022-04-18 21:36:30.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479043944878080[0;39m <==    Updates: 0
2022-04-18 21:36:30.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479043944878080[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:36:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479064937369600[0;39m 生成今日电子书快照开始
2022-04-18 21:36:35.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479064937369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:35.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479064937369600[0;39m ==> Parameters: 
2022-04-18 21:36:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479064937369600[0;39m <==    Updates: 0
2022-04-18 21:36:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479064937369600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:36:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479065205805056[0;39m start updating Ebook doc
2022-04-18 21:36:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479065205805056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:36:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479065205805056[0;39m ==> Parameters: 
2022-04-18 21:36:35.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479065205805056[0;39m <==    Updates: 1
2022-04-18 21:36:35.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479065205805056[0;39m update ends, take 30 millisecs
2022-04-18 21:36:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479085913083904[0;39m 生成今日电子书快照开始
2022-04-18 21:36:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479085913083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479085913083904[0;39m ==> Parameters: 
2022-04-18 21:36:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479085913083904[0;39m <==    Updates: 0
2022-04-18 21:36:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479085913083904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:36:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479106867826688[0;39m 生成今日电子书快照开始
2022-04-18 21:36:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479106867826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479106867826688[0;39m ==> Parameters: 
2022-04-18 21:36:45.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479106867826688[0;39m <==    Updates: 0
2022-04-18 21:36:45.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479106867826688[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 21:36:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479127847735296[0;39m 生成今日电子书快照开始
2022-04-18 21:36:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479127847735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479127847735296[0;39m ==> Parameters: 
2022-04-18 21:36:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479127847735296[0;39m <==    Updates: 0
2022-04-18 21:36:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479127847735296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:36:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479148831838208[0;39m 生成今日电子书快照开始
2022-04-18 21:36:55.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479148831838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:36:55.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479148831838208[0;39m ==> Parameters: 
2022-04-18 21:36:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479148831838208[0;39m <==    Updates: 0
2022-04-18 21:36:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479148831838208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:37:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479169803358208[0;39m 生成今日电子书快照开始
2022-04-18 21:37:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479169803358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479169803358208[0;39m ==> Parameters: 
2022-04-18 21:37:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479169803358208[0;39m <==    Updates: 0
2022-04-18 21:37:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479169803358208[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 21:37:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479190741323776[0;39m 生成今日电子书快照开始
2022-04-18 21:37:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479190741323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479190741323776[0;39m ==> Parameters: 
2022-04-18 21:37:05.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479190741323776[0;39m <==    Updates: 0
2022-04-18 21:37:05.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479190741323776[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:37:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479190963621888[0;39m start updating Ebook doc
2022-04-18 21:37:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479190963621888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:37:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479190963621888[0;39m ==> Parameters: 
2022-04-18 21:37:05.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479190963621888[0;39m <==    Updates: 1
2022-04-18 21:37:05.089 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479190963621888[0;39m update ends, take 34 millisecs
2022-04-18 21:37:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479211742203904[0;39m 生成今日电子书快照开始
2022-04-18 21:37:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479211742203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479211742203904[0;39m ==> Parameters: 
2022-04-18 21:37:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479211742203904[0;39m <==    Updates: 0
2022-04-18 21:37:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479211742203904[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:37:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479232713723904[0;39m 生成今日电子书快照开始
2022-04-18 21:37:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479232713723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479232713723904[0;39m ==> Parameters: 
2022-04-18 21:37:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479232713723904[0;39m <==    Updates: 0
2022-04-18 21:37:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479232713723904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:37:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479253668466688[0;39m 生成今日电子书快照开始
2022-04-18 21:37:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479253668466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479253668466688[0;39m ==> Parameters: 
2022-04-18 21:37:20.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479253668466688[0;39m <==    Updates: 0
2022-04-18 21:37:20.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479253668466688[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:37:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479274644180992[0;39m 生成今日电子书快照开始
2022-04-18 21:37:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479274644180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479274644180992[0;39m ==> Parameters: 
2022-04-18 21:37:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479274644180992[0;39m <==    Updates: 0
2022-04-18 21:37:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479274644180992[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:37:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479295598923776[0;39m 生成今日电子书快照开始
2022-04-18 21:37:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479295598923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479295598923776[0;39m ==> Parameters: 
2022-04-18 21:37:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479295598923776[0;39m <==    Updates: 0
2022-04-18 21:37:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479295598923776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:37:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479316583026688[0;39m start updating Ebook doc
2022-04-18 21:37:35.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479316583026688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:37:35.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479316583026688[0;39m ==> Parameters: 
2022-04-18 21:37:35.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479316583026688[0;39m <==    Updates: 1
2022-04-18 21:37:35.057 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479316583026688[0;39m update ends, take 52 millisecs
2022-04-18 21:37:35.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479316801130496[0;39m 生成今日电子书快照开始
2022-04-18 21:37:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479316801130496[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479316801130496[0;39m ==> Parameters: 
2022-04-18 21:37:35.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479316801130496[0;39m <==    Updates: 0
2022-04-18 21:37:35.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479316801130496[0;39m 生成今日电子书快照结束，耗时：28毫秒
2022-04-18 21:37:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479337562935296[0;39m 生成今日电子书快照开始
2022-04-18 21:37:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479337562935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479337562935296[0;39m ==> Parameters: 
2022-04-18 21:37:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479337562935296[0;39m <==    Updates: 0
2022-04-18 21:37:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479337562935296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:37:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479358513483776[0;39m 生成今日电子书快照开始
2022-04-18 21:37:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479358513483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479358513483776[0;39m ==> Parameters: 
2022-04-18 21:37:45.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479358513483776[0;39m <==    Updates: 0
2022-04-18 21:37:45.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479358513483776[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:37:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479379510169600[0;39m 生成今日电子书快照开始
2022-04-18 21:37:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479379510169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479379510169600[0;39m ==> Parameters: 
2022-04-18 21:37:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479379510169600[0;39m <==    Updates: 0
2022-04-18 21:37:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479379510169600[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:37:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479400448135168[0;39m 生成今日电子书快照开始
2022-04-18 21:37:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479400448135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:37:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479400448135168[0;39m ==> Parameters: 
2022-04-18 21:37:55.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479400448135168[0;39m <==    Updates: 0
2022-04-18 21:37:55.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479400448135168[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:38:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479421449015296[0;39m 生成今日电子书快照开始
2022-04-18 21:38:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479421449015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479421449015296[0;39m ==> Parameters: 
2022-04-18 21:38:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479421449015296[0;39m <==    Updates: 0
2022-04-18 21:38:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479421449015296[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:38:04.999 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479442386980864[0;39m start updating Ebook doc
2022-04-18 21:38:05.015 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479442386980864[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:38:05.015 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479442386980864[0;39m ==> Parameters: 
2022-04-18 21:38:05.042 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479442386980864[0;39m <==    Updates: 1
2022-04-18 21:38:05.042 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479442386980864[0;39m update ends, take 42 millisecs
2022-04-18 21:38:05.042 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479442567335936[0;39m 生成今日电子书快照开始
2022-04-18 21:38:05.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479442567335936[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:05.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479442567335936[0;39m ==> Parameters: 
2022-04-18 21:38:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479442567335936[0;39m <==    Updates: 0
2022-04-18 21:38:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479442567335936[0;39m 生成今日电子书快照结束，耗时：30毫秒
2022-04-18 21:38:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479463400443904[0;39m 生成今日电子书快照开始
2022-04-18 21:38:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479463400443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479463400443904[0;39m ==> Parameters: 
2022-04-18 21:38:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479463400443904[0;39m <==    Updates: 0
2022-04-18 21:38:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479463400443904[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:38:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479484359380992[0;39m 生成今日电子书快照开始
2022-04-18 21:38:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479484359380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479484359380992[0;39m ==> Parameters: 
2022-04-18 21:38:15.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479484359380992[0;39m <==    Updates: 0
2022-04-18 21:38:15.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479484359380992[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 21:38:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479505343483904[0;39m 生成今日电子书快照开始
2022-04-18 21:38:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479505343483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479505343483904[0;39m ==> Parameters: 
2022-04-18 21:38:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479505343483904[0;39m <==    Updates: 0
2022-04-18 21:38:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479505343483904[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:38:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479526319198208[0;39m 生成今日电子书快照开始
2022-04-18 21:38:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479526319198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479526319198208[0;39m ==> Parameters: 
2022-04-18 21:38:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479526319198208[0;39m <==    Updates: 0
2022-04-18 21:38:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479526319198208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:38:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479547282329600[0;39m 生成今日电子书快照开始
2022-04-18 21:38:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479547282329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479547282329600[0;39m ==> Parameters: 
2022-04-18 21:38:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479547282329600[0;39m <==    Updates: 0
2022-04-18 21:38:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479547282329600[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:38:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479568249655296[0;39m start updating Ebook doc
2022-04-18 21:38:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479568249655296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:38:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479568249655296[0;39m ==> Parameters: 
2022-04-18 21:38:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479568249655296[0;39m <==    Updates: 1
2022-04-18 21:38:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479568249655296[0;39m update ends, take 60 millisecs
2022-04-18 21:38:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479568505507840[0;39m 生成今日电子书快照开始
2022-04-18 21:38:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479568505507840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479568505507840[0;39m ==> Parameters: 
2022-04-18 21:38:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479568505507840[0;39m <==    Updates: 0
2022-04-18 21:38:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479568505507840[0;39m 生成今日电子书快照结束，耗时：30毫秒
2022-04-18 21:38:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479589221175296[0;39m 生成今日电子书快照开始
2022-04-18 21:38:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479589221175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479589221175296[0;39m ==> Parameters: 
2022-04-18 21:38:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479589221175296[0;39m <==    Updates: 0
2022-04-18 21:38:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479589221175296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:38:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479610196889600[0;39m 生成今日电子书快照开始
2022-04-18 21:38:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479610196889600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479610196889600[0;39m ==> Parameters: 
2022-04-18 21:38:45.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479610196889600[0;39m <==    Updates: 0
2022-04-18 21:38:45.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479610196889600[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:38:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479631172603904[0;39m 生成今日电子书快照开始
2022-04-18 21:38:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479631172603904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479631172603904[0;39m ==> Parameters: 
2022-04-18 21:38:50.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479631172603904[0;39m <==    Updates: 0
2022-04-18 21:38:50.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479631172603904[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 21:38:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479652148318208[0;39m 生成今日电子书快照开始
2022-04-18 21:38:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479652148318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:38:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479652148318208[0;39m ==> Parameters: 
2022-04-18 21:38:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479652148318208[0;39m <==    Updates: 0
2022-04-18 21:38:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479652148318208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:39:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479673103060992[0;39m 生成今日电子书快照开始
2022-04-18 21:39:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479673103060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479673103060992[0;39m ==> Parameters: 
2022-04-18 21:39:00.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479673103060992[0;39m <==    Updates: 0
2022-04-18 21:39:00.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479673103060992[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 21:39:05.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479694082969600[0;39m start updating Ebook doc
2022-04-18 21:39:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479694082969600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:39:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479694082969600[0;39m ==> Parameters: 
2022-04-18 21:39:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479694082969600[0;39m <==    Updates: 1
2022-04-18 21:39:05.056 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479694082969600[0;39m update ends, take 47 millisecs
2022-04-18 21:39:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479694288490496[0;39m 生成今日电子书快照开始
2022-04-18 21:39:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479694288490496[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479694288490496[0;39m ==> Parameters: 
2022-04-18 21:39:05.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479694288490496[0;39m <==    Updates: 0
2022-04-18 21:39:05.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479694288490496[0;39m 生成今日电子书快照结束，耗时：27毫秒
2022-04-18 21:39:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479715054489600[0;39m 生成今日电子书快照开始
2022-04-18 21:39:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479715054489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479715054489600[0;39m ==> Parameters: 
2022-04-18 21:39:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479715054489600[0;39m <==    Updates: 0
2022-04-18 21:39:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479715054489600[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:39:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479736030203904[0;39m 生成今日电子书快照开始
2022-04-18 21:39:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479736030203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479736030203904[0;39m ==> Parameters: 
2022-04-18 21:39:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479736030203904[0;39m <==    Updates: 0
2022-04-18 21:39:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479736030203904[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:39:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479757005918208[0;39m 生成今日电子书快照开始
2022-04-18 21:39:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479757005918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479757005918208[0;39m ==> Parameters: 
2022-04-18 21:39:20.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479757005918208[0;39m <==    Updates: 0
2022-04-18 21:39:20.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479757005918208[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:39:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479777973243904[0;39m 生成今日电子书快照开始
2022-04-18 21:39:25.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479777973243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479777973243904[0;39m ==> Parameters: 
2022-04-18 21:39:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479777973243904[0;39m <==    Updates: 0
2022-04-18 21:39:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479777973243904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:39:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479798927986688[0;39m 生成今日电子书快照开始
2022-04-18 21:39:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479798927986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479798927986688[0;39m ==> Parameters: 
2022-04-18 21:39:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479798927986688[0;39m <==    Updates: 0
2022-04-18 21:39:30.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479798927986688[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:39:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479819903700992[0;39m start updating Ebook doc
2022-04-18 21:39:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479819903700992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:39:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479819903700992[0;39m ==> Parameters: 
2022-04-18 21:39:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479819903700992[0;39m <==    Updates: 1
2022-04-18 21:39:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479819903700992[0;39m update ends, take 55 millisecs
2022-04-18 21:39:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479820138582016[0;39m 生成今日电子书快照开始
2022-04-18 21:39:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479820138582016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479820138582016[0;39m ==> Parameters: 
2022-04-18 21:39:35.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479820138582016[0;39m <==    Updates: 0
2022-04-18 21:39:35.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479820138582016[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:39:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479840887803904[0;39m 生成今日电子书快照开始
2022-04-18 21:39:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479840887803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479840887803904[0;39m ==> Parameters: 
2022-04-18 21:39:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479840887803904[0;39m <==    Updates: 0
2022-04-18 21:39:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479840887803904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:39:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479861850935296[0;39m 生成今日电子书快照开始
2022-04-18 21:39:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479861850935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479861850935296[0;39m ==> Parameters: 
2022-04-18 21:39:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479861850935296[0;39m <==    Updates: 0
2022-04-18 21:39:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479861850935296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:39:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479882835038208[0;39m 生成今日电子书快照开始
2022-04-18 21:39:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479882835038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479882835038208[0;39m ==> Parameters: 
2022-04-18 21:39:50.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479882835038208[0;39m <==    Updates: 0
2022-04-18 21:39:50.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479882835038208[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:39:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479903777198080[0;39m 生成今日电子书快照开始
2022-04-18 21:39:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479903777198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:39:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479903777198080[0;39m ==> Parameters: 
2022-04-18 21:39:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479903777198080[0;39m <==    Updates: 0
2022-04-18 21:39:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479903777198080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:40:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479924736135168[0;39m 生成今日电子书快照开始
2022-04-18 21:40:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479924736135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479924736135168[0;39m ==> Parameters: 
2022-04-18 21:40:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479924736135168[0;39m <==    Updates: 0
2022-04-18 21:40:00.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479924736135168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:40:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479945728626688[0;39m 生成今日电子书快照开始
2022-04-18 21:40:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479945728626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479945728626688[0;39m ==> Parameters: 
2022-04-18 21:40:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479945728626688[0;39m <==    Updates: 0
2022-04-18 21:40:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479945728626688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:40:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171479945950924800[0;39m start updating Ebook doc
2022-04-18 21:40:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479945950924800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:40:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479945950924800[0;39m ==> Parameters: 
2022-04-18 21:40:05.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171479945950924800[0;39m <==    Updates: 1
2022-04-18 21:40:05.091 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171479945950924800[0;39m update ends, take 33 millisecs
2022-04-18 21:40:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479966704340992[0;39m 生成今日电子书快照开始
2022-04-18 21:40:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479966704340992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479966704340992[0;39m ==> Parameters: 
2022-04-18 21:40:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479966704340992[0;39m <==    Updates: 0
2022-04-18 21:40:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479966704340992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:40:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171479987654889472[0;39m 生成今日电子书快照开始
2022-04-18 21:40:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479987654889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479987654889472[0;39m ==> Parameters: 
2022-04-18 21:40:15.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171479987654889472[0;39m <==    Updates: 0
2022-04-18 21:40:15.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171479987654889472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:40:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480008638992384[0;39m 生成今日电子书快照开始
2022-04-18 21:40:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480008638992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480008638992384[0;39m ==> Parameters: 
2022-04-18 21:40:20.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480008638992384[0;39m <==    Updates: 0
2022-04-18 21:40:20.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480008638992384[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:40:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480029627289600[0;39m 生成今日电子书快照开始
2022-04-18 21:40:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480029627289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480029627289600[0;39m ==> Parameters: 
2022-04-18 21:40:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480029627289600[0;39m <==    Updates: 0
2022-04-18 21:40:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480029627289600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:40:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480050582032384[0;39m 生成今日电子书快照开始
2022-04-18 21:40:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480050582032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480050582032384[0;39m ==> Parameters: 
2022-04-18 21:40:30.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480050582032384[0;39m <==    Updates: 0
2022-04-18 21:40:30.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480050582032384[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:40:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480071574523904[0;39m 生成今日电子书快照开始
2022-04-18 21:40:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480071574523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480071574523904[0;39m ==> Parameters: 
2022-04-18 21:40:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480071574523904[0;39m <==    Updates: 0
2022-04-18 21:40:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480071574523904[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 21:40:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480071788433408[0;39m start updating Ebook doc
2022-04-18 21:40:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480071788433408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:40:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480071788433408[0;39m ==> Parameters: 
2022-04-18 21:40:35.090 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480071788433408[0;39m <==    Updates: 1
2022-04-18 21:40:35.090 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480071788433408[0;39m update ends, take 30 millisecs
2022-04-18 21:40:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480092533460992[0;39m 生成今日电子书快照开始
2022-04-18 21:40:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480092533460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480092533460992[0;39m ==> Parameters: 
2022-04-18 21:40:40.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480092533460992[0;39m <==    Updates: 0
2022-04-18 21:40:40.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480092533460992[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 21:40:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480113504980992[0;39m 生成今日电子书快照开始
2022-04-18 21:40:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480113504980992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480113504980992[0;39m ==> Parameters: 
2022-04-18 21:40:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480113504980992[0;39m <==    Updates: 0
2022-04-18 21:40:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480113504980992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:40:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480134451335168[0;39m 生成今日电子书快照开始
2022-04-18 21:40:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480134451335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480134451335168[0;39m ==> Parameters: 
2022-04-18 21:40:50.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480134451335168[0;39m <==    Updates: 0
2022-04-18 21:40:50.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480134451335168[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:40:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480155448020992[0;39m 生成今日电子书快照开始
2022-04-18 21:40:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480155448020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:40:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480155448020992[0;39m ==> Parameters: 
2022-04-18 21:40:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480155448020992[0;39m <==    Updates: 0
2022-04-18 21:40:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480155448020992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:41:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480176419540992[0;39m 生成今日电子书快照开始
2022-04-18 21:41:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480176419540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480176419540992[0;39m ==> Parameters: 
2022-04-18 21:41:00.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480176419540992[0;39m <==    Updates: 0
2022-04-18 21:41:00.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480176419540992[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:41:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480197382672384[0;39m 生成今日电子书快照开始
2022-04-18 21:41:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480197382672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480197382672384[0;39m ==> Parameters: 
2022-04-18 21:41:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480197382672384[0;39m <==    Updates: 0
2022-04-18 21:41:05.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480197382672384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:41:05.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480197600776192[0;39m start updating Ebook doc
2022-04-18 21:41:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480197600776192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:41:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480197600776192[0;39m ==> Parameters: 
2022-04-18 21:41:05.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480197600776192[0;39m <==    Updates: 1
2022-04-18 21:41:05.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480197600776192[0;39m update ends, take 40 millisecs
2022-04-18 21:41:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480218370969600[0;39m 生成今日电子书快照开始
2022-04-18 21:41:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480218370969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480218370969600[0;39m ==> Parameters: 
2022-04-18 21:41:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480218370969600[0;39m <==    Updates: 0
2022-04-18 21:41:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480218370969600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:41:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480239338295296[0;39m 生成今日电子书快照开始
2022-04-18 21:41:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480239338295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480239338295296[0;39m ==> Parameters: 
2022-04-18 21:41:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480239338295296[0;39m <==    Updates: 0
2022-04-18 21:41:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480239338295296[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:41:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480260305620992[0;39m 生成今日电子书快照开始
2022-04-18 21:41:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480260305620992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480260305620992[0;39m ==> Parameters: 
2022-04-18 21:41:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480260305620992[0;39m <==    Updates: 0
2022-04-18 21:41:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480260305620992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:41:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480281264558080[0;39m 生成今日电子书快照开始
2022-04-18 21:41:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480281264558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480281264558080[0;39m ==> Parameters: 
2022-04-18 21:41:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480281264558080[0;39m <==    Updates: 0
2022-04-18 21:41:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480281264558080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:41:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480302252855296[0;39m 生成今日电子书快照开始
2022-04-18 21:41:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480302252855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480302252855296[0;39m ==> Parameters: 
2022-04-18 21:41:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480302252855296[0;39m <==    Updates: 0
2022-04-18 21:41:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480302252855296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:41:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480323215986688[0;39m 生成今日电子书快照开始
2022-04-18 21:41:35.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480323215986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:35.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480323215986688[0;39m ==> Parameters: 
2022-04-18 21:41:35.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480323215986688[0;39m <==    Updates: 0
2022-04-18 21:41:35.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480323215986688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:41:35.082 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480323538948096[0;39m start updating Ebook doc
2022-04-18 21:41:35.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480323538948096[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:41:35.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480323538948096[0;39m ==> Parameters: 
2022-04-18 21:41:35.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480323538948096[0;39m <==    Updates: 1
2022-04-18 21:41:35.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480323538948096[0;39m update ends, take 37 millisecs
2022-04-18 21:41:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480344174923776[0;39m 生成今日电子书快照开始
2022-04-18 21:41:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480344174923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480344174923776[0;39m ==> Parameters: 
2022-04-18 21:41:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480344174923776[0;39m <==    Updates: 0
2022-04-18 21:41:40.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480344174923776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:41:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480365175803904[0;39m 生成今日电子书快照开始
2022-04-18 21:41:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480365175803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480365175803904[0;39m ==> Parameters: 
2022-04-18 21:41:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480365175803904[0;39m <==    Updates: 0
2022-04-18 21:41:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480365175803904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:41:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480386151518208[0;39m 生成今日电子书快照开始
2022-04-18 21:41:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480386151518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480386151518208[0;39m ==> Parameters: 
2022-04-18 21:41:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480386151518208[0;39m <==    Updates: 0
2022-04-18 21:41:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480386151518208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:41:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480407097872384[0;39m 生成今日电子书快照开始
2022-04-18 21:41:55.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480407097872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:41:55.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480407097872384[0;39m ==> Parameters: 
2022-04-18 21:41:55.148 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480407097872384[0;39m <==    Updates: 0
2022-04-18 21:41:55.148 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480407097872384[0;39m 生成今日电子书快照结束，耗时：143毫秒
2022-04-18 21:42:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480428081975296[0;39m 生成今日电子书快照开始
2022-04-18 21:42:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480428081975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480428081975296[0;39m ==> Parameters: 
2022-04-18 21:42:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480428081975296[0;39m <==    Updates: 0
2022-04-18 21:42:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480428081975296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:42:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480449053495296[0;39m 生成今日电子书快照开始
2022-04-18 21:42:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480449053495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480449053495296[0;39m ==> Parameters: 
2022-04-18 21:42:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480449053495296[0;39m <==    Updates: 0
2022-04-18 21:42:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480449053495296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:42:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480449321930752[0;39m start updating Ebook doc
2022-04-18 21:42:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480449321930752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:42:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480449321930752[0;39m ==> Parameters: 
2022-04-18 21:42:05.142 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480449321930752[0;39m <==    Updates: 1
2022-04-18 21:42:05.142 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480449321930752[0;39m update ends, take 71 millisecs
2022-04-18 21:42:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480470025015296[0;39m 生成今日电子书快照开始
2022-04-18 21:42:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480470025015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480470025015296[0;39m ==> Parameters: 
2022-04-18 21:42:10.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480470025015296[0;39m <==    Updates: 0
2022-04-18 21:42:10.142 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480470025015296[0;39m 生成今日电子书快照结束，耗时：134毫秒
2022-04-18 21:42:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480490988146688[0;39m 生成今日电子书快照开始
2022-04-18 21:42:15.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480490988146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:15.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480490988146688[0;39m ==> Parameters: 
2022-04-18 21:42:15.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480490988146688[0;39m <==    Updates: 0
2022-04-18 21:42:15.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480490988146688[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 21:42:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480511955472384[0;39m 生成今日电子书快照开始
2022-04-18 21:42:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480511955472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480511955472384[0;39m ==> Parameters: 
2022-04-18 21:42:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480511955472384[0;39m <==    Updates: 0
2022-04-18 21:42:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480511955472384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:42:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480532952158208[0;39m 生成今日电子书快照开始
2022-04-18 21:42:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480532952158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480532952158208[0;39m ==> Parameters: 
2022-04-18 21:42:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480532952158208[0;39m <==    Updates: 0
2022-04-18 21:42:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480532952158208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:42:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480553906900992[0;39m 生成今日电子书快照开始
2022-04-18 21:42:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480553906900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480553906900992[0;39m ==> Parameters: 
2022-04-18 21:42:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480553906900992[0;39m <==    Updates: 0
2022-04-18 21:42:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480553906900992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:42:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480574870032384[0;39m 生成今日电子书快照开始
2022-04-18 21:42:35.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480574870032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:35.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480574870032384[0;39m ==> Parameters: 
2022-04-18 21:42:35.165 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480574870032384[0;39m <==    Updates: 0
2022-04-18 21:42:35.165 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480574870032384[0;39m 生成今日电子书快照结束，耗时：161毫秒
2022-04-18 21:42:35.165 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480575545315328[0;39m start updating Ebook doc
2022-04-18 21:42:35.165 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480575545315328[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:42:35.165 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480575545315328[0;39m ==> Parameters: 
2022-04-18 21:42:35.211 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480575545315328[0;39m <==    Updates: 1
2022-04-18 21:42:35.212 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480575545315328[0;39m update ends, take 47 millisecs
2022-04-18 21:42:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480595858329600[0;39m 生成今日电子书快照开始
2022-04-18 21:42:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480595858329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480595858329600[0;39m ==> Parameters: 
2022-04-18 21:42:40.275 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480595858329600[0;39m <==    Updates: 0
2022-04-18 21:42:40.276 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480595858329600[0;39m 生成今日电子书快照结束，耗时：268毫秒
2022-04-18 21:42:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480616825655296[0;39m 生成今日电子书快照开始
2022-04-18 21:42:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480616825655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480616825655296[0;39m ==> Parameters: 
2022-04-18 21:42:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480616825655296[0;39m <==    Updates: 0
2022-04-18 21:42:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480616825655296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:42:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480637801369600[0;39m 生成今日电子书快照开始
2022-04-18 21:42:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480637801369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480637801369600[0;39m ==> Parameters: 
2022-04-18 21:42:50.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480637801369600[0;39m <==    Updates: 0
2022-04-18 21:42:50.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480637801369600[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:42:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480658781278208[0;39m 生成今日电子书快照开始
2022-04-18 21:42:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480658781278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:42:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480658781278208[0;39m ==> Parameters: 
2022-04-18 21:42:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480658781278208[0;39m <==    Updates: 0
2022-04-18 21:42:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480658781278208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:43:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480679715049472[0;39m 生成今日电子书快照开始
2022-04-18 21:43:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480679715049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480679715049472[0;39m ==> Parameters: 
2022-04-18 21:43:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480679715049472[0;39m <==    Updates: 0
2022-04-18 21:43:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480679715049472[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:43:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480700690763776[0;39m start updating Ebook doc
2022-04-18 21:43:05.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480700690763776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:43:05.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480700690763776[0;39m ==> Parameters: 
2022-04-18 21:43:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480700690763776[0;39m <==    Updates: 1
2022-04-18 21:43:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480700690763776[0;39m update ends, take 55 millisecs
2022-04-18 21:43:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480700925644800[0;39m 生成今日电子书快照开始
2022-04-18 21:43:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480700925644800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480700925644800[0;39m ==> Parameters: 
2022-04-18 21:43:05.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480700925644800[0;39m <==    Updates: 0
2022-04-18 21:43:05.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480700925644800[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 21:43:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480721679060992[0;39m 生成今日电子书快照开始
2022-04-18 21:43:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480721679060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480721679060992[0;39m ==> Parameters: 
2022-04-18 21:43:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480721679060992[0;39m <==    Updates: 0
2022-04-18 21:43:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480721679060992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:43:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480742650580992[0;39m 生成今日电子书快照开始
2022-04-18 21:43:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480742650580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480742650580992[0;39m ==> Parameters: 
2022-04-18 21:43:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480742650580992[0;39m <==    Updates: 0
2022-04-18 21:43:15.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480742650580992[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:43:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480763622100992[0;39m 生成今日电子书快照开始
2022-04-18 21:43:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480763622100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480763622100992[0;39m ==> Parameters: 
2022-04-18 21:43:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480763622100992[0;39m <==    Updates: 0
2022-04-18 21:43:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480763622100992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:43:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480784597815296[0;39m 生成今日电子书快照开始
2022-04-18 21:43:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480784597815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480784597815296[0;39m ==> Parameters: 
2022-04-18 21:43:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480784597815296[0;39m <==    Updates: 0
2022-04-18 21:43:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480784597815296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:43:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480805552558080[0;39m 生成今日电子书快照开始
2022-04-18 21:43:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480805552558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480805552558080[0;39m ==> Parameters: 
2022-04-18 21:43:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480805552558080[0;39m <==    Updates: 0
2022-04-18 21:43:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480805552558080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:43:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480826515689472[0;39m start updating Ebook doc
2022-04-18 21:43:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480826515689472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:43:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480826515689472[0;39m ==> Parameters: 
2022-04-18 21:43:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480826515689472[0;39m <==    Updates: 1
2022-04-18 21:43:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480826515689472[0;39m update ends, take 54 millisecs
2022-04-18 21:43:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480826746376192[0;39m 生成今日电子书快照开始
2022-04-18 21:43:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480826746376192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480826746376192[0;39m ==> Parameters: 
2022-04-18 21:43:35.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480826746376192[0;39m <==    Updates: 0
2022-04-18 21:43:35.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480826746376192[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-18 21:43:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480847524958208[0;39m 生成今日电子书快照开始
2022-04-18 21:43:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480847524958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480847524958208[0;39m ==> Parameters: 
2022-04-18 21:43:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480847524958208[0;39m <==    Updates: 0
2022-04-18 21:43:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480847524958208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:43:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480868488089600[0;39m 生成今日电子书快照开始
2022-04-18 21:43:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480868488089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480868488089600[0;39m ==> Parameters: 
2022-04-18 21:43:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480868488089600[0;39m <==    Updates: 0
2022-04-18 21:43:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480868488089600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:43:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480889467998208[0;39m 生成今日电子书快照开始
2022-04-18 21:43:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480889467998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480889467998208[0;39m ==> Parameters: 
2022-04-18 21:43:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480889467998208[0;39m <==    Updates: 0
2022-04-18 21:43:50.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480889467998208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:43:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480910418546688[0;39m 生成今日电子书快照开始
2022-04-18 21:43:55.230 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480910418546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:43:55.230 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480910418546688[0;39m ==> Parameters: 
2022-04-18 21:43:55.272 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480910418546688[0;39m <==    Updates: 0
2022-04-18 21:43:55.272 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480910418546688[0;39m 生成今日电子书快照结束，耗时：267毫秒
2022-04-18 21:44:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480931398455296[0;39m 生成今日电子书快照开始
2022-04-18 21:44:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480931398455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480931398455296[0;39m ==> Parameters: 
2022-04-18 21:44:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480931398455296[0;39m <==    Updates: 0
2022-04-18 21:44:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480931398455296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:44:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171480952349003776[0;39m start updating Ebook doc
2022-04-18 21:44:05.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480952349003776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:44:05.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480952349003776[0;39m ==> Parameters: 
2022-04-18 21:44:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171480952349003776[0;39m <==    Updates: 1
2022-04-18 21:44:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171480952349003776[0;39m update ends, take 60 millisecs
2022-04-18 21:44:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480952604856320[0;39m 生成今日电子书快照开始
2022-04-18 21:44:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480952604856320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480952604856320[0;39m ==> Parameters: 
2022-04-18 21:44:05.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480952604856320[0;39m <==    Updates: 0
2022-04-18 21:44:05.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480952604856320[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 21:44:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480973354078208[0;39m 生成今日电子书快照开始
2022-04-18 21:44:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480973354078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480973354078208[0;39m ==> Parameters: 
2022-04-18 21:44:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480973354078208[0;39m <==    Updates: 0
2022-04-18 21:44:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480973354078208[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:44:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171480994313015296[0;39m 生成今日电子书快照开始
2022-04-18 21:44:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480994313015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480994313015296[0;39m ==> Parameters: 
2022-04-18 21:44:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171480994313015296[0;39m <==    Updates: 0
2022-04-18 21:44:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171480994313015296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:44:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481015288729600[0;39m 生成今日电子书快照开始
2022-04-18 21:44:20.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481015288729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:20.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481015288729600[0;39m ==> Parameters: 
2022-04-18 21:44:20.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481015288729600[0;39m <==    Updates: 0
2022-04-18 21:44:20.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481015288729600[0;39m 生成今日电子书快照结束，耗时：86毫秒
2022-04-18 21:44:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481036264443904[0;39m 生成今日电子书快照开始
2022-04-18 21:44:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481036264443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481036264443904[0;39m ==> Parameters: 
2022-04-18 21:44:25.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481036264443904[0;39m <==    Updates: 0
2022-04-18 21:44:25.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481036264443904[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:44:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481057223380992[0;39m 生成今日电子书快照开始
2022-04-18 21:44:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481057223380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481057223380992[0;39m ==> Parameters: 
2022-04-18 21:44:30.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481057223380992[0;39m <==    Updates: 0
2022-04-18 21:44:30.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481057223380992[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 21:44:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481078178123776[0;39m 生成今日电子书快照开始
2022-04-18 21:44:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481078178123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481078178123776[0;39m ==> Parameters: 
2022-04-18 21:44:35.198 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481078178123776[0;39m <==    Updates: 0
2022-04-18 21:44:35.198 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481078178123776[0;39m 生成今日电子书快照结束，耗时：195毫秒
2022-04-18 21:44:35.198 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481079000207360[0;39m start updating Ebook doc
2022-04-18 21:44:35.198 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481079000207360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:44:35.198 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481079000207360[0;39m ==> Parameters: 
2022-04-18 21:44:35.237 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481079000207360[0;39m <==    Updates: 1
2022-04-18 21:44:35.237 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481079000207360[0;39m update ends, take 39 millisecs
2022-04-18 21:44:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481099153838080[0;39m 生成今日电子书快照开始
2022-04-18 21:44:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481099153838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481099153838080[0;39m ==> Parameters: 
2022-04-18 21:44:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481099153838080[0;39m <==    Updates: 0
2022-04-18 21:44:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481099153838080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:44:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481120142135296[0;39m 生成今日电子书快照开始
2022-04-18 21:44:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481120142135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481120142135296[0;39m ==> Parameters: 
2022-04-18 21:44:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481120142135296[0;39m <==    Updates: 0
2022-04-18 21:44:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481120142135296[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:44:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481141105266688[0;39m 生成今日电子书快照开始
2022-04-18 21:44:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481141105266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481141105266688[0;39m ==> Parameters: 
2022-04-18 21:44:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481141105266688[0;39m <==    Updates: 0
2022-04-18 21:44:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481141105266688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:44:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481162060009472[0;39m 生成今日电子书快照开始
2022-04-18 21:44:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481162060009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:44:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481162060009472[0;39m ==> Parameters: 
2022-04-18 21:44:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481162060009472[0;39m <==    Updates: 0
2022-04-18 21:44:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481162060009472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:45:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481183069278208[0;39m 生成今日电子书快照开始
2022-04-18 21:45:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481183069278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481183069278208[0;39m ==> Parameters: 
2022-04-18 21:45:00.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481183069278208[0;39m <==    Updates: 0
2022-04-18 21:45:00.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481183069278208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:45:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481204032409600[0;39m 生成今日电子书快照开始
2022-04-18 21:45:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481204032409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481204032409600[0;39m ==> Parameters: 
2022-04-18 21:45:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481204032409600[0;39m <==    Updates: 0
2022-04-18 21:45:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481204032409600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:45:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481204296650752[0;39m start updating Ebook doc
2022-04-18 21:45:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481204296650752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:45:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481204296650752[0;39m ==> Parameters: 
2022-04-18 21:45:05.118 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481204296650752[0;39m <==    Updates: 1
2022-04-18 21:45:05.118 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481204296650752[0;39m update ends, take 47 millisecs
2022-04-18 21:45:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481225008123904[0;39m 生成今日电子书快照开始
2022-04-18 21:45:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481225008123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481225008123904[0;39m ==> Parameters: 
2022-04-18 21:45:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481225008123904[0;39m <==    Updates: 0
2022-04-18 21:45:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481225008123904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:45:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481245975449600[0;39m 生成今日电子书快照开始
2022-04-18 21:45:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481245975449600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481245975449600[0;39m ==> Parameters: 
2022-04-18 21:45:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481245975449600[0;39m <==    Updates: 0
2022-04-18 21:45:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481245975449600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:45:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481266942775296[0;39m 生成今日电子书快照开始
2022-04-18 21:45:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481266942775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481266942775296[0;39m ==> Parameters: 
2022-04-18 21:45:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481266942775296[0;39m <==    Updates: 0
2022-04-18 21:45:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481266942775296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:45:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481287926878208[0;39m 生成今日电子书快照开始
2022-04-18 21:45:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481287926878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481287926878208[0;39m ==> Parameters: 
2022-04-18 21:45:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481287926878208[0;39m <==    Updates: 0
2022-04-18 21:45:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481287926878208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:45:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481308894203904[0;39m 生成今日电子书快照开始
2022-04-18 21:45:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481308894203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481308894203904[0;39m ==> Parameters: 
2022-04-18 21:45:30.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481308894203904[0;39m <==    Updates: 0
2022-04-18 21:45:30.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481308894203904[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 21:45:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481329869918208[0;39m 生成今日电子书快照开始
2022-04-18 21:45:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481329869918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481329869918208[0;39m ==> Parameters: 
2022-04-18 21:45:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481329869918208[0;39m <==    Updates: 0
2022-04-18 21:45:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481329869918208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:45:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481330108993536[0;39m start updating Ebook doc
2022-04-18 21:45:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481330108993536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:45:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481330108993536[0;39m ==> Parameters: 
2022-04-18 21:45:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481330108993536[0;39m <==    Updates: 1
2022-04-18 21:45:35.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481330108993536[0;39m update ends, take 37 millisecs
2022-04-18 21:45:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481350828855296[0;39m 生成今日电子书快照开始
2022-04-18 21:45:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481350828855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481350828855296[0;39m ==> Parameters: 
2022-04-18 21:45:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481350828855296[0;39m <==    Updates: 0
2022-04-18 21:45:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481350828855296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:45:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481371771015168[0;39m 生成今日电子书快照开始
2022-04-18 21:45:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481371771015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481371771015168[0;39m ==> Parameters: 
2022-04-18 21:45:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481371771015168[0;39m <==    Updates: 0
2022-04-18 21:45:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481371771015168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:45:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481392746729472[0;39m 生成今日电子书快照开始
2022-04-18 21:45:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481392746729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481392746729472[0;39m ==> Parameters: 
2022-04-18 21:45:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481392746729472[0;39m <==    Updates: 0
2022-04-18 21:45:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481392746729472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:45:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481413751803904[0;39m 生成今日电子书快照开始
2022-04-18 21:45:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481413751803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:45:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481413751803904[0;39m ==> Parameters: 
2022-04-18 21:45:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481413751803904[0;39m <==    Updates: 0
2022-04-18 21:45:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481413751803904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:46:00.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481434731712512[0;39m 生成今日电子书快照开始
2022-04-18 21:46:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481434731712512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481434731712512[0;39m ==> Parameters: 
2022-04-18 21:46:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481434731712512[0;39m <==    Updates: 0
2022-04-18 21:46:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481434731712512[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:46:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481455699038208[0;39m start updating Ebook doc
2022-04-18 21:46:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481455699038208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:46:05.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481455699038208[0;39m ==> Parameters: 
2022-04-18 21:46:05.085 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481455699038208[0;39m <==    Updates: 1
2022-04-18 21:46:05.086 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481455699038208[0;39m update ends, take 76 millisecs
2022-04-18 21:46:05.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481456017805312[0;39m 生成今日电子书快照开始
2022-04-18 21:46:05.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481456017805312[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:05.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481456017805312[0;39m ==> Parameters: 
2022-04-18 21:46:05.126 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481456017805312[0;39m <==    Updates: 0
2022-04-18 21:46:05.126 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481456017805312[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 21:46:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481476666363904[0;39m 生成今日电子书快照开始
2022-04-18 21:46:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481476666363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:10.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481476666363904[0;39m ==> Parameters: 
2022-04-18 21:46:10.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481476666363904[0;39m <==    Updates: 0
2022-04-18 21:46:10.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481476666363904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:46:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481497637883904[0;39m 生成今日电子书快照开始
2022-04-18 21:46:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481497637883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481497637883904[0;39m ==> Parameters: 
2022-04-18 21:46:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481497637883904[0;39m <==    Updates: 0
2022-04-18 21:46:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481497637883904[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:46:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481518575849472[0;39m 生成今日电子书快照开始
2022-04-18 21:46:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481518575849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481518575849472[0;39m ==> Parameters: 
2022-04-18 21:46:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481518575849472[0;39m <==    Updates: 0
2022-04-18 21:46:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481518575849472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:46:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481539547369472[0;39m 生成今日电子书快照开始
2022-04-18 21:46:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481539547369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481539547369472[0;39m ==> Parameters: 
2022-04-18 21:46:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481539547369472[0;39m <==    Updates: 0
2022-04-18 21:46:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481539547369472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:46:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481560539860992[0;39m 生成今日电子书快照开始
2022-04-18 21:46:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481560539860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481560539860992[0;39m ==> Parameters: 
2022-04-18 21:46:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481560539860992[0;39m <==    Updates: 0
2022-04-18 21:46:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481560539860992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:46:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481581528158208[0;39m start updating Ebook doc
2022-04-18 21:46:35.040 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481581528158208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:46:35.040 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481581528158208[0;39m ==> Parameters: 
2022-04-18 21:46:35.083 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481581528158208[0;39m <==    Updates: 1
2022-04-18 21:46:35.083 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481581528158208[0;39m update ends, take 72 millisecs
2022-04-18 21:46:35.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481581834342400[0;39m 生成今日电子书快照开始
2022-04-18 21:46:35.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481581834342400[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:35.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481581834342400[0;39m ==> Parameters: 
2022-04-18 21:46:35.124 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481581834342400[0;39m <==    Updates: 0
2022-04-18 21:46:35.125 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481581834342400[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 21:46:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481602487095296[0;39m 生成今日电子书快照开始
2022-04-18 21:46:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481602487095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481602487095296[0;39m ==> Parameters: 
2022-04-18 21:46:40.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481602487095296[0;39m <==    Updates: 0
2022-04-18 21:46:40.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481602487095296[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 21:46:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481623462809600[0;39m 生成今日电子书快照开始
2022-04-18 21:46:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481623462809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481623462809600[0;39m ==> Parameters: 
2022-04-18 21:46:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481623462809600[0;39m <==    Updates: 0
2022-04-18 21:46:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481623462809600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:46:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481644438523904[0;39m 生成今日电子书快照开始
2022-04-18 21:46:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481644438523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481644438523904[0;39m ==> Parameters: 
2022-04-18 21:46:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481644438523904[0;39m <==    Updates: 0
2022-04-18 21:46:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481644438523904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:46:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481665380683776[0;39m 生成今日电子书快照开始
2022-04-18 21:46:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481665380683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:46:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481665380683776[0;39m ==> Parameters: 
2022-04-18 21:46:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481665380683776[0;39m <==    Updates: 0
2022-04-18 21:46:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481665380683776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:47:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481686381563904[0;39m 生成今日电子书快照开始
2022-04-18 21:47:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481686381563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481686381563904[0;39m ==> Parameters: 
2022-04-18 21:47:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481686381563904[0;39m <==    Updates: 0
2022-04-18 21:47:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481686381563904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:47:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481707336306688[0;39m 生成今日电子书快照开始
2022-04-18 21:47:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481707336306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481707336306688[0;39m ==> Parameters: 
2022-04-18 21:47:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481707336306688[0;39m <==    Updates: 0
2022-04-18 21:47:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481707336306688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:47:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481707554410496[0;39m start updating Ebook doc
2022-04-18 21:47:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481707554410496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:47:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481707554410496[0;39m ==> Parameters: 
2022-04-18 21:47:05.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481707554410496[0;39m <==    Updates: 1
2022-04-18 21:47:05.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481707554410496[0;39m update ends, take 37 millisecs
2022-04-18 21:47:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481728312020992[0;39m 生成今日电子书快照开始
2022-04-18 21:47:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481728312020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481728312020992[0;39m ==> Parameters: 
2022-04-18 21:47:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481728312020992[0;39m <==    Updates: 0
2022-04-18 21:47:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481728312020992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:47:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481749300318208[0;39m 生成今日电子书快照开始
2022-04-18 21:47:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481749300318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481749300318208[0;39m ==> Parameters: 
2022-04-18 21:47:15.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481749300318208[0;39m <==    Updates: 0
2022-04-18 21:47:15.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481749300318208[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-18 21:47:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481770246672384[0;39m 生成今日电子书快照开始
2022-04-18 21:47:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481770246672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481770246672384[0;39m ==> Parameters: 
2022-04-18 21:47:20.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481770246672384[0;39m <==    Updates: 0
2022-04-18 21:47:20.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481770246672384[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 21:47:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481791213998080[0;39m 生成今日电子书快照开始
2022-04-18 21:47:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481791213998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481791213998080[0;39m ==> Parameters: 
2022-04-18 21:47:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481791213998080[0;39m <==    Updates: 0
2022-04-18 21:47:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481791213998080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:47:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481812198100992[0;39m 生成今日电子书快照开始
2022-04-18 21:47:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481812198100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481812198100992[0;39m ==> Parameters: 
2022-04-18 21:47:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481812198100992[0;39m <==    Updates: 0
2022-04-18 21:47:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481812198100992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:47:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481833186398208[0;39m 生成今日电子书快照开始
2022-04-18 21:47:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481833186398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481833186398208[0;39m ==> Parameters: 
2022-04-18 21:47:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481833186398208[0;39m <==    Updates: 0
2022-04-18 21:47:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481833186398208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:47:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481833459027968[0;39m start updating Ebook doc
2022-04-18 21:47:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481833459027968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:47:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481833459027968[0;39m ==> Parameters: 
2022-04-18 21:47:35.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481833459027968[0;39m <==    Updates: 1
2022-04-18 21:47:35.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481833459027968[0;39m update ends, take 39 millisecs
2022-04-18 21:47:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481854149529600[0;39m 生成今日电子书快照开始
2022-04-18 21:47:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481854149529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481854149529600[0;39m ==> Parameters: 
2022-04-18 21:47:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481854149529600[0;39m <==    Updates: 0
2022-04-18 21:47:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481854149529600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:47:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481875116855296[0;39m 生成今日电子书快照开始
2022-04-18 21:47:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481875116855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481875116855296[0;39m ==> Parameters: 
2022-04-18 21:47:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481875116855296[0;39m <==    Updates: 0
2022-04-18 21:47:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481875116855296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:47:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481896096763904[0;39m 生成今日电子书快照开始
2022-04-18 21:47:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481896096763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481896096763904[0;39m ==> Parameters: 
2022-04-18 21:47:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481896096763904[0;39m <==    Updates: 0
2022-04-18 21:47:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481896096763904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:47:55.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481917076672512[0;39m 生成今日电子书快照开始
2022-04-18 21:47:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481917076672512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:47:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481917076672512[0;39m ==> Parameters: 
2022-04-18 21:47:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481917076672512[0;39m <==    Updates: 0
2022-04-18 21:47:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481917076672512[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:48:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481938031415296[0;39m 生成今日电子书快照开始
2022-04-18 21:48:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481938031415296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481938031415296[0;39m ==> Parameters: 
2022-04-18 21:48:00.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481938031415296[0;39m <==    Updates: 0
2022-04-18 21:48:00.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481938031415296[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:48:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481959002935296[0;39m 生成今日电子书快照开始
2022-04-18 21:48:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481959002935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481959002935296[0;39m ==> Parameters: 
2022-04-18 21:48:05.146 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481959002935296[0;39m <==    Updates: 0
2022-04-18 21:48:05.146 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481959002935296[0;39m 生成今日电子书快照结束，耗时：138毫秒
2022-04-18 21:48:05.146 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171481959585943552[0;39m start updating Ebook doc
2022-04-18 21:48:05.146 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481959585943552[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:48:05.146 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481959585943552[0;39m ==> Parameters: 
2022-04-18 21:48:05.181 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171481959585943552[0;39m <==    Updates: 1
2022-04-18 21:48:05.181 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171481959585943552[0;39m update ends, take 35 millisecs
2022-04-18 21:48:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171481979949289472[0;39m 生成今日电子书快照开始
2022-04-18 21:48:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481979949289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481979949289472[0;39m ==> Parameters: 
2022-04-18 21:48:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171481979949289472[0;39m <==    Updates: 0
2022-04-18 21:48:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171481979949289472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 21:48:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482000933392384[0;39m 生成今日电子书快照开始
2022-04-18 21:48:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482000933392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482000933392384[0;39m ==> Parameters: 
2022-04-18 21:48:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482000933392384[0;39m <==    Updates: 0
2022-04-18 21:48:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482000933392384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:48:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482021900718080[0;39m 生成今日电子书快照开始
2022-04-18 21:48:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482021900718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482021900718080[0;39m ==> Parameters: 
2022-04-18 21:48:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482021900718080[0;39m <==    Updates: 0
2022-04-18 21:48:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482021900718080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:48:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482042901598208[0;39m 生成今日电子书快照开始
2022-04-18 21:48:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482042901598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482042901598208[0;39m ==> Parameters: 
2022-04-18 21:48:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482042901598208[0;39m <==    Updates: 0
2022-04-18 21:48:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482042901598208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:48:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482063864729600[0;39m 生成今日电子书快照开始
2022-04-18 21:48:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482063864729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482063864729600[0;39m ==> Parameters: 
2022-04-18 21:48:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482063864729600[0;39m <==    Updates: 0
2022-04-18 21:48:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482063864729600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:48:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482084823666688[0;39m start updating Ebook doc
2022-04-18 21:48:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482084823666688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:48:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482084823666688[0;39m ==> Parameters: 
2022-04-18 21:48:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482084823666688[0;39m <==    Updates: 1
2022-04-18 21:48:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482084823666688[0;39m update ends, take 56 millisecs
2022-04-18 21:48:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482085058547712[0;39m 生成今日电子书快照开始
2022-04-18 21:48:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482085058547712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482085058547712[0;39m ==> Parameters: 
2022-04-18 21:48:35.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482085058547712[0;39m <==    Updates: 0
2022-04-18 21:48:35.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482085058547712[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 21:48:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482105807769600[0;39m 生成今日电子书快照开始
2022-04-18 21:48:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482105807769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482105807769600[0;39m ==> Parameters: 
2022-04-18 21:48:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482105807769600[0;39m <==    Updates: 0
2022-04-18 21:48:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482105807769600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:48:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482126766706688[0;39m 生成今日电子书快照开始
2022-04-18 21:48:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482126766706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482126766706688[0;39m ==> Parameters: 
2022-04-18 21:48:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482126766706688[0;39m <==    Updates: 0
2022-04-18 21:48:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482126766706688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 21:48:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482147734032384[0;39m 生成今日电子书快照开始
2022-04-18 21:48:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482147734032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482147734032384[0;39m ==> Parameters: 
2022-04-18 21:48:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482147734032384[0;39m <==    Updates: 0
2022-04-18 21:48:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482147734032384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:48:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482168705552384[0;39m 生成今日电子书快照开始
2022-04-18 21:48:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482168705552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:48:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482168705552384[0;39m ==> Parameters: 
2022-04-18 21:48:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482168705552384[0;39m <==    Updates: 0
2022-04-18 21:48:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482168705552384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:49:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482189668683776[0;39m 生成今日电子书快照开始
2022-04-18 21:49:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482189668683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482189668683776[0;39m ==> Parameters: 
2022-04-18 21:49:00.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482189668683776[0;39m <==    Updates: 0
2022-04-18 21:49:00.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482189668683776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:49:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482210640203776[0;39m 生成今日电子书快照开始
2022-04-18 21:49:05.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482210640203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:05.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482210640203776[0;39m ==> Parameters: 
2022-04-18 21:49:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482210640203776[0;39m <==    Updates: 0
2022-04-18 21:49:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482210640203776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:49:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482210883473408[0;39m start updating Ebook doc
2022-04-18 21:49:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482210883473408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:49:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482210883473408[0;39m ==> Parameters: 
2022-04-18 21:49:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482210883473408[0;39m <==    Updates: 1
2022-04-18 21:49:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482210883473408[0;39m update ends, take 47 millisecs
2022-04-18 21:49:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482231645278208[0;39m 生成今日电子书快照开始
2022-04-18 21:49:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482231645278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482231645278208[0;39m ==> Parameters: 
2022-04-18 21:49:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482231645278208[0;39m <==    Updates: 0
2022-04-18 21:49:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482231645278208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:49:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482252608409600[0;39m 生成今日电子书快照开始
2022-04-18 21:49:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482252608409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482252608409600[0;39m ==> Parameters: 
2022-04-18 21:49:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482252608409600[0;39m <==    Updates: 0
2022-04-18 21:49:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482252608409600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:49:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482273563152384[0;39m 生成今日电子书快照开始
2022-04-18 21:49:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482273563152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482273563152384[0;39m ==> Parameters: 
2022-04-18 21:49:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482273563152384[0;39m <==    Updates: 0
2022-04-18 21:49:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482273563152384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:49:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482294530478080[0;39m 生成今日电子书快照开始
2022-04-18 21:49:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482294530478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482294530478080[0;39m ==> Parameters: 
2022-04-18 21:49:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482294530478080[0;39m <==    Updates: 0
2022-04-18 21:49:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482294530478080[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:49:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482315493609472[0;39m 生成今日电子书快照开始
2022-04-18 21:49:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482315493609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482315493609472[0;39m ==> Parameters: 
2022-04-18 21:49:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482315493609472[0;39m <==    Updates: 0
2022-04-18 21:49:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482315493609472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:49:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482336460935168[0;39m 生成今日电子书快照开始
2022-04-18 21:49:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482336460935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482336460935168[0;39m ==> Parameters: 
2022-04-18 21:49:35.233 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482336460935168[0;39m <==    Updates: 0
2022-04-18 21:49:35.233 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482336460935168[0;39m 生成今日电子书快照结束，耗时：233毫秒
2022-04-18 21:49:35.233 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482337438208000[0;39m start updating Ebook doc
2022-04-18 21:49:35.234 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482337438208000[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:49:35.234 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482337438208000[0;39m ==> Parameters: 
2022-04-18 21:49:35.394 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482337438208000[0;39m <==    Updates: 1
2022-04-18 21:49:35.394 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482337438208000[0;39m update ends, take 160 millisecs
2022-04-18 21:49:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482357436649472[0;39m 生成今日电子书快照开始
2022-04-18 21:49:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482357436649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482357436649472[0;39m ==> Parameters: 
2022-04-18 21:49:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482357436649472[0;39m <==    Updates: 0
2022-04-18 21:49:40.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482357436649472[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 21:49:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482378420752384[0;39m 生成今日电子书快照开始
2022-04-18 21:49:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482378420752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482378420752384[0;39m ==> Parameters: 
2022-04-18 21:49:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482378420752384[0;39m <==    Updates: 0
2022-04-18 21:49:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482378420752384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:49:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482399388078080[0;39m 生成今日电子书快照开始
2022-04-18 21:49:50.160 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482399388078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:50.160 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482399388078080[0;39m ==> Parameters: 
2022-04-18 21:49:50.194 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482399388078080[0;39m <==    Updates: 0
2022-04-18 21:49:50.194 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482399388078080[0;39m 生成今日电子书快照结束，耗时：190毫秒
2022-04-18 21:49:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482420355403776[0;39m 生成今日电子书快照开始
2022-04-18 21:49:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482420355403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:49:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482420355403776[0;39m ==> Parameters: 
2022-04-18 21:49:55.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482420355403776[0;39m <==    Updates: 0
2022-04-18 21:49:55.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482420355403776[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 21:50:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482441322729472[0;39m 生成今日电子书快照开始
2022-04-18 21:50:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482441322729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482441322729472[0;39m ==> Parameters: 
2022-04-18 21:50:00.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482441322729472[0;39m <==    Updates: 0
2022-04-18 21:50:00.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482441322729472[0;39m 生成今日电子书快照结束，耗时：119毫秒
2022-04-18 21:50:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482462311026688[0;39m 生成今日电子书快照开始
2022-04-18 21:50:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482462311026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482462311026688[0;39m ==> Parameters: 
2022-04-18 21:50:05.284 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482462311026688[0;39m <==    Updates: 0
2022-04-18 21:50:05.285 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482462311026688[0;39m 生成今日电子书快照结束，耗时：279毫秒
2022-04-18 21:50:05.285 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482463485431808[0;39m start updating Ebook doc
2022-04-18 21:50:05.285 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482463485431808[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:50:05.285 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482463485431808[0;39m ==> Parameters: 
2022-04-18 21:50:05.339 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482463485431808[0;39m <==    Updates: 1
2022-04-18 21:50:05.340 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482463485431808[0;39m update ends, take 55 millisecs
2022-04-18 21:50:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482483265769472[0;39m 生成今日电子书快照开始
2022-04-18 21:50:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482483265769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482483265769472[0;39m ==> Parameters: 
2022-04-18 21:50:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482483265769472[0;39m <==    Updates: 0
2022-04-18 21:50:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482483265769472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:50:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482504245678080[0;39m 生成今日电子书快照开始
2022-04-18 21:50:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482504245678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482504245678080[0;39m ==> Parameters: 
2022-04-18 21:50:15.157 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482504245678080[0;39m <==    Updates: 0
2022-04-18 21:50:15.157 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482504245678080[0;39m 生成今日电子书快照结束，耗时：153毫秒
2022-04-18 21:50:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482525217198080[0;39m 生成今日电子书快照开始
2022-04-18 21:50:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482525217198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482525217198080[0;39m ==> Parameters: 
2022-04-18 21:50:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482525217198080[0;39m <==    Updates: 0
2022-04-18 21:50:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482525217198080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 21:50:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482546184523776[0;39m 生成今日电子书快照开始
2022-04-18 21:50:25.225 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482546184523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:25.225 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482546184523776[0;39m ==> Parameters: 
2022-04-18 21:50:25.295 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482546184523776[0;39m <==    Updates: 0
2022-04-18 21:50:25.295 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482546184523776[0;39m 生成今日电子书快照结束，耗时：292毫秒
2022-04-18 21:50:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482567151849472[0;39m 生成今日电子书快照开始
2022-04-18 21:50:30.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482567151849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482567151849472[0;39m ==> Parameters: 
2022-04-18 21:50:30.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482567151849472[0;39m <==    Updates: 0
2022-04-18 21:50:30.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482567151849472[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 21:50:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482588135952384[0;39m 生成今日电子书快照开始
2022-04-18 21:50:35.184 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482588135952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:35.184 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482588135952384[0;39m ==> Parameters: 
2022-04-18 21:50:35.230 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482588135952384[0;39m <==    Updates: 0
2022-04-18 21:50:35.230 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482588135952384[0;39m 生成今日电子书快照结束，耗时：226毫秒
2022-04-18 21:50:35.231 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482589088059392[0;39m start updating Ebook doc
2022-04-18 21:50:35.231 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482589088059392[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:50:35.231 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482589088059392[0;39m ==> Parameters: 
2022-04-18 21:50:35.263 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482589088059392[0;39m <==    Updates: 1
2022-04-18 21:50:35.263 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482589088059392[0;39m update ends, take 32 millisecs
2022-04-18 21:50:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482609103278080[0;39m 生成今日电子书快照开始
2022-04-18 21:50:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482609103278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482609103278080[0;39m ==> Parameters: 
2022-04-18 21:50:40.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482609103278080[0;39m <==    Updates: 0
2022-04-18 21:50:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482609103278080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:50:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482630078992384[0;39m 生成今日电子书快照开始
2022-04-18 21:50:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482630078992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482630078992384[0;39m ==> Parameters: 
2022-04-18 21:50:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482630078992384[0;39m <==    Updates: 0
2022-04-18 21:50:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482630078992384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:50:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482651054706688[0;39m 生成今日电子书快照开始
2022-04-18 21:50:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482651054706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482651054706688[0;39m ==> Parameters: 
2022-04-18 21:50:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482651054706688[0;39m <==    Updates: 0
2022-04-18 21:50:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482651054706688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:50:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482672017838080[0;39m 生成今日电子书快照开始
2022-04-18 21:50:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482672017838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:50:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482672017838080[0;39m ==> Parameters: 
2022-04-18 21:50:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482672017838080[0;39m <==    Updates: 0
2022-04-18 21:50:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482672017838080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:51:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482692980969472[0;39m 生成今日电子书快照开始
2022-04-18 21:51:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482692980969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482692980969472[0;39m ==> Parameters: 
2022-04-18 21:51:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482692980969472[0;39m <==    Updates: 0
2022-04-18 21:51:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482692980969472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:51:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482713969266688[0;39m 生成今日电子书快照开始
2022-04-18 21:51:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482713969266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482713969266688[0;39m ==> Parameters: 
2022-04-18 21:51:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482713969266688[0;39m <==    Updates: 0
2022-04-18 21:51:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482713969266688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:51:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482714225119232[0;39m start updating Ebook doc
2022-04-18 21:51:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482714225119232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:51:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482714225119232[0;39m ==> Parameters: 
2022-04-18 21:51:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482714225119232[0;39m <==    Updates: 1
2022-04-18 21:51:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482714225119232[0;39m update ends, take 41 millisecs
2022-04-18 21:51:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482734936592384[0;39m 生成今日电子书快照开始
2022-04-18 21:51:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482734936592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482734936592384[0;39m ==> Parameters: 
2022-04-18 21:51:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482734936592384[0;39m <==    Updates: 0
2022-04-18 21:51:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482734936592384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:51:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482755908112384[0;39m 生成今日电子书快照开始
2022-04-18 21:51:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482755908112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482755908112384[0;39m ==> Parameters: 
2022-04-18 21:51:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482755908112384[0;39m <==    Updates: 0
2022-04-18 21:51:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482755908112384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:51:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482776879632384[0;39m 生成今日电子书快照开始
2022-04-18 21:51:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482776879632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482776879632384[0;39m ==> Parameters: 
2022-04-18 21:51:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482776879632384[0;39m <==    Updates: 0
2022-04-18 21:51:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482776879632384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:51:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482797842763776[0;39m 生成今日电子书快照开始
2022-04-18 21:51:25.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482797842763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:25.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482797842763776[0;39m ==> Parameters: 
2022-04-18 21:51:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482797842763776[0;39m <==    Updates: 0
2022-04-18 21:51:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482797842763776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:51:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482818814283776[0;39m 生成今日电子书快照开始
2022-04-18 21:51:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482818814283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482818814283776[0;39m ==> Parameters: 
2022-04-18 21:51:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482818814283776[0;39m <==    Updates: 0
2022-04-18 21:51:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482818814283776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:51:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482839802580992[0;39m start updating Ebook doc
2022-04-18 21:51:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482839802580992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:51:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482839802580992[0;39m ==> Parameters: 
2022-04-18 21:51:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482839802580992[0;39m <==    Updates: 1
2022-04-18 21:51:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482839802580992[0;39m update ends, take 61 millisecs
2022-04-18 21:51:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482840058433536[0;39m 生成今日电子书快照开始
2022-04-18 21:51:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482840058433536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482840058433536[0;39m ==> Parameters: 
2022-04-18 21:51:35.121 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482840058433536[0;39m <==    Updates: 0
2022-04-18 21:51:35.121 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482840058433536[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:51:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482860765712384[0;39m 生成今日电子书快照开始
2022-04-18 21:51:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482860765712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482860765712384[0;39m ==> Parameters: 
2022-04-18 21:51:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482860765712384[0;39m <==    Updates: 0
2022-04-18 21:51:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482860765712384[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 21:51:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482881737232384[0;39m 生成今日电子书快照开始
2022-04-18 21:51:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482881737232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482881737232384[0;39m ==> Parameters: 
2022-04-18 21:51:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482881737232384[0;39m <==    Updates: 0
2022-04-18 21:51:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482881737232384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:51:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482902712946688[0;39m 生成今日电子书快照开始
2022-04-18 21:51:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482902712946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482902712946688[0;39m ==> Parameters: 
2022-04-18 21:51:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482902712946688[0;39m <==    Updates: 0
2022-04-18 21:51:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482902712946688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:51:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482923671883776[0;39m 生成今日电子书快照开始
2022-04-18 21:51:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482923671883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:51:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482923671883776[0;39m ==> Parameters: 
2022-04-18 21:51:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482923671883776[0;39m <==    Updates: 0
2022-04-18 21:51:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482923671883776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:52:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482944639209472[0;39m 生成今日电子书快照开始
2022-04-18 21:52:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482944639209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482944639209472[0;39m ==> Parameters: 
2022-04-18 21:52:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482944639209472[0;39m <==    Updates: 0
2022-04-18 21:52:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482944639209472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:52:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482965619118080[0;39m 生成今日电子书快照开始
2022-04-18 21:52:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482965619118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482965619118080[0;39m ==> Parameters: 
2022-04-18 21:52:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482965619118080[0;39m <==    Updates: 0
2022-04-18 21:52:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482965619118080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:52:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171482965874970624[0;39m start updating Ebook doc
2022-04-18 21:52:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482965874970624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:52:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482965874970624[0;39m ==> Parameters: 
2022-04-18 21:52:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171482965874970624[0;39m <==    Updates: 1
2022-04-18 21:52:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171482965874970624[0;39m update ends, take 38 millisecs
2022-04-18 21:52:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171482986586443776[0;39m 生成今日电子书快照开始
2022-04-18 21:52:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482986586443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482986586443776[0;39m ==> Parameters: 
2022-04-18 21:52:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171482986586443776[0;39m <==    Updates: 0
2022-04-18 21:52:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171482986586443776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:52:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483007570546688[0;39m 生成今日电子书快照开始
2022-04-18 21:52:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483007570546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483007570546688[0;39m ==> Parameters: 
2022-04-18 21:52:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483007570546688[0;39m <==    Updates: 0
2022-04-18 21:52:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483007570546688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:52:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483028521095168[0;39m 生成今日电子书快照开始
2022-04-18 21:52:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483028521095168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483028521095168[0;39m ==> Parameters: 
2022-04-18 21:52:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483028521095168[0;39m <==    Updates: 0
2022-04-18 21:52:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483028521095168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:52:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483049513586688[0;39m 生成今日电子书快照开始
2022-04-18 21:52:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483049513586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483049513586688[0;39m ==> Parameters: 
2022-04-18 21:52:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483049513586688[0;39m <==    Updates: 0
2022-04-18 21:52:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483049513586688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:52:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483070472523776[0;39m 生成今日电子书快照开始
2022-04-18 21:52:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483070472523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483070472523776[0;39m ==> Parameters: 
2022-04-18 21:52:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483070472523776[0;39m <==    Updates: 0
2022-04-18 21:52:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483070472523776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:52:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483091448238080[0;39m 生成今日电子书快照开始
2022-04-18 21:52:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483091448238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483091448238080[0;39m ==> Parameters: 
2022-04-18 21:52:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483091448238080[0;39m <==    Updates: 0
2022-04-18 21:52:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483091448238080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:52:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483091695702016[0;39m start updating Ebook doc
2022-04-18 21:52:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483091695702016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:52:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483091695702016[0;39m ==> Parameters: 
2022-04-18 21:52:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483091695702016[0;39m <==    Updates: 1
2022-04-18 21:52:35.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483091695702016[0;39m update ends, take 37 millisecs
2022-04-18 21:52:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483112423952384[0;39m 生成今日电子书快照开始
2022-04-18 21:52:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483112423952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483112423952384[0;39m ==> Parameters: 
2022-04-18 21:52:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483112423952384[0;39m <==    Updates: 0
2022-04-18 21:52:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483112423952384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:52:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483133399666688[0;39m 生成今日电子书快照开始
2022-04-18 21:52:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483133399666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483133399666688[0;39m ==> Parameters: 
2022-04-18 21:52:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483133399666688[0;39m <==    Updates: 0
2022-04-18 21:52:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483133399666688[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:52:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483154362798080[0;39m 生成今日电子书快照开始
2022-04-18 21:52:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483154362798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483154362798080[0;39m ==> Parameters: 
2022-04-18 21:52:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483154362798080[0;39m <==    Updates: 0
2022-04-18 21:52:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483154362798080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:52:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483175330123776[0;39m 生成今日电子书快照开始
2022-04-18 21:52:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483175330123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:52:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483175330123776[0;39m ==> Parameters: 
2022-04-18 21:52:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483175330123776[0;39m <==    Updates: 0
2022-04-18 21:52:55.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483175330123776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:53:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483196297449472[0;39m 生成今日电子书快照开始
2022-04-18 21:53:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483196297449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483196297449472[0;39m ==> Parameters: 
2022-04-18 21:53:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483196297449472[0;39m <==    Updates: 0
2022-04-18 21:53:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483196297449472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:53:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483217277358080[0;39m 生成今日电子书快照开始
2022-04-18 21:53:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483217277358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483217277358080[0;39m ==> Parameters: 
2022-04-18 21:53:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483217277358080[0;39m <==    Updates: 0
2022-04-18 21:53:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483217277358080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:53:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483217562570752[0;39m start updating Ebook doc
2022-04-18 21:53:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483217562570752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:53:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483217562570752[0;39m ==> Parameters: 
2022-04-18 21:53:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483217562570752[0;39m <==    Updates: 1
2022-04-18 21:53:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483217562570752[0;39m update ends, take 41 millisecs
2022-04-18 21:53:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483238257266688[0;39m 生成今日电子书快照开始
2022-04-18 21:53:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483238257266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483238257266688[0;39m ==> Parameters: 
2022-04-18 21:53:10.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483238257266688[0;39m <==    Updates: 0
2022-04-18 21:53:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483238257266688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:53:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483259220398080[0;39m 生成今日电子书快照开始
2022-04-18 21:53:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483259220398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483259220398080[0;39m ==> Parameters: 
2022-04-18 21:53:15.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483259220398080[0;39m <==    Updates: 0
2022-04-18 21:53:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483259220398080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:53:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483280196112384[0;39m 生成今日电子书快照开始
2022-04-18 21:53:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483280196112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483280196112384[0;39m ==> Parameters: 
2022-04-18 21:53:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483280196112384[0;39m <==    Updates: 0
2022-04-18 21:53:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483280196112384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:53:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483301171826688[0;39m 生成今日电子书快照开始
2022-04-18 21:53:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483301171826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483301171826688[0;39m ==> Parameters: 
2022-04-18 21:53:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483301171826688[0;39m <==    Updates: 0
2022-04-18 21:53:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483301171826688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:53:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483322126569472[0;39m 生成今日电子书快照开始
2022-04-18 21:53:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483322126569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483322126569472[0;39m ==> Parameters: 
2022-04-18 21:53:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483322126569472[0;39m <==    Updates: 0
2022-04-18 21:53:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483322126569472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:53:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483343106478080[0;39m 生成今日电子书快照开始
2022-04-18 21:53:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483343106478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483343106478080[0;39m ==> Parameters: 
2022-04-18 21:53:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483343106478080[0;39m <==    Updates: 0
2022-04-18 21:53:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483343106478080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:53:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483343341359104[0;39m start updating Ebook doc
2022-04-18 21:53:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483343341359104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:53:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483343341359104[0;39m ==> Parameters: 
2022-04-18 21:53:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483343341359104[0;39m <==    Updates: 1
2022-04-18 21:53:35.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483343341359104[0;39m update ends, take 40 millisecs
2022-04-18 21:53:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483364086386688[0;39m 生成今日电子书快照开始
2022-04-18 21:53:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483364086386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483364086386688[0;39m ==> Parameters: 
2022-04-18 21:53:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483364086386688[0;39m <==    Updates: 0
2022-04-18 21:53:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483364086386688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:53:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483385057906688[0;39m 生成今日电子书快照开始
2022-04-18 21:53:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483385057906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483385057906688[0;39m ==> Parameters: 
2022-04-18 21:53:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483385057906688[0;39m <==    Updates: 0
2022-04-18 21:53:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483385057906688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:53:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483406008455168[0;39m 生成今日电子书快照开始
2022-04-18 21:53:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483406008455168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483406008455168[0;39m ==> Parameters: 
2022-04-18 21:53:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483406008455168[0;39m <==    Updates: 0
2022-04-18 21:53:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483406008455168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:53:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483426988363776[0;39m 生成今日电子书快照开始
2022-04-18 21:53:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483426988363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:53:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483426988363776[0;39m ==> Parameters: 
2022-04-18 21:53:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483426988363776[0;39m <==    Updates: 0
2022-04-18 21:53:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483426988363776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:54:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483447951495168[0;39m 生成今日电子书快照开始
2022-04-18 21:54:00.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483447951495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483447951495168[0;39m ==> Parameters: 
2022-04-18 21:54:00.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483447951495168[0;39m <==    Updates: 0
2022-04-18 21:54:00.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483447951495168[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 21:54:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483468935598080[0;39m 生成今日电子书快照开始
2022-04-18 21:54:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483468935598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483468935598080[0;39m ==> Parameters: 
2022-04-18 21:54:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483468935598080[0;39m <==    Updates: 0
2022-04-18 21:54:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483468935598080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:54:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483469191450624[0;39m start updating Ebook doc
2022-04-18 21:54:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483469191450624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:54:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483469191450624[0;39m ==> Parameters: 
2022-04-18 21:54:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483469191450624[0;39m <==    Updates: 1
2022-04-18 21:54:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483469191450624[0;39m update ends, take 42 millisecs
2022-04-18 21:54:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483489911312384[0;39m 生成今日电子书快照开始
2022-04-18 21:54:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483489911312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483489911312384[0;39m ==> Parameters: 
2022-04-18 21:54:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483489911312384[0;39m <==    Updates: 0
2022-04-18 21:54:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483489911312384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:54:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483510874443776[0;39m 生成今日电子书快照开始
2022-04-18 21:54:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483510874443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483510874443776[0;39m ==> Parameters: 
2022-04-18 21:54:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483510874443776[0;39m <==    Updates: 0
2022-04-18 21:54:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483510874443776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:54:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483531854352384[0;39m 生成今日电子书快照开始
2022-04-18 21:54:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483531854352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483531854352384[0;39m ==> Parameters: 
2022-04-18 21:54:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483531854352384[0;39m <==    Updates: 0
2022-04-18 21:54:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483531854352384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:54:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483552830066688[0;39m 生成今日电子书快照开始
2022-04-18 21:54:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483552830066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483552830066688[0;39m ==> Parameters: 
2022-04-18 21:54:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483552830066688[0;39m <==    Updates: 0
2022-04-18 21:54:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483552830066688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:54:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483573780615168[0;39m 生成今日电子书快照开始
2022-04-18 21:54:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483573780615168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483573780615168[0;39m ==> Parameters: 
2022-04-18 21:54:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483573780615168[0;39m <==    Updates: 0
2022-04-18 21:54:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483573780615168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 21:54:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483594764718080[0;39m 生成今日电子书快照开始
2022-04-18 21:54:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483594764718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483594764718080[0;39m ==> Parameters: 
2022-04-18 21:54:35.267 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483594764718080[0;39m <==    Updates: 0
2022-04-18 21:54:35.267 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483594764718080[0;39m 生成今日电子书快照结束，耗时：264毫秒
2022-04-18 21:54:35.267 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483595872014336[0;39m start updating Ebook doc
2022-04-18 21:54:35.267 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483595872014336[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:54:35.268 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483595872014336[0;39m ==> Parameters: 
2022-04-18 21:54:35.305 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483595872014336[0;39m <==    Updates: 1
2022-04-18 21:54:35.305 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483595872014336[0;39m update ends, take 38 millisecs
2022-04-18 21:54:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483615744626688[0;39m 生成今日电子书快照开始
2022-04-18 21:54:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483615744626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483615744626688[0;39m ==> Parameters: 
2022-04-18 21:54:40.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483615744626688[0;39m <==    Updates: 0
2022-04-18 21:54:40.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483615744626688[0;39m 生成今日电子书快照结束，耗时：106毫秒
2022-04-18 21:54:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483636711952384[0;39m 生成今日电子书快照开始
2022-04-18 21:54:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483636711952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483636711952384[0;39m ==> Parameters: 
2022-04-18 21:54:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483636711952384[0;39m <==    Updates: 0
2022-04-18 21:54:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483636711952384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 21:54:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483657687666688[0;39m 生成今日电子书快照开始
2022-04-18 21:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483657687666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483657687666688[0;39m ==> Parameters: 
2022-04-18 21:54:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483657687666688[0;39m <==    Updates: 0
2022-04-18 21:54:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483657687666688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:54:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483678659186688[0;39m 生成今日电子书快照开始
2022-04-18 21:54:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483678659186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:54:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483678659186688[0;39m ==> Parameters: 
2022-04-18 21:54:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483678659186688[0;39m <==    Updates: 0
2022-04-18 21:54:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483678659186688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:55:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483699609735168[0;39m 生成今日电子书快照开始
2022-04-18 21:55:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483699609735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483699609735168[0;39m ==> Parameters: 
2022-04-18 21:55:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483699609735168[0;39m <==    Updates: 0
2022-04-18 21:55:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483699609735168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:55:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483720598032384[0;39m start updating Ebook doc
2022-04-18 21:55:05.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483720598032384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:55:05.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483720598032384[0;39m ==> Parameters: 
2022-04-18 21:55:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483720598032384[0;39m <==    Updates: 1
2022-04-18 21:55:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483720598032384[0;39m update ends, take 60 millisecs
2022-04-18 21:55:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483720849690624[0;39m 生成今日电子书快照开始
2022-04-18 21:55:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483720849690624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483720849690624[0;39m ==> Parameters: 
2022-04-18 21:55:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483720849690624[0;39m <==    Updates: 0
2022-04-18 21:55:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483720849690624[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 21:55:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483741552775168[0;39m 生成今日电子书快照开始
2022-04-18 21:55:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483741552775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483741552775168[0;39m ==> Parameters: 
2022-04-18 21:55:10.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483741552775168[0;39m <==    Updates: 0
2022-04-18 21:55:10.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483741552775168[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-18 21:55:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483762545266688[0;39m 生成今日电子书快照开始
2022-04-18 21:55:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483762545266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483762545266688[0;39m ==> Parameters: 
2022-04-18 21:55:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483762545266688[0;39m <==    Updates: 0
2022-04-18 21:55:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483762545266688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:55:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483783504203776[0;39m 生成今日电子书快照开始
2022-04-18 21:55:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483783504203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483783504203776[0;39m ==> Parameters: 
2022-04-18 21:55:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483783504203776[0;39m <==    Updates: 0
2022-04-18 21:55:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483783504203776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:55:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483804467335168[0;39m 生成今日电子书快照开始
2022-04-18 21:55:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483804467335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483804467335168[0;39m ==> Parameters: 
2022-04-18 21:55:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483804467335168[0;39m <==    Updates: 0
2022-04-18 21:55:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483804467335168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:55:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483825459826688[0;39m 生成今日电子书快照开始
2022-04-18 21:55:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483825459826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483825459826688[0;39m ==> Parameters: 
2022-04-18 21:55:30.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483825459826688[0;39m <==    Updates: 0
2022-04-18 21:55:30.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483825459826688[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 21:55:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483846414569472[0;39m 生成今日电子书快照开始
2022-04-18 21:55:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483846414569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483846414569472[0;39m ==> Parameters: 
2022-04-18 21:55:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483846414569472[0;39m <==    Updates: 0
2022-04-18 21:55:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483846414569472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:55:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483846687199232[0;39m start updating Ebook doc
2022-04-18 21:55:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483846687199232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:55:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483846687199232[0;39m ==> Parameters: 
2022-04-18 21:55:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483846687199232[0;39m <==    Updates: 1
2022-04-18 21:55:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483846687199232[0;39m update ends, take 40 millisecs
2022-04-18 21:55:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483867398672384[0;39m 生成今日电子书快照开始
2022-04-18 21:55:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483867398672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483867398672384[0;39m ==> Parameters: 
2022-04-18 21:55:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483867398672384[0;39m <==    Updates: 0
2022-04-18 21:55:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483867398672384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:55:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483888374386688[0;39m 生成今日电子书快照开始
2022-04-18 21:55:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483888374386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483888374386688[0;39m ==> Parameters: 
2022-04-18 21:55:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483888374386688[0;39m <==    Updates: 0
2022-04-18 21:55:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483888374386688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:55:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483909333323776[0;39m 生成今日电子书快照开始
2022-04-18 21:55:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483909333323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483909333323776[0;39m ==> Parameters: 
2022-04-18 21:55:50.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483909333323776[0;39m <==    Updates: 0
2022-04-18 21:55:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483909333323776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:55:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483930309038080[0;39m 生成今日电子书快照开始
2022-04-18 21:55:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483930309038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:55:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483930309038080[0;39m ==> Parameters: 
2022-04-18 21:55:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483930309038080[0;39m <==    Updates: 0
2022-04-18 21:55:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483930309038080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:56:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483951284752384[0;39m 生成今日电子书快照开始
2022-04-18 21:56:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483951284752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483951284752384[0;39m ==> Parameters: 
2022-04-18 21:56:00.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483951284752384[0;39m <==    Updates: 0
2022-04-18 21:56:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483951284752384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:56:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171483972243689472[0;39m start updating Ebook doc
2022-04-18 21:56:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483972243689472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:56:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483972243689472[0;39m ==> Parameters: 
2022-04-18 21:56:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171483972243689472[0;39m <==    Updates: 1
2022-04-18 21:56:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171483972243689472[0;39m update ends, take 73 millisecs
2022-04-18 21:56:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483972554067968[0;39m 生成今日电子书快照开始
2022-04-18 21:56:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483972554067968[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483972554067968[0;39m ==> Parameters: 
2022-04-18 21:56:05.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483972554067968[0;39m <==    Updates: 0
2022-04-18 21:56:05.114 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483972554067968[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 21:56:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171483993223598080[0;39m 生成今日电子书快照开始
2022-04-18 21:56:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483993223598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483993223598080[0;39m ==> Parameters: 
2022-04-18 21:56:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171483993223598080[0;39m <==    Updates: 0
2022-04-18 21:56:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171483993223598080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:56:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484014203506688[0;39m 生成今日电子书快照开始
2022-04-18 21:56:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484014203506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484014203506688[0;39m ==> Parameters: 
2022-04-18 21:56:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484014203506688[0;39m <==    Updates: 0
2022-04-18 21:56:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484014203506688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:56:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484035158249472[0;39m 生成今日电子书快照开始
2022-04-18 21:56:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484035158249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484035158249472[0;39m ==> Parameters: 
2022-04-18 21:56:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484035158249472[0;39m <==    Updates: 0
2022-04-18 21:56:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484035158249472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:56:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484056138158080[0;39m 生成今日电子书快照开始
2022-04-18 21:56:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484056138158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484056138158080[0;39m ==> Parameters: 
2022-04-18 21:56:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484056138158080[0;39m <==    Updates: 0
2022-04-18 21:56:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484056138158080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:56:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484077113872384[0;39m 生成今日电子书快照开始
2022-04-18 21:56:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484077113872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484077113872384[0;39m ==> Parameters: 
2022-04-18 21:56:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484077113872384[0;39m <==    Updates: 0
2022-04-18 21:56:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484077113872384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 21:56:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484098072809472[0;39m 生成今日电子书快照开始
2022-04-18 21:56:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484098072809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484098072809472[0;39m ==> Parameters: 
2022-04-18 21:56:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484098072809472[0;39m <==    Updates: 0
2022-04-18 21:56:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484098072809472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:56:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484098349633536[0;39m start updating Ebook doc
2022-04-18 21:56:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484098349633536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:56:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484098349633536[0;39m ==> Parameters: 
2022-04-18 21:56:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484098349633536[0;39m <==    Updates: 1
2022-04-18 21:56:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484098349633536[0;39m update ends, take 39 millisecs
2022-04-18 21:56:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484119056912384[0;39m 生成今日电子书快照开始
2022-04-18 21:56:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484119056912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484119056912384[0;39m ==> Parameters: 
2022-04-18 21:56:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484119056912384[0;39m <==    Updates: 0
2022-04-18 21:56:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484119056912384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:56:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484140032626688[0;39m 生成今日电子书快照开始
2022-04-18 21:56:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484140032626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484140032626688[0;39m ==> Parameters: 
2022-04-18 21:56:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484140032626688[0;39m <==    Updates: 0
2022-04-18 21:56:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484140032626688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:56:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484160999952384[0;39m 生成今日电子书快照开始
2022-04-18 21:56:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484160999952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484160999952384[0;39m ==> Parameters: 
2022-04-18 21:56:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484160999952384[0;39m <==    Updates: 0
2022-04-18 21:56:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484160999952384[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 21:56:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484181958889472[0;39m 生成今日电子书快照开始
2022-04-18 21:56:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484181958889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:56:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484181958889472[0;39m ==> Parameters: 
2022-04-18 21:56:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484181958889472[0;39m <==    Updates: 0
2022-04-18 21:56:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484181958889472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:57:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484202930409472[0;39m 生成今日电子书快照开始
2022-04-18 21:57:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484202930409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484202930409472[0;39m ==> Parameters: 
2022-04-18 21:57:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484202930409472[0;39m <==    Updates: 0
2022-04-18 21:57:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484202930409472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:57:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484223918706688[0;39m start updating Ebook doc
2022-04-18 21:57:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484223918706688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:57:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484223918706688[0;39m ==> Parameters: 
2022-04-18 21:57:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484223918706688[0;39m <==    Updates: 1
2022-04-18 21:57:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484223918706688[0;39m update ends, take 66 millisecs
2022-04-18 21:57:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484224199725056[0;39m 生成今日电子书快照开始
2022-04-18 21:57:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484224199725056[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484224199725056[0;39m ==> Parameters: 
2022-04-18 21:57:05.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484224199725056[0;39m <==    Updates: 0
2022-04-18 21:57:05.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484224199725056[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-18 21:57:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484244881838080[0;39m 生成今日电子书快照开始
2022-04-18 21:57:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484244881838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484244881838080[0;39m ==> Parameters: 
2022-04-18 21:57:10.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484244881838080[0;39m <==    Updates: 0
2022-04-18 21:57:10.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484244881838080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:57:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484265849163776[0;39m 生成今日电子书快照开始
2022-04-18 21:57:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484265849163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484265849163776[0;39m ==> Parameters: 
2022-04-18 21:57:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484265849163776[0;39m <==    Updates: 0
2022-04-18 21:57:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484265849163776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:57:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484286824878080[0;39m 生成今日电子书快照开始
2022-04-18 21:57:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484286824878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484286824878080[0;39m ==> Parameters: 
2022-04-18 21:57:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484286824878080[0;39m <==    Updates: 0
2022-04-18 21:57:20.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484286824878080[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 21:57:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484307800592384[0;39m 生成今日电子书快照开始
2022-04-18 21:57:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484307800592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484307800592384[0;39m ==> Parameters: 
2022-04-18 21:57:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484307800592384[0;39m <==    Updates: 0
2022-04-18 21:57:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484307800592384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:57:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484328776306688[0;39m 生成今日电子书快照开始
2022-04-18 21:57:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484328776306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484328776306688[0;39m ==> Parameters: 
2022-04-18 21:57:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484328776306688[0;39m <==    Updates: 0
2022-04-18 21:57:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484328776306688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 21:57:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484349735243776[0;39m start updating Ebook doc
2022-04-18 21:57:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484349735243776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:57:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484349735243776[0;39m ==> Parameters: 
2022-04-18 21:57:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484349735243776[0;39m <==    Updates: 1
2022-04-18 21:57:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484349735243776[0;39m update ends, take 63 millisecs
2022-04-18 21:57:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484349999484928[0;39m 生成今日电子书快照开始
2022-04-18 21:57:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484349999484928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484349999484928[0;39m ==> Parameters: 
2022-04-18 21:57:35.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484349999484928[0;39m <==    Updates: 0
2022-04-18 21:57:35.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484349999484928[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 21:57:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484370715152384[0;39m 生成今日电子书快照开始
2022-04-18 21:57:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484370715152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484370715152384[0;39m ==> Parameters: 
2022-04-18 21:57:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484370715152384[0;39m <==    Updates: 0
2022-04-18 21:57:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484370715152384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 21:57:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484391682478080[0;39m 生成今日电子书快照开始
2022-04-18 21:57:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484391682478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484391682478080[0;39m ==> Parameters: 
2022-04-18 21:57:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484391682478080[0;39m <==    Updates: 0
2022-04-18 21:57:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484391682478080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:57:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484412649803776[0;39m 生成今日电子书快照开始
2022-04-18 21:57:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484412649803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484412649803776[0;39m ==> Parameters: 
2022-04-18 21:57:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484412649803776[0;39m <==    Updates: 0
2022-04-18 21:57:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484412649803776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 21:57:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484433612935168[0;39m 生成今日电子书快照开始
2022-04-18 21:57:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484433612935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:57:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484433612935168[0;39m ==> Parameters: 
2022-04-18 21:57:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484433612935168[0;39m <==    Updates: 0
2022-04-18 21:57:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484433612935168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:58:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484454588649472[0;39m 生成今日电子书快照开始
2022-04-18 21:58:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484454588649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484454588649472[0;39m ==> Parameters: 
2022-04-18 21:58:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484454588649472[0;39m <==    Updates: 0
2022-04-18 21:58:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484454588649472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 21:58:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484475560169472[0;39m start updating Ebook doc
2022-04-18 21:58:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484475560169472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:58:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484475560169472[0;39m ==> Parameters: 
2022-04-18 21:58:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484475560169472[0;39m <==    Updates: 1
2022-04-18 21:58:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484475560169472[0;39m update ends, take 53 millisecs
2022-04-18 21:58:05.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484475786661888[0;39m 生成今日电子书快照开始
2022-04-18 21:58:05.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484475786661888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484475786661888[0;39m ==> Parameters: 
2022-04-18 21:58:05.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484475786661888[0;39m <==    Updates: 0
2022-04-18 21:58:05.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484475786661888[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 21:58:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484496531689472[0;39m 生成今日电子书快照开始
2022-04-18 21:58:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484496531689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484496531689472[0;39m ==> Parameters: 
2022-04-18 21:58:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484496531689472[0;39m <==    Updates: 0
2022-04-18 21:58:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484496531689472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 21:58:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484517511598080[0;39m 生成今日电子书快照开始
2022-04-18 21:58:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484517511598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484517511598080[0;39m ==> Parameters: 
2022-04-18 21:58:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484517511598080[0;39m <==    Updates: 0
2022-04-18 21:58:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484517511598080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:58:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484538491506688[0;39m 生成今日电子书快照开始
2022-04-18 21:58:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484538491506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484538491506688[0;39m ==> Parameters: 
2022-04-18 21:58:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484538491506688[0;39m <==    Updates: 0
2022-04-18 21:58:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484538491506688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:58:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484559450443776[0;39m 生成今日电子书快照开始
2022-04-18 21:58:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484559450443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484559450443776[0;39m ==> Parameters: 
2022-04-18 21:58:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484559450443776[0;39m <==    Updates: 0
2022-04-18 21:58:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484559450443776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:58:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484580426158080[0;39m 生成今日电子书快照开始
2022-04-18 21:58:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484580426158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484580426158080[0;39m ==> Parameters: 
2022-04-18 21:58:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484580426158080[0;39m <==    Updates: 0
2022-04-18 21:58:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484580426158080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:58:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484601389289472[0;39m 生成今日电子书快照开始
2022-04-18 21:58:35.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484601389289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:35.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484601389289472[0;39m ==> Parameters: 
2022-04-18 21:58:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484601389289472[0;39m <==    Updates: 0
2022-04-18 21:58:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484601389289472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 21:58:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484601615781888[0;39m start updating Ebook doc
2022-04-18 21:58:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484601615781888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:58:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484601615781888[0;39m ==> Parameters: 
2022-04-18 21:58:35.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484601615781888[0;39m <==    Updates: 1
2022-04-18 21:58:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484601615781888[0;39m update ends, take 43 millisecs
2022-04-18 21:58:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484622369198080[0;39m 生成今日电子书快照开始
2022-04-18 21:58:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484622369198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484622369198080[0;39m ==> Parameters: 
2022-04-18 21:58:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484622369198080[0;39m <==    Updates: 0
2022-04-18 21:58:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484622369198080[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 21:58:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484643332329472[0;39m 生成今日电子书快照开始
2022-04-18 21:58:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484643332329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484643332329472[0;39m ==> Parameters: 
2022-04-18 21:58:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484643332329472[0;39m <==    Updates: 0
2022-04-18 21:58:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484643332329472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:58:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484664320626688[0;39m 生成今日电子书快照开始
2022-04-18 21:58:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484664320626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484664320626688[0;39m ==> Parameters: 
2022-04-18 21:58:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484664320626688[0;39m <==    Updates: 0
2022-04-18 21:58:50.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484664320626688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 21:58:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484685275369472[0;39m 生成今日电子书快照开始
2022-04-18 21:58:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484685275369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:58:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484685275369472[0;39m ==> Parameters: 
2022-04-18 21:58:55.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484685275369472[0;39m <==    Updates: 0
2022-04-18 21:58:55.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484685275369472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 21:59:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484706251083776[0;39m 生成今日电子书快照开始
2022-04-18 21:59:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484706251083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484706251083776[0;39m ==> Parameters: 
2022-04-18 21:59:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484706251083776[0;39m <==    Updates: 0
2022-04-18 21:59:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484706251083776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 21:59:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484727222603776[0;39m 生成今日电子书快照开始
2022-04-18 21:59:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484727222603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484727222603776[0;39m ==> Parameters: 
2022-04-18 21:59:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484727222603776[0;39m <==    Updates: 0
2022-04-18 21:59:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484727222603776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:59:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484727528787968[0;39m start updating Ebook doc
2022-04-18 21:59:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484727528787968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:59:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484727528787968[0;39m ==> Parameters: 
2022-04-18 21:59:05.123 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484727528787968[0;39m <==    Updates: 1
2022-04-18 21:59:05.123 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484727528787968[0;39m update ends, take 48 millisecs
2022-04-18 21:59:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484748206706688[0;39m 生成今日电子书快照开始
2022-04-18 21:59:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484748206706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484748206706688[0;39m ==> Parameters: 
2022-04-18 21:59:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484748206706688[0;39m <==    Updates: 0
2022-04-18 21:59:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484748206706688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 21:59:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484769174032384[0;39m 生成今日电子书快照开始
2022-04-18 21:59:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484769174032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484769174032384[0;39m ==> Parameters: 
2022-04-18 21:59:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484769174032384[0;39m <==    Updates: 0
2022-04-18 21:59:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484769174032384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 21:59:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484790149746688[0;39m 生成今日电子书快照开始
2022-04-18 21:59:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484790149746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484790149746688[0;39m ==> Parameters: 
2022-04-18 21:59:20.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484790149746688[0;39m <==    Updates: 0
2022-04-18 21:59:20.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484790149746688[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:59:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484811104489472[0;39m 生成今日电子书快照开始
2022-04-18 21:59:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484811104489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484811104489472[0;39m ==> Parameters: 
2022-04-18 21:59:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484811104489472[0;39m <==    Updates: 0
2022-04-18 21:59:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484811104489472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 21:59:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484832092786688[0;39m 生成今日电子书快照开始
2022-04-18 21:59:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484832092786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484832092786688[0;39m ==> Parameters: 
2022-04-18 21:59:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484832092786688[0;39m <==    Updates: 0
2022-04-18 21:59:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484832092786688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 21:59:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484853060112384[0;39m 生成今日电子书快照开始
2022-04-18 21:59:35.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484853060112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:35.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484853060112384[0;39m ==> Parameters: 
2022-04-18 21:59:35.269 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484853060112384[0;39m <==    Updates: 0
2022-04-18 21:59:35.270 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484853060112384[0;39m 生成今日电子书快照结束，耗时：266毫秒
2022-04-18 21:59:35.270 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484854175797248[0;39m start updating Ebook doc
2022-04-18 21:59:35.270 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484854175797248[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 21:59:35.271 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484854175797248[0;39m ==> Parameters: 
2022-04-18 21:59:35.309 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484854175797248[0;39m <==    Updates: 1
2022-04-18 21:59:35.309 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484854175797248[0;39m update ends, take 39 millisecs
2022-04-18 21:59:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484874031632384[0;39m 生成今日电子书快照开始
2022-04-18 21:59:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484874031632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484874031632384[0;39m ==> Parameters: 
2022-04-18 21:59:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484874031632384[0;39m <==    Updates: 0
2022-04-18 21:59:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484874031632384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 21:59:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484894990569472[0;39m 生成今日电子书快照开始
2022-04-18 21:59:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484894990569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484894990569472[0;39m ==> Parameters: 
2022-04-18 21:59:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484894990569472[0;39m <==    Updates: 0
2022-04-18 21:59:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484894990569472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 21:59:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484915962089472[0;39m 生成今日电子书快照开始
2022-04-18 21:59:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484915962089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484915962089472[0;39m ==> Parameters: 
2022-04-18 21:59:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484915962089472[0;39m <==    Updates: 0
2022-04-18 21:59:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484915962089472[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 21:59:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484936946192384[0;39m 生成今日电子书快照开始
2022-04-18 21:59:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484936946192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 21:59:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484936946192384[0;39m ==> Parameters: 
2022-04-18 21:59:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484936946192384[0;39m <==    Updates: 0
2022-04-18 21:59:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484936946192384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:00:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484957921906688[0;39m 生成今日电子书快照开始
2022-04-18 22:00:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484957921906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484957921906688[0;39m ==> Parameters: 
2022-04-18 22:00:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484957921906688[0;39m <==    Updates: 0
2022-04-18 22:00:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484957921906688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:00:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484978889232384[0;39m 生成今日电子书快照开始
2022-04-18 22:00:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484978889232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484978889232384[0;39m ==> Parameters: 
2022-04-18 22:00:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484978889232384[0;39m <==    Updates: 0
2022-04-18 22:00:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484978889232384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:00:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171484979124113408[0;39m start updating Ebook doc
2022-04-18 22:00:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484979124113408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:00:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484979124113408[0;39m ==> Parameters: 
2022-04-18 22:00:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171484979124113408[0;39m <==    Updates: 1
2022-04-18 22:00:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171484979124113408[0;39m update ends, take 39 millisecs
2022-04-18 22:00:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171484999864946688[0;39m 生成今日电子书快照开始
2022-04-18 22:00:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484999864946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484999864946688[0;39m ==> Parameters: 
2022-04-18 22:00:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171484999864946688[0;39m <==    Updates: 0
2022-04-18 22:00:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171484999864946688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:00:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485020828078080[0;39m 生成今日电子书快照开始
2022-04-18 22:00:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485020828078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485020828078080[0;39m ==> Parameters: 
2022-04-18 22:00:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485020828078080[0;39m <==    Updates: 0
2022-04-18 22:00:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485020828078080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:00:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485041787015168[0;39m 生成今日电子书快照开始
2022-04-18 22:00:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485041787015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485041787015168[0;39m ==> Parameters: 
2022-04-18 22:00:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485041787015168[0;39m <==    Updates: 0
2022-04-18 22:00:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485041787015168[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 22:00:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485062779506688[0;39m 生成今日电子书快照开始
2022-04-18 22:00:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485062779506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485062779506688[0;39m ==> Parameters: 
2022-04-18 22:00:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485062779506688[0;39m <==    Updates: 0
2022-04-18 22:00:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485062779506688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:00:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485083751026688[0;39m 生成今日电子书快照开始
2022-04-18 22:00:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485083751026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485083751026688[0;39m ==> Parameters: 
2022-04-18 22:00:30.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485083751026688[0;39m <==    Updates: 0
2022-04-18 22:00:30.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485083751026688[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 22:00:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485104705769472[0;39m 生成今日电子书快照开始
2022-04-18 22:00:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485104705769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485104705769472[0;39m ==> Parameters: 
2022-04-18 22:00:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485104705769472[0;39m <==    Updates: 0
2022-04-18 22:00:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485104705769472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:00:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485104999370752[0;39m start updating Ebook doc
2022-04-18 22:00:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485104999370752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:00:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485104999370752[0;39m ==> Parameters: 
2022-04-18 22:00:35.111 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485104999370752[0;39m <==    Updates: 1
2022-04-18 22:00:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485104999370752[0;39m update ends, take 41 millisecs
2022-04-18 22:00:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485125685678080[0;39m 生成今日电子书快照开始
2022-04-18 22:00:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485125685678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485125685678080[0;39m ==> Parameters: 
2022-04-18 22:00:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485125685678080[0;39m <==    Updates: 0
2022-04-18 22:00:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485125685678080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:00:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485146648809472[0;39m 生成今日电子书快照开始
2022-04-18 22:00:45.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485146648809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:45.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485146648809472[0;39m ==> Parameters: 
2022-04-18 22:00:45.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485146648809472[0;39m <==    Updates: 0
2022-04-18 22:00:45.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485146648809472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:00:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485167637106688[0;39m 生成今日电子书快照开始
2022-04-18 22:00:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485167637106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485167637106688[0;39m ==> Parameters: 
2022-04-18 22:00:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485167637106688[0;39m <==    Updates: 0
2022-04-18 22:00:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485167637106688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:00:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485188604432384[0;39m 生成今日电子书快照开始
2022-04-18 22:00:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485188604432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:00:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485188604432384[0;39m ==> Parameters: 
2022-04-18 22:00:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485188604432384[0;39m <==    Updates: 0
2022-04-18 22:00:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485188604432384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:01:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485209567563776[0;39m 生成今日电子书快照开始
2022-04-18 22:01:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485209567563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485209567563776[0;39m ==> Parameters: 
2022-04-18 22:01:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485209567563776[0;39m <==    Updates: 0
2022-04-18 22:01:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485209567563776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:01:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485230539083776[0;39m 生成今日电子书快照开始
2022-04-18 22:01:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485230539083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485230539083776[0;39m ==> Parameters: 
2022-04-18 22:01:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485230539083776[0;39m <==    Updates: 0
2022-04-18 22:01:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485230539083776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:01:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485230790742016[0;39m start updating Ebook doc
2022-04-18 22:01:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485230790742016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:01:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485230790742016[0;39m ==> Parameters: 
2022-04-18 22:01:05.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485230790742016[0;39m <==    Updates: 1
2022-04-18 22:01:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485230790742016[0;39m update ends, take 41 millisecs
2022-04-18 22:01:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485251510603776[0;39m 生成今日电子书快照开始
2022-04-18 22:01:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485251510603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485251510603776[0;39m ==> Parameters: 
2022-04-18 22:01:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485251510603776[0;39m <==    Updates: 0
2022-04-18 22:01:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485251510603776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:01:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485272477929472[0;39m 生成今日电子书快照开始
2022-04-18 22:01:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485272477929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485272477929472[0;39m ==> Parameters: 
2022-04-18 22:01:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485272477929472[0;39m <==    Updates: 0
2022-04-18 22:01:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485272477929472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:01:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485293462032384[0;39m 生成今日电子书快照开始
2022-04-18 22:01:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485293462032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485293462032384[0;39m ==> Parameters: 
2022-04-18 22:01:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485293462032384[0;39m <==    Updates: 0
2022-04-18 22:01:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485293462032384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:01:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485314429358080[0;39m 生成今日电子书快照开始
2022-04-18 22:01:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485314429358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485314429358080[0;39m ==> Parameters: 
2022-04-18 22:01:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485314429358080[0;39m <==    Updates: 0
2022-04-18 22:01:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485314429358080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:01:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485335392489472[0;39m 生成今日电子书快照开始
2022-04-18 22:01:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485335392489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485335392489472[0;39m ==> Parameters: 
2022-04-18 22:01:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485335392489472[0;39m <==    Updates: 0
2022-04-18 22:01:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485335392489472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:01:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485356380786688[0;39m 生成今日电子书快照开始
2022-04-18 22:01:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485356380786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485356380786688[0;39m ==> Parameters: 
2022-04-18 22:01:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485356380786688[0;39m <==    Updates: 0
2022-04-18 22:01:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485356380786688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:01:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485356645027840[0;39m start updating Ebook doc
2022-04-18 22:01:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485356645027840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:01:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485356645027840[0;39m ==> Parameters: 
2022-04-18 22:01:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485356645027840[0;39m <==    Updates: 1
2022-04-18 22:01:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485356645027840[0;39m update ends, take 39 millisecs
2022-04-18 22:01:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485377339723776[0;39m 生成今日电子书快照开始
2022-04-18 22:01:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485377339723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485377339723776[0;39m ==> Parameters: 
2022-04-18 22:01:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485377339723776[0;39m <==    Updates: 0
2022-04-18 22:01:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485377339723776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:01:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485398323826688[0;39m 生成今日电子书快照开始
2022-04-18 22:01:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485398323826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485398323826688[0;39m ==> Parameters: 
2022-04-18 22:01:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485398323826688[0;39m <==    Updates: 0
2022-04-18 22:01:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485398323826688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:01:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485419282763776[0;39m 生成今日电子书快照开始
2022-04-18 22:01:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485419282763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485419282763776[0;39m ==> Parameters: 
2022-04-18 22:01:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485419282763776[0;39m <==    Updates: 0
2022-04-18 22:01:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485419282763776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:01:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485440254283776[0;39m 生成今日电子书快照开始
2022-04-18 22:01:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485440254283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:01:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485440254283776[0;39m ==> Parameters: 
2022-04-18 22:01:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485440254283776[0;39m <==    Updates: 0
2022-04-18 22:01:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485440254283776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:02:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485461221609472[0;39m 生成今日电子书快照开始
2022-04-18 22:02:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485461221609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485461221609472[0;39m ==> Parameters: 
2022-04-18 22:02:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485461221609472[0;39m <==    Updates: 0
2022-04-18 22:02:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485461221609472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:02:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485482201518080[0;39m start updating Ebook doc
2022-04-18 22:02:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485482201518080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:02:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485482201518080[0;39m ==> Parameters: 
2022-04-18 22:02:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485482201518080[0;39m <==    Updates: 1
2022-04-18 22:02:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485482201518080[0;39m update ends, take 60 millisecs
2022-04-18 22:02:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485482453176320[0;39m 生成今日电子书快照开始
2022-04-18 22:02:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485482453176320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485482453176320[0;39m ==> Parameters: 
2022-04-18 22:02:05.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485482453176320[0;39m <==    Updates: 0
2022-04-18 22:02:05.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485482453176320[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:02:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485503177232384[0;39m 生成今日电子书快照开始
2022-04-18 22:02:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485503177232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485503177232384[0;39m ==> Parameters: 
2022-04-18 22:02:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485503177232384[0;39m <==    Updates: 0
2022-04-18 22:02:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485503177232384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:02:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485524140363776[0;39m 生成今日电子书快照开始
2022-04-18 22:02:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485524140363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485524140363776[0;39m ==> Parameters: 
2022-04-18 22:02:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485524140363776[0;39m <==    Updates: 0
2022-04-18 22:02:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485524140363776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:02:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485545111883776[0;39m 生成今日电子书快照开始
2022-04-18 22:02:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485545111883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485545111883776[0;39m ==> Parameters: 
2022-04-18 22:02:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485545111883776[0;39m <==    Updates: 0
2022-04-18 22:02:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485545111883776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:02:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485566083403776[0;39m 生成今日电子书快照开始
2022-04-18 22:02:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485566083403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485566083403776[0;39m ==> Parameters: 
2022-04-18 22:02:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485566083403776[0;39m <==    Updates: 0
2022-04-18 22:02:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485566083403776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:02:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485587054923776[0;39m 生成今日电子书快照开始
2022-04-18 22:02:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485587054923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485587054923776[0;39m ==> Parameters: 
2022-04-18 22:02:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485587054923776[0;39m <==    Updates: 0
2022-04-18 22:02:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485587054923776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:02:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485608030638080[0;39m 生成今日电子书快照开始
2022-04-18 22:02:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485608030638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485608030638080[0;39m ==> Parameters: 
2022-04-18 22:02:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485608030638080[0;39m <==    Updates: 0
2022-04-18 22:02:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485608030638080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:02:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485608294879232[0;39m start updating Ebook doc
2022-04-18 22:02:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485608294879232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:02:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485608294879232[0;39m ==> Parameters: 
2022-04-18 22:02:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485608294879232[0;39m <==    Updates: 1
2022-04-18 22:02:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485608294879232[0;39m update ends, take 38 millisecs
2022-04-18 22:02:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485628997963776[0;39m 生成今日电子书快照开始
2022-04-18 22:02:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485628997963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485628997963776[0;39m ==> Parameters: 
2022-04-18 22:02:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485628997963776[0;39m <==    Updates: 0
2022-04-18 22:02:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485628997963776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:02:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485649973678080[0;39m 生成今日电子书快照开始
2022-04-18 22:02:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485649973678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485649973678080[0;39m ==> Parameters: 
2022-04-18 22:02:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485649973678080[0;39m <==    Updates: 0
2022-04-18 22:02:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485649973678080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:02:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485670932615168[0;39m 生成今日电子书快照开始
2022-04-18 22:02:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485670932615168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485670932615168[0;39m ==> Parameters: 
2022-04-18 22:02:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485670932615168[0;39m <==    Updates: 0
2022-04-18 22:02:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485670932615168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:02:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485691920912384[0;39m 生成今日电子书快照开始
2022-04-18 22:02:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485691920912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:02:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485691920912384[0;39m ==> Parameters: 
2022-04-18 22:02:55.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485691920912384[0;39m <==    Updates: 0
2022-04-18 22:02:55.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485691920912384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:03:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485712884043776[0;39m 生成今日电子书快照开始
2022-04-18 22:03:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485712884043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485712884043776[0;39m ==> Parameters: 
2022-04-18 22:03:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485712884043776[0;39m <==    Updates: 0
2022-04-18 22:03:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485712884043776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:03:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485733863952384[0;39m 生成今日电子书快照开始
2022-04-18 22:03:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485733863952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485733863952384[0;39m ==> Parameters: 
2022-04-18 22:03:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485733863952384[0;39m <==    Updates: 0
2022-04-18 22:03:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485733863952384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:03:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485734140776448[0;39m start updating Ebook doc
2022-04-18 22:03:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485734140776448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:03:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485734140776448[0;39m ==> Parameters: 
2022-04-18 22:03:05.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485734140776448[0;39m <==    Updates: 1
2022-04-18 22:03:05.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485734140776448[0;39m update ends, take 38 millisecs
2022-04-18 22:03:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485754835472384[0;39m 生成今日电子书快照开始
2022-04-18 22:03:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485754835472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485754835472384[0;39m ==> Parameters: 
2022-04-18 22:03:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485754835472384[0;39m <==    Updates: 0
2022-04-18 22:03:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485754835472384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:03:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485775802798080[0;39m 生成今日电子书快照开始
2022-04-18 22:03:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485775802798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485775802798080[0;39m ==> Parameters: 
2022-04-18 22:03:15.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485775802798080[0;39m <==    Updates: 0
2022-04-18 22:03:15.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485775802798080[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-18 22:03:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485796774318080[0;39m 生成今日电子书快照开始
2022-04-18 22:03:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485796774318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485796774318080[0;39m ==> Parameters: 
2022-04-18 22:03:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485796774318080[0;39m <==    Updates: 0
2022-04-18 22:03:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485796774318080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:03:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485817745838080[0;39m 生成今日电子书快照开始
2022-04-18 22:03:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485817745838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485817745838080[0;39m ==> Parameters: 
2022-04-18 22:03:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485817745838080[0;39m <==    Updates: 0
2022-04-18 22:03:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485817745838080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:03:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485838717358080[0;39m 生成今日电子书快照开始
2022-04-18 22:03:30.244 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485838717358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:30.245 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485838717358080[0;39m ==> Parameters: 
2022-04-18 22:03:30.282 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485838717358080[0;39m <==    Updates: 0
2022-04-18 22:03:30.282 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485838717358080[0;39m 生成今日电子书快照结束，耗时：278毫秒
2022-04-18 22:03:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485859693072384[0;39m 生成今日电子书快照开始
2022-04-18 22:03:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485859693072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485859693072384[0;39m ==> Parameters: 
2022-04-18 22:03:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485859693072384[0;39m <==    Updates: 0
2022-04-18 22:03:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485859693072384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:03:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485859927953408[0;39m start updating Ebook doc
2022-04-18 22:03:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485859927953408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:03:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485859927953408[0;39m ==> Parameters: 
2022-04-18 22:03:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485859927953408[0;39m <==    Updates: 1
2022-04-18 22:03:35.095 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485859927953408[0;39m update ends, take 35 millisecs
2022-04-18 22:03:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485880660398080[0;39m 生成今日电子书快照开始
2022-04-18 22:03:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485880660398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485880660398080[0;39m ==> Parameters: 
2022-04-18 22:03:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485880660398080[0;39m <==    Updates: 0
2022-04-18 22:03:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485880660398080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:03:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485901636112384[0;39m 生成今日电子书快照开始
2022-04-18 22:03:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485901636112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485901636112384[0;39m ==> Parameters: 
2022-04-18 22:03:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485901636112384[0;39m <==    Updates: 0
2022-04-18 22:03:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485901636112384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:03:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485922603438080[0;39m 生成今日电子书快照开始
2022-04-18 22:03:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485922603438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485922603438080[0;39m ==> Parameters: 
2022-04-18 22:03:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485922603438080[0;39m <==    Updates: 0
2022-04-18 22:03:50.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485922603438080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:03:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485943579152384[0;39m 生成今日电子书快照开始
2022-04-18 22:03:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485943579152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:03:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485943579152384[0;39m ==> Parameters: 
2022-04-18 22:03:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485943579152384[0;39m <==    Updates: 0
2022-04-18 22:03:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485943579152384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:04:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485964550672384[0;39m 生成今日电子书快照开始
2022-04-18 22:04:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485964550672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485964550672384[0;39m ==> Parameters: 
2022-04-18 22:04:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485964550672384[0;39m <==    Updates: 0
2022-04-18 22:04:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485964550672384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:04:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171485985517998080[0;39m 生成今日电子书快照开始
2022-04-18 22:04:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485985517998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485985517998080[0;39m ==> Parameters: 
2022-04-18 22:04:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171485985517998080[0;39m <==    Updates: 0
2022-04-18 22:04:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171485985517998080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:04:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171485985757073408[0;39m start updating Ebook doc
2022-04-18 22:04:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485985757073408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:04:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485985757073408[0;39m ==> Parameters: 
2022-04-18 22:04:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171485985757073408[0;39m <==    Updates: 1
2022-04-18 22:04:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171485985757073408[0;39m update ends, take 39 millisecs
2022-04-18 22:04:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486006493712384[0;39m 生成今日电子书快照开始
2022-04-18 22:04:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486006493712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:10.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486006493712384[0;39m ==> Parameters: 
2022-04-18 22:04:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486006493712384[0;39m <==    Updates: 0
2022-04-18 22:04:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486006493712384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:04:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486027465232384[0;39m 生成今日电子书快照开始
2022-04-18 22:04:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486027465232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486027465232384[0;39m ==> Parameters: 
2022-04-18 22:04:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486027465232384[0;39m <==    Updates: 0
2022-04-18 22:04:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486027465232384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:04:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486048419975168[0;39m 生成今日电子书快照开始
2022-04-18 22:04:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486048419975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486048419975168[0;39m ==> Parameters: 
2022-04-18 22:04:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486048419975168[0;39m <==    Updates: 0
2022-04-18 22:04:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486048419975168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:04:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486069408272384[0;39m 生成今日电子书快照开始
2022-04-18 22:04:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486069408272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486069408272384[0;39m ==> Parameters: 
2022-04-18 22:04:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486069408272384[0;39m <==    Updates: 0
2022-04-18 22:04:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486069408272384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:04:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486090379792384[0;39m 生成今日电子书快照开始
2022-04-18 22:04:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486090379792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486090379792384[0;39m ==> Parameters: 
2022-04-18 22:04:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486090379792384[0;39m <==    Updates: 0
2022-04-18 22:04:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486090379792384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:04:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486111351312384[0;39m 生成今日电子书快照开始
2022-04-18 22:04:35.141 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486111351312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:35.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486111351312384[0;39m ==> Parameters: 
2022-04-18 22:04:35.299 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486111351312384[0;39m <==    Updates: 0
2022-04-18 22:04:35.300 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486111351312384[0;39m 生成今日电子书快照结束，耗时：295毫秒
2022-04-18 22:04:35.300 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486112592826368[0;39m start updating Ebook doc
2022-04-18 22:04:35.300 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486112592826368[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:04:35.300 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486112592826368[0;39m ==> Parameters: 
2022-04-18 22:04:35.477 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486112592826368[0;39m <==    Updates: 1
2022-04-18 22:04:35.478 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486112592826368[0;39m update ends, take 178 millisecs
2022-04-18 22:04:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486132327026688[0;39m 生成今日电子书快照开始
2022-04-18 22:04:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486132327026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486132327026688[0;39m ==> Parameters: 
2022-04-18 22:04:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486132327026688[0;39m <==    Updates: 0
2022-04-18 22:04:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486132327026688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:04:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486153298546688[0;39m 生成今日电子书快照开始
2022-04-18 22:04:45.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486153298546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486153298546688[0;39m ==> Parameters: 
2022-04-18 22:04:45.123 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486153298546688[0;39m <==    Updates: 0
2022-04-18 22:04:45.123 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486153298546688[0;39m 生成今日电子书快照结束，耗时：118毫秒
2022-04-18 22:04:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486174261678080[0;39m 生成今日电子书快照开始
2022-04-18 22:04:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486174261678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486174261678080[0;39m ==> Parameters: 
2022-04-18 22:04:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486174261678080[0;39m <==    Updates: 0
2022-04-18 22:04:50.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486174261678080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:04:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486195241586688[0;39m 生成今日电子书快照开始
2022-04-18 22:04:55.182 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486195241586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:04:55.182 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486195241586688[0;39m ==> Parameters: 
2022-04-18 22:04:55.228 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486195241586688[0;39m <==    Updates: 0
2022-04-18 22:04:55.228 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486195241586688[0;39m 生成今日电子书快照结束，耗时：223毫秒
2022-04-18 22:05:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486216213106688[0;39m 生成今日电子书快照开始
2022-04-18 22:05:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486216213106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486216213106688[0;39m ==> Parameters: 
2022-04-18 22:05:00.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486216213106688[0;39m <==    Updates: 0
2022-04-18 22:05:00.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486216213106688[0;39m 生成今日电子书快照结束，耗时：92毫秒
2022-04-18 22:05:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486237176238080[0;39m 生成今日电子书快照开始
2022-04-18 22:05:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486237176238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486237176238080[0;39m ==> Parameters: 
2022-04-18 22:05:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486237176238080[0;39m <==    Updates: 0
2022-04-18 22:05:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486237176238080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:05:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486237402730496[0;39m start updating Ebook doc
2022-04-18 22:05:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486237402730496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:05:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486237402730496[0;39m ==> Parameters: 
2022-04-18 22:05:05.127 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486237402730496[0;39m <==    Updates: 1
2022-04-18 22:05:05.127 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486237402730496[0;39m update ends, take 70 millisecs
2022-04-18 22:05:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486258147758080[0;39m 生成今日电子书快照开始
2022-04-18 22:05:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486258147758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486258147758080[0;39m ==> Parameters: 
2022-04-18 22:05:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486258147758080[0;39m <==    Updates: 0
2022-04-18 22:05:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486258147758080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:05:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486279119278080[0;39m 生成今日电子书快照开始
2022-04-18 22:05:15.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486279119278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:15.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486279119278080[0;39m ==> Parameters: 
2022-04-18 22:05:15.154 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486279119278080[0;39m <==    Updates: 0
2022-04-18 22:05:15.154 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486279119278080[0;39m 生成今日电子书快照结束，耗时：150毫秒
2022-04-18 22:05:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486300082409472[0;39m 生成今日电子书快照开始
2022-04-18 22:05:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486300082409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486300082409472[0;39m ==> Parameters: 
2022-04-18 22:05:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486300082409472[0;39m <==    Updates: 0
2022-04-18 22:05:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486300082409472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:05:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486321070706688[0;39m 生成今日电子书快照开始
2022-04-18 22:05:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486321070706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486321070706688[0;39m ==> Parameters: 
2022-04-18 22:05:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486321070706688[0;39m <==    Updates: 0
2022-04-18 22:05:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486321070706688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:05:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486342038032384[0;39m 生成今日电子书快照开始
2022-04-18 22:05:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486342038032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486342038032384[0;39m ==> Parameters: 
2022-04-18 22:05:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486342038032384[0;39m <==    Updates: 0
2022-04-18 22:05:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486342038032384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:05:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486363013746688[0;39m 生成今日电子书快照开始
2022-04-18 22:05:35.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486363013746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486363013746688[0;39m ==> Parameters: 
2022-04-18 22:05:35.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486363013746688[0;39m <==    Updates: 0
2022-04-18 22:05:35.135 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486363013746688[0;39m 生成今日电子书快照结束，耗时：130毫秒
2022-04-18 22:05:35.136 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486363563200512[0;39m start updating Ebook doc
2022-04-18 22:05:35.136 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486363563200512[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:05:35.136 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486363563200512[0;39m ==> Parameters: 
2022-04-18 22:05:35.177 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486363563200512[0;39m <==    Updates: 1
2022-04-18 22:05:35.178 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486363563200512[0;39m update ends, take 42 millisecs
2022-04-18 22:05:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486383964295168[0;39m 生成今日电子书快照开始
2022-04-18 22:05:40.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486383964295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:40.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486383964295168[0;39m ==> Parameters: 
2022-04-18 22:05:40.286 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486383964295168[0;39m <==    Updates: 0
2022-04-18 22:05:40.286 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486383964295168[0;39m 生成今日电子书快照结束，耗时：286毫秒
2022-04-18 22:05:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486404952592384[0;39m 生成今日电子书快照开始
2022-04-18 22:05:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486404952592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486404952592384[0;39m ==> Parameters: 
2022-04-18 22:05:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486404952592384[0;39m <==    Updates: 0
2022-04-18 22:05:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486404952592384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:05:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486425928306688[0;39m 生成今日电子书快照开始
2022-04-18 22:05:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486425928306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486425928306688[0;39m ==> Parameters: 
2022-04-18 22:05:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486425928306688[0;39m <==    Updates: 0
2022-04-18 22:05:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486425928306688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:05:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486446883049472[0;39m 生成今日电子书快照开始
2022-04-18 22:05:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486446883049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:05:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486446883049472[0;39m ==> Parameters: 
2022-04-18 22:05:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486446883049472[0;39m <==    Updates: 0
2022-04-18 22:05:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486446883049472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:06:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486467862958080[0;39m 生成今日电子书快照开始
2022-04-18 22:06:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486467862958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486467862958080[0;39m ==> Parameters: 
2022-04-18 22:06:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486467862958080[0;39m <==    Updates: 0
2022-04-18 22:06:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486467862958080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:06:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486488830283776[0;39m 生成今日电子书快照开始
2022-04-18 22:06:05.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486488830283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:05.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486488830283776[0;39m ==> Parameters: 
2022-04-18 22:06:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486488830283776[0;39m <==    Updates: 0
2022-04-18 22:06:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486488830283776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:06:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486489065164800[0;39m start updating Ebook doc
2022-04-18 22:06:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486489065164800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:06:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486489065164800[0;39m ==> Parameters: 
2022-04-18 22:06:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486489065164800[0;39m <==    Updates: 1
2022-04-18 22:06:05.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486489065164800[0;39m update ends, take 35 millisecs
2022-04-18 22:06:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486509810192384[0;39m 生成今日电子书快照开始
2022-04-18 22:06:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486509810192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486509810192384[0;39m ==> Parameters: 
2022-04-18 22:06:10.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486509810192384[0;39m <==    Updates: 0
2022-04-18 22:06:10.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486509810192384[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 22:06:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486530781712384[0;39m 生成今日电子书快照开始
2022-04-18 22:06:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486530781712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486530781712384[0;39m ==> Parameters: 
2022-04-18 22:06:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486530781712384[0;39m <==    Updates: 0
2022-04-18 22:06:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486530781712384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:06:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486551744843776[0;39m 生成今日电子书快照开始
2022-04-18 22:06:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486551744843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486551744843776[0;39m ==> Parameters: 
2022-04-18 22:06:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486551744843776[0;39m <==    Updates: 0
2022-04-18 22:06:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486551744843776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:06:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486572707975168[0;39m 生成今日电子书快照开始
2022-04-18 22:06:25.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486572707975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486572707975168[0;39m ==> Parameters: 
2022-04-18 22:06:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486572707975168[0;39m <==    Updates: 0
2022-04-18 22:06:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486572707975168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:06:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486593692078080[0;39m 生成今日电子书快照开始
2022-04-18 22:06:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486593692078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486593692078080[0;39m ==> Parameters: 
2022-04-18 22:06:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486593692078080[0;39m <==    Updates: 0
2022-04-18 22:06:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486593692078080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:06:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486614667792384[0;39m 生成今日电子书快照开始
2022-04-18 22:06:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486614667792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486614667792384[0;39m ==> Parameters: 
2022-04-18 22:06:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486614667792384[0;39m <==    Updates: 0
2022-04-18 22:06:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486614667792384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:06:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486614948810752[0;39m start updating Ebook doc
2022-04-18 22:06:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486614948810752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:06:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486614948810752[0;39m ==> Parameters: 
2022-04-18 22:06:35.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486614948810752[0;39m <==    Updates: 1
2022-04-18 22:06:35.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486614948810752[0;39m update ends, take 46 millisecs
2022-04-18 22:06:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486635626729472[0;39m 生成今日电子书快照开始
2022-04-18 22:06:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486635626729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486635626729472[0;39m ==> Parameters: 
2022-04-18 22:06:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486635626729472[0;39m <==    Updates: 0
2022-04-18 22:06:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486635626729472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:06:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486656606638080[0;39m 生成今日电子书快照开始
2022-04-18 22:06:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486656606638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486656606638080[0;39m ==> Parameters: 
2022-04-18 22:06:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486656606638080[0;39m <==    Updates: 0
2022-04-18 22:06:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486656606638080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:06:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486677573963776[0;39m 生成今日电子书快照开始
2022-04-18 22:06:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486677573963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486677573963776[0;39m ==> Parameters: 
2022-04-18 22:06:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486677573963776[0;39m <==    Updates: 0
2022-04-18 22:06:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486677573963776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:06:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486698553872384[0;39m 生成今日电子书快照开始
2022-04-18 22:06:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486698553872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:06:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486698553872384[0;39m ==> Parameters: 
2022-04-18 22:06:55.338 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486698553872384[0;39m <==    Updates: 0
2022-04-18 22:06:55.339 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486698553872384[0;39m 生成今日电子书快照结束，耗时：335毫秒
2022-04-18 22:07:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486719512809472[0;39m 生成今日电子书快照开始
2022-04-18 22:07:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486719512809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486719512809472[0;39m ==> Parameters: 
2022-04-18 22:07:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486719512809472[0;39m <==    Updates: 0
2022-04-18 22:07:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486719512809472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:07:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486740501106688[0;39m 生成今日电子书快照开始
2022-04-18 22:07:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486740501106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486740501106688[0;39m ==> Parameters: 
2022-04-18 22:07:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486740501106688[0;39m <==    Updates: 0
2022-04-18 22:07:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486740501106688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:07:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486740782125056[0;39m start updating Ebook doc
2022-04-18 22:07:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486740782125056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:07:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486740782125056[0;39m ==> Parameters: 
2022-04-18 22:07:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486740782125056[0;39m <==    Updates: 1
2022-04-18 22:07:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486740782125056[0;39m update ends, take 42 millisecs
2022-04-18 22:07:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486761468432384[0;39m 生成今日电子书快照开始
2022-04-18 22:07:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486761468432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486761468432384[0;39m ==> Parameters: 
2022-04-18 22:07:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486761468432384[0;39m <==    Updates: 0
2022-04-18 22:07:10.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486761468432384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:07:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486782431563776[0;39m 生成今日电子书快照开始
2022-04-18 22:07:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486782431563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486782431563776[0;39m ==> Parameters: 
2022-04-18 22:07:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486782431563776[0;39m <==    Updates: 0
2022-04-18 22:07:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486782431563776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:07:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486803394695168[0;39m 生成今日电子书快照开始
2022-04-18 22:07:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486803394695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486803394695168[0;39m ==> Parameters: 
2022-04-18 22:07:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486803394695168[0;39m <==    Updates: 0
2022-04-18 22:07:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486803394695168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:07:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486824382992384[0;39m 生成今日电子书快照开始
2022-04-18 22:07:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486824382992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486824382992384[0;39m ==> Parameters: 
2022-04-18 22:07:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486824382992384[0;39m <==    Updates: 0
2022-04-18 22:07:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486824382992384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:07:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486845354512384[0;39m 生成今日电子书快照开始
2022-04-18 22:07:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486845354512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486845354512384[0;39m ==> Parameters: 
2022-04-18 22:07:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486845354512384[0;39m <==    Updates: 0
2022-04-18 22:07:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486845354512384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:07:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486866317643776[0;39m start updating Ebook doc
2022-04-18 22:07:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486866317643776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:07:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486866317643776[0;39m ==> Parameters: 
2022-04-18 22:07:35.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486866317643776[0;39m <==    Updates: 1
2022-04-18 22:07:35.078 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486866317643776[0;39m update ends, take 76 millisecs
2022-04-18 22:07:35.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486866640605184[0;39m 生成今日电子书快照开始
2022-04-18 22:07:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486866640605184[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486866640605184[0;39m ==> Parameters: 
2022-04-18 22:07:35.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486866640605184[0;39m <==    Updates: 0
2022-04-18 22:07:35.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486866640605184[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:07:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486887301746688[0;39m 生成今日电子书快照开始
2022-04-18 22:07:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486887301746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486887301746688[0;39m ==> Parameters: 
2022-04-18 22:07:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486887301746688[0;39m <==    Updates: 0
2022-04-18 22:07:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486887301746688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:07:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486908273266688[0;39m 生成今日电子书快照开始
2022-04-18 22:07:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486908273266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486908273266688[0;39m ==> Parameters: 
2022-04-18 22:07:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486908273266688[0;39m <==    Updates: 0
2022-04-18 22:07:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486908273266688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:07:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486929244786688[0;39m 生成今日电子书快照开始
2022-04-18 22:07:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486929244786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486929244786688[0;39m ==> Parameters: 
2022-04-18 22:07:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486929244786688[0;39m <==    Updates: 0
2022-04-18 22:07:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486929244786688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:07:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486950216306688[0;39m 生成今日电子书快照开始
2022-04-18 22:07:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486950216306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:07:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486950216306688[0;39m ==> Parameters: 
2022-04-18 22:07:55.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486950216306688[0;39m <==    Updates: 0
2022-04-18 22:07:55.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486950216306688[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 22:08:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486971187826688[0;39m 生成今日电子书快照开始
2022-04-18 22:08:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486971187826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486971187826688[0;39m ==> Parameters: 
2022-04-18 22:08:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486971187826688[0;39m <==    Updates: 0
2022-04-18 22:08:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486971187826688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:08:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171486992146763776[0;39m 生成今日电子书快照开始
2022-04-18 22:08:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486992146763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486992146763776[0;39m ==> Parameters: 
2022-04-18 22:08:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171486992146763776[0;39m <==    Updates: 0
2022-04-18 22:08:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171486992146763776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:08:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171486992415199232[0;39m start updating Ebook doc
2022-04-18 22:08:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486992415199232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:08:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486992415199232[0;39m ==> Parameters: 
2022-04-18 22:08:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171486992415199232[0;39m <==    Updates: 1
2022-04-18 22:08:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171486992415199232[0;39m update ends, take 40 millisecs
2022-04-18 22:08:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487013126672384[0;39m 生成今日电子书快照开始
2022-04-18 22:08:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487013126672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487013126672384[0;39m ==> Parameters: 
2022-04-18 22:08:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487013126672384[0;39m <==    Updates: 0
2022-04-18 22:08:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487013126672384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:08:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487034102386688[0;39m 生成今日电子书快照开始
2022-04-18 22:08:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487034102386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487034102386688[0;39m ==> Parameters: 
2022-04-18 22:08:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487034102386688[0;39m <==    Updates: 0
2022-04-18 22:08:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487034102386688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:08:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487055057129472[0;39m 生成今日电子书快照开始
2022-04-18 22:08:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487055057129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487055057129472[0;39m ==> Parameters: 
2022-04-18 22:08:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487055057129472[0;39m <==    Updates: 0
2022-04-18 22:08:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487055057129472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:08:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487076045426688[0;39m 生成今日电子书快照开始
2022-04-18 22:08:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487076045426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487076045426688[0;39m ==> Parameters: 
2022-04-18 22:08:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487076045426688[0;39m <==    Updates: 0
2022-04-18 22:08:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487076045426688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:08:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487097000169472[0;39m 生成今日电子书快照开始
2022-04-18 22:08:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487097000169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487097000169472[0;39m ==> Parameters: 
2022-04-18 22:08:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487097000169472[0;39m <==    Updates: 0
2022-04-18 22:08:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487097000169472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:08:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487117980078080[0;39m 生成今日电子书快照开始
2022-04-18 22:08:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487117980078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487117980078080[0;39m ==> Parameters: 
2022-04-18 22:08:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487117980078080[0;39m <==    Updates: 0
2022-04-18 22:08:35.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487117980078080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:08:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487118273679360[0;39m start updating Ebook doc
2022-04-18 22:08:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487118273679360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:08:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487118273679360[0;39m ==> Parameters: 
2022-04-18 22:08:35.121 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487118273679360[0;39m <==    Updates: 1
2022-04-18 22:08:35.122 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487118273679360[0;39m update ends, take 49 millisecs
2022-04-18 22:08:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487138955792384[0;39m 生成今日电子书快照开始
2022-04-18 22:08:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487138955792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487138955792384[0;39m ==> Parameters: 
2022-04-18 22:08:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487138955792384[0;39m <==    Updates: 0
2022-04-18 22:08:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487138955792384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:08:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487159923118080[0;39m 生成今日电子书快照开始
2022-04-18 22:08:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487159923118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487159923118080[0;39m ==> Parameters: 
2022-04-18 22:08:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487159923118080[0;39m <==    Updates: 0
2022-04-18 22:08:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487159923118080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:08:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487180898832384[0;39m 生成今日电子书快照开始
2022-04-18 22:08:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487180898832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487180898832384[0;39m ==> Parameters: 
2022-04-18 22:08:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487180898832384[0;39m <==    Updates: 0
2022-04-18 22:08:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487180898832384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:08:54.999 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487201849380864[0;39m 生成今日电子书快照开始
2022-04-18 22:08:55.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487201849380864[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:08:55.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487201849380864[0;39m ==> Parameters: 
2022-04-18 22:08:55.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487201849380864[0;39m <==    Updates: 0
2022-04-18 22:08:55.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487201849380864[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 22:08:59.994 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487222799929344[0;39m 生成今日电子书快照开始
2022-04-18 22:09:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487222799929344[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487222799929344[0;39m ==> Parameters: 
2022-04-18 22:09:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487222799929344[0;39m <==    Updates: 0
2022-04-18 22:09:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487222799929344[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:09:04.982 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487243721117696[0;39m start updating Ebook doc
2022-04-18 22:09:04.997 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487243721117696[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:09:04.998 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487243721117696[0;39m ==> Parameters: 
2022-04-18 22:09:05.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487243721117696[0;39m <==    Updates: 1
2022-04-18 22:09:05.036 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487243721117696[0;39m update ends, take 54 millisecs
2022-04-18 22:09:05.036 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487243947610112[0;39m 生成今日电子书快照开始
2022-04-18 22:09:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487243947610112[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:05.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487243947610112[0;39m ==> Parameters: 
2022-04-18 22:09:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487243947610112[0;39m <==    Updates: 0
2022-04-18 22:09:05.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487243947610112[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:09:09.998 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487264759746560[0;39m 生成今日电子书快照开始
2022-04-18 22:09:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487264759746560[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487264759746560[0;39m ==> Parameters: 
2022-04-18 22:09:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487264759746560[0;39m <==    Updates: 0
2022-04-18 22:09:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487264759746560[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:09:14.999 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487285735460864[0;39m 生成今日电子书快照开始
2022-04-18 22:09:15.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487285735460864[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:15.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487285735460864[0;39m ==> Parameters: 
2022-04-18 22:09:15.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487285735460864[0;39m <==    Updates: 0
2022-04-18 22:09:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487285735460864[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:09:19.999 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487306706980864[0;39m 生成今日电子书快照开始
2022-04-18 22:09:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487306706980864[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487306706980864[0;39m ==> Parameters: 
2022-04-18 22:09:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487306706980864[0;39m <==    Updates: 0
2022-04-18 22:09:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487306706980864[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:09:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487327699472384[0;39m 生成今日电子书快照开始
2022-04-18 22:09:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487327699472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487327699472384[0;39m ==> Parameters: 
2022-04-18 22:09:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487327699472384[0;39m <==    Updates: 0
2022-04-18 22:09:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487327699472384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:09:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487348670992384[0;39m 生成今日电子书快照开始
2022-04-18 22:09:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487348670992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487348670992384[0;39m ==> Parameters: 
2022-04-18 22:09:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487348670992384[0;39m <==    Updates: 0
2022-04-18 22:09:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487348670992384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:09:34.987 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487369571209216[0;39m start updating Ebook doc
2022-04-18 22:09:35.247 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487369571209216[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:09:35.248 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487369571209216[0;39m ==> Parameters: 
2022-04-18 22:09:35.286 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487369571209216[0;39m <==    Updates: 1
2022-04-18 22:09:35.286 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487369571209216[0;39m update ends, take 298 millisecs
2022-04-18 22:09:35.287 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487370829500416[0;39m 生成今日电子书快照开始
2022-04-18 22:09:35.287 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487370829500416[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:35.287 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487370829500416[0;39m ==> Parameters: 
2022-04-18 22:09:35.451 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487370829500416[0;39m <==    Updates: 0
2022-04-18 22:09:35.452 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487370829500416[0;39m 生成今日电子书快照结束，耗时：165毫秒
2022-04-18 22:09:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487390614032384[0;39m 生成今日电子书快照开始
2022-04-18 22:09:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487390614032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487390614032384[0;39m ==> Parameters: 
2022-04-18 22:09:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487390614032384[0;39m <==    Updates: 0
2022-04-18 22:09:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487390614032384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:09:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487411581358080[0;39m 生成今日电子书快照开始
2022-04-18 22:09:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487411581358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487411581358080[0;39m ==> Parameters: 
2022-04-18 22:09:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487411581358080[0;39m <==    Updates: 0
2022-04-18 22:09:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487411581358080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:09:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487432552878080[0;39m 生成今日电子书快照开始
2022-04-18 22:09:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487432552878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487432552878080[0;39m ==> Parameters: 
2022-04-18 22:09:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487432552878080[0;39m <==    Updates: 0
2022-04-18 22:09:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487432552878080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:09:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487453520203776[0;39m 生成今日电子书快照开始
2022-04-18 22:09:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487453520203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:09:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487453520203776[0;39m ==> Parameters: 
2022-04-18 22:09:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487453520203776[0;39m <==    Updates: 0
2022-04-18 22:09:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487453520203776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:10:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487474495918080[0;39m 生成今日电子书快照开始
2022-04-18 22:10:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487474495918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487474495918080[0;39m ==> Parameters: 
2022-04-18 22:10:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487474495918080[0;39m <==    Updates: 0
2022-04-18 22:10:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487474495918080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:10:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487495463243776[0;39m start updating Ebook doc
2022-04-18 22:10:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487495463243776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:10:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487495463243776[0;39m ==> Parameters: 
2022-04-18 22:10:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487495463243776[0;39m <==    Updates: 1
2022-04-18 22:10:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487495463243776[0;39m update ends, take 60 millisecs
2022-04-18 22:10:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487495714902016[0;39m 生成今日电子书快照开始
2022-04-18 22:10:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487495714902016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487495714902016[0;39m ==> Parameters: 
2022-04-18 22:10:05.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487495714902016[0;39m <==    Updates: 0
2022-04-18 22:10:05.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487495714902016[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:10:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487516434763776[0;39m 生成今日电子书快照开始
2022-04-18 22:10:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487516434763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487516434763776[0;39m ==> Parameters: 
2022-04-18 22:10:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487516434763776[0;39m <==    Updates: 0
2022-04-18 22:10:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487516434763776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:10:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487537414672384[0;39m 生成今日电子书快照开始
2022-04-18 22:10:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487537414672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487537414672384[0;39m ==> Parameters: 
2022-04-18 22:10:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487537414672384[0;39m <==    Updates: 0
2022-04-18 22:10:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487537414672384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:10:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487558386192384[0;39m 生成今日电子书快照开始
2022-04-18 22:10:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487558386192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487558386192384[0;39m ==> Parameters: 
2022-04-18 22:10:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487558386192384[0;39m <==    Updates: 0
2022-04-18 22:10:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487558386192384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:10:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487579353518080[0;39m 生成今日电子书快照开始
2022-04-18 22:10:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487579353518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487579353518080[0;39m ==> Parameters: 
2022-04-18 22:10:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487579353518080[0;39m <==    Updates: 0
2022-04-18 22:10:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487579353518080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:10:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487600320843776[0;39m 生成今日电子书快照开始
2022-04-18 22:10:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487600320843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487600320843776[0;39m ==> Parameters: 
2022-04-18 22:10:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487600320843776[0;39m <==    Updates: 0
2022-04-18 22:10:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487600320843776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:10:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487621296558080[0;39m 生成今日电子书快照开始
2022-04-18 22:10:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487621296558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487621296558080[0;39m ==> Parameters: 
2022-04-18 22:10:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487621296558080[0;39m <==    Updates: 0
2022-04-18 22:10:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487621296558080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:10:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487621581770752[0;39m start updating Ebook doc
2022-04-18 22:10:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487621581770752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:10:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487621581770752[0;39m ==> Parameters: 
2022-04-18 22:10:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487621581770752[0;39m <==    Updates: 1
2022-04-18 22:10:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487621581770752[0;39m update ends, take 37 millisecs
2022-04-18 22:10:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487642263883776[0;39m 生成今日电子书快照开始
2022-04-18 22:10:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487642263883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487642263883776[0;39m ==> Parameters: 
2022-04-18 22:10:40.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487642263883776[0;39m <==    Updates: 0
2022-04-18 22:10:40.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487642263883776[0;39m 生成今日电子书快照结束，耗时：95毫秒
2022-04-18 22:10:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487663243792384[0;39m 生成今日电子书快照开始
2022-04-18 22:10:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487663243792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487663243792384[0;39m ==> Parameters: 
2022-04-18 22:10:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487663243792384[0;39m <==    Updates: 0
2022-04-18 22:10:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487663243792384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:10:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487684206923776[0;39m 生成今日电子书快照开始
2022-04-18 22:10:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487684206923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487684206923776[0;39m ==> Parameters: 
2022-04-18 22:10:50.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487684206923776[0;39m <==    Updates: 0
2022-04-18 22:10:50.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487684206923776[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:10:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487705182638080[0;39m 生成今日电子书快照开始
2022-04-18 22:10:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487705182638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:10:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487705182638080[0;39m ==> Parameters: 
2022-04-18 22:10:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487705182638080[0;39m <==    Updates: 0
2022-04-18 22:10:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487705182638080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:11:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487726141575168[0;39m 生成今日电子书快照开始
2022-04-18 22:11:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487726141575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487726141575168[0;39m ==> Parameters: 
2022-04-18 22:11:00.284 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487726141575168[0;39m <==    Updates: 0
2022-04-18 22:11:00.284 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487726141575168[0;39m 生成今日电子书快照结束，耗时：283毫秒
2022-04-18 22:11:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487747121483776[0;39m start updating Ebook doc
2022-04-18 22:11:05.048 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487747121483776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:11:05.048 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487747121483776[0;39m ==> Parameters: 
2022-04-18 22:11:05.085 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487747121483776[0;39m <==    Updates: 1
2022-04-18 22:11:05.085 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487747121483776[0;39m update ends, take 82 millisecs
2022-04-18 22:11:05.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487747469611008[0;39m 生成今日电子书快照开始
2022-04-18 22:11:05.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487747469611008[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:05.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487747469611008[0;39m ==> Parameters: 
2022-04-18 22:11:05.123 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487747469611008[0;39m <==    Updates: 0
2022-04-18 22:11:05.124 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487747469611008[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 22:11:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487768093003776[0;39m 生成今日电子书快照开始
2022-04-18 22:11:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487768093003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487768093003776[0;39m ==> Parameters: 
2022-04-18 22:11:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487768093003776[0;39m <==    Updates: 0
2022-04-18 22:11:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487768093003776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:11:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487789072912384[0;39m 生成今日电子书快照开始
2022-04-18 22:11:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487789072912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487789072912384[0;39m ==> Parameters: 
2022-04-18 22:11:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487789072912384[0;39m <==    Updates: 0
2022-04-18 22:11:15.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487789072912384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:11:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487810044432384[0;39m 生成今日电子书快照开始
2022-04-18 22:11:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487810044432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487810044432384[0;39m ==> Parameters: 
2022-04-18 22:11:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487810044432384[0;39m <==    Updates: 0
2022-04-18 22:11:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487810044432384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:11:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487831003369472[0;39m 生成今日电子书快照开始
2022-04-18 22:11:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487831003369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487831003369472[0;39m ==> Parameters: 
2022-04-18 22:11:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487831003369472[0;39m <==    Updates: 0
2022-04-18 22:11:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487831003369472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:11:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487851979083776[0;39m 生成今日电子书快照开始
2022-04-18 22:11:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487851979083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487851979083776[0;39m ==> Parameters: 
2022-04-18 22:11:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487851979083776[0;39m <==    Updates: 0
2022-04-18 22:11:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487851979083776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:11:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487872946409472[0;39m 生成今日电子书快照开始
2022-04-18 22:11:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487872946409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487872946409472[0;39m ==> Parameters: 
2022-04-18 22:11:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487872946409472[0;39m <==    Updates: 0
2022-04-18 22:11:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487872946409472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:11:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487873193873408[0;39m start updating Ebook doc
2022-04-18 22:11:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487873193873408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:11:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487873193873408[0;39m ==> Parameters: 
2022-04-18 22:11:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487873193873408[0;39m <==    Updates: 1
2022-04-18 22:11:35.095 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487873193873408[0;39m update ends, take 35 millisecs
2022-04-18 22:11:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487893922123776[0;39m 生成今日电子书快照开始
2022-04-18 22:11:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487893922123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487893922123776[0;39m ==> Parameters: 
2022-04-18 22:11:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487893922123776[0;39m <==    Updates: 0
2022-04-18 22:11:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487893922123776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:11:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487914897838080[0;39m 生成今日电子书快照开始
2022-04-18 22:11:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487914897838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487914897838080[0;39m ==> Parameters: 
2022-04-18 22:11:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487914897838080[0;39m <==    Updates: 0
2022-04-18 22:11:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487914897838080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:11:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487935869358080[0;39m 生成今日电子书快照开始
2022-04-18 22:11:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487935869358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487935869358080[0;39m ==> Parameters: 
2022-04-18 22:11:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487935869358080[0;39m <==    Updates: 0
2022-04-18 22:11:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487935869358080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:11:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487956866043904[0;39m 生成今日电子书快照开始
2022-04-18 22:11:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487956866043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:11:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487956866043904[0;39m ==> Parameters: 
2022-04-18 22:11:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487956866043904[0;39m <==    Updates: 0
2022-04-18 22:11:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487956866043904[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:12:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487977837563904[0;39m 生成今日电子书快照开始
2022-04-18 22:12:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487977837563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487977837563904[0;39m ==> Parameters: 
2022-04-18 22:12:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487977837563904[0;39m <==    Updates: 0
2022-04-18 22:12:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487977837563904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:12:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171487998779723776[0;39m 生成今日电子书快照开始
2022-04-18 22:12:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487998779723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487998779723776[0;39m ==> Parameters: 
2022-04-18 22:12:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171487998779723776[0;39m <==    Updates: 0
2022-04-18 22:12:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171487998779723776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:12:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171487999043964928[0;39m start updating Ebook doc
2022-04-18 22:12:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487999043964928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:12:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487999043964928[0;39m ==> Parameters: 
2022-04-18 22:12:05.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171487999043964928[0;39m <==    Updates: 1
2022-04-18 22:12:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171487999043964928[0;39m update ends, take 35 millisecs
2022-04-18 22:12:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488019780603904[0;39m 生成今日电子书快照开始
2022-04-18 22:12:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488019780603904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488019780603904[0;39m ==> Parameters: 
2022-04-18 22:12:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488019780603904[0;39m <==    Updates: 0
2022-04-18 22:12:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488019780603904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:12:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488040747929600[0;39m 生成今日电子书快照开始
2022-04-18 22:12:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488040747929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488040747929600[0;39m ==> Parameters: 
2022-04-18 22:12:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488040747929600[0;39m <==    Updates: 0
2022-04-18 22:12:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488040747929600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:12:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488061711060992[0;39m 生成今日电子书快照开始
2022-04-18 22:12:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488061711060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488061711060992[0;39m ==> Parameters: 
2022-04-18 22:12:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488061711060992[0;39m <==    Updates: 0
2022-04-18 22:12:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488061711060992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:12:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488082682580992[0;39m 生成今日电子书快照开始
2022-04-18 22:12:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488082682580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488082682580992[0;39m ==> Parameters: 
2022-04-18 22:12:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488082682580992[0;39m <==    Updates: 0
2022-04-18 22:12:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488082682580992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:12:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488103658295296[0;39m 生成今日电子书快照开始
2022-04-18 22:12:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488103658295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488103658295296[0;39m ==> Parameters: 
2022-04-18 22:12:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488103658295296[0;39m <==    Updates: 0
2022-04-18 22:12:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488103658295296[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:12:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488124608843776[0;39m start updating Ebook doc
2022-04-18 22:12:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488124608843776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:12:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488124608843776[0;39m ==> Parameters: 
2022-04-18 22:12:35.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488124608843776[0;39m <==    Updates: 1
2022-04-18 22:12:35.053 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488124608843776[0;39m update ends, take 51 millisecs
2022-04-18 22:12:35.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488124822753280[0;39m 生成今日电子书快照开始
2022-04-18 22:12:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488124822753280[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488124822753280[0;39m ==> Parameters: 
2022-04-18 22:12:35.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488124822753280[0;39m <==    Updates: 0
2022-04-18 22:12:35.093 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488124822753280[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:12:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488145597140992[0;39m 生成今日电子书快照开始
2022-04-18 22:12:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488145597140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488145597140992[0;39m ==> Parameters: 
2022-04-18 22:12:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488145597140992[0;39m <==    Updates: 0
2022-04-18 22:12:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488145597140992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:12:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488166581243904[0;39m 生成今日电子书快照开始
2022-04-18 22:12:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488166581243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488166581243904[0;39m ==> Parameters: 
2022-04-18 22:12:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488166581243904[0;39m <==    Updates: 0
2022-04-18 22:12:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488166581243904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:12:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488187540180992[0;39m 生成今日电子书快照开始
2022-04-18 22:12:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488187540180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488187540180992[0;39m ==> Parameters: 
2022-04-18 22:12:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488187540180992[0;39m <==    Updates: 0
2022-04-18 22:12:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488187540180992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:12:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488208499118080[0;39m 生成今日电子书快照开始
2022-04-18 22:12:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488208499118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:12:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488208499118080[0;39m ==> Parameters: 
2022-04-18 22:12:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488208499118080[0;39m <==    Updates: 0
2022-04-18 22:12:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488208499118080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:13:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488229483220992[0;39m 生成今日电子书快照开始
2022-04-18 22:13:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488229483220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488229483220992[0;39m ==> Parameters: 
2022-04-18 22:13:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488229483220992[0;39m <==    Updates: 0
2022-04-18 22:13:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488229483220992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:13:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488250437963776[0;39m start updating Ebook doc
2022-04-18 22:13:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488250437963776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:13:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488250437963776[0;39m ==> Parameters: 
2022-04-18 22:13:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488250437963776[0;39m <==    Updates: 1
2022-04-18 22:13:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488250437963776[0;39m update ends, take 64 millisecs
2022-04-18 22:13:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488250706399232[0;39m 生成今日电子书快照开始
2022-04-18 22:13:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488250706399232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488250706399232[0;39m ==> Parameters: 
2022-04-18 22:13:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488250706399232[0;39m <==    Updates: 0
2022-04-18 22:13:05.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488250706399232[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 22:13:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488271443038208[0;39m 生成今日电子书快照开始
2022-04-18 22:13:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488271443038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488271443038208[0;39m ==> Parameters: 
2022-04-18 22:13:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488271443038208[0;39m <==    Updates: 0
2022-04-18 22:13:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488271443038208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:13:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488292410363904[0;39m 生成今日电子书快照开始
2022-04-18 22:13:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488292410363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488292410363904[0;39m ==> Parameters: 
2022-04-18 22:13:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488292410363904[0;39m <==    Updates: 0
2022-04-18 22:13:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488292410363904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:13:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488313348329472[0;39m 生成今日电子书快照开始
2022-04-18 22:13:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488313348329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488313348329472[0;39m ==> Parameters: 
2022-04-18 22:13:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488313348329472[0;39m <==    Updates: 0
2022-04-18 22:13:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488313348329472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:13:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488334336626688[0;39m 生成今日电子书快照开始
2022-04-18 22:13:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488334336626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488334336626688[0;39m ==> Parameters: 
2022-04-18 22:13:25.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488334336626688[0;39m <==    Updates: 0
2022-04-18 22:13:25.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488334336626688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:13:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488355295563776[0;39m 生成今日电子书快照开始
2022-04-18 22:13:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488355295563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488355295563776[0;39m ==> Parameters: 
2022-04-18 22:13:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488355295563776[0;39m <==    Updates: 0
2022-04-18 22:13:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488355295563776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:13:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488376271278080[0;39m start updating Ebook doc
2022-04-18 22:13:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488376271278080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:13:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488376271278080[0;39m ==> Parameters: 
2022-04-18 22:13:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488376271278080[0;39m <==    Updates: 1
2022-04-18 22:13:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488376271278080[0;39m update ends, take 73 millisecs
2022-04-18 22:13:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488376577462272[0;39m 生成今日电子书快照开始
2022-04-18 22:13:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488376577462272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488376577462272[0;39m ==> Parameters: 
2022-04-18 22:13:35.125 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488376577462272[0;39m <==    Updates: 0
2022-04-18 22:13:35.125 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488376577462272[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:13:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488397255380992[0;39m 生成今日电子书快照开始
2022-04-18 22:13:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488397255380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488397255380992[0;39m ==> Parameters: 
2022-04-18 22:13:40.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488397255380992[0;39m <==    Updates: 0
2022-04-18 22:13:40.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488397255380992[0;39m 生成今日电子书快照结束，耗时：105毫秒
2022-04-18 22:13:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488418210123776[0;39m 生成今日电子书快照开始
2022-04-18 22:13:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488418210123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488418210123776[0;39m ==> Parameters: 
2022-04-18 22:13:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488418210123776[0;39m <==    Updates: 0
2022-04-18 22:13:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488418210123776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:13:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488439185838080[0;39m 生成今日电子书快照开始
2022-04-18 22:13:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488439185838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488439185838080[0;39m ==> Parameters: 
2022-04-18 22:13:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488439185838080[0;39m <==    Updates: 0
2022-04-18 22:13:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488439185838080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:13:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488460144775168[0;39m 生成今日电子书快照开始
2022-04-18 22:13:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488460144775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:13:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488460144775168[0;39m ==> Parameters: 
2022-04-18 22:13:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488460144775168[0;39m <==    Updates: 0
2022-04-18 22:13:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488460144775168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:14:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488481154043904[0;39m 生成今日电子书快照开始
2022-04-18 22:14:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488481154043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488481154043904[0;39m ==> Parameters: 
2022-04-18 22:14:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488481154043904[0;39m <==    Updates: 0
2022-04-18 22:14:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488481154043904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:14:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488502092009472[0;39m 生成今日电子书快照开始
2022-04-18 22:14:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488502092009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488502092009472[0;39m ==> Parameters: 
2022-04-18 22:14:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488502092009472[0;39m <==    Updates: 0
2022-04-18 22:14:05.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488502092009472[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:14:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488502398193664[0;39m start updating Ebook doc
2022-04-18 22:14:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488502398193664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:14:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488502398193664[0;39m ==> Parameters: 
2022-04-18 22:14:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488502398193664[0;39m <==    Updates: 1
2022-04-18 22:14:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488502398193664[0;39m update ends, take 38 millisecs
2022-04-18 22:14:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488523084500992[0;39m 生成今日电子书快照开始
2022-04-18 22:14:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488523084500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488523084500992[0;39m ==> Parameters: 
2022-04-18 22:14:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488523084500992[0;39m <==    Updates: 0
2022-04-18 22:14:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488523084500992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:14:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488544035049472[0;39m 生成今日电子书快照开始
2022-04-18 22:14:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488544035049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488544035049472[0;39m ==> Parameters: 
2022-04-18 22:14:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488544035049472[0;39m <==    Updates: 0
2022-04-18 22:14:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488544035049472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:14:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488565006569472[0;39m 生成今日电子书快照开始
2022-04-18 22:14:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488565006569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488565006569472[0;39m ==> Parameters: 
2022-04-18 22:14:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488565006569472[0;39m <==    Updates: 0
2022-04-18 22:14:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488565006569472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:14:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488585973895168[0;39m 生成今日电子书快照开始
2022-04-18 22:14:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488585973895168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488585973895168[0;39m ==> Parameters: 
2022-04-18 22:14:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488585973895168[0;39m <==    Updates: 0
2022-04-18 22:14:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488585973895168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:14:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488606974775296[0;39m 生成今日电子书快照开始
2022-04-18 22:14:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488606974775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488606974775296[0;39m ==> Parameters: 
2022-04-18 22:14:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488606974775296[0;39m <==    Updates: 0
2022-04-18 22:14:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488606974775296[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:14:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488627916935168[0;39m 生成今日电子书快照开始
2022-04-18 22:14:35.185 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488627916935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:35.186 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488627916935168[0;39m ==> Parameters: 
2022-04-18 22:14:35.262 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488627916935168[0;39m <==    Updates: 0
2022-04-18 22:14:35.262 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488627916935168[0;39m 生成今日电子书快照结束，耗时：262毫秒
2022-04-18 22:14:35.263 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488629020037120[0;39m start updating Ebook doc
2022-04-18 22:14:35.263 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488629020037120[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:14:35.263 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488629020037120[0;39m ==> Parameters: 
2022-04-18 22:14:35.401 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488629020037120[0;39m <==    Updates: 1
2022-04-18 22:14:35.401 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488629020037120[0;39m update ends, take 138 millisecs
2022-04-18 22:14:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488648892649472[0;39m 生成今日电子书快照开始
2022-04-18 22:14:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488648892649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488648892649472[0;39m ==> Parameters: 
2022-04-18 22:14:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488648892649472[0;39m <==    Updates: 0
2022-04-18 22:14:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488648892649472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:14:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488669893529600[0;39m 生成今日电子书快照开始
2022-04-18 22:14:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488669893529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488669893529600[0;39m ==> Parameters: 
2022-04-18 22:14:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488669893529600[0;39m <==    Updates: 0
2022-04-18 22:14:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488669893529600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:14:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488690844078080[0;39m 生成今日电子书快照开始
2022-04-18 22:14:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488690844078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488690844078080[0;39m ==> Parameters: 
2022-04-18 22:14:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488690844078080[0;39m <==    Updates: 0
2022-04-18 22:14:50.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488690844078080[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 22:14:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488711836569600[0;39m 生成今日电子书快照开始
2022-04-18 22:14:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488711836569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:14:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488711836569600[0;39m ==> Parameters: 
2022-04-18 22:14:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488711836569600[0;39m <==    Updates: 0
2022-04-18 22:14:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488711836569600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:15:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488732808089600[0;39m 生成今日电子书快照开始
2022-04-18 22:15:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488732808089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488732808089600[0;39m ==> Parameters: 
2022-04-18 22:15:00.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488732808089600[0;39m <==    Updates: 0
2022-04-18 22:15:00.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488732808089600[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:15:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488753783803904[0;39m 生成今日电子书快照开始
2022-04-18 22:15:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488753783803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:05.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488753783803904[0;39m ==> Parameters: 
2022-04-18 22:15:05.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488753783803904[0;39m <==    Updates: 0
2022-04-18 22:15:05.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488753783803904[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:15:05.078 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488754073210880[0;39m start updating Ebook doc
2022-04-18 22:15:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488754073210880[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:15:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488754073210880[0;39m ==> Parameters: 
2022-04-18 22:15:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488754073210880[0;39m <==    Updates: 1
2022-04-18 22:15:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488754073210880[0;39m update ends, take 36 millisecs
2022-04-18 22:15:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488774721769472[0;39m 生成今日电子书快照开始
2022-04-18 22:15:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488774721769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488774721769472[0;39m ==> Parameters: 
2022-04-18 22:15:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488774721769472[0;39m <==    Updates: 0
2022-04-18 22:15:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488774721769472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:15:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488795701678080[0;39m 生成今日电子书快照开始
2022-04-18 22:15:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488795701678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488795701678080[0;39m ==> Parameters: 
2022-04-18 22:15:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488795701678080[0;39m <==    Updates: 0
2022-04-18 22:15:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488795701678080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:15:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488816694169600[0;39m 生成今日电子书快照开始
2022-04-18 22:15:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488816694169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488816694169600[0;39m ==> Parameters: 
2022-04-18 22:15:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488816694169600[0;39m <==    Updates: 0
2022-04-18 22:15:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488816694169600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:15:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488837653106688[0;39m 生成今日电子书快照开始
2022-04-18 22:15:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488837653106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488837653106688[0;39m ==> Parameters: 
2022-04-18 22:15:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488837653106688[0;39m <==    Updates: 0
2022-04-18 22:15:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488837653106688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:15:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488858612043776[0;39m 生成今日电子书快照开始
2022-04-18 22:15:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488858612043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488858612043776[0;39m ==> Parameters: 
2022-04-18 22:15:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488858612043776[0;39m <==    Updates: 0
2022-04-18 22:15:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488858612043776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:15:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488879587758080[0;39m 生成今日电子书快照开始
2022-04-18 22:15:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488879587758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488879587758080[0;39m ==> Parameters: 
2022-04-18 22:15:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488879587758080[0;39m <==    Updates: 0
2022-04-18 22:15:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488879587758080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:15:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171488879835222016[0;39m start updating Ebook doc
2022-04-18 22:15:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488879835222016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:15:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488879835222016[0;39m ==> Parameters: 
2022-04-18 22:15:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171488879835222016[0;39m <==    Updates: 1
2022-04-18 22:15:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171488879835222016[0;39m update ends, take 42 millisecs
2022-04-18 22:15:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488900555083776[0;39m 生成今日电子书快照开始
2022-04-18 22:15:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488900555083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488900555083776[0;39m ==> Parameters: 
2022-04-18 22:15:40.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488900555083776[0;39m <==    Updates: 0
2022-04-18 22:15:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488900555083776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:15:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488921522409472[0;39m 生成今日电子书快照开始
2022-04-18 22:15:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488921522409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488921522409472[0;39m ==> Parameters: 
2022-04-18 22:15:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488921522409472[0;39m <==    Updates: 0
2022-04-18 22:15:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488921522409472[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:15:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488942502318080[0;39m 生成今日电子书快照开始
2022-04-18 22:15:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488942502318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488942502318080[0;39m ==> Parameters: 
2022-04-18 22:15:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488942502318080[0;39m <==    Updates: 0
2022-04-18 22:15:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488942502318080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:15:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488963469643776[0;39m 生成今日电子书快照开始
2022-04-18 22:15:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488963469643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:15:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488963469643776[0;39m ==> Parameters: 
2022-04-18 22:15:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488963469643776[0;39m <==    Updates: 0
2022-04-18 22:15:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488963469643776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:16:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171488984432775168[0;39m 生成今日电子书快照开始
2022-04-18 22:16:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488984432775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488984432775168[0;39m ==> Parameters: 
2022-04-18 22:16:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171488984432775168[0;39m <==    Updates: 0
2022-04-18 22:16:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171488984432775168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:16:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489005416878080[0;39m 生成今日电子书快照开始
2022-04-18 22:16:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489005416878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489005416878080[0;39m ==> Parameters: 
2022-04-18 22:16:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489005416878080[0;39m <==    Updates: 0
2022-04-18 22:16:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489005416878080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:16:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489005681119232[0;39m start updating Ebook doc
2022-04-18 22:16:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489005681119232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:16:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489005681119232[0;39m ==> Parameters: 
2022-04-18 22:16:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489005681119232[0;39m <==    Updates: 1
2022-04-18 22:16:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489005681119232[0;39m update ends, take 36 millisecs
2022-04-18 22:16:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489026392592384[0;39m 生成今日电子书快照开始
2022-04-18 22:16:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489026392592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489026392592384[0;39m ==> Parameters: 
2022-04-18 22:16:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489026392592384[0;39m <==    Updates: 0
2022-04-18 22:16:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489026392592384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:16:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489047351529472[0;39m 生成今日电子书快照开始
2022-04-18 22:16:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489047351529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489047351529472[0;39m ==> Parameters: 
2022-04-18 22:16:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489047351529472[0;39m <==    Updates: 0
2022-04-18 22:16:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489047351529472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:16:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489068327243776[0;39m 生成今日电子书快照开始
2022-04-18 22:16:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489068327243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489068327243776[0;39m ==> Parameters: 
2022-04-18 22:16:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489068327243776[0;39m <==    Updates: 0
2022-04-18 22:16:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489068327243776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:16:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489089302958080[0;39m 生成今日电子书快照开始
2022-04-18 22:16:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489089302958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489089302958080[0;39m ==> Parameters: 
2022-04-18 22:16:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489089302958080[0;39m <==    Updates: 0
2022-04-18 22:16:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489089302958080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:16:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489110270283776[0;39m 生成今日电子书快照开始
2022-04-18 22:16:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489110270283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489110270283776[0;39m ==> Parameters: 
2022-04-18 22:16:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489110270283776[0;39m <==    Updates: 0
2022-04-18 22:16:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489110270283776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:16:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489131250192384[0;39m start updating Ebook doc
2022-04-18 22:16:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489131250192384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:16:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489131250192384[0;39m ==> Parameters: 
2022-04-18 22:16:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489131250192384[0;39m <==    Updates: 1
2022-04-18 22:16:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489131250192384[0;39m update ends, take 54 millisecs
2022-04-18 22:16:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489131476684800[0;39m 生成今日电子书快照开始
2022-04-18 22:16:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489131476684800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489131476684800[0;39m ==> Parameters: 
2022-04-18 22:16:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489131476684800[0;39m <==    Updates: 0
2022-04-18 22:16:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489131476684800[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:16:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489152221712384[0;39m 生成今日电子书快照开始
2022-04-18 22:16:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489152221712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489152221712384[0;39m ==> Parameters: 
2022-04-18 22:16:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489152221712384[0;39m <==    Updates: 0
2022-04-18 22:16:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489152221712384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:16:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489173193232384[0;39m 生成今日电子书快照开始
2022-04-18 22:16:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489173193232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489173193232384[0;39m ==> Parameters: 
2022-04-18 22:16:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489173193232384[0;39m <==    Updates: 0
2022-04-18 22:16:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489173193232384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:16:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489194152169472[0;39m 生成今日电子书快照开始
2022-04-18 22:16:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489194152169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489194152169472[0;39m ==> Parameters: 
2022-04-18 22:16:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489194152169472[0;39m <==    Updates: 0
2022-04-18 22:16:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489194152169472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:16:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489215127883776[0;39m 生成今日电子书快照开始
2022-04-18 22:16:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489215127883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:16:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489215127883776[0;39m ==> Parameters: 
2022-04-18 22:16:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489215127883776[0;39m <==    Updates: 0
2022-04-18 22:16:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489215127883776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:17:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489236107792384[0;39m 生成今日电子书快照开始
2022-04-18 22:17:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489236107792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489236107792384[0;39m ==> Parameters: 
2022-04-18 22:17:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489236107792384[0;39m <==    Updates: 0
2022-04-18 22:17:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489236107792384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:17:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489257066729472[0;39m start updating Ebook doc
2022-04-18 22:17:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489257066729472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:17:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489257066729472[0;39m ==> Parameters: 
2022-04-18 22:17:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489257066729472[0;39m <==    Updates: 1
2022-04-18 22:17:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489257066729472[0;39m update ends, take 63 millisecs
2022-04-18 22:17:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489257330970624[0;39m 生成今日电子书快照开始
2022-04-18 22:17:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489257330970624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489257330970624[0;39m ==> Parameters: 
2022-04-18 22:17:05.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489257330970624[0;39m <==    Updates: 0
2022-04-18 22:17:05.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489257330970624[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:17:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489278034055168[0;39m 生成今日电子书快照开始
2022-04-18 22:17:10.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489278034055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:10.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489278034055168[0;39m ==> Parameters: 
2022-04-18 22:17:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489278034055168[0;39m <==    Updates: 0
2022-04-18 22:17:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489278034055168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:17:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489299009769472[0;39m 生成今日电子书快照开始
2022-04-18 22:17:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489299009769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489299009769472[0;39m ==> Parameters: 
2022-04-18 22:17:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489299009769472[0;39m <==    Updates: 0
2022-04-18 22:17:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489299009769472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:17:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489319981289472[0;39m 生成今日电子书快照开始
2022-04-18 22:17:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489319981289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489319981289472[0;39m ==> Parameters: 
2022-04-18 22:17:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489319981289472[0;39m <==    Updates: 0
2022-04-18 22:17:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489319981289472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:17:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489340952809472[0;39m 生成今日电子书快照开始
2022-04-18 22:17:25.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489340952809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:25.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489340952809472[0;39m ==> Parameters: 
2022-04-18 22:17:25.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489340952809472[0;39m <==    Updates: 0
2022-04-18 22:17:25.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489340952809472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:17:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489361924329472[0;39m 生成今日电子书快照开始
2022-04-18 22:17:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489361924329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489361924329472[0;39m ==> Parameters: 
2022-04-18 22:17:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489361924329472[0;39m <==    Updates: 0
2022-04-18 22:17:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489361924329472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:17:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489382895849472[0;39m start updating Ebook doc
2022-04-18 22:17:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489382895849472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:17:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489382895849472[0;39m ==> Parameters: 
2022-04-18 22:17:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489382895849472[0;39m <==    Updates: 1
2022-04-18 22:17:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489382895849472[0;39m update ends, take 63 millisecs
2022-04-18 22:17:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489383164284928[0;39m 生成今日电子书快照开始
2022-04-18 22:17:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489383164284928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489383164284928[0;39m ==> Parameters: 
2022-04-18 22:17:35.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489383164284928[0;39m <==    Updates: 0
2022-04-18 22:17:35.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489383164284928[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 22:17:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489403867369472[0;39m 生成今日电子书快照开始
2022-04-18 22:17:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489403867369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489403867369472[0;39m ==> Parameters: 
2022-04-18 22:17:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489403867369472[0;39m <==    Updates: 0
2022-04-18 22:17:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489403867369472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:17:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489424855666688[0;39m 生成今日电子书快照开始
2022-04-18 22:17:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489424855666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489424855666688[0;39m ==> Parameters: 
2022-04-18 22:17:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489424855666688[0;39m <==    Updates: 0
2022-04-18 22:17:45.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489424855666688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:17:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489445814603776[0;39m 生成今日电子书快照开始
2022-04-18 22:17:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489445814603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489445814603776[0;39m ==> Parameters: 
2022-04-18 22:17:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489445814603776[0;39m <==    Updates: 0
2022-04-18 22:17:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489445814603776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:17:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489466790318080[0;39m 生成今日电子书快照开始
2022-04-18 22:17:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489466790318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:17:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489466790318080[0;39m ==> Parameters: 
2022-04-18 22:17:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489466790318080[0;39m <==    Updates: 0
2022-04-18 22:17:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489466790318080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:18:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489487753449472[0;39m 生成今日电子书快照开始
2022-04-18 22:18:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489487753449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489487753449472[0;39m ==> Parameters: 
2022-04-18 22:18:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489487753449472[0;39m <==    Updates: 0
2022-04-18 22:18:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489487753449472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:18:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489508724969472[0;39m start updating Ebook doc
2022-04-18 22:18:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489508724969472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:18:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489508724969472[0;39m ==> Parameters: 
2022-04-18 22:18:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489508724969472[0;39m <==    Updates: 1
2022-04-18 22:18:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489508724969472[0;39m update ends, take 64 millisecs
2022-04-18 22:18:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489508993404928[0;39m 生成今日电子书快照开始
2022-04-18 22:18:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489508993404928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489508993404928[0;39m ==> Parameters: 
2022-04-18 22:18:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489508993404928[0;39m <==    Updates: 0
2022-04-18 22:18:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489508993404928[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:18:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489529700683776[0;39m 生成今日电子书快照开始
2022-04-18 22:18:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489529700683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489529700683776[0;39m ==> Parameters: 
2022-04-18 22:18:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489529700683776[0;39m <==    Updates: 0
2022-04-18 22:18:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489529700683776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:18:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489550680592384[0;39m 生成今日电子书快照开始
2022-04-18 22:18:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489550680592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489550680592384[0;39m ==> Parameters: 
2022-04-18 22:18:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489550680592384[0;39m <==    Updates: 0
2022-04-18 22:18:15.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489550680592384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:18:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489571647918080[0;39m 生成今日电子书快照开始
2022-04-18 22:18:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489571647918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489571647918080[0;39m ==> Parameters: 
2022-04-18 22:18:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489571647918080[0;39m <==    Updates: 0
2022-04-18 22:18:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489571647918080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:18:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489592623632384[0;39m 生成今日电子书快照开始
2022-04-18 22:18:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489592623632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489592623632384[0;39m ==> Parameters: 
2022-04-18 22:18:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489592623632384[0;39m <==    Updates: 0
2022-04-18 22:18:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489592623632384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:18:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489613582569472[0;39m 生成今日电子书快照开始
2022-04-18 22:18:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489613582569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489613582569472[0;39m ==> Parameters: 
2022-04-18 22:18:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489613582569472[0;39m <==    Updates: 0
2022-04-18 22:18:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489613582569472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:18:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489634554089472[0;39m start updating Ebook doc
2022-04-18 22:18:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489634554089472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:18:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489634554089472[0;39m ==> Parameters: 
2022-04-18 22:18:35.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489634554089472[0;39m <==    Updates: 1
2022-04-18 22:18:35.057 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489634554089472[0;39m update ends, take 55 millisecs
2022-04-18 22:18:35.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489634788970496[0;39m 生成今日电子书快照开始
2022-04-18 22:18:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489634788970496[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489634788970496[0;39m ==> Parameters: 
2022-04-18 22:18:35.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489634788970496[0;39m <==    Updates: 0
2022-04-18 22:18:35.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489634788970496[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 22:18:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489655525609472[0;39m 生成今日电子书快照开始
2022-04-18 22:18:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489655525609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489655525609472[0;39m ==> Parameters: 
2022-04-18 22:18:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489655525609472[0;39m <==    Updates: 0
2022-04-18 22:18:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489655525609472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:18:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489676505518080[0;39m 生成今日电子书快照开始
2022-04-18 22:18:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489676505518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489676505518080[0;39m ==> Parameters: 
2022-04-18 22:18:45.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489676505518080[0;39m <==    Updates: 0
2022-04-18 22:18:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489676505518080[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:18:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489697468649472[0;39m 生成今日电子书快照开始
2022-04-18 22:18:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489697468649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489697468649472[0;39m ==> Parameters: 
2022-04-18 22:18:50.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489697468649472[0;39m <==    Updates: 0
2022-04-18 22:18:50.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489697468649472[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:18:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489718440169472[0;39m 生成今日电子书快照开始
2022-04-18 22:18:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489718440169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:18:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489718440169472[0;39m ==> Parameters: 
2022-04-18 22:18:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489718440169472[0;39m <==    Updates: 0
2022-04-18 22:18:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489718440169472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:19:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489739411689472[0;39m 生成今日电子书快照开始
2022-04-18 22:19:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489739411689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489739411689472[0;39m ==> Parameters: 
2022-04-18 22:19:00.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489739411689472[0;39m <==    Updates: 0
2022-04-18 22:19:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489739411689472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:19:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489760395792384[0;39m 生成今日电子书快照开始
2022-04-18 22:19:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489760395792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489760395792384[0;39m ==> Parameters: 
2022-04-18 22:19:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489760395792384[0;39m <==    Updates: 0
2022-04-18 22:19:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489760395792384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:19:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489760630673408[0;39m start updating Ebook doc
2022-04-18 22:19:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489760630673408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:19:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489760630673408[0;39m ==> Parameters: 
2022-04-18 22:19:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489760630673408[0;39m <==    Updates: 1
2022-04-18 22:19:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489760630673408[0;39m update ends, take 42 millisecs
2022-04-18 22:19:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489781367312384[0;39m 生成今日电子书快照开始
2022-04-18 22:19:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489781367312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489781367312384[0;39m ==> Parameters: 
2022-04-18 22:19:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489781367312384[0;39m <==    Updates: 0
2022-04-18 22:19:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489781367312384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:19:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489802326249472[0;39m 生成今日电子书快照开始
2022-04-18 22:19:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489802326249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489802326249472[0;39m ==> Parameters: 
2022-04-18 22:19:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489802326249472[0;39m <==    Updates: 0
2022-04-18 22:19:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489802326249472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:19:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489823297769472[0;39m 生成今日电子书快照开始
2022-04-18 22:19:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489823297769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489823297769472[0;39m ==> Parameters: 
2022-04-18 22:19:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489823297769472[0;39m <==    Updates: 0
2022-04-18 22:19:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489823297769472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:19:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489844273483776[0;39m 生成今日电子书快照开始
2022-04-18 22:19:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489844273483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489844273483776[0;39m ==> Parameters: 
2022-04-18 22:19:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489844273483776[0;39m <==    Updates: 0
2022-04-18 22:19:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489844273483776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:19:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489865249198080[0;39m 生成今日电子书快照开始
2022-04-18 22:19:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489865249198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489865249198080[0;39m ==> Parameters: 
2022-04-18 22:19:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489865249198080[0;39m <==    Updates: 0
2022-04-18 22:19:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489865249198080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:19:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489886212329472[0;39m 生成今日电子书快照开始
2022-04-18 22:19:35.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489886212329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:35.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489886212329472[0;39m ==> Parameters: 
2022-04-18 22:19:35.207 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489886212329472[0;39m <==    Updates: 0
2022-04-18 22:19:35.208 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489886212329472[0;39m 生成今日电子书快照结束，耗时：206毫秒
2022-04-18 22:19:35.208 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171489887080550400[0;39m start updating Ebook doc
2022-04-18 22:19:35.208 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489887080550400[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:19:35.208 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489887080550400[0;39m ==> Parameters: 
2022-04-18 22:19:35.411 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171489887080550400[0;39m <==    Updates: 1
2022-04-18 22:19:35.411 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171489887080550400[0;39m update ends, take 203 millisecs
2022-04-18 22:19:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489907183849472[0;39m 生成今日电子书快照开始
2022-04-18 22:19:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489907183849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489907183849472[0;39m ==> Parameters: 
2022-04-18 22:19:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489907183849472[0;39m <==    Updates: 0
2022-04-18 22:19:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489907183849472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:19:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489928172146688[0;39m 生成今日电子书快照开始
2022-04-18 22:19:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489928172146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489928172146688[0;39m ==> Parameters: 
2022-04-18 22:19:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489928172146688[0;39m <==    Updates: 0
2022-04-18 22:19:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489928172146688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:19:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489949126889472[0;39m 生成今日电子书快照开始
2022-04-18 22:19:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489949126889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489949126889472[0;39m ==> Parameters: 
2022-04-18 22:19:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489949126889472[0;39m <==    Updates: 0
2022-04-18 22:19:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489949126889472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:19:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489970110992384[0;39m 生成今日电子书快照开始
2022-04-18 22:19:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489970110992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:19:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489970110992384[0;39m ==> Parameters: 
2022-04-18 22:19:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489970110992384[0;39m <==    Updates: 0
2022-04-18 22:19:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489970110992384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:20:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171489991065735168[0;39m 生成今日电子书快照开始
2022-04-18 22:20:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489991065735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489991065735168[0;39m ==> Parameters: 
2022-04-18 22:20:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171489991065735168[0;39m <==    Updates: 0
2022-04-18 22:20:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171489991065735168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:20:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490012054032384[0;39m start updating Ebook doc
2022-04-18 22:20:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490012054032384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:20:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490012054032384[0;39m ==> Parameters: 
2022-04-18 22:20:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490012054032384[0;39m <==    Updates: 1
2022-04-18 22:20:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490012054032384[0;39m update ends, take 66 millisecs
2022-04-18 22:20:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490012335050752[0;39m 生成今日电子书快照开始
2022-04-18 22:20:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490012335050752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490012335050752[0;39m ==> Parameters: 
2022-04-18 22:20:05.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490012335050752[0;39m <==    Updates: 0
2022-04-18 22:20:05.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490012335050752[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:20:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490033012969472[0;39m 生成今日电子书快照开始
2022-04-18 22:20:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490033012969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:10.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490033012969472[0;39m ==> Parameters: 
2022-04-18 22:20:10.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490033012969472[0;39m <==    Updates: 0
2022-04-18 22:20:10.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490033012969472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:20:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490053988683776[0;39m 生成今日电子书快照开始
2022-04-18 22:20:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490053988683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490053988683776[0;39m ==> Parameters: 
2022-04-18 22:20:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490053988683776[0;39m <==    Updates: 0
2022-04-18 22:20:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490053988683776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:20:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490074956009472[0;39m 生成今日电子书快照开始
2022-04-18 22:20:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490074956009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490074956009472[0;39m ==> Parameters: 
2022-04-18 22:20:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490074956009472[0;39m <==    Updates: 0
2022-04-18 22:20:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490074956009472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:20:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490095923335168[0;39m 生成今日电子书快照开始
2022-04-18 22:20:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490095923335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490095923335168[0;39m ==> Parameters: 
2022-04-18 22:20:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490095923335168[0;39m <==    Updates: 0
2022-04-18 22:20:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490095923335168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:20:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490116899049472[0;39m 生成今日电子书快照开始
2022-04-18 22:20:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490116899049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490116899049472[0;39m ==> Parameters: 
2022-04-18 22:20:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490116899049472[0;39m <==    Updates: 0
2022-04-18 22:20:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490116899049472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:20:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490137870569472[0;39m start updating Ebook doc
2022-04-18 22:20:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490137870569472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:20:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490137870569472[0;39m ==> Parameters: 
2022-04-18 22:20:35.052 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490137870569472[0;39m <==    Updates: 1
2022-04-18 22:20:35.053 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490137870569472[0;39m update ends, take 51 millisecs
2022-04-18 22:20:35.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490138088673280[0;39m 生成今日电子书快照开始
2022-04-18 22:20:35.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490138088673280[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:35.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490138088673280[0;39m ==> Parameters: 
2022-04-18 22:20:35.090 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490138088673280[0;39m <==    Updates: 0
2022-04-18 22:20:35.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490138088673280[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 22:20:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490158850478080[0;39m 生成今日电子书快照开始
2022-04-18 22:20:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490158850478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490158850478080[0;39m ==> Parameters: 
2022-04-18 22:20:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490158850478080[0;39m <==    Updates: 0
2022-04-18 22:20:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490158850478080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:20:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490179821998080[0;39m 生成今日电子书快照开始
2022-04-18 22:20:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490179821998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490179821998080[0;39m ==> Parameters: 
2022-04-18 22:20:45.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490179821998080[0;39m <==    Updates: 0
2022-04-18 22:20:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490179821998080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:20:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490200793518080[0;39m 生成今日电子书快照开始
2022-04-18 22:20:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490200793518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490200793518080[0;39m ==> Parameters: 
2022-04-18 22:20:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490200793518080[0;39m <==    Updates: 0
2022-04-18 22:20:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490200793518080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:20:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490221760843776[0;39m 生成今日电子书快照开始
2022-04-18 22:20:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490221760843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:20:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490221760843776[0;39m ==> Parameters: 
2022-04-18 22:20:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490221760843776[0;39m <==    Updates: 0
2022-04-18 22:20:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490221760843776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:21:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490242732363776[0;39m 生成今日电子书快照开始
2022-04-18 22:21:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490242732363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490242732363776[0;39m ==> Parameters: 
2022-04-18 22:21:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490242732363776[0;39m <==    Updates: 0
2022-04-18 22:21:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490242732363776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:21:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490263703883776[0;39m start updating Ebook doc
2022-04-18 22:21:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490263703883776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:21:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490263703883776[0;39m ==> Parameters: 
2022-04-18 22:21:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490263703883776[0;39m <==    Updates: 1
2022-04-18 22:21:05.056 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490263703883776[0;39m update ends, take 54 millisecs
2022-04-18 22:21:05.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490263930376192[0;39m 生成今日电子书快照开始
2022-04-18 22:21:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490263930376192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490263930376192[0;39m ==> Parameters: 
2022-04-18 22:21:05.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490263930376192[0;39m <==    Updates: 0
2022-04-18 22:21:05.093 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490263930376192[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 22:21:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490284683792384[0;39m 生成今日电子书快照开始
2022-04-18 22:21:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490284683792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490284683792384[0;39m ==> Parameters: 
2022-04-18 22:21:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490284683792384[0;39m <==    Updates: 0
2022-04-18 22:21:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490284683792384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:21:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490305651118080[0;39m 生成今日电子书快照开始
2022-04-18 22:21:15.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490305651118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:15.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490305651118080[0;39m ==> Parameters: 
2022-04-18 22:21:15.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490305651118080[0;39m <==    Updates: 0
2022-04-18 22:21:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490305651118080[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 22:21:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490326614249472[0;39m 生成今日电子书快照开始
2022-04-18 22:21:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490326614249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490326614249472[0;39m ==> Parameters: 
2022-04-18 22:21:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490326614249472[0;39m <==    Updates: 0
2022-04-18 22:21:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490326614249472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:21:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490347598352384[0;39m 生成今日电子书快照开始
2022-04-18 22:21:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490347598352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490347598352384[0;39m ==> Parameters: 
2022-04-18 22:21:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490347598352384[0;39m <==    Updates: 0
2022-04-18 22:21:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490347598352384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:21:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490368557289472[0;39m 生成今日电子书快照开始
2022-04-18 22:21:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490368557289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490368557289472[0;39m ==> Parameters: 
2022-04-18 22:21:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490368557289472[0;39m <==    Updates: 0
2022-04-18 22:21:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490368557289472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:21:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490389533003776[0;39m 生成今日电子书快照开始
2022-04-18 22:21:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490389533003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490389533003776[0;39m ==> Parameters: 
2022-04-18 22:21:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490389533003776[0;39m <==    Updates: 0
2022-04-18 22:21:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490389533003776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:21:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490389767884800[0;39m start updating Ebook doc
2022-04-18 22:21:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490389767884800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:21:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490389767884800[0;39m ==> Parameters: 
2022-04-18 22:21:35.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490389767884800[0;39m <==    Updates: 1
2022-04-18 22:21:35.091 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490389767884800[0;39m update ends, take 33 millisecs
2022-04-18 22:21:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490410496135168[0;39m 生成今日电子书快照开始
2022-04-18 22:21:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490410496135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490410496135168[0;39m ==> Parameters: 
2022-04-18 22:21:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490410496135168[0;39m <==    Updates: 0
2022-04-18 22:21:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490410496135168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:21:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490431467655168[0;39m 生成今日电子书快照开始
2022-04-18 22:21:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490431467655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490431467655168[0;39m ==> Parameters: 
2022-04-18 22:21:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490431467655168[0;39m <==    Updates: 0
2022-04-18 22:21:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490431467655168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:21:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490452455952384[0;39m 生成今日电子书快照开始
2022-04-18 22:21:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490452455952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490452455952384[0;39m ==> Parameters: 
2022-04-18 22:21:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490452455952384[0;39m <==    Updates: 0
2022-04-18 22:21:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490452455952384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:21:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490473414889472[0;39m 生成今日电子书快照开始
2022-04-18 22:21:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490473414889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:21:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490473414889472[0;39m ==> Parameters: 
2022-04-18 22:21:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490473414889472[0;39m <==    Updates: 0
2022-04-18 22:21:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490473414889472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:22:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490494386409472[0;39m 生成今日电子书快照开始
2022-04-18 22:22:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490494386409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490494386409472[0;39m ==> Parameters: 
2022-04-18 22:22:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490494386409472[0;39m <==    Updates: 0
2022-04-18 22:22:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490494386409472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:22:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490515362123776[0;39m start updating Ebook doc
2022-04-18 22:22:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490515362123776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:22:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490515362123776[0;39m ==> Parameters: 
2022-04-18 22:22:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490515362123776[0;39m <==    Updates: 1
2022-04-18 22:22:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490515362123776[0;39m update ends, take 61 millisecs
2022-04-18 22:22:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490515617976320[0;39m 生成今日电子书快照开始
2022-04-18 22:22:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490515617976320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490515617976320[0;39m ==> Parameters: 
2022-04-18 22:22:05.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490515617976320[0;39m <==    Updates: 0
2022-04-18 22:22:05.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490515617976320[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:22:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490536325255168[0;39m 生成今日电子书快照开始
2022-04-18 22:22:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490536325255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490536325255168[0;39m ==> Parameters: 
2022-04-18 22:22:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490536325255168[0;39m <==    Updates: 0
2022-04-18 22:22:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490536325255168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:22:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490557300969472[0;39m 生成今日电子书快照开始
2022-04-18 22:22:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490557300969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490557300969472[0;39m ==> Parameters: 
2022-04-18 22:22:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490557300969472[0;39m <==    Updates: 0
2022-04-18 22:22:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490557300969472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:22:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490578268295168[0;39m 生成今日电子书快照开始
2022-04-18 22:22:20.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490578268295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490578268295168[0;39m ==> Parameters: 
2022-04-18 22:22:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490578268295168[0;39m <==    Updates: 0
2022-04-18 22:22:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490578268295168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:22:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490599252398080[0;39m 生成今日电子书快照开始
2022-04-18 22:22:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490599252398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490599252398080[0;39m ==> Parameters: 
2022-04-18 22:22:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490599252398080[0;39m <==    Updates: 0
2022-04-18 22:22:25.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490599252398080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:22:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490620232306688[0;39m 生成今日电子书快照开始
2022-04-18 22:22:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490620232306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490620232306688[0;39m ==> Parameters: 
2022-04-18 22:22:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490620232306688[0;39m <==    Updates: 0
2022-04-18 22:22:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490620232306688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:22:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490641203826688[0;39m 生成今日电子书快照开始
2022-04-18 22:22:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490641203826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490641203826688[0;39m ==> Parameters: 
2022-04-18 22:22:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490641203826688[0;39m <==    Updates: 0
2022-04-18 22:22:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490641203826688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:22:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490641476456448[0;39m start updating Ebook doc
2022-04-18 22:22:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490641476456448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:22:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490641476456448[0;39m ==> Parameters: 
2022-04-18 22:22:35.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490641476456448[0;39m <==    Updates: 1
2022-04-18 22:22:35.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490641476456448[0;39m update ends, take 45 millisecs
2022-04-18 22:22:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490662175346688[0;39m 生成今日电子书快照开始
2022-04-18 22:22:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490662175346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490662175346688[0;39m ==> Parameters: 
2022-04-18 22:22:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490662175346688[0;39m <==    Updates: 0
2022-04-18 22:22:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490662175346688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:22:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490683142672384[0;39m 生成今日电子书快照开始
2022-04-18 22:22:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490683142672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490683142672384[0;39m ==> Parameters: 
2022-04-18 22:22:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490683142672384[0;39m <==    Updates: 0
2022-04-18 22:22:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490683142672384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:22:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490704118386688[0;39m 生成今日电子书快照开始
2022-04-18 22:22:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490704118386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490704118386688[0;39m ==> Parameters: 
2022-04-18 22:22:50.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490704118386688[0;39m <==    Updates: 0
2022-04-18 22:22:50.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490704118386688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 22:22:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490725081518080[0;39m 生成今日电子书快照开始
2022-04-18 22:22:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490725081518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:22:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490725081518080[0;39m ==> Parameters: 
2022-04-18 22:22:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490725081518080[0;39m <==    Updates: 0
2022-04-18 22:22:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490725081518080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:23:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490746057232384[0;39m 生成今日电子书快照开始
2022-04-18 22:23:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490746057232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490746057232384[0;39m ==> Parameters: 
2022-04-18 22:23:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490746057232384[0;39m <==    Updates: 0
2022-04-18 22:23:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490746057232384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:23:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490767024558080[0;39m start updating Ebook doc
2022-04-18 22:23:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490767024558080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:23:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490767024558080[0;39m ==> Parameters: 
2022-04-18 22:23:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490767024558080[0;39m <==    Updates: 1
2022-04-18 22:23:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490767024558080[0;39m update ends, take 66 millisecs
2022-04-18 22:23:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490767301382144[0;39m 生成今日电子书快照开始
2022-04-18 22:23:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490767301382144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490767301382144[0;39m ==> Parameters: 
2022-04-18 22:23:05.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490767301382144[0;39m <==    Updates: 0
2022-04-18 22:23:05.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490767301382144[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 22:23:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490787983495168[0;39m 生成今日电子书快照开始
2022-04-18 22:23:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490787983495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490787983495168[0;39m ==> Parameters: 
2022-04-18 22:23:10.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490787983495168[0;39m <==    Updates: 0
2022-04-18 22:23:10.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490787983495168[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-18 22:23:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490808975986688[0;39m 生成今日电子书快照开始
2022-04-18 22:23:15.126 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490808975986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:15.126 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490808975986688[0;39m ==> Parameters: 
2022-04-18 22:23:15.162 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490808975986688[0;39m <==    Updates: 0
2022-04-18 22:23:15.162 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490808975986688[0;39m 生成今日电子书快照结束，耗时：157毫秒
2022-04-18 22:23:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490829926535168[0;39m 生成今日电子书快照开始
2022-04-18 22:23:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490829926535168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490829926535168[0;39m ==> Parameters: 
2022-04-18 22:23:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490829926535168[0;39m <==    Updates: 0
2022-04-18 22:23:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490829926535168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:23:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490850914832384[0;39m 生成今日电子书快照开始
2022-04-18 22:23:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490850914832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490850914832384[0;39m ==> Parameters: 
2022-04-18 22:23:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490850914832384[0;39m <==    Updates: 0
2022-04-18 22:23:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490850914832384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:23:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490871869575168[0;39m 生成今日电子书快照开始
2022-04-18 22:23:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490871869575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490871869575168[0;39m ==> Parameters: 
2022-04-18 22:23:30.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490871869575168[0;39m <==    Updates: 0
2022-04-18 22:23:30.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490871869575168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:23:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490892862066688[0;39m 生成今日电子书快照开始
2022-04-18 22:23:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490892862066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490892862066688[0;39m ==> Parameters: 
2022-04-18 22:23:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490892862066688[0;39m <==    Updates: 0
2022-04-18 22:23:35.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490892862066688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:23:35.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171490893080170496[0;39m start updating Ebook doc
2022-04-18 22:23:35.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490893080170496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:23:35.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490893080170496[0;39m ==> Parameters: 
2022-04-18 22:23:35.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171490893080170496[0;39m <==    Updates: 1
2022-04-18 22:23:35.091 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171490893080170496[0;39m update ends, take 34 millisecs
2022-04-18 22:23:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490913816809472[0;39m 生成今日电子书快照开始
2022-04-18 22:23:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490913816809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490913816809472[0;39m ==> Parameters: 
2022-04-18 22:23:40.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490913816809472[0;39m <==    Updates: 0
2022-04-18 22:23:40.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490913816809472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:23:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490934796718080[0;39m 生成今日电子书快照开始
2022-04-18 22:23:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490934796718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490934796718080[0;39m ==> Parameters: 
2022-04-18 22:23:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490934796718080[0;39m <==    Updates: 0
2022-04-18 22:23:45.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490934796718080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:23:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490955759849472[0;39m 生成今日电子书快照开始
2022-04-18 22:23:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490955759849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490955759849472[0;39m ==> Parameters: 
2022-04-18 22:23:50.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490955759849472[0;39m <==    Updates: 0
2022-04-18 22:23:50.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490955759849472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:23:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490976748146688[0;39m 生成今日电子书快照开始
2022-04-18 22:23:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490976748146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:23:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490976748146688[0;39m ==> Parameters: 
2022-04-18 22:23:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490976748146688[0;39m <==    Updates: 0
2022-04-18 22:23:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490976748146688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:24:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171490997711278080[0;39m 生成今日电子书快照开始
2022-04-18 22:24:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490997711278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490997711278080[0;39m ==> Parameters: 
2022-04-18 22:24:00.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171490997711278080[0;39m <==    Updates: 0
2022-04-18 22:24:00.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171490997711278080[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 22:24:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491018686992384[0;39m 生成今日电子书快照开始
2022-04-18 22:24:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491018686992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491018686992384[0;39m ==> Parameters: 
2022-04-18 22:24:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491018686992384[0;39m <==    Updates: 0
2022-04-18 22:24:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491018686992384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:24:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491018934456320[0;39m start updating Ebook doc
2022-04-18 22:24:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491018934456320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:24:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491018934456320[0;39m ==> Parameters: 
2022-04-18 22:24:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491018934456320[0;39m <==    Updates: 1
2022-04-18 22:24:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491018934456320[0;39m update ends, take 37 millisecs
2022-04-18 22:24:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491039654318080[0;39m 生成今日电子书快照开始
2022-04-18 22:24:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491039654318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491039654318080[0;39m ==> Parameters: 
2022-04-18 22:24:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491039654318080[0;39m <==    Updates: 0
2022-04-18 22:24:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491039654318080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:24:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491060621643776[0;39m 生成今日电子书快照开始
2022-04-18 22:24:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491060621643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491060621643776[0;39m ==> Parameters: 
2022-04-18 22:24:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491060621643776[0;39m <==    Updates: 0
2022-04-18 22:24:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491060621643776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:24:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491081588969472[0;39m 生成今日电子书快照开始
2022-04-18 22:24:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491081588969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491081588969472[0;39m ==> Parameters: 
2022-04-18 22:24:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491081588969472[0;39m <==    Updates: 0
2022-04-18 22:24:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491081588969472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:24:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491102564683776[0;39m 生成今日电子书快照开始
2022-04-18 22:24:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491102564683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491102564683776[0;39m ==> Parameters: 
2022-04-18 22:24:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491102564683776[0;39m <==    Updates: 0
2022-04-18 22:24:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491102564683776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:24:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491123540398080[0;39m 生成今日电子书快照开始
2022-04-18 22:24:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491123540398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491123540398080[0;39m ==> Parameters: 
2022-04-18 22:24:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491123540398080[0;39m <==    Updates: 0
2022-04-18 22:24:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491123540398080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:24:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491144503529472[0;39m start updating Ebook doc
2022-04-18 22:24:35.152 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491144503529472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:24:35.153 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491144503529472[0;39m ==> Parameters: 
2022-04-18 22:24:35.236 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491144503529472[0;39m <==    Updates: 1
2022-04-18 22:24:35.236 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491144503529472[0;39m update ends, take 235 millisecs
2022-04-18 22:24:35.237 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491145493385216[0;39m 生成今日电子书快照开始
2022-04-18 22:24:35.237 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491145493385216[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:35.237 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491145493385216[0;39m ==> Parameters: 
2022-04-18 22:24:35.440 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491145493385216[0;39m <==    Updates: 0
2022-04-18 22:24:35.441 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491145493385216[0;39m 生成今日电子书快照结束，耗时：204毫秒
2022-04-18 22:24:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491165491826688[0;39m 生成今日电子书快照开始
2022-04-18 22:24:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491165491826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491165491826688[0;39m ==> Parameters: 
2022-04-18 22:24:40.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491165491826688[0;39m <==    Updates: 0
2022-04-18 22:24:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491165491826688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:24:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491186463346688[0;39m 生成今日电子书快照开始
2022-04-18 22:24:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491186463346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491186463346688[0;39m ==> Parameters: 
2022-04-18 22:24:45.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491186463346688[0;39m <==    Updates: 0
2022-04-18 22:24:45.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491186463346688[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 22:24:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491207430672384[0;39m 生成今日电子书快照开始
2022-04-18 22:24:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491207430672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491207430672384[0;39m ==> Parameters: 
2022-04-18 22:24:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491207430672384[0;39m <==    Updates: 0
2022-04-18 22:24:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491207430672384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:24:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491228389609472[0;39m 生成今日电子书快照开始
2022-04-18 22:24:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491228389609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:24:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491228389609472[0;39m ==> Parameters: 
2022-04-18 22:24:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491228389609472[0;39m <==    Updates: 0
2022-04-18 22:24:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491228389609472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:25:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491249373712384[0;39m 生成今日电子书快照开始
2022-04-18 22:25:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491249373712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491249373712384[0;39m ==> Parameters: 
2022-04-18 22:25:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491249373712384[0;39m <==    Updates: 0
2022-04-18 22:25:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491249373712384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:25:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491270345232384[0;39m start updating Ebook doc
2022-04-18 22:25:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491270345232384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:25:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491270345232384[0;39m ==> Parameters: 
2022-04-18 22:25:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491270345232384[0;39m <==    Updates: 1
2022-04-18 22:25:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491270345232384[0;39m update ends, take 60 millisecs
2022-04-18 22:25:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491270601084928[0;39m 生成今日电子书快照开始
2022-04-18 22:25:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491270601084928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491270601084928[0;39m ==> Parameters: 
2022-04-18 22:25:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491270601084928[0;39m <==    Updates: 0
2022-04-18 22:25:05.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491270601084928[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:25:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491291320946688[0;39m 生成今日电子书快照开始
2022-04-18 22:25:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491291320946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491291320946688[0;39m ==> Parameters: 
2022-04-18 22:25:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491291320946688[0;39m <==    Updates: 0
2022-04-18 22:25:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491291320946688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:25:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491312288272384[0;39m 生成今日电子书快照开始
2022-04-18 22:25:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491312288272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491312288272384[0;39m ==> Parameters: 
2022-04-18 22:25:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491312288272384[0;39m <==    Updates: 0
2022-04-18 22:25:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491312288272384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:25:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491333263986688[0;39m 生成今日电子书快照开始
2022-04-18 22:25:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491333263986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491333263986688[0;39m ==> Parameters: 
2022-04-18 22:25:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491333263986688[0;39m <==    Updates: 0
2022-04-18 22:25:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491333263986688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:25:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491354235506688[0;39m 生成今日电子书快照开始
2022-04-18 22:25:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491354235506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491354235506688[0;39m ==> Parameters: 
2022-04-18 22:25:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491354235506688[0;39m <==    Updates: 0
2022-04-18 22:25:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491354235506688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:25:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491375207026688[0;39m 生成今日电子书快照开始
2022-04-18 22:25:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491375207026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491375207026688[0;39m ==> Parameters: 
2022-04-18 22:25:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491375207026688[0;39m <==    Updates: 0
2022-04-18 22:25:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491375207026688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:25:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491396165963776[0;39m start updating Ebook doc
2022-04-18 22:25:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491396165963776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:25:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491396165963776[0;39m ==> Parameters: 
2022-04-18 22:25:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491396165963776[0;39m <==    Updates: 1
2022-04-18 22:25:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491396165963776[0;39m update ends, take 68 millisecs
2022-04-18 22:25:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491396455370752[0;39m 生成今日电子书快照开始
2022-04-18 22:25:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491396455370752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491396455370752[0;39m ==> Parameters: 
2022-04-18 22:25:35.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491396455370752[0;39m <==    Updates: 0
2022-04-18 22:25:35.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491396455370752[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:25:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491417133289472[0;39m 生成今日电子书快照开始
2022-04-18 22:25:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491417133289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491417133289472[0;39m ==> Parameters: 
2022-04-18 22:25:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491417133289472[0;39m <==    Updates: 0
2022-04-18 22:25:40.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491417133289472[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 22:25:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491438117392384[0;39m 生成今日电子书快照开始
2022-04-18 22:25:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491438117392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491438117392384[0;39m ==> Parameters: 
2022-04-18 22:25:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491438117392384[0;39m <==    Updates: 0
2022-04-18 22:25:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491438117392384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:25:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491459076329472[0;39m 生成今日电子书快照开始
2022-04-18 22:25:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491459076329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491459076329472[0;39m ==> Parameters: 
2022-04-18 22:25:50.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491459076329472[0;39m <==    Updates: 0
2022-04-18 22:25:50.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491459076329472[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 22:25:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491480060432384[0;39m 生成今日电子书快照开始
2022-04-18 22:25:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491480060432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:25:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491480060432384[0;39m ==> Parameters: 
2022-04-18 22:25:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491480060432384[0;39m <==    Updates: 0
2022-04-18 22:25:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491480060432384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:26:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491501019369472[0;39m 生成今日电子书快照开始
2022-04-18 22:26:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491501019369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491501019369472[0;39m ==> Parameters: 
2022-04-18 22:26:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491501019369472[0;39m <==    Updates: 0
2022-04-18 22:26:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491501019369472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:26:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491521995083776[0;39m 生成今日电子书快照开始
2022-04-18 22:26:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491521995083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491521995083776[0;39m ==> Parameters: 
2022-04-18 22:26:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491521995083776[0;39m <==    Updates: 0
2022-04-18 22:26:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491521995083776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:26:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491522234159104[0;39m start updating Ebook doc
2022-04-18 22:26:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491522234159104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:26:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491522234159104[0;39m ==> Parameters: 
2022-04-18 22:26:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491522234159104[0;39m <==    Updates: 1
2022-04-18 22:26:05.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491522234159104[0;39m update ends, take 42 millisecs
2022-04-18 22:26:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491542970798080[0;39m 生成今日电子书快照开始
2022-04-18 22:26:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491542970798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491542970798080[0;39m ==> Parameters: 
2022-04-18 22:26:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491542970798080[0;39m <==    Updates: 0
2022-04-18 22:26:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491542970798080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:26:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491563933929472[0;39m 生成今日电子书快照开始
2022-04-18 22:26:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491563933929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491563933929472[0;39m ==> Parameters: 
2022-04-18 22:26:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491563933929472[0;39m <==    Updates: 0
2022-04-18 22:26:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491563933929472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:26:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491584913838080[0;39m 生成今日电子书快照开始
2022-04-18 22:26:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491584913838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491584913838080[0;39m ==> Parameters: 
2022-04-18 22:26:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491584913838080[0;39m <==    Updates: 0
2022-04-18 22:26:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491584913838080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:26:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491605876969472[0;39m 生成今日电子书快照开始
2022-04-18 22:26:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491605876969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491605876969472[0;39m ==> Parameters: 
2022-04-18 22:26:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491605876969472[0;39m <==    Updates: 0
2022-04-18 22:26:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491605876969472[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:26:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491626865266688[0;39m 生成今日电子书快照开始
2022-04-18 22:26:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491626865266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491626865266688[0;39m ==> Parameters: 
2022-04-18 22:26:30.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491626865266688[0;39m <==    Updates: 0
2022-04-18 22:26:30.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491626865266688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:26:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491647828398080[0;39m start updating Ebook doc
2022-04-18 22:26:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491647828398080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:26:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491647828398080[0;39m ==> Parameters: 
2022-04-18 22:26:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491647828398080[0;39m <==    Updates: 1
2022-04-18 22:26:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491647828398080[0;39m update ends, take 65 millisecs
2022-04-18 22:26:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491648105222144[0;39m 生成今日电子书快照开始
2022-04-18 22:26:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491648105222144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491648105222144[0;39m ==> Parameters: 
2022-04-18 22:26:35.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491648105222144[0;39m <==    Updates: 0
2022-04-18 22:26:35.114 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491648105222144[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:26:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491668804112384[0;39m 生成今日电子书快照开始
2022-04-18 22:26:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491668804112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491668804112384[0;39m ==> Parameters: 
2022-04-18 22:26:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491668804112384[0;39m <==    Updates: 0
2022-04-18 22:26:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491668804112384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:26:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491689771438080[0;39m 生成今日电子书快照开始
2022-04-18 22:26:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491689771438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491689771438080[0;39m ==> Parameters: 
2022-04-18 22:26:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491689771438080[0;39m <==    Updates: 0
2022-04-18 22:26:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491689771438080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:26:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491710738763776[0;39m 生成今日电子书快照开始
2022-04-18 22:26:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491710738763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491710738763776[0;39m ==> Parameters: 
2022-04-18 22:26:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491710738763776[0;39m <==    Updates: 0
2022-04-18 22:26:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491710738763776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:26:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491731706089472[0;39m 生成今日电子书快照开始
2022-04-18 22:26:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491731706089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:26:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491731706089472[0;39m ==> Parameters: 
2022-04-18 22:26:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491731706089472[0;39m <==    Updates: 0
2022-04-18 22:26:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491731706089472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:27:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491752681803776[0;39m 生成今日电子书快照开始
2022-04-18 22:27:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491752681803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491752681803776[0;39m ==> Parameters: 
2022-04-18 22:27:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491752681803776[0;39m <==    Updates: 0
2022-04-18 22:27:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491752681803776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:27:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491773657518080[0;39m start updating Ebook doc
2022-04-18 22:27:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491773657518080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:27:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491773657518080[0;39m ==> Parameters: 
2022-04-18 22:27:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491773657518080[0;39m <==    Updates: 1
2022-04-18 22:27:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491773657518080[0;39m update ends, take 62 millisecs
2022-04-18 22:27:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491773921759232[0;39m 生成今日电子书快照开始
2022-04-18 22:27:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491773921759232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491773921759232[0;39m ==> Parameters: 
2022-04-18 22:27:05.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491773921759232[0;39m <==    Updates: 0
2022-04-18 22:27:05.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491773921759232[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:27:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491794633232384[0;39m 生成今日电子书快照开始
2022-04-18 22:27:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491794633232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491794633232384[0;39m ==> Parameters: 
2022-04-18 22:27:10.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491794633232384[0;39m <==    Updates: 0
2022-04-18 22:27:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491794633232384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:27:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491815592169472[0;39m 生成今日电子书快照开始
2022-04-18 22:27:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491815592169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491815592169472[0;39m ==> Parameters: 
2022-04-18 22:27:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491815592169472[0;39m <==    Updates: 0
2022-04-18 22:27:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491815592169472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:27:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491836563689472[0;39m 生成今日电子书快照开始
2022-04-18 22:27:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491836563689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491836563689472[0;39m ==> Parameters: 
2022-04-18 22:27:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491836563689472[0;39m <==    Updates: 0
2022-04-18 22:27:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491836563689472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:27:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491857531015168[0;39m 生成今日电子书快照开始
2022-04-18 22:27:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491857531015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491857531015168[0;39m ==> Parameters: 
2022-04-18 22:27:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491857531015168[0;39m <==    Updates: 0
2022-04-18 22:27:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491857531015168[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:27:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491878506729472[0;39m 生成今日电子书快照开始
2022-04-18 22:27:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491878506729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491878506729472[0;39m ==> Parameters: 
2022-04-18 22:27:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491878506729472[0;39m <==    Updates: 0
2022-04-18 22:27:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491878506729472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:27:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491899478249472[0;39m 生成今日电子书快照开始
2022-04-18 22:27:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491899478249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491899478249472[0;39m ==> Parameters: 
2022-04-18 22:27:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491899478249472[0;39m <==    Updates: 0
2022-04-18 22:27:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491899478249472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:27:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171491899742490624[0;39m start updating Ebook doc
2022-04-18 22:27:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491899742490624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:27:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491899742490624[0;39m ==> Parameters: 
2022-04-18 22:27:35.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171491899742490624[0;39m <==    Updates: 1
2022-04-18 22:27:35.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171491899742490624[0;39m update ends, take 37 millisecs
2022-04-18 22:27:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491920458158080[0;39m 生成今日电子书快照开始
2022-04-18 22:27:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491920458158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491920458158080[0;39m ==> Parameters: 
2022-04-18 22:27:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491920458158080[0;39m <==    Updates: 0
2022-04-18 22:27:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491920458158080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:27:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491941421289472[0;39m 生成今日电子书快照开始
2022-04-18 22:27:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491941421289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491941421289472[0;39m ==> Parameters: 
2022-04-18 22:27:45.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491941421289472[0;39m <==    Updates: 0
2022-04-18 22:27:45.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491941421289472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 22:27:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491962392809472[0;39m 生成今日电子书快照开始
2022-04-18 22:27:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491962392809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491962392809472[0;39m ==> Parameters: 
2022-04-18 22:27:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491962392809472[0;39m <==    Updates: 0
2022-04-18 22:27:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491962392809472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:27:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171491983372718080[0;39m 生成今日电子书快照开始
2022-04-18 22:27:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491983372718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:27:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491983372718080[0;39m ==> Parameters: 
2022-04-18 22:27:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171491983372718080[0;39m <==    Updates: 0
2022-04-18 22:27:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171491983372718080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:28:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492004348432384[0;39m 生成今日电子书快照开始
2022-04-18 22:28:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492004348432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492004348432384[0;39m ==> Parameters: 
2022-04-18 22:28:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492004348432384[0;39m <==    Updates: 0
2022-04-18 22:28:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492004348432384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:28:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492025311563776[0;39m start updating Ebook doc
2022-04-18 22:28:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492025311563776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:28:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492025311563776[0;39m ==> Parameters: 
2022-04-18 22:28:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492025311563776[0;39m <==    Updates: 1
2022-04-18 22:28:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492025311563776[0;39m update ends, take 65 millisecs
2022-04-18 22:28:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492025584193536[0;39m 生成今日电子书快照开始
2022-04-18 22:28:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492025584193536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492025584193536[0;39m ==> Parameters: 
2022-04-18 22:28:05.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492025584193536[0;39m <==    Updates: 0
2022-04-18 22:28:05.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492025584193536[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:28:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492046278889472[0;39m 生成今日电子书快照开始
2022-04-18 22:28:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492046278889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492046278889472[0;39m ==> Parameters: 
2022-04-18 22:28:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492046278889472[0;39m <==    Updates: 0
2022-04-18 22:28:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492046278889472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:28:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492067262992384[0;39m 生成今日电子书快照开始
2022-04-18 22:28:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492067262992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492067262992384[0;39m ==> Parameters: 
2022-04-18 22:28:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492067262992384[0;39m <==    Updates: 0
2022-04-18 22:28:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492067262992384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:28:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492088221929472[0;39m 生成今日电子书快照开始
2022-04-18 22:28:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492088221929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492088221929472[0;39m ==> Parameters: 
2022-04-18 22:28:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492088221929472[0;39m <==    Updates: 0
2022-04-18 22:28:20.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492088221929472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:28:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492109193449472[0;39m 生成今日电子书快照开始
2022-04-18 22:28:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492109193449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492109193449472[0;39m ==> Parameters: 
2022-04-18 22:28:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492109193449472[0;39m <==    Updates: 0
2022-04-18 22:28:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492109193449472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:28:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492130160775168[0;39m 生成今日电子书快照开始
2022-04-18 22:28:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492130160775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492130160775168[0;39m ==> Parameters: 
2022-04-18 22:28:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492130160775168[0;39m <==    Updates: 0
2022-04-18 22:28:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492130160775168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:28:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492151136489472[0;39m start updating Ebook doc
2022-04-18 22:28:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492151136489472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:28:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492151136489472[0;39m ==> Parameters: 
2022-04-18 22:28:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492151136489472[0;39m <==    Updates: 1
2022-04-18 22:28:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492151136489472[0;39m update ends, take 57 millisecs
2022-04-18 22:28:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492151379759104[0;39m 生成今日电子书快照开始
2022-04-18 22:28:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492151379759104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492151379759104[0;39m ==> Parameters: 
2022-04-18 22:28:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492151379759104[0;39m <==    Updates: 0
2022-04-18 22:28:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492151379759104[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 22:28:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492172124786688[0;39m 生成今日电子书快照开始
2022-04-18 22:28:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492172124786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492172124786688[0;39m ==> Parameters: 
2022-04-18 22:28:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492172124786688[0;39m <==    Updates: 0
2022-04-18 22:28:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492172124786688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:28:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492193079529472[0;39m 生成今日电子书快照开始
2022-04-18 22:28:45.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492193079529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:45.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492193079529472[0;39m ==> Parameters: 
2022-04-18 22:28:45.156 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492193079529472[0;39m <==    Updates: 0
2022-04-18 22:28:45.157 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492193079529472[0;39m 生成今日电子书快照结束，耗时：155毫秒
2022-04-18 22:28:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492214067826688[0;39m 生成今日电子书快照开始
2022-04-18 22:28:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492214067826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492214067826688[0;39m ==> Parameters: 
2022-04-18 22:28:50.280 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492214067826688[0;39m <==    Updates: 0
2022-04-18 22:28:50.281 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492214067826688[0;39m 生成今日电子书快照结束，耗时：276毫秒
2022-04-18 22:28:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492235022569472[0;39m 生成今日电子书快照开始
2022-04-18 22:28:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492235022569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:28:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492235022569472[0;39m ==> Parameters: 
2022-04-18 22:28:55.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492235022569472[0;39m <==    Updates: 0
2022-04-18 22:28:55.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492235022569472[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 22:29:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492256010866688[0;39m 生成今日电子书快照开始
2022-04-18 22:29:00.157 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492256010866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:00.158 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492256010866688[0;39m ==> Parameters: 
2022-04-18 22:29:00.197 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492256010866688[0;39m <==    Updates: 0
2022-04-18 22:29:00.198 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492256010866688[0;39m 生成今日电子书快照结束，耗时：193毫秒
2022-04-18 22:29:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492276978192384[0;39m start updating Ebook doc
2022-04-18 22:29:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492276978192384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:29:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492276978192384[0;39m ==> Parameters: 
2022-04-18 22:29:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492276978192384[0;39m <==    Updates: 1
2022-04-18 22:29:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492276978192384[0;39m update ends, take 58 millisecs
2022-04-18 22:29:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492277225656320[0;39m 生成今日电子书快照开始
2022-04-18 22:29:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492277225656320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492277225656320[0;39m ==> Parameters: 
2022-04-18 22:29:05.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492277225656320[0;39m <==    Updates: 0
2022-04-18 22:29:05.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492277225656320[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:29:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492297953906688[0;39m 生成今日电子书快照开始
2022-04-18 22:29:10.222 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492297953906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:10.222 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492297953906688[0;39m ==> Parameters: 
2022-04-18 22:29:10.263 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492297953906688[0;39m <==    Updates: 0
2022-04-18 22:29:10.264 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492297953906688[0;39m 生成今日电子书快照结束，耗时：259毫秒
2022-04-18 22:29:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492318908649472[0;39m 生成今日电子书快照开始
2022-04-18 22:29:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492318908649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492318908649472[0;39m ==> Parameters: 
2022-04-18 22:29:15.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492318908649472[0;39m <==    Updates: 0
2022-04-18 22:29:15.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492318908649472[0;39m 生成今日电子书快照结束，耗时：85毫秒
2022-04-18 22:29:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492339880169472[0;39m 生成今日电子书快照开始
2022-04-18 22:29:20.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492339880169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:20.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492339880169472[0;39m ==> Parameters: 
2022-04-18 22:29:20.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492339880169472[0;39m <==    Updates: 0
2022-04-18 22:29:20.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492339880169472[0;39m 生成今日电子书快照结束，耗时：97毫秒
2022-04-18 22:29:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492360851689472[0;39m 生成今日电子书快照开始
2022-04-18 22:29:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492360851689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:25.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492360851689472[0;39m ==> Parameters: 
2022-04-18 22:29:25.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492360851689472[0;39m <==    Updates: 0
2022-04-18 22:29:25.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492360851689472[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-18 22:29:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492381835792384[0;39m 生成今日电子书快照开始
2022-04-18 22:29:30.139 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492381835792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:30.140 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492381835792384[0;39m ==> Parameters: 
2022-04-18 22:29:30.181 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492381835792384[0;39m <==    Updates: 0
2022-04-18 22:29:30.182 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492381835792384[0;39m 生成今日电子书快照结束，耗时：177毫秒
2022-04-18 22:29:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492402798923776[0;39m 生成今日电子书快照开始
2022-04-18 22:29:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492402798923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492402798923776[0;39m ==> Parameters: 
2022-04-18 22:29:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492402798923776[0;39m <==    Updates: 0
2022-04-18 22:29:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492402798923776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:29:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492403079942144[0;39m start updating Ebook doc
2022-04-18 22:29:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492403079942144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:29:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492403079942144[0;39m ==> Parameters: 
2022-04-18 22:29:35.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492403079942144[0;39m <==    Updates: 1
2022-04-18 22:29:35.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492403079942144[0;39m update ends, take 50 millisecs
2022-04-18 22:29:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492423774638080[0;39m 生成今日电子书快照开始
2022-04-18 22:29:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492423774638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492423774638080[0;39m ==> Parameters: 
2022-04-18 22:29:40.193 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492423774638080[0;39m <==    Updates: 0
2022-04-18 22:29:40.193 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492423774638080[0;39m 生成今日电子书快照结束，耗时：190毫秒
2022-04-18 22:29:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492444750352384[0;39m 生成今日电子书快照开始
2022-04-18 22:29:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492444750352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492444750352384[0;39m ==> Parameters: 
2022-04-18 22:29:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492444750352384[0;39m <==    Updates: 0
2022-04-18 22:29:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492444750352384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:29:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492465721872384[0;39m 生成今日电子书快照开始
2022-04-18 22:29:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492465721872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492465721872384[0;39m ==> Parameters: 
2022-04-18 22:29:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492465721872384[0;39m <==    Updates: 0
2022-04-18 22:29:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492465721872384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 22:29:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492486697586688[0;39m 生成今日电子书快照开始
2022-04-18 22:29:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492486697586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:29:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492486697586688[0;39m ==> Parameters: 
2022-04-18 22:29:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492486697586688[0;39m <==    Updates: 0
2022-04-18 22:29:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492486697586688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:30:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492507652329472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492507652329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492507652329472[0;39m ==> Parameters: 
2022-04-18 22:30:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492507652329472[0;39m <==    Updates: 0
2022-04-18 22:30:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492507652329472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:30:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492528623849472[0;39m start updating Ebook doc
2022-04-18 22:30:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492528623849472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:30:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492528623849472[0;39m ==> Parameters: 
2022-04-18 22:30:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492528623849472[0;39m <==    Updates: 1
2022-04-18 22:30:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492528623849472[0;39m update ends, take 62 millisecs
2022-04-18 22:30:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492528883896320[0;39m 生成今日电子书快照开始
2022-04-18 22:30:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492528883896320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492528883896320[0;39m ==> Parameters: 
2022-04-18 22:30:05.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492528883896320[0;39m <==    Updates: 0
2022-04-18 22:30:05.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492528883896320[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 22:30:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492549595369472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492549595369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492549595369472[0;39m ==> Parameters: 
2022-04-18 22:30:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492549595369472[0;39m <==    Updates: 0
2022-04-18 22:30:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492549595369472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:30:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492570579472384[0;39m 生成今日电子书快照开始
2022-04-18 22:30:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492570579472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492570579472384[0;39m ==> Parameters: 
2022-04-18 22:30:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492570579472384[0;39m <==    Updates: 0
2022-04-18 22:30:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492570579472384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:30:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492591538409472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492591538409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492591538409472[0;39m ==> Parameters: 
2022-04-18 22:30:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492591538409472[0;39m <==    Updates: 0
2022-04-18 22:30:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492591538409472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:30:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492612518318080[0;39m 生成今日电子书快照开始
2022-04-18 22:30:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492612518318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492612518318080[0;39m ==> Parameters: 
2022-04-18 22:30:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492612518318080[0;39m <==    Updates: 0
2022-04-18 22:30:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492612518318080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:30:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492633481449472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492633481449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492633481449472[0;39m ==> Parameters: 
2022-04-18 22:30:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492633481449472[0;39m <==    Updates: 0
2022-04-18 22:30:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492633481449472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:30:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492654452969472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492654452969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492654452969472[0;39m ==> Parameters: 
2022-04-18 22:30:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492654452969472[0;39m <==    Updates: 0
2022-04-18 22:30:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492654452969472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:30:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492654708822016[0;39m start updating Ebook doc
2022-04-18 22:30:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492654708822016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:30:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492654708822016[0;39m ==> Parameters: 
2022-04-18 22:30:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492654708822016[0;39m <==    Updates: 1
2022-04-18 22:30:35.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492654708822016[0;39m update ends, take 37 millisecs
2022-04-18 22:30:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492675437072384[0;39m 生成今日电子书快照开始
2022-04-18 22:30:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492675437072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492675437072384[0;39m ==> Parameters: 
2022-04-18 22:30:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492675437072384[0;39m <==    Updates: 0
2022-04-18 22:30:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492675437072384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:30:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492696408592384[0;39m 生成今日电子书快照开始
2022-04-18 22:30:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492696408592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492696408592384[0;39m ==> Parameters: 
2022-04-18 22:30:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492696408592384[0;39m <==    Updates: 0
2022-04-18 22:30:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492696408592384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:30:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492717367529472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492717367529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492717367529472[0;39m ==> Parameters: 
2022-04-18 22:30:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492717367529472[0;39m <==    Updates: 0
2022-04-18 22:30:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492717367529472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:30:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492738339049472[0;39m 生成今日电子书快照开始
2022-04-18 22:30:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492738339049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:30:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492738339049472[0;39m ==> Parameters: 
2022-04-18 22:30:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492738339049472[0;39m <==    Updates: 0
2022-04-18 22:30:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492738339049472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:31:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492759314763776[0;39m 生成今日电子书快照开始
2022-04-18 22:31:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492759314763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492759314763776[0;39m ==> Parameters: 
2022-04-18 22:31:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492759314763776[0;39m <==    Updates: 0
2022-04-18 22:31:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492759314763776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:31:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492780282089472[0;39m start updating Ebook doc
2022-04-18 22:31:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492780282089472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:31:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492780282089472[0;39m ==> Parameters: 
2022-04-18 22:31:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492780282089472[0;39m <==    Updates: 1
2022-04-18 22:31:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492780282089472[0;39m update ends, take 60 millisecs
2022-04-18 22:31:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492780537942016[0;39m 生成今日电子书快照开始
2022-04-18 22:31:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492780537942016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492780537942016[0;39m ==> Parameters: 
2022-04-18 22:31:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492780537942016[0;39m <==    Updates: 0
2022-04-18 22:31:05.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492780537942016[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 22:31:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492801253609472[0;39m 生成今日电子书快照开始
2022-04-18 22:31:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492801253609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492801253609472[0;39m ==> Parameters: 
2022-04-18 22:31:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492801253609472[0;39m <==    Updates: 0
2022-04-18 22:31:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492801253609472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:31:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492822225129472[0;39m 生成今日电子书快照开始
2022-04-18 22:31:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492822225129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492822225129472[0;39m ==> Parameters: 
2022-04-18 22:31:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492822225129472[0;39m <==    Updates: 0
2022-04-18 22:31:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492822225129472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:31:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492843209232384[0;39m 生成今日电子书快照开始
2022-04-18 22:31:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492843209232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492843209232384[0;39m ==> Parameters: 
2022-04-18 22:31:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492843209232384[0;39m <==    Updates: 0
2022-04-18 22:31:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492843209232384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:31:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492864172363776[0;39m 生成今日电子书快照开始
2022-04-18 22:31:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492864172363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492864172363776[0;39m ==> Parameters: 
2022-04-18 22:31:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492864172363776[0;39m <==    Updates: 0
2022-04-18 22:31:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492864172363776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:31:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492885152272384[0;39m 生成今日电子书快照开始
2022-04-18 22:31:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492885152272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492885152272384[0;39m ==> Parameters: 
2022-04-18 22:31:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492885152272384[0;39m <==    Updates: 0
2022-04-18 22:31:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492885152272384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:31:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492906107015168[0;39m 生成今日电子书快照开始
2022-04-18 22:31:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492906107015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492906107015168[0;39m ==> Parameters: 
2022-04-18 22:31:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492906107015168[0;39m <==    Updates: 0
2022-04-18 22:31:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492906107015168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:31:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171492906341896192[0;39m start updating Ebook doc
2022-04-18 22:31:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492906341896192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:31:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492906341896192[0;39m ==> Parameters: 
2022-04-18 22:31:35.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171492906341896192[0;39m <==    Updates: 1
2022-04-18 22:31:35.090 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171492906341896192[0;39m update ends, take 34 millisecs
2022-04-18 22:31:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492927082729472[0;39m 生成今日电子书快照开始
2022-04-18 22:31:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492927082729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492927082729472[0;39m ==> Parameters: 
2022-04-18 22:31:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492927082729472[0;39m <==    Updates: 0
2022-04-18 22:31:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492927082729472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:31:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492948050055168[0;39m 生成今日电子书快照开始
2022-04-18 22:31:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492948050055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492948050055168[0;39m ==> Parameters: 
2022-04-18 22:31:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492948050055168[0;39m <==    Updates: 0
2022-04-18 22:31:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492948050055168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:31:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492969021575168[0;39m 生成今日电子书快照开始
2022-04-18 22:31:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492969021575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492969021575168[0;39m ==> Parameters: 
2022-04-18 22:31:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492969021575168[0;39m <==    Updates: 0
2022-04-18 22:31:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492969021575168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:31:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171492989997289472[0;39m 生成今日电子书快照开始
2022-04-18 22:31:55.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492989997289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:31:55.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492989997289472[0;39m ==> Parameters: 
2022-04-18 22:31:55.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171492989997289472[0;39m <==    Updates: 0
2022-04-18 22:31:55.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171492989997289472[0;39m 生成今日电子书快照结束，耗时：115毫秒
2022-04-18 22:32:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493010973003776[0;39m 生成今日电子书快照开始
2022-04-18 22:32:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493010973003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493010973003776[0;39m ==> Parameters: 
2022-04-18 22:32:00.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493010973003776[0;39m <==    Updates: 0
2022-04-18 22:32:00.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493010973003776[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 22:32:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493031944523776[0;39m 生成今日电子书快照开始
2022-04-18 22:32:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493031944523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493031944523776[0;39m ==> Parameters: 
2022-04-18 22:32:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493031944523776[0;39m <==    Updates: 0
2022-04-18 22:32:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493031944523776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:32:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493032250707968[0;39m start updating Ebook doc
2022-04-18 22:32:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493032250707968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:32:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493032250707968[0;39m ==> Parameters: 
2022-04-18 22:32:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493032250707968[0;39m <==    Updates: 1
2022-04-18 22:32:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493032250707968[0;39m update ends, take 39 millisecs
2022-04-18 22:32:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493052924432384[0;39m 生成今日电子书快照开始
2022-04-18 22:32:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493052924432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493052924432384[0;39m ==> Parameters: 
2022-04-18 22:32:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493052924432384[0;39m <==    Updates: 0
2022-04-18 22:32:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493052924432384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:32:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493073895952384[0;39m 生成今日电子书快照开始
2022-04-18 22:32:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493073895952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493073895952384[0;39m ==> Parameters: 
2022-04-18 22:32:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493073895952384[0;39m <==    Updates: 0
2022-04-18 22:32:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493073895952384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:32:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493094859083776[0;39m 生成今日电子书快照开始
2022-04-18 22:32:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493094859083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493094859083776[0;39m ==> Parameters: 
2022-04-18 22:32:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493094859083776[0;39m <==    Updates: 0
2022-04-18 22:32:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493094859083776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:32:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493115838992384[0;39m 生成今日电子书快照开始
2022-04-18 22:32:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493115838992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493115838992384[0;39m ==> Parameters: 
2022-04-18 22:32:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493115838992384[0;39m <==    Updates: 0
2022-04-18 22:32:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493115838992384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:32:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493136814706688[0;39m 生成今日电子书快照开始
2022-04-18 22:32:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493136814706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493136814706688[0;39m ==> Parameters: 
2022-04-18 22:32:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493136814706688[0;39m <==    Updates: 0
2022-04-18 22:32:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493136814706688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:32:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493157765255168[0;39m 生成今日电子书快照开始
2022-04-18 22:32:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493157765255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493157765255168[0;39m ==> Parameters: 
2022-04-18 22:32:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493157765255168[0;39m <==    Updates: 0
2022-04-18 22:32:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493157765255168[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:32:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493158058856448[0;39m start updating Ebook doc
2022-04-18 22:32:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493158058856448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:32:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493158058856448[0;39m ==> Parameters: 
2022-04-18 22:32:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493158058856448[0;39m <==    Updates: 1
2022-04-18 22:32:35.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493158058856448[0;39m update ends, take 39 millisecs
2022-04-18 22:32:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493178745163776[0;39m 生成今日电子书快照开始
2022-04-18 22:32:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493178745163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493178745163776[0;39m ==> Parameters: 
2022-04-18 22:32:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493178745163776[0;39m <==    Updates: 0
2022-04-18 22:32:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493178745163776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:32:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493199716683776[0;39m 生成今日电子书快照开始
2022-04-18 22:32:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493199716683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493199716683776[0;39m ==> Parameters: 
2022-04-18 22:32:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493199716683776[0;39m <==    Updates: 0
2022-04-18 22:32:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493199716683776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:32:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493220679815168[0;39m 生成今日电子书快照开始
2022-04-18 22:32:50.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493220679815168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:50.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493220679815168[0;39m ==> Parameters: 
2022-04-18 22:32:50.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493220679815168[0;39m <==    Updates: 0
2022-04-18 22:32:50.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493220679815168[0;39m 生成今日电子书快照结束，耗时：109毫秒
2022-04-18 22:32:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493241651335168[0;39m 生成今日电子书快照开始
2022-04-18 22:32:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493241651335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:32:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493241651335168[0;39m ==> Parameters: 
2022-04-18 22:32:55.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493241651335168[0;39m <==    Updates: 0
2022-04-18 22:32:55.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493241651335168[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-18 22:33:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493262627049472[0;39m 生成今日电子书快照开始
2022-04-18 22:33:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493262627049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493262627049472[0;39m ==> Parameters: 
2022-04-18 22:33:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493262627049472[0;39m <==    Updates: 0
2022-04-18 22:33:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493262627049472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:33:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493283611152384[0;39m 生成今日电子书快照开始
2022-04-18 22:33:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493283611152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493283611152384[0;39m ==> Parameters: 
2022-04-18 22:33:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493283611152384[0;39m <==    Updates: 0
2022-04-18 22:33:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493283611152384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:33:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493283837644800[0;39m start updating Ebook doc
2022-04-18 22:33:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493283837644800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:33:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493283837644800[0;39m ==> Parameters: 
2022-04-18 22:33:05.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493283837644800[0;39m <==    Updates: 1
2022-04-18 22:33:05.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493283837644800[0;39m update ends, take 39 millisecs
2022-04-18 22:33:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493304570089472[0;39m 生成今日电子书快照开始
2022-04-18 22:33:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493304570089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493304570089472[0;39m ==> Parameters: 
2022-04-18 22:33:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493304570089472[0;39m <==    Updates: 0
2022-04-18 22:33:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493304570089472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:33:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493325541609472[0;39m 生成今日电子书快照开始
2022-04-18 22:33:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493325541609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493325541609472[0;39m ==> Parameters: 
2022-04-18 22:33:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493325541609472[0;39m <==    Updates: 0
2022-04-18 22:33:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493325541609472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:33:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493346508935168[0;39m 生成今日电子书快照开始
2022-04-18 22:33:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493346508935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493346508935168[0;39m ==> Parameters: 
2022-04-18 22:33:20.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493346508935168[0;39m <==    Updates: 0
2022-04-18 22:33:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493346508935168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:33:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493367480455168[0;39m 生成今日电子书快照开始
2022-04-18 22:33:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493367480455168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493367480455168[0;39m ==> Parameters: 
2022-04-18 22:33:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493367480455168[0;39m <==    Updates: 0
2022-04-18 22:33:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493367480455168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:33:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493388456169472[0;39m 生成今日电子书快照开始
2022-04-18 22:33:30.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493388456169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493388456169472[0;39m ==> Parameters: 
2022-04-18 22:33:30.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493388456169472[0;39m <==    Updates: 0
2022-04-18 22:33:30.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493388456169472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:33:35.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493409423495168[0;39m start updating Ebook doc
2022-04-18 22:33:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493409423495168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:33:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493409423495168[0;39m ==> Parameters: 
2022-04-18 22:33:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493409423495168[0;39m <==    Updates: 1
2022-04-18 22:33:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493409423495168[0;39m update ends, take 56 millisecs
2022-04-18 22:33:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493409658376192[0;39m 生成今日电子书快照开始
2022-04-18 22:33:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493409658376192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493409658376192[0;39m ==> Parameters: 
2022-04-18 22:33:35.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493409658376192[0;39m <==    Updates: 0
2022-04-18 22:33:35.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493409658376192[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:33:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493430411792384[0;39m 生成今日电子书快照开始
2022-04-18 22:33:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493430411792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493430411792384[0;39m ==> Parameters: 
2022-04-18 22:33:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493430411792384[0;39m <==    Updates: 0
2022-04-18 22:33:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493430411792384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:33:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493451383312384[0;39m 生成今日电子书快照开始
2022-04-18 22:33:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493451383312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493451383312384[0;39m ==> Parameters: 
2022-04-18 22:33:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493451383312384[0;39m <==    Updates: 0
2022-04-18 22:33:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493451383312384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:33:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493472354832384[0;39m 生成今日电子书快照开始
2022-04-18 22:33:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493472354832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493472354832384[0;39m ==> Parameters: 
2022-04-18 22:33:50.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493472354832384[0;39m <==    Updates: 0
2022-04-18 22:33:50.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493472354832384[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-18 22:33:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493493309575168[0;39m 生成今日电子书快照开始
2022-04-18 22:33:55.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493493309575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:33:55.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493493309575168[0;39m ==> Parameters: 
2022-04-18 22:33:55.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493493309575168[0;39m <==    Updates: 0
2022-04-18 22:33:55.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493493309575168[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 22:34:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493514297872384[0;39m 生成今日电子书快照开始
2022-04-18 22:34:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493514297872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493514297872384[0;39m ==> Parameters: 
2022-04-18 22:34:00.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493514297872384[0;39m <==    Updates: 0
2022-04-18 22:34:00.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493514297872384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:34:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493535261003776[0;39m start updating Ebook doc
2022-04-18 22:34:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493535261003776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:34:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493535261003776[0;39m ==> Parameters: 
2022-04-18 22:34:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493535261003776[0;39m <==    Updates: 1
2022-04-18 22:34:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493535261003776[0;39m update ends, take 66 millisecs
2022-04-18 22:34:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493535537827840[0;39m 生成今日电子书快照开始
2022-04-18 22:34:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493535537827840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493535537827840[0;39m ==> Parameters: 
2022-04-18 22:34:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493535537827840[0;39m <==    Updates: 0
2022-04-18 22:34:05.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493535537827840[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:34:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493556224135168[0;39m 生成今日电子书快照开始
2022-04-18 22:34:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493556224135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493556224135168[0;39m ==> Parameters: 
2022-04-18 22:34:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493556224135168[0;39m <==    Updates: 0
2022-04-18 22:34:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493556224135168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:34:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493577216626688[0;39m 生成今日电子书快照开始
2022-04-18 22:34:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493577216626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493577216626688[0;39m ==> Parameters: 
2022-04-18 22:34:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493577216626688[0;39m <==    Updates: 0
2022-04-18 22:34:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493577216626688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:34:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493598179758080[0;39m 生成今日电子书快照开始
2022-04-18 22:34:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493598179758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493598179758080[0;39m ==> Parameters: 
2022-04-18 22:34:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493598179758080[0;39m <==    Updates: 0
2022-04-18 22:34:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493598179758080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:34:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493619151278080[0;39m 生成今日电子书快照开始
2022-04-18 22:34:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493619151278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493619151278080[0;39m ==> Parameters: 
2022-04-18 22:34:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493619151278080[0;39m <==    Updates: 0
2022-04-18 22:34:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493619151278080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:34:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493640110215168[0;39m 生成今日电子书快照开始
2022-04-18 22:34:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493640110215168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493640110215168[0;39m ==> Parameters: 
2022-04-18 22:34:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493640110215168[0;39m <==    Updates: 0
2022-04-18 22:34:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493640110215168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:34:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493661081735168[0;39m 生成今日电子书快照开始
2022-04-18 22:34:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493661081735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493661081735168[0;39m ==> Parameters: 
2022-04-18 22:34:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493661081735168[0;39m <==    Updates: 0
2022-04-18 22:34:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493661081735168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:34:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493661337587712[0;39m start updating Ebook doc
2022-04-18 22:34:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493661337587712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:34:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493661337587712[0;39m ==> Parameters: 
2022-04-18 22:34:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493661337587712[0;39m <==    Updates: 1
2022-04-18 22:34:35.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493661337587712[0;39m update ends, take 56 millisecs
2022-04-18 22:34:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493682074226688[0;39m 生成今日电子书快照开始
2022-04-18 22:34:40.152 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493682074226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:40.153 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493682074226688[0;39m ==> Parameters: 
2022-04-18 22:34:40.189 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493682074226688[0;39m <==    Updates: 0
2022-04-18 22:34:40.189 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493682074226688[0;39m 生成今日电子书快照结束，耗时：184毫秒
2022-04-18 22:34:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493703028969472[0;39m 生成今日电子书快照开始
2022-04-18 22:34:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493703028969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493703028969472[0;39m ==> Parameters: 
2022-04-18 22:34:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493703028969472[0;39m <==    Updates: 0
2022-04-18 22:34:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493703028969472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:34:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493724004683776[0;39m 生成今日电子书快照开始
2022-04-18 22:34:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493724004683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493724004683776[0;39m ==> Parameters: 
2022-04-18 22:34:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493724004683776[0;39m <==    Updates: 0
2022-04-18 22:34:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493724004683776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:34:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493744967815168[0;39m 生成今日电子书快照开始
2022-04-18 22:34:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493744967815168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:34:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493744967815168[0;39m ==> Parameters: 
2022-04-18 22:34:55.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493744967815168[0;39m <==    Updates: 0
2022-04-18 22:34:55.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493744967815168[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 22:35:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493765939335168[0;39m 生成今日电子书快照开始
2022-04-18 22:35:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493765939335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493765939335168[0;39m ==> Parameters: 
2022-04-18 22:35:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493765939335168[0;39m <==    Updates: 0
2022-04-18 22:35:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493765939335168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:35:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493786919243776[0;39m start updating Ebook doc
2022-04-18 22:35:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493786919243776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:35:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493786919243776[0;39m ==> Parameters: 
2022-04-18 22:35:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493786919243776[0;39m <==    Updates: 1
2022-04-18 22:35:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493786919243776[0;39m update ends, take 58 millisecs
2022-04-18 22:35:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493787162513408[0;39m 生成今日电子书快照开始
2022-04-18 22:35:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493787162513408[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493787162513408[0;39m ==> Parameters: 
2022-04-18 22:35:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493787162513408[0;39m <==    Updates: 0
2022-04-18 22:35:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493787162513408[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 22:35:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493807890763776[0;39m 生成今日电子书快照开始
2022-04-18 22:35:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493807890763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493807890763776[0;39m ==> Parameters: 
2022-04-18 22:35:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493807890763776[0;39m <==    Updates: 0
2022-04-18 22:35:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493807890763776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:35:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493828858089472[0;39m 生成今日电子书快照开始
2022-04-18 22:35:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493828858089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493828858089472[0;39m ==> Parameters: 
2022-04-18 22:35:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493828858089472[0;39m <==    Updates: 0
2022-04-18 22:35:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493828858089472[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:35:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493849837998080[0;39m 生成今日电子书快照开始
2022-04-18 22:35:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493849837998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493849837998080[0;39m ==> Parameters: 
2022-04-18 22:35:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493849837998080[0;39m <==    Updates: 0
2022-04-18 22:35:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493849837998080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:35:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493870817906688[0;39m 生成今日电子书快照开始
2022-04-18 22:35:25.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493870817906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:25.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493870817906688[0;39m ==> Parameters: 
2022-04-18 22:35:25.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493870817906688[0;39m <==    Updates: 0
2022-04-18 22:35:25.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493870817906688[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 22:35:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493891772649472[0;39m 生成今日电子书快照开始
2022-04-18 22:35:30.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493891772649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:30.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493891772649472[0;39m ==> Parameters: 
2022-04-18 22:35:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493891772649472[0;39m <==    Updates: 0
2022-04-18 22:35:30.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493891772649472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:35:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171493912752558080[0;39m start updating Ebook doc
2022-04-18 22:35:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493912752558080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:35:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493912752558080[0;39m ==> Parameters: 
2022-04-18 22:35:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171493912752558080[0;39m <==    Updates: 1
2022-04-18 22:35:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171493912752558080[0;39m update ends, take 52 millisecs
2022-04-18 22:35:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493912970661888[0;39m 生成今日电子书快照开始
2022-04-18 22:35:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493912970661888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493912970661888[0;39m ==> Parameters: 
2022-04-18 22:35:35.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493912970661888[0;39m <==    Updates: 0
2022-04-18 22:35:35.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493912970661888[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:35:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493933728272384[0;39m 生成今日电子书快照开始
2022-04-18 22:35:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493933728272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493933728272384[0;39m ==> Parameters: 
2022-04-18 22:35:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493933728272384[0;39m <==    Updates: 0
2022-04-18 22:35:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493933728272384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:35:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493954695598080[0;39m 生成今日电子书快照开始
2022-04-18 22:35:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493954695598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493954695598080[0;39m ==> Parameters: 
2022-04-18 22:35:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493954695598080[0;39m <==    Updates: 0
2022-04-18 22:35:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493954695598080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:35:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493975654535168[0;39m 生成今日电子书快照开始
2022-04-18 22:35:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493975654535168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493975654535168[0;39m ==> Parameters: 
2022-04-18 22:35:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493975654535168[0;39m <==    Updates: 0
2022-04-18 22:35:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493975654535168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:35:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171493996626055168[0;39m 生成今日电子书快照开始
2022-04-18 22:35:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493996626055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:35:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493996626055168[0;39m ==> Parameters: 
2022-04-18 22:35:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171493996626055168[0;39m <==    Updates: 0
2022-04-18 22:35:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171493996626055168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:36:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494017601769472[0;39m 生成今日电子书快照开始
2022-04-18 22:36:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494017601769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494017601769472[0;39m ==> Parameters: 
2022-04-18 22:36:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494017601769472[0;39m <==    Updates: 0
2022-04-18 22:36:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494017601769472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:36:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494038590066688[0;39m start updating Ebook doc
2022-04-18 22:36:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494038590066688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:36:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494038590066688[0;39m ==> Parameters: 
2022-04-18 22:36:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494038590066688[0;39m <==    Updates: 1
2022-04-18 22:36:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494038590066688[0;39m update ends, take 61 millisecs
2022-04-18 22:36:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494038845919232[0;39m 生成今日电子书快照开始
2022-04-18 22:36:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494038845919232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494038845919232[0;39m ==> Parameters: 
2022-04-18 22:36:05.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494038845919232[0;39m <==    Updates: 0
2022-04-18 22:36:05.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494038845919232[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 22:36:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494059553198080[0;39m 生成今日电子书快照开始
2022-04-18 22:36:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494059553198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494059553198080[0;39m ==> Parameters: 
2022-04-18 22:36:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494059553198080[0;39m <==    Updates: 0
2022-04-18 22:36:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494059553198080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:36:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494080512135168[0;39m 生成今日电子书快照开始
2022-04-18 22:36:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494080512135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494080512135168[0;39m ==> Parameters: 
2022-04-18 22:36:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494080512135168[0;39m <==    Updates: 0
2022-04-18 22:36:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494080512135168[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 22:36:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494101487849472[0;39m 生成今日电子书快照开始
2022-04-18 22:36:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494101487849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494101487849472[0;39m ==> Parameters: 
2022-04-18 22:36:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494101487849472[0;39m <==    Updates: 0
2022-04-18 22:36:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494101487849472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:36:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494122459369472[0;39m 生成今日电子书快照开始
2022-04-18 22:36:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494122459369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494122459369472[0;39m ==> Parameters: 
2022-04-18 22:36:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494122459369472[0;39m <==    Updates: 0
2022-04-18 22:36:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494122459369472[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:36:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494143426695168[0;39m 生成今日电子书快照开始
2022-04-18 22:36:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494143426695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494143426695168[0;39m ==> Parameters: 
2022-04-18 22:36:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494143426695168[0;39m <==    Updates: 0
2022-04-18 22:36:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494143426695168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:36:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494164414992384[0;39m start updating Ebook doc
2022-04-18 22:36:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494164414992384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:36:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494164414992384[0;39m ==> Parameters: 
2022-04-18 22:36:35.052 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494164414992384[0;39m <==    Updates: 1
2022-04-18 22:36:35.052 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494164414992384[0;39m update ends, take 48 millisecs
2022-04-18 22:36:35.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494164616318976[0;39m 生成今日电子书快照开始
2022-04-18 22:36:35.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494164616318976[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:35.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494164616318976[0;39m ==> Parameters: 
2022-04-18 22:36:35.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494164616318976[0;39m <==    Updates: 0
2022-04-18 22:36:35.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494164616318976[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 22:36:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494185373929472[0;39m 生成今日电子书快照开始
2022-04-18 22:36:40.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494185373929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494185373929472[0;39m ==> Parameters: 
2022-04-18 22:36:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494185373929472[0;39m <==    Updates: 0
2022-04-18 22:36:40.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494185373929472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:36:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494206349643776[0;39m 生成今日电子书快照开始
2022-04-18 22:36:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494206349643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494206349643776[0;39m ==> Parameters: 
2022-04-18 22:36:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494206349643776[0;39m <==    Updates: 0
2022-04-18 22:36:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494206349643776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:36:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494227329552384[0;39m 生成今日电子书快照开始
2022-04-18 22:36:50.170 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494227329552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:50.171 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494227329552384[0;39m ==> Parameters: 
2022-04-18 22:36:50.213 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494227329552384[0;39m <==    Updates: 0
2022-04-18 22:36:50.214 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494227329552384[0;39m 生成今日电子书快照结束，耗时：209毫秒
2022-04-18 22:36:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494248301072384[0;39m 生成今日电子书快照开始
2022-04-18 22:36:55.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494248301072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:36:55.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494248301072384[0;39m ==> Parameters: 
2022-04-18 22:36:55.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494248301072384[0;39m <==    Updates: 0
2022-04-18 22:36:55.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494248301072384[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-18 22:37:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494269276786688[0;39m 生成今日电子书快照开始
2022-04-18 22:37:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494269276786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494269276786688[0;39m ==> Parameters: 
2022-04-18 22:37:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494269276786688[0;39m <==    Updates: 0
2022-04-18 22:37:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494269276786688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:37:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494290244112384[0;39m start updating Ebook doc
2022-04-18 22:37:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494290244112384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:37:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494290244112384[0;39m ==> Parameters: 
2022-04-18 22:37:05.083 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494290244112384[0;39m <==    Updates: 1
2022-04-18 22:37:05.083 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494290244112384[0;39m update ends, take 79 millisecs
2022-04-18 22:37:05.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494290575462400[0;39m 生成今日电子书快照开始
2022-04-18 22:37:05.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494290575462400[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:05.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494290575462400[0;39m ==> Parameters: 
2022-04-18 22:37:05.125 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494290575462400[0;39m <==    Updates: 0
2022-04-18 22:37:05.125 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494290575462400[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:37:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494311198855168[0;39m 生成今日电子书快照开始
2022-04-18 22:37:10.119 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494311198855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:10.119 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494311198855168[0;39m ==> Parameters: 
2022-04-18 22:37:10.158 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494311198855168[0;39m <==    Updates: 0
2022-04-18 22:37:10.158 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494311198855168[0;39m 生成今日电子书快照结束，耗时：158毫秒
2022-04-18 22:37:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494332187152384[0;39m 生成今日电子书快照开始
2022-04-18 22:37:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494332187152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494332187152384[0;39m ==> Parameters: 
2022-04-18 22:37:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494332187152384[0;39m <==    Updates: 0
2022-04-18 22:37:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494332187152384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 22:37:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494353150283776[0;39m 生成今日电子书快照开始
2022-04-18 22:37:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494353150283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494353150283776[0;39m ==> Parameters: 
2022-04-18 22:37:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494353150283776[0;39m <==    Updates: 0
2022-04-18 22:37:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494353150283776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 22:37:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494374113415168[0;39m 生成今日电子书快照开始
2022-04-18 22:37:25.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494374113415168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:25.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494374113415168[0;39m ==> Parameters: 
2022-04-18 22:37:25.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494374113415168[0;39m <==    Updates: 0
2022-04-18 22:37:25.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494374113415168[0;39m 生成今日电子书快照结束，耗时：95毫秒
2022-04-18 22:37:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494395089129472[0;39m 生成今日电子书快照开始
2022-04-18 22:37:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494395089129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494395089129472[0;39m ==> Parameters: 
2022-04-18 22:37:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494395089129472[0;39m <==    Updates: 0
2022-04-18 22:37:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494395089129472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:37:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494416069038080[0;39m 生成今日电子书快照开始
2022-04-18 22:37:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494416069038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494416069038080[0;39m ==> Parameters: 
2022-04-18 22:37:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494416069038080[0;39m <==    Updates: 0
2022-04-18 22:37:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494416069038080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:37:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494416354250752[0;39m start updating Ebook doc
2022-04-18 22:37:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494416354250752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:37:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494416354250752[0;39m ==> Parameters: 
2022-04-18 22:37:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494416354250752[0;39m <==    Updates: 1
2022-04-18 22:37:35.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494416354250752[0;39m update ends, take 45 millisecs
2022-04-18 22:37:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494437027975168[0;39m 生成今日电子书快照开始
2022-04-18 22:37:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494437027975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494437027975168[0;39m ==> Parameters: 
2022-04-18 22:37:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494437027975168[0;39m <==    Updates: 0
2022-04-18 22:37:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494437027975168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:37:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494458003689472[0;39m 生成今日电子书快照开始
2022-04-18 22:37:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494458003689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494458003689472[0;39m ==> Parameters: 
2022-04-18 22:37:45.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494458003689472[0;39m <==    Updates: 0
2022-04-18 22:37:45.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494458003689472[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 22:37:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494478983598080[0;39m 生成今日电子书快照开始
2022-04-18 22:37:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494478983598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494478983598080[0;39m ==> Parameters: 
2022-04-18 22:37:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494478983598080[0;39m <==    Updates: 0
2022-04-18 22:37:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494478983598080[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 22:37:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494499946729472[0;39m 生成今日电子书快照开始
2022-04-18 22:37:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494499946729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:37:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494499946729472[0;39m ==> Parameters: 
2022-04-18 22:37:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494499946729472[0;39m <==    Updates: 0
2022-04-18 22:37:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494499946729472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:38:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494520922443776[0;39m 生成今日电子书快照开始
2022-04-18 22:38:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494520922443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494520922443776[0;39m ==> Parameters: 
2022-04-18 22:38:00.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494520922443776[0;39m <==    Updates: 0
2022-04-18 22:38:00.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494520922443776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:38:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494541889769472[0;39m 生成今日电子书快照开始
2022-04-18 22:38:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494541889769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494541889769472[0;39m ==> Parameters: 
2022-04-18 22:38:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494541889769472[0;39m <==    Updates: 0
2022-04-18 22:38:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494541889769472[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 22:38:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494542204342272[0;39m start updating Ebook doc
2022-04-18 22:38:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494542204342272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:38:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494542204342272[0;39m ==> Parameters: 
2022-04-18 22:38:05.127 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494542204342272[0;39m <==    Updates: 1
2022-04-18 22:38:05.128 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494542204342272[0;39m update ends, take 52 millisecs
2022-04-18 22:38:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494562873872384[0;39m 生成今日电子书快照开始
2022-04-18 22:38:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494562873872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494562873872384[0;39m ==> Parameters: 
2022-04-18 22:38:10.119 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494562873872384[0;39m <==    Updates: 0
2022-04-18 22:38:10.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494562873872384[0;39m 生成今日电子书快照结束，耗时：116毫秒
2022-04-18 22:38:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494583832809472[0;39m 生成今日电子书快照开始
2022-04-18 22:38:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494583832809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494583832809472[0;39m ==> Parameters: 
2022-04-18 22:38:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494583832809472[0;39m <==    Updates: 0
2022-04-18 22:38:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494583832809472[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:38:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494604816912384[0;39m 生成今日电子书快照开始
2022-04-18 22:38:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494604816912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494604816912384[0;39m ==> Parameters: 
2022-04-18 22:38:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494604816912384[0;39m <==    Updates: 0
2022-04-18 22:38:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494604816912384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:38:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494625780043776[0;39m 生成今日电子书快照开始
2022-04-18 22:38:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494625780043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494625780043776[0;39m ==> Parameters: 
2022-04-18 22:38:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494625780043776[0;39m <==    Updates: 0
2022-04-18 22:38:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494625780043776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:38:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494646764146688[0;39m 生成今日电子书快照开始
2022-04-18 22:38:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494646764146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494646764146688[0;39m ==> Parameters: 
2022-04-18 22:38:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494646764146688[0;39m <==    Updates: 0
2022-04-18 22:38:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494646764146688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:38:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494667723083776[0;39m start updating Ebook doc
2022-04-18 22:38:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494667723083776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:38:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494667723083776[0;39m ==> Parameters: 
2022-04-18 22:38:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494667723083776[0;39m <==    Updates: 1
2022-04-18 22:38:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494667723083776[0;39m update ends, take 72 millisecs
2022-04-18 22:38:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494668029267968[0;39m 生成今日电子书快照开始
2022-04-18 22:38:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494668029267968[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494668029267968[0;39m ==> Parameters: 
2022-04-18 22:38:35.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494668029267968[0;39m <==    Updates: 0
2022-04-18 22:38:35.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494668029267968[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:38:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494688686215168[0;39m 生成今日电子书快照开始
2022-04-18 22:38:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494688686215168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494688686215168[0;39m ==> Parameters: 
2022-04-18 22:38:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494688686215168[0;39m <==    Updates: 0
2022-04-18 22:38:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494688686215168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:38:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494709670318080[0;39m 生成今日电子书快照开始
2022-04-18 22:38:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494709670318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494709670318080[0;39m ==> Parameters: 
2022-04-18 22:38:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494709670318080[0;39m <==    Updates: 0
2022-04-18 22:38:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494709670318080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:38:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494730637643776[0;39m 生成今日电子书快照开始
2022-04-18 22:38:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494730637643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494730637643776[0;39m ==> Parameters: 
2022-04-18 22:38:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494730637643776[0;39m <==    Updates: 0
2022-04-18 22:38:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494730637643776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:38:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494751613358080[0;39m 生成今日电子书快照开始
2022-04-18 22:38:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494751613358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:38:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494751613358080[0;39m ==> Parameters: 
2022-04-18 22:38:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494751613358080[0;39m <==    Updates: 0
2022-04-18 22:38:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494751613358080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:39:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494772584878080[0;39m 生成今日电子书快照开始
2022-04-18 22:39:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494772584878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494772584878080[0;39m ==> Parameters: 
2022-04-18 22:39:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494772584878080[0;39m <==    Updates: 0
2022-04-18 22:39:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494772584878080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:39:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494793556398080[0;39m start updating Ebook doc
2022-04-18 22:39:05.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494793556398080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:39:05.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494793556398080[0;39m ==> Parameters: 
2022-04-18 22:39:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494793556398080[0;39m <==    Updates: 1
2022-04-18 22:39:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494793556398080[0;39m update ends, take 64 millisecs
2022-04-18 22:39:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494793824833536[0;39m 生成今日电子书快照开始
2022-04-18 22:39:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494793824833536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494793824833536[0;39m ==> Parameters: 
2022-04-18 22:39:05.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494793824833536[0;39m <==    Updates: 0
2022-04-18 22:39:05.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494793824833536[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 22:39:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494814515335168[0;39m 生成今日电子书快照开始
2022-04-18 22:39:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494814515335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494814515335168[0;39m ==> Parameters: 
2022-04-18 22:39:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494814515335168[0;39m <==    Updates: 0
2022-04-18 22:39:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494814515335168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:39:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494835491049472[0;39m 生成今日电子书快照开始
2022-04-18 22:39:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494835491049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494835491049472[0;39m ==> Parameters: 
2022-04-18 22:39:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494835491049472[0;39m <==    Updates: 0
2022-04-18 22:39:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494835491049472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:39:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494856458375168[0;39m 生成今日电子书快照开始
2022-04-18 22:39:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494856458375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494856458375168[0;39m ==> Parameters: 
2022-04-18 22:39:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494856458375168[0;39m <==    Updates: 0
2022-04-18 22:39:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494856458375168[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:39:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494877450866688[0;39m 生成今日电子书快照开始
2022-04-18 22:39:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494877450866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494877450866688[0;39m ==> Parameters: 
2022-04-18 22:39:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494877450866688[0;39m <==    Updates: 0
2022-04-18 22:39:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494877450866688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:39:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494898413998080[0;39m 生成今日电子书快照开始
2022-04-18 22:39:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494898413998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494898413998080[0;39m ==> Parameters: 
2022-04-18 22:39:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494898413998080[0;39m <==    Updates: 0
2022-04-18 22:39:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494898413998080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:39:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494919389712384[0;39m 生成今日电子书快照开始
2022-04-18 22:39:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494919389712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494919389712384[0;39m ==> Parameters: 
2022-04-18 22:39:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494919389712384[0;39m <==    Updates: 0
2022-04-18 22:39:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494919389712384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:39:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171494919641370624[0;39m start updating Ebook doc
2022-04-18 22:39:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494919641370624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:39:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494919641370624[0;39m ==> Parameters: 
2022-04-18 22:39:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171494919641370624[0;39m <==    Updates: 1
2022-04-18 22:39:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171494919641370624[0;39m update ends, take 42 millisecs
2022-04-18 22:39:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494940357038080[0;39m 生成今日电子书快照开始
2022-04-18 22:39:40.144 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494940357038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:40.144 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494940357038080[0;39m ==> Parameters: 
2022-04-18 22:39:40.321 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494940357038080[0;39m <==    Updates: 0
2022-04-18 22:39:40.321 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494940357038080[0;39m 生成今日电子书快照结束，耗时：318毫秒
2022-04-18 22:39:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494961320169472[0;39m 生成今日电子书快照开始
2022-04-18 22:39:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494961320169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494961320169472[0;39m ==> Parameters: 
2022-04-18 22:39:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494961320169472[0;39m <==    Updates: 0
2022-04-18 22:39:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494961320169472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:39:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171494982287495168[0;39m 生成今日电子书快照开始
2022-04-18 22:39:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494982287495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494982287495168[0;39m ==> Parameters: 
2022-04-18 22:39:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171494982287495168[0;39m <==    Updates: 0
2022-04-18 22:39:50.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171494982287495168[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 22:39:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495003259015168[0;39m 生成今日电子书快照开始
2022-04-18 22:39:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495003259015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:39:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495003259015168[0;39m ==> Parameters: 
2022-04-18 22:39:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495003259015168[0;39m <==    Updates: 0
2022-04-18 22:39:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495003259015168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:40:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495024234729472[0;39m 生成今日电子书快照开始
2022-04-18 22:40:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495024234729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495024234729472[0;39m ==> Parameters: 
2022-04-18 22:40:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495024234729472[0;39m <==    Updates: 0
2022-04-18 22:40:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495024234729472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:40:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495045206249472[0;39m start updating Ebook doc
2022-04-18 22:40:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495045206249472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:40:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495045206249472[0;39m ==> Parameters: 
2022-04-18 22:40:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495045206249472[0;39m <==    Updates: 1
2022-04-18 22:40:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495045206249472[0;39m update ends, take 63 millisecs
2022-04-18 22:40:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495045470490624[0;39m 生成今日电子书快照开始
2022-04-18 22:40:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495045470490624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495045470490624[0;39m ==> Parameters: 
2022-04-18 22:40:05.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495045470490624[0;39m <==    Updates: 0
2022-04-18 22:40:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495045470490624[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:40:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495066194546688[0;39m 生成今日电子书快照开始
2022-04-18 22:40:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495066194546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495066194546688[0;39m ==> Parameters: 
2022-04-18 22:40:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495066194546688[0;39m <==    Updates: 0
2022-04-18 22:40:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495066194546688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:40:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495087161872384[0;39m 生成今日电子书快照开始
2022-04-18 22:40:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495087161872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495087161872384[0;39m ==> Parameters: 
2022-04-18 22:40:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495087161872384[0;39m <==    Updates: 0
2022-04-18 22:40:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495087161872384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:40:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495108133392384[0;39m 生成今日电子书快照开始
2022-04-18 22:40:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495108133392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495108133392384[0;39m ==> Parameters: 
2022-04-18 22:40:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495108133392384[0;39m <==    Updates: 0
2022-04-18 22:40:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495108133392384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:40:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495129096523776[0;39m 生成今日电子书快照开始
2022-04-18 22:40:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495129096523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495129096523776[0;39m ==> Parameters: 
2022-04-18 22:40:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495129096523776[0;39m <==    Updates: 0
2022-04-18 22:40:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495129096523776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:40:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495150059655168[0;39m 生成今日电子书快照开始
2022-04-18 22:40:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495150059655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495150059655168[0;39m ==> Parameters: 
2022-04-18 22:40:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495150059655168[0;39m <==    Updates: 0
2022-04-18 22:40:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495150059655168[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:40:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495171047952384[0;39m 生成今日电子书快照开始
2022-04-18 22:40:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495171047952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495171047952384[0;39m ==> Parameters: 
2022-04-18 22:40:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495171047952384[0;39m <==    Updates: 0
2022-04-18 22:40:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495171047952384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:40:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495171320582144[0;39m start updating Ebook doc
2022-04-18 22:40:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495171320582144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:40:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495171320582144[0;39m ==> Parameters: 
2022-04-18 22:40:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495171320582144[0;39m <==    Updates: 1
2022-04-18 22:40:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495171320582144[0;39m update ends, take 39 millisecs
2022-04-18 22:40:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495192019472384[0;39m 生成今日电子书快照开始
2022-04-18 22:40:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495192019472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495192019472384[0;39m ==> Parameters: 
2022-04-18 22:40:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495192019472384[0;39m <==    Updates: 0
2022-04-18 22:40:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495192019472384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:40:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495212995186688[0;39m 生成今日电子书快照开始
2022-04-18 22:40:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495212995186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495212995186688[0;39m ==> Parameters: 
2022-04-18 22:40:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495212995186688[0;39m <==    Updates: 0
2022-04-18 22:40:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495212995186688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:40:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495233958318080[0;39m 生成今日电子书快照开始
2022-04-18 22:40:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495233958318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495233958318080[0;39m ==> Parameters: 
2022-04-18 22:40:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495233958318080[0;39m <==    Updates: 0
2022-04-18 22:40:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495233958318080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:40:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495254938226688[0;39m 生成今日电子书快照开始
2022-04-18 22:40:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495254938226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:40:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495254938226688[0;39m ==> Parameters: 
2022-04-18 22:40:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495254938226688[0;39m <==    Updates: 0
2022-04-18 22:40:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495254938226688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:41:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495275913940992[0;39m 生成今日电子书快照开始
2022-04-18 22:41:00.129 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495275913940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:00.130 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495275913940992[0;39m ==> Parameters: 
2022-04-18 22:41:00.170 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495275913940992[0;39m <==    Updates: 0
2022-04-18 22:41:00.170 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495275913940992[0;39m 生成今日电子书快照结束，耗时：163毫秒
2022-04-18 22:41:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495296877072384[0;39m 生成今日电子书快照开始
2022-04-18 22:41:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495296877072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495296877072384[0;39m ==> Parameters: 
2022-04-18 22:41:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495296877072384[0;39m <==    Updates: 0
2022-04-18 22:41:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495296877072384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:41:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495297153896448[0;39m start updating Ebook doc
2022-04-18 22:41:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495297153896448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:41:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495297153896448[0;39m ==> Parameters: 
2022-04-18 22:41:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495297153896448[0;39m <==    Updates: 1
2022-04-18 22:41:05.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495297153896448[0;39m update ends, take 43 millisecs
2022-04-18 22:41:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495317852786688[0;39m 生成今日电子书快照开始
2022-04-18 22:41:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495317852786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495317852786688[0;39m ==> Parameters: 
2022-04-18 22:41:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495317852786688[0;39m <==    Updates: 0
2022-04-18 22:41:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495317852786688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:41:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495338828500992[0;39m 生成今日电子书快照开始
2022-04-18 22:41:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495338828500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495338828500992[0;39m ==> Parameters: 
2022-04-18 22:41:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495338828500992[0;39m <==    Updates: 0
2022-04-18 22:41:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495338828500992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:41:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495359791632384[0;39m 生成今日电子书快照开始
2022-04-18 22:41:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495359791632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495359791632384[0;39m ==> Parameters: 
2022-04-18 22:41:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495359791632384[0;39m <==    Updates: 0
2022-04-18 22:41:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495359791632384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:41:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495380754763776[0;39m 生成今日电子书快照开始
2022-04-18 22:41:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495380754763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495380754763776[0;39m ==> Parameters: 
2022-04-18 22:41:25.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495380754763776[0;39m <==    Updates: 0
2022-04-18 22:41:25.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495380754763776[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-18 22:41:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495401738866688[0;39m 生成今日电子书快照开始
2022-04-18 22:41:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495401738866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495401738866688[0;39m ==> Parameters: 
2022-04-18 22:41:30.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495401738866688[0;39m <==    Updates: 0
2022-04-18 22:41:30.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495401738866688[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 22:41:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495422710386688[0;39m 生成今日电子书快照开始
2022-04-18 22:41:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495422710386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495422710386688[0;39m ==> Parameters: 
2022-04-18 22:41:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495422710386688[0;39m <==    Updates: 0
2022-04-18 22:41:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495422710386688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:41:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495422970433536[0;39m start updating Ebook doc
2022-04-18 22:41:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495422970433536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:41:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495422970433536[0;39m ==> Parameters: 
2022-04-18 22:41:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495422970433536[0;39m <==    Updates: 1
2022-04-18 22:41:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495422970433536[0;39m update ends, take 37 millisecs
2022-04-18 22:41:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495443677712384[0;39m 生成今日电子书快照开始
2022-04-18 22:41:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495443677712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495443677712384[0;39m ==> Parameters: 
2022-04-18 22:41:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495443677712384[0;39m <==    Updates: 0
2022-04-18 22:41:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495443677712384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:41:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495464640843776[0;39m 生成今日电子书快照开始
2022-04-18 22:41:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495464640843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495464640843776[0;39m ==> Parameters: 
2022-04-18 22:41:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495464640843776[0;39m <==    Updates: 0
2022-04-18 22:41:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495464640843776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:41:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495485608169472[0;39m 生成今日电子书快照开始
2022-04-18 22:41:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495485608169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495485608169472[0;39m ==> Parameters: 
2022-04-18 22:41:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495485608169472[0;39m <==    Updates: 0
2022-04-18 22:41:50.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495485608169472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 22:41:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495506592272384[0;39m 生成今日电子书快照开始
2022-04-18 22:41:55.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495506592272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:41:55.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495506592272384[0;39m ==> Parameters: 
2022-04-18 22:41:55.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495506592272384[0;39m <==    Updates: 0
2022-04-18 22:41:55.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495506592272384[0;39m 生成今日电子书快照结束，耗时：116毫秒
2022-04-18 22:42:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495527563792384[0;39m 生成今日电子书快照开始
2022-04-18 22:42:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495527563792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495527563792384[0;39m ==> Parameters: 
2022-04-18 22:42:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495527563792384[0;39m <==    Updates: 0
2022-04-18 22:42:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495527563792384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:42:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495548535312384[0;39m 生成今日电子书快照开始
2022-04-18 22:42:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495548535312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495548535312384[0;39m ==> Parameters: 
2022-04-18 22:42:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495548535312384[0;39m <==    Updates: 0
2022-04-18 22:42:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495548535312384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:42:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495548786970624[0;39m start updating Ebook doc
2022-04-18 22:42:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495548786970624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:42:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495548786970624[0;39m ==> Parameters: 
2022-04-18 22:42:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495548786970624[0;39m <==    Updates: 1
2022-04-18 22:42:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495548786970624[0;39m update ends, take 35 millisecs
2022-04-18 22:42:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495569511026688[0;39m 生成今日电子书快照开始
2022-04-18 22:42:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495569511026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495569511026688[0;39m ==> Parameters: 
2022-04-18 22:42:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495569511026688[0;39m <==    Updates: 0
2022-04-18 22:42:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495569511026688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:42:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495590482546688[0;39m 生成今日电子书快照开始
2022-04-18 22:42:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495590482546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495590482546688[0;39m ==> Parameters: 
2022-04-18 22:42:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495590482546688[0;39m <==    Updates: 0
2022-04-18 22:42:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495590482546688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:42:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495611454066688[0;39m 生成今日电子书快照开始
2022-04-18 22:42:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495611454066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495611454066688[0;39m ==> Parameters: 
2022-04-18 22:42:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495611454066688[0;39m <==    Updates: 0
2022-04-18 22:42:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495611454066688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:42:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495632421392384[0;39m 生成今日电子书快照开始
2022-04-18 22:42:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495632421392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495632421392384[0;39m ==> Parameters: 
2022-04-18 22:42:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495632421392384[0;39m <==    Updates: 0
2022-04-18 22:42:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495632421392384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:42:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495653380329472[0;39m 生成今日电子书快照开始
2022-04-18 22:42:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495653380329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495653380329472[0;39m ==> Parameters: 
2022-04-18 22:42:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495653380329472[0;39m <==    Updates: 0
2022-04-18 22:42:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495653380329472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:42:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495674356043776[0;39m start updating Ebook doc
2022-04-18 22:42:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495674356043776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:42:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495674356043776[0;39m ==> Parameters: 
2022-04-18 22:42:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495674356043776[0;39m <==    Updates: 1
2022-04-18 22:42:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495674356043776[0;39m update ends, take 61 millisecs
2022-04-18 22:42:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495674611896320[0;39m 生成今日电子书快照开始
2022-04-18 22:42:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495674611896320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495674611896320[0;39m ==> Parameters: 
2022-04-18 22:42:35.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495674611896320[0;39m <==    Updates: 0
2022-04-18 22:42:35.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495674611896320[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 22:42:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495695340146688[0;39m 生成今日电子书快照开始
2022-04-18 22:42:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495695340146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495695340146688[0;39m ==> Parameters: 
2022-04-18 22:42:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495695340146688[0;39m <==    Updates: 0
2022-04-18 22:42:40.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495695340146688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:42:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495716311666688[0;39m 生成今日电子书快照开始
2022-04-18 22:42:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495716311666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495716311666688[0;39m ==> Parameters: 
2022-04-18 22:42:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495716311666688[0;39m <==    Updates: 0
2022-04-18 22:42:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495716311666688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:42:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495737283186688[0;39m 生成今日电子书快照开始
2022-04-18 22:42:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495737283186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495737283186688[0;39m ==> Parameters: 
2022-04-18 22:42:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495737283186688[0;39m <==    Updates: 0
2022-04-18 22:42:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495737283186688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:42:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495758250512384[0;39m 生成今日电子书快照开始
2022-04-18 22:42:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495758250512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:42:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495758250512384[0;39m ==> Parameters: 
2022-04-18 22:42:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495758250512384[0;39m <==    Updates: 0
2022-04-18 22:42:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495758250512384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:43:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495779205255168[0;39m 生成今日电子书快照开始
2022-04-18 22:43:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495779205255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495779205255168[0;39m ==> Parameters: 
2022-04-18 22:43:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495779205255168[0;39m <==    Updates: 0
2022-04-18 22:43:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495779205255168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:43:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495800185163776[0;39m start updating Ebook doc
2022-04-18 22:43:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495800185163776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:43:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495800185163776[0;39m ==> Parameters: 
2022-04-18 22:43:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495800185163776[0;39m <==    Updates: 1
2022-04-18 22:43:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495800185163776[0;39m update ends, take 62 millisecs
2022-04-18 22:43:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495800445210624[0;39m 生成今日电子书快照开始
2022-04-18 22:43:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495800445210624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495800445210624[0;39m ==> Parameters: 
2022-04-18 22:43:05.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495800445210624[0;39m <==    Updates: 0
2022-04-18 22:43:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495800445210624[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 22:43:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495821165072384[0;39m 生成今日电子书快照开始
2022-04-18 22:43:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495821165072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495821165072384[0;39m ==> Parameters: 
2022-04-18 22:43:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495821165072384[0;39m <==    Updates: 0
2022-04-18 22:43:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495821165072384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:43:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495842124009472[0;39m 生成今日电子书快照开始
2022-04-18 22:43:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495842124009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495842124009472[0;39m ==> Parameters: 
2022-04-18 22:43:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495842124009472[0;39m <==    Updates: 0
2022-04-18 22:43:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495842124009472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:43:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495863095529472[0;39m 生成今日电子书快照开始
2022-04-18 22:43:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495863095529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495863095529472[0;39m ==> Parameters: 
2022-04-18 22:43:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495863095529472[0;39m <==    Updates: 0
2022-04-18 22:43:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495863095529472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:43:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495884067049472[0;39m 生成今日电子书快照开始
2022-04-18 22:43:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495884067049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495884067049472[0;39m ==> Parameters: 
2022-04-18 22:43:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495884067049472[0;39m <==    Updates: 0
2022-04-18 22:43:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495884067049472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:43:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495905051152384[0;39m 生成今日电子书快照开始
2022-04-18 22:43:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495905051152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495905051152384[0;39m ==> Parameters: 
2022-04-18 22:43:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495905051152384[0;39m <==    Updates: 0
2022-04-18 22:43:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495905051152384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:43:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495926018478080[0;39m 生成今日电子书快照开始
2022-04-18 22:43:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495926018478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495926018478080[0;39m ==> Parameters: 
2022-04-18 22:43:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495926018478080[0;39m <==    Updates: 0
2022-04-18 22:43:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495926018478080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:43:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171495926240776192[0;39m start updating Ebook doc
2022-04-18 22:43:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495926240776192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:43:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495926240776192[0;39m ==> Parameters: 
2022-04-18 22:43:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171495926240776192[0;39m <==    Updates: 1
2022-04-18 22:43:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171495926240776192[0;39m update ends, take 42 millisecs
2022-04-18 22:43:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495946998386688[0;39m 生成今日电子书快照开始
2022-04-18 22:43:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495946998386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495946998386688[0;39m ==> Parameters: 
2022-04-18 22:43:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495946998386688[0;39m <==    Updates: 0
2022-04-18 22:43:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495946998386688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:43:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495967961518080[0;39m 生成今日电子书快照开始
2022-04-18 22:43:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495967961518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495967961518080[0;39m ==> Parameters: 
2022-04-18 22:43:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495967961518080[0;39m <==    Updates: 0
2022-04-18 22:43:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495967961518080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:43:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171495988937232384[0;39m 生成今日电子书快照开始
2022-04-18 22:43:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495988937232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495988937232384[0;39m ==> Parameters: 
2022-04-18 22:43:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171495988937232384[0;39m <==    Updates: 0
2022-04-18 22:43:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171495988937232384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:43:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496009912946688[0;39m 生成今日电子书快照开始
2022-04-18 22:43:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496009912946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:43:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496009912946688[0;39m ==> Parameters: 
2022-04-18 22:43:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496009912946688[0;39m <==    Updates: 0
2022-04-18 22:43:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496009912946688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:44:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496030867689472[0;39m 生成今日电子书快照开始
2022-04-18 22:44:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496030867689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496030867689472[0;39m ==> Parameters: 
2022-04-18 22:44:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496030867689472[0;39m <==    Updates: 0
2022-04-18 22:44:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496030867689472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:44:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496051855986688[0;39m 生成今日电子书快照开始
2022-04-18 22:44:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496051855986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496051855986688[0;39m ==> Parameters: 
2022-04-18 22:44:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496051855986688[0;39m <==    Updates: 0
2022-04-18 22:44:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496051855986688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:44:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496052120227840[0;39m start updating Ebook doc
2022-04-18 22:44:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496052120227840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:44:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496052120227840[0;39m ==> Parameters: 
2022-04-18 22:44:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496052120227840[0;39m <==    Updates: 1
2022-04-18 22:44:05.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496052120227840[0;39m update ends, take 45 millisecs
2022-04-18 22:44:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496072827506688[0;39m 生成今日电子书快照开始
2022-04-18 22:44:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496072827506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496072827506688[0;39m ==> Parameters: 
2022-04-18 22:44:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496072827506688[0;39m <==    Updates: 0
2022-04-18 22:44:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496072827506688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:44:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496093782249472[0;39m 生成今日电子书快照开始
2022-04-18 22:44:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496093782249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496093782249472[0;39m ==> Parameters: 
2022-04-18 22:44:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496093782249472[0;39m <==    Updates: 0
2022-04-18 22:44:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496093782249472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:44:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496114753769472[0;39m 生成今日电子书快照开始
2022-04-18 22:44:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496114753769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496114753769472[0;39m ==> Parameters: 
2022-04-18 22:44:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496114753769472[0;39m <==    Updates: 0
2022-04-18 22:44:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496114753769472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:44:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496135733678080[0;39m 生成今日电子书快照开始
2022-04-18 22:44:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496135733678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496135733678080[0;39m ==> Parameters: 
2022-04-18 22:44:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496135733678080[0;39m <==    Updates: 0
2022-04-18 22:44:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496135733678080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:44:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496156709392384[0;39m 生成今日电子书快照开始
2022-04-18 22:44:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496156709392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496156709392384[0;39m ==> Parameters: 
2022-04-18 22:44:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496156709392384[0;39m <==    Updates: 0
2022-04-18 22:44:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496156709392384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:44:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496177668329472[0;39m start updating Ebook doc
2022-04-18 22:44:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496177668329472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:44:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496177668329472[0;39m ==> Parameters: 
2022-04-18 22:44:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496177668329472[0;39m <==    Updates: 1
2022-04-18 22:44:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496177668329472[0;39m update ends, take 53 millisecs
2022-04-18 22:44:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496177894821888[0;39m 生成今日电子书快照开始
2022-04-18 22:44:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496177894821888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496177894821888[0;39m ==> Parameters: 
2022-04-18 22:44:35.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496177894821888[0;39m <==    Updates: 0
2022-04-18 22:44:35.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496177894821888[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 22:44:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496198648238080[0;39m 生成今日电子书快照开始
2022-04-18 22:44:40.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496198648238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:40.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496198648238080[0;39m ==> Parameters: 
2022-04-18 22:44:40.271 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496198648238080[0;39m <==    Updates: 0
2022-04-18 22:44:40.271 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496198648238080[0;39m 生成今日电子书快照结束，耗时：268毫秒
2022-04-18 22:44:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496219623952384[0;39m 生成今日电子书快照开始
2022-04-18 22:44:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496219623952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496219623952384[0;39m ==> Parameters: 
2022-04-18 22:44:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496219623952384[0;39m <==    Updates: 0
2022-04-18 22:44:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496219623952384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:44:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496240591278080[0;39m 生成今日电子书快照开始
2022-04-18 22:44:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496240591278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496240591278080[0;39m ==> Parameters: 
2022-04-18 22:44:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496240591278080[0;39m <==    Updates: 0
2022-04-18 22:44:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496240591278080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:44:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496261558603776[0;39m 生成今日电子书快照开始
2022-04-18 22:44:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496261558603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:44:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496261558603776[0;39m ==> Parameters: 
2022-04-18 22:44:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496261558603776[0;39m <==    Updates: 0
2022-04-18 22:44:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496261558603776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:45:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496282530123776[0;39m 生成今日电子书快照开始
2022-04-18 22:45:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496282530123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496282530123776[0;39m ==> Parameters: 
2022-04-18 22:45:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496282530123776[0;39m <==    Updates: 0
2022-04-18 22:45:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496282530123776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:45:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496303505838080[0;39m start updating Ebook doc
2022-04-18 22:45:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496303505838080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:45:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496303505838080[0;39m ==> Parameters: 
2022-04-18 22:45:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496303505838080[0;39m <==    Updates: 1
2022-04-18 22:45:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496303505838080[0;39m update ends, take 51 millisecs
2022-04-18 22:45:05.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496303728136192[0;39m 生成今日电子书快照开始
2022-04-18 22:45:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496303728136192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496303728136192[0;39m ==> Parameters: 
2022-04-18 22:45:05.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496303728136192[0;39m <==    Updates: 0
2022-04-18 22:45:05.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496303728136192[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 22:45:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496324481552384[0;39m 生成今日电子书快照开始
2022-04-18 22:45:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496324481552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496324481552384[0;39m ==> Parameters: 
2022-04-18 22:45:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496324481552384[0;39m <==    Updates: 0
2022-04-18 22:45:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496324481552384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:45:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496345448878080[0;39m 生成今日电子书快照开始
2022-04-18 22:45:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496345448878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496345448878080[0;39m ==> Parameters: 
2022-04-18 22:45:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496345448878080[0;39m <==    Updates: 0
2022-04-18 22:45:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496345448878080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:45:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496366424592384[0;39m 生成今日电子书快照开始
2022-04-18 22:45:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496366424592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496366424592384[0;39m ==> Parameters: 
2022-04-18 22:45:20.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496366424592384[0;39m <==    Updates: 0
2022-04-18 22:45:20.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496366424592384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:45:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496387400306688[0;39m 生成今日电子书快照开始
2022-04-18 22:45:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496387400306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496387400306688[0;39m ==> Parameters: 
2022-04-18 22:45:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496387400306688[0;39m <==    Updates: 0
2022-04-18 22:45:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496387400306688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:45:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496408355049472[0;39m 生成今日电子书快照开始
2022-04-18 22:45:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496408355049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496408355049472[0;39m ==> Parameters: 
2022-04-18 22:45:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496408355049472[0;39m <==    Updates: 0
2022-04-18 22:45:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496408355049472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:45:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496429326569472[0;39m start updating Ebook doc
2022-04-18 22:45:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496429326569472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:45:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496429326569472[0;39m ==> Parameters: 
2022-04-18 22:45:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496429326569472[0;39m <==    Updates: 1
2022-04-18 22:45:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496429326569472[0;39m update ends, take 62 millisecs
2022-04-18 22:45:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496429586616320[0;39m 生成今日电子书快照开始
2022-04-18 22:45:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496429586616320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496429586616320[0;39m ==> Parameters: 
2022-04-18 22:45:35.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496429586616320[0;39m <==    Updates: 0
2022-04-18 22:45:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496429586616320[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-18 22:45:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496450306478080[0;39m 生成今日电子书快照开始
2022-04-18 22:45:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496450306478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496450306478080[0;39m ==> Parameters: 
2022-04-18 22:45:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496450306478080[0;39m <==    Updates: 0
2022-04-18 22:45:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496450306478080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:45:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496471277998080[0;39m 生成今日电子书快照开始
2022-04-18 22:45:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496471277998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496471277998080[0;39m ==> Parameters: 
2022-04-18 22:45:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496471277998080[0;39m <==    Updates: 0
2022-04-18 22:45:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496471277998080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:45:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496492245323776[0;39m 生成今日电子书快照开始
2022-04-18 22:45:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496492245323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496492245323776[0;39m ==> Parameters: 
2022-04-18 22:45:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496492245323776[0;39m <==    Updates: 0
2022-04-18 22:45:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496492245323776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:45:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496513208455168[0;39m 生成今日电子书快照开始
2022-04-18 22:45:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496513208455168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:45:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496513208455168[0;39m ==> Parameters: 
2022-04-18 22:45:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496513208455168[0;39m <==    Updates: 0
2022-04-18 22:45:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496513208455168[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:46:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496534192558080[0;39m 生成今日电子书快照开始
2022-04-18 22:46:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496534192558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496534192558080[0;39m ==> Parameters: 
2022-04-18 22:46:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496534192558080[0;39m <==    Updates: 0
2022-04-18 22:46:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496534192558080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:46:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496555155689472[0;39m 生成今日电子书快照开始
2022-04-18 22:46:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496555155689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496555155689472[0;39m ==> Parameters: 
2022-04-18 22:46:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496555155689472[0;39m <==    Updates: 0
2022-04-18 22:46:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496555155689472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:46:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496555419930624[0;39m start updating Ebook doc
2022-04-18 22:46:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496555419930624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:46:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496555419930624[0;39m ==> Parameters: 
2022-04-18 22:46:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496555419930624[0;39m <==    Updates: 1
2022-04-18 22:46:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496555419930624[0;39m update ends, take 42 millisecs
2022-04-18 22:46:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496576127209472[0;39m 生成今日电子书快照开始
2022-04-18 22:46:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496576127209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496576127209472[0;39m ==> Parameters: 
2022-04-18 22:46:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496576127209472[0;39m <==    Updates: 0
2022-04-18 22:46:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496576127209472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:46:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496597115506688[0;39m 生成今日电子书快照开始
2022-04-18 22:46:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496597115506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496597115506688[0;39m ==> Parameters: 
2022-04-18 22:46:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496597115506688[0;39m <==    Updates: 0
2022-04-18 22:46:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496597115506688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:46:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496618070249472[0;39m 生成今日电子书快照开始
2022-04-18 22:46:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496618070249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496618070249472[0;39m ==> Parameters: 
2022-04-18 22:46:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496618070249472[0;39m <==    Updates: 0
2022-04-18 22:46:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496618070249472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:46:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496639041769472[0;39m 生成今日电子书快照开始
2022-04-18 22:46:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496639041769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496639041769472[0;39m ==> Parameters: 
2022-04-18 22:46:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496639041769472[0;39m <==    Updates: 0
2022-04-18 22:46:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496639041769472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:46:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496660025872384[0;39m 生成今日电子书快照开始
2022-04-18 22:46:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496660025872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496660025872384[0;39m ==> Parameters: 
2022-04-18 22:46:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496660025872384[0;39m <==    Updates: 0
2022-04-18 22:46:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496660025872384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:46:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496680989003776[0;39m start updating Ebook doc
2022-04-18 22:46:35.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496680989003776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:46:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496680989003776[0;39m ==> Parameters: 
2022-04-18 22:46:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496680989003776[0;39m <==    Updates: 1
2022-04-18 22:46:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496680989003776[0;39m update ends, take 56 millisecs
2022-04-18 22:46:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496681223884800[0;39m 生成今日电子书快照开始
2022-04-18 22:46:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496681223884800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496681223884800[0;39m ==> Parameters: 
2022-04-18 22:46:35.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496681223884800[0;39m <==    Updates: 0
2022-04-18 22:46:35.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496681223884800[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 22:46:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496701956329472[0;39m 生成今日电子书快照开始
2022-04-18 22:46:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496701956329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496701956329472[0;39m ==> Parameters: 
2022-04-18 22:46:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496701956329472[0;39m <==    Updates: 0
2022-04-18 22:46:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496701956329472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:46:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496722923655168[0;39m 生成今日电子书快照开始
2022-04-18 22:46:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496722923655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496722923655168[0;39m ==> Parameters: 
2022-04-18 22:46:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496722923655168[0;39m <==    Updates: 0
2022-04-18 22:46:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496722923655168[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:46:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496743899369472[0;39m 生成今日电子书快照开始
2022-04-18 22:46:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496743899369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496743899369472[0;39m ==> Parameters: 
2022-04-18 22:46:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496743899369472[0;39m <==    Updates: 0
2022-04-18 22:46:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496743899369472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:46:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496764866695168[0;39m 生成今日电子书快照开始
2022-04-18 22:46:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496764866695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:46:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496764866695168[0;39m ==> Parameters: 
2022-04-18 22:46:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496764866695168[0;39m <==    Updates: 0
2022-04-18 22:46:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496764866695168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:47:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496785859186688[0;39m 生成今日电子书快照开始
2022-04-18 22:47:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496785859186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496785859186688[0;39m ==> Parameters: 
2022-04-18 22:47:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496785859186688[0;39m <==    Updates: 0
2022-04-18 22:47:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496785859186688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:47:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496806830706688[0;39m start updating Ebook doc
2022-04-18 22:47:05.039 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496806830706688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:47:05.039 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496806830706688[0;39m ==> Parameters: 
2022-04-18 22:47:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496806830706688[0;39m <==    Updates: 1
2022-04-18 22:47:05.081 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496806830706688[0;39m update ends, take 76 millisecs
2022-04-18 22:47:05.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496807149473792[0;39m 生成今日电子书快照开始
2022-04-18 22:47:05.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496807149473792[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:05.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496807149473792[0;39m ==> Parameters: 
2022-04-18 22:47:05.123 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496807149473792[0;39m <==    Updates: 0
2022-04-18 22:47:05.123 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496807149473792[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:47:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496827793838080[0;39m 生成今日电子书快照开始
2022-04-18 22:47:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496827793838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496827793838080[0;39m ==> Parameters: 
2022-04-18 22:47:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496827793838080[0;39m <==    Updates: 0
2022-04-18 22:47:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496827793838080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:47:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496848773746688[0;39m 生成今日电子书快照开始
2022-04-18 22:47:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496848773746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496848773746688[0;39m ==> Parameters: 
2022-04-18 22:47:15.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496848773746688[0;39m <==    Updates: 0
2022-04-18 22:47:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496848773746688[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 22:47:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496869728489472[0;39m 生成今日电子书快照开始
2022-04-18 22:47:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496869728489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496869728489472[0;39m ==> Parameters: 
2022-04-18 22:47:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496869728489472[0;39m <==    Updates: 0
2022-04-18 22:47:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496869728489472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:47:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496890708398080[0;39m 生成今日电子书快照开始
2022-04-18 22:47:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496890708398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496890708398080[0;39m ==> Parameters: 
2022-04-18 22:47:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496890708398080[0;39m <==    Updates: 0
2022-04-18 22:47:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496890708398080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:47:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496911675723776[0;39m 生成今日电子书快照开始
2022-04-18 22:47:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496911675723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496911675723776[0;39m ==> Parameters: 
2022-04-18 22:47:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496911675723776[0;39m <==    Updates: 0
2022-04-18 22:47:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496911675723776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:47:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496932638855168[0;39m 生成今日电子书快照开始
2022-04-18 22:47:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496932638855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496932638855168[0;39m ==> Parameters: 
2022-04-18 22:47:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496932638855168[0;39m <==    Updates: 0
2022-04-18 22:47:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496932638855168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:47:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171496932898902016[0;39m start updating Ebook doc
2022-04-18 22:47:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496932898902016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:47:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496932898902016[0;39m ==> Parameters: 
2022-04-18 22:47:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171496932898902016[0;39m <==    Updates: 1
2022-04-18 22:47:35.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171496932898902016[0;39m update ends, take 37 millisecs
2022-04-18 22:47:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496953627152384[0;39m 生成今日电子书快照开始
2022-04-18 22:47:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496953627152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496953627152384[0;39m ==> Parameters: 
2022-04-18 22:47:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496953627152384[0;39m <==    Updates: 0
2022-04-18 22:47:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496953627152384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:47:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496974598672384[0;39m 生成今日电子书快照开始
2022-04-18 22:47:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496974598672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496974598672384[0;39m ==> Parameters: 
2022-04-18 22:47:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496974598672384[0;39m <==    Updates: 0
2022-04-18 22:47:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496974598672384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:47:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171496995561803776[0;39m 生成今日电子书快照开始
2022-04-18 22:47:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496995561803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496995561803776[0;39m ==> Parameters: 
2022-04-18 22:47:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171496995561803776[0;39m <==    Updates: 0
2022-04-18 22:47:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171496995561803776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:47:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497016537518080[0;39m 生成今日电子书快照开始
2022-04-18 22:47:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497016537518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:47:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497016537518080[0;39m ==> Parameters: 
2022-04-18 22:47:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497016537518080[0;39m <==    Updates: 0
2022-04-18 22:47:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497016537518080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:48:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497037517426688[0;39m 生成今日电子书快照开始
2022-04-18 22:48:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497037517426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497037517426688[0;39m ==> Parameters: 
2022-04-18 22:48:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497037517426688[0;39m <==    Updates: 0
2022-04-18 22:48:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497037517426688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:48:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497058488946688[0;39m 生成今日电子书快照开始
2022-04-18 22:48:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497058488946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497058488946688[0;39m ==> Parameters: 
2022-04-18 22:48:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497058488946688[0;39m <==    Updates: 0
2022-04-18 22:48:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497058488946688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:48:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497058782547968[0;39m start updating Ebook doc
2022-04-18 22:48:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497058782547968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:48:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497058782547968[0;39m ==> Parameters: 
2022-04-18 22:48:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497058782547968[0;39m <==    Updates: 1
2022-04-18 22:48:05.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497058782547968[0;39m update ends, take 36 millisecs
2022-04-18 22:48:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497079460466688[0;39m 生成今日电子书快照开始
2022-04-18 22:48:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497079460466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497079460466688[0;39m ==> Parameters: 
2022-04-18 22:48:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497079460466688[0;39m <==    Updates: 0
2022-04-18 22:48:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497079460466688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:48:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497100411015168[0;39m 生成今日电子书快照开始
2022-04-18 22:48:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497100411015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497100411015168[0;39m ==> Parameters: 
2022-04-18 22:48:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497100411015168[0;39m <==    Updates: 0
2022-04-18 22:48:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497100411015168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:48:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497121386729472[0;39m 生成今日电子书快照开始
2022-04-18 22:48:20.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497121386729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:20.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497121386729472[0;39m ==> Parameters: 
2022-04-18 22:48:20.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497121386729472[0;39m <==    Updates: 0
2022-04-18 22:48:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497121386729472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:48:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497142370832384[0;39m 生成今日电子书快照开始
2022-04-18 22:48:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497142370832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497142370832384[0;39m ==> Parameters: 
2022-04-18 22:48:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497142370832384[0;39m <==    Updates: 0
2022-04-18 22:48:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497142370832384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:48:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497163329769472[0;39m 生成今日电子书快照开始
2022-04-18 22:48:30.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497163329769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:30.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497163329769472[0;39m ==> Parameters: 
2022-04-18 22:48:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497163329769472[0;39m <==    Updates: 0
2022-04-18 22:48:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497163329769472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:48:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497184301289472[0;39m start updating Ebook doc
2022-04-18 22:48:35.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497184301289472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:48:35.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497184301289472[0;39m ==> Parameters: 
2022-04-18 22:48:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497184301289472[0;39m <==    Updates: 1
2022-04-18 22:48:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497184301289472[0;39m update ends, take 55 millisecs
2022-04-18 22:48:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497184531976192[0;39m 生成今日电子书快照开始
2022-04-18 22:48:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497184531976192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497184531976192[0;39m ==> Parameters: 
2022-04-18 22:48:35.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497184531976192[0;39m <==    Updates: 0
2022-04-18 22:48:35.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497184531976192[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 22:48:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497205268615168[0;39m 生成今日电子书快照开始
2022-04-18 22:48:40.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497205268615168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497205268615168[0;39m ==> Parameters: 
2022-04-18 22:48:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497205268615168[0;39m <==    Updates: 0
2022-04-18 22:48:40.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497205268615168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:48:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497226256912384[0;39m 生成今日电子书快照开始
2022-04-18 22:48:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497226256912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497226256912384[0;39m ==> Parameters: 
2022-04-18 22:48:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497226256912384[0;39m <==    Updates: 0
2022-04-18 22:48:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497226256912384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:48:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497247220043776[0;39m 生成今日电子书快照开始
2022-04-18 22:48:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497247220043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497247220043776[0;39m ==> Parameters: 
2022-04-18 22:48:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497247220043776[0;39m <==    Updates: 0
2022-04-18 22:48:50.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497247220043776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:48:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497268183175168[0;39m 生成今日电子书快照开始
2022-04-18 22:48:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497268183175168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:48:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497268183175168[0;39m ==> Parameters: 
2022-04-18 22:48:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497268183175168[0;39m <==    Updates: 0
2022-04-18 22:48:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497268183175168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:49:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497289158889472[0;39m 生成今日电子书快照开始
2022-04-18 22:49:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497289158889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497289158889472[0;39m ==> Parameters: 
2022-04-18 22:49:00.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497289158889472[0;39m <==    Updates: 0
2022-04-18 22:49:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497289158889472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:49:05.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497310126215168[0;39m 生成今日电子书快照开始
2022-04-18 22:49:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497310126215168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497310126215168[0;39m ==> Parameters: 
2022-04-18 22:49:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497310126215168[0;39m <==    Updates: 0
2022-04-18 22:49:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497310126215168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 22:49:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497310411427840[0;39m start updating Ebook doc
2022-04-18 22:49:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497310411427840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:49:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497310411427840[0;39m ==> Parameters: 
2022-04-18 22:49:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497310411427840[0;39m <==    Updates: 1
2022-04-18 22:49:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497310411427840[0;39m update ends, take 44 millisecs
2022-04-18 22:49:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497331106123776[0;39m 生成今日电子书快照开始
2022-04-18 22:49:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497331106123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497331106123776[0;39m ==> Parameters: 
2022-04-18 22:49:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497331106123776[0;39m <==    Updates: 0
2022-04-18 22:49:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497331106123776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:49:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497352077643776[0;39m 生成今日电子书快照开始
2022-04-18 22:49:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497352077643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497352077643776[0;39m ==> Parameters: 
2022-04-18 22:49:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497352077643776[0;39m <==    Updates: 0
2022-04-18 22:49:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497352077643776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:49:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497373044969472[0;39m 生成今日电子书快照开始
2022-04-18 22:49:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497373044969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497373044969472[0;39m ==> Parameters: 
2022-04-18 22:49:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497373044969472[0;39m <==    Updates: 0
2022-04-18 22:49:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497373044969472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:49:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497394020683776[0;39m 生成今日电子书快照开始
2022-04-18 22:49:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497394020683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497394020683776[0;39m ==> Parameters: 
2022-04-18 22:49:25.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497394020683776[0;39m <==    Updates: 0
2022-04-18 22:49:25.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497394020683776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:49:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497414996398080[0;39m 生成今日电子书快照开始
2022-04-18 22:49:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497414996398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497414996398080[0;39m ==> Parameters: 
2022-04-18 22:49:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497414996398080[0;39m <==    Updates: 0
2022-04-18 22:49:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497414996398080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:49:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497435972112384[0;39m 生成今日电子书快照开始
2022-04-18 22:49:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497435972112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497435972112384[0;39m ==> Parameters: 
2022-04-18 22:49:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497435972112384[0;39m <==    Updates: 0
2022-04-18 22:49:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497435972112384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:49:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497436223770624[0;39m start updating Ebook doc
2022-04-18 22:49:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497436223770624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:49:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497436223770624[0;39m ==> Parameters: 
2022-04-18 22:49:35.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497436223770624[0;39m <==    Updates: 1
2022-04-18 22:49:35.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497436223770624[0;39m update ends, take 49 millisecs
2022-04-18 22:49:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497456931049472[0;39m 生成今日电子书快照开始
2022-04-18 22:49:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497456931049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497456931049472[0;39m ==> Parameters: 
2022-04-18 22:49:40.204 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497456931049472[0;39m <==    Updates: 0
2022-04-18 22:49:40.205 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497456931049472[0;39m 生成今日电子书快照结束，耗时：204毫秒
2022-04-18 22:49:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497477915152384[0;39m 生成今日电子书快照开始
2022-04-18 22:49:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497477915152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497477915152384[0;39m ==> Parameters: 
2022-04-18 22:49:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497477915152384[0;39m <==    Updates: 0
2022-04-18 22:49:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497477915152384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:49:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497498878283776[0;39m 生成今日电子书快照开始
2022-04-18 22:49:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497498878283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497498878283776[0;39m ==> Parameters: 
2022-04-18 22:49:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497498878283776[0;39m <==    Updates: 0
2022-04-18 22:49:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497498878283776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:49:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497519849803776[0;39m 生成今日电子书快照开始
2022-04-18 22:49:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497519849803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:49:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497519849803776[0;39m ==> Parameters: 
2022-04-18 22:49:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497519849803776[0;39m <==    Updates: 0
2022-04-18 22:49:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497519849803776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:50:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497540817129472[0;39m 生成今日电子书快照开始
2022-04-18 22:50:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497540817129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497540817129472[0;39m ==> Parameters: 
2022-04-18 22:50:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497540817129472[0;39m <==    Updates: 0
2022-04-18 22:50:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497540817129472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:50:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497561801232384[0;39m 生成今日电子书快照开始
2022-04-18 22:50:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497561801232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497561801232384[0;39m ==> Parameters: 
2022-04-18 22:50:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497561801232384[0;39m <==    Updates: 0
2022-04-18 22:50:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497561801232384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:50:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497562048696320[0;39m start updating Ebook doc
2022-04-18 22:50:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497562048696320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:50:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497562048696320[0;39m ==> Parameters: 
2022-04-18 22:50:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497562048696320[0;39m <==    Updates: 1
2022-04-18 22:50:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497562048696320[0;39m update ends, take 43 millisecs
2022-04-18 22:50:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497582768558080[0;39m 生成今日电子书快照开始
2022-04-18 22:50:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497582768558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497582768558080[0;39m ==> Parameters: 
2022-04-18 22:50:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497582768558080[0;39m <==    Updates: 0
2022-04-18 22:50:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497582768558080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:50:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497603740078080[0;39m 生成今日电子书快照开始
2022-04-18 22:50:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497603740078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497603740078080[0;39m ==> Parameters: 
2022-04-18 22:50:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497603740078080[0;39m <==    Updates: 0
2022-04-18 22:50:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497603740078080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:50:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497624715792384[0;39m 生成今日电子书快照开始
2022-04-18 22:50:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497624715792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497624715792384[0;39m ==> Parameters: 
2022-04-18 22:50:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497624715792384[0;39m <==    Updates: 0
2022-04-18 22:50:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497624715792384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:50:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497645683118080[0;39m 生成今日电子书快照开始
2022-04-18 22:50:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497645683118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497645683118080[0;39m ==> Parameters: 
2022-04-18 22:50:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497645683118080[0;39m <==    Updates: 0
2022-04-18 22:50:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497645683118080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:50:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497666658832384[0;39m 生成今日电子书快照开始
2022-04-18 22:50:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497666658832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497666658832384[0;39m ==> Parameters: 
2022-04-18 22:50:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497666658832384[0;39m <==    Updates: 0
2022-04-18 22:50:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497666658832384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:50:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497687630352384[0;39m start updating Ebook doc
2022-04-18 22:50:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497687630352384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:50:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497687630352384[0;39m ==> Parameters: 
2022-04-18 22:50:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497687630352384[0;39m <==    Updates: 1
2022-04-18 22:50:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497687630352384[0;39m update ends, take 59 millisecs
2022-04-18 22:50:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497687877816320[0;39m 生成今日电子书快照开始
2022-04-18 22:50:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497687877816320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497687877816320[0;39m ==> Parameters: 
2022-04-18 22:50:35.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497687877816320[0;39m <==    Updates: 0
2022-04-18 22:50:35.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497687877816320[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 22:50:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497708601872384[0;39m 生成今日电子书快照开始
2022-04-18 22:50:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497708601872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497708601872384[0;39m ==> Parameters: 
2022-04-18 22:50:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497708601872384[0;39m <==    Updates: 0
2022-04-18 22:50:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497708601872384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:50:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497729560809472[0;39m 生成今日电子书快照开始
2022-04-18 22:50:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497729560809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497729560809472[0;39m ==> Parameters: 
2022-04-18 22:50:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497729560809472[0;39m <==    Updates: 0
2022-04-18 22:50:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497729560809472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:50:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497750528135168[0;39m 生成今日电子书快照开始
2022-04-18 22:50:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497750528135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497750528135168[0;39m ==> Parameters: 
2022-04-18 22:50:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497750528135168[0;39m <==    Updates: 0
2022-04-18 22:50:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497750528135168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:50:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497771520626688[0;39m 生成今日电子书快照开始
2022-04-18 22:50:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497771520626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:50:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497771520626688[0;39m ==> Parameters: 
2022-04-18 22:50:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497771520626688[0;39m <==    Updates: 0
2022-04-18 22:50:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497771520626688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:51:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497792479563776[0;39m 生成今日电子书快照开始
2022-04-18 22:51:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497792479563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497792479563776[0;39m ==> Parameters: 
2022-04-18 22:51:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497792479563776[0;39m <==    Updates: 0
2022-04-18 22:51:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497792479563776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:51:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497813459472384[0;39m 生成今日电子书快照开始
2022-04-18 22:51:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497813459472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497813459472384[0;39m ==> Parameters: 
2022-04-18 22:51:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497813459472384[0;39m <==    Updates: 0
2022-04-18 22:51:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497813459472384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:51:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497813698547712[0;39m start updating Ebook doc
2022-04-18 22:51:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497813698547712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:51:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497813698547712[0;39m ==> Parameters: 
2022-04-18 22:51:05.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497813698547712[0;39m <==    Updates: 1
2022-04-18 22:51:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497813698547712[0;39m update ends, take 38 millisecs
2022-04-18 22:51:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497834426798080[0;39m 生成今日电子书快照开始
2022-04-18 22:51:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497834426798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497834426798080[0;39m ==> Parameters: 
2022-04-18 22:51:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497834426798080[0;39m <==    Updates: 0
2022-04-18 22:51:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497834426798080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:51:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497855406706688[0;39m 生成今日电子书快照开始
2022-04-18 22:51:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497855406706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497855406706688[0;39m ==> Parameters: 
2022-04-18 22:51:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497855406706688[0;39m <==    Updates: 0
2022-04-18 22:51:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497855406706688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:51:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497876365643776[0;39m 生成今日电子书快照开始
2022-04-18 22:51:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497876365643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497876365643776[0;39m ==> Parameters: 
2022-04-18 22:51:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497876365643776[0;39m <==    Updates: 0
2022-04-18 22:51:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497876365643776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:51:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497897345552384[0;39m 生成今日电子书快照开始
2022-04-18 22:51:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497897345552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497897345552384[0;39m ==> Parameters: 
2022-04-18 22:51:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497897345552384[0;39m <==    Updates: 0
2022-04-18 22:51:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497897345552384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:51:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497918308683776[0;39m 生成今日电子书快照开始
2022-04-18 22:51:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497918308683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497918308683776[0;39m ==> Parameters: 
2022-04-18 22:51:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497918308683776[0;39m <==    Updates: 0
2022-04-18 22:51:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497918308683776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 22:51:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497939280203776[0;39m 生成今日电子书快照开始
2022-04-18 22:51:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497939280203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497939280203776[0;39m ==> Parameters: 
2022-04-18 22:51:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497939280203776[0;39m <==    Updates: 0
2022-04-18 22:51:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497939280203776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:51:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171497939552833536[0;39m start updating Ebook doc
2022-04-18 22:51:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497939552833536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:51:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497939552833536[0;39m ==> Parameters: 
2022-04-18 22:51:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171497939552833536[0;39m <==    Updates: 1
2022-04-18 22:51:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171497939552833536[0;39m update ends, take 41 millisecs
2022-04-18 22:51:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497960260112384[0;39m 生成今日电子书快照开始
2022-04-18 22:51:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497960260112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497960260112384[0;39m ==> Parameters: 
2022-04-18 22:51:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497960260112384[0;39m <==    Updates: 0
2022-04-18 22:51:40.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497960260112384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:51:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171497981223243776[0;39m 生成今日电子书快照开始
2022-04-18 22:51:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497981223243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497981223243776[0;39m ==> Parameters: 
2022-04-18 22:51:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171497981223243776[0;39m <==    Updates: 0
2022-04-18 22:51:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171497981223243776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:51:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498002207346688[0;39m 生成今日电子书快照开始
2022-04-18 22:51:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498002207346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498002207346688[0;39m ==> Parameters: 
2022-04-18 22:51:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498002207346688[0;39m <==    Updates: 0
2022-04-18 22:51:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498002207346688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:51:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498023157895168[0;39m 生成今日电子书快照开始
2022-04-18 22:51:55.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498023157895168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:51:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498023157895168[0;39m ==> Parameters: 
2022-04-18 22:51:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498023157895168[0;39m <==    Updates: 0
2022-04-18 22:51:55.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498023157895168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:52:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498044146192384[0;39m 生成今日电子书快照开始
2022-04-18 22:52:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498044146192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498044146192384[0;39m ==> Parameters: 
2022-04-18 22:52:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498044146192384[0;39m <==    Updates: 0
2022-04-18 22:52:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498044146192384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:52:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498065105129472[0;39m 生成今日电子书快照开始
2022-04-18 22:52:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498065105129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498065105129472[0;39m ==> Parameters: 
2022-04-18 22:52:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498065105129472[0;39m <==    Updates: 0
2022-04-18 22:52:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498065105129472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:52:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498065360982016[0;39m start updating Ebook doc
2022-04-18 22:52:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498065360982016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:52:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498065360982016[0;39m ==> Parameters: 
2022-04-18 22:52:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498065360982016[0;39m <==    Updates: 1
2022-04-18 22:52:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498065360982016[0;39m update ends, take 40 millisecs
2022-04-18 22:52:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498086076649472[0;39m 生成今日电子书快照开始
2022-04-18 22:52:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498086076649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498086076649472[0;39m ==> Parameters: 
2022-04-18 22:52:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498086076649472[0;39m <==    Updates: 0
2022-04-18 22:52:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498086076649472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:52:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498107052363776[0;39m 生成今日电子书快照开始
2022-04-18 22:52:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498107052363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498107052363776[0;39m ==> Parameters: 
2022-04-18 22:52:15.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498107052363776[0;39m <==    Updates: 0
2022-04-18 22:52:15.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498107052363776[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:52:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498128032272384[0;39m 生成今日电子书快照开始
2022-04-18 22:52:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498128032272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498128032272384[0;39m ==> Parameters: 
2022-04-18 22:52:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498128032272384[0;39m <==    Updates: 0
2022-04-18 22:52:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498128032272384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:52:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498148999598080[0;39m 生成今日电子书快照开始
2022-04-18 22:52:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498148999598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498148999598080[0;39m ==> Parameters: 
2022-04-18 22:52:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498148999598080[0;39m <==    Updates: 0
2022-04-18 22:52:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498148999598080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:52:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498169975312384[0;39m 生成今日电子书快照开始
2022-04-18 22:52:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498169975312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498169975312384[0;39m ==> Parameters: 
2022-04-18 22:52:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498169975312384[0;39m <==    Updates: 0
2022-04-18 22:52:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498169975312384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:52:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498190934249472[0;39m 生成今日电子书快照开始
2022-04-18 22:52:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498190934249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:35.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498190934249472[0;39m ==> Parameters: 
2022-04-18 22:52:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498190934249472[0;39m <==    Updates: 0
2022-04-18 22:52:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498190934249472[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 22:52:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498191248822272[0;39m start updating Ebook doc
2022-04-18 22:52:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498191248822272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:52:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498191248822272[0;39m ==> Parameters: 
2022-04-18 22:52:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498191248822272[0;39m <==    Updates: 1
2022-04-18 22:52:35.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498191248822272[0;39m update ends, take 40 millisecs
2022-04-18 22:52:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498211905769472[0;39m 生成今日电子书快照开始
2022-04-18 22:52:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498211905769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498211905769472[0;39m ==> Parameters: 
2022-04-18 22:52:40.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498211905769472[0;39m <==    Updates: 0
2022-04-18 22:52:40.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498211905769472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:52:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498232885678080[0;39m 生成今日电子书快照开始
2022-04-18 22:52:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498232885678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498232885678080[0;39m ==> Parameters: 
2022-04-18 22:52:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498232885678080[0;39m <==    Updates: 0
2022-04-18 22:52:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498232885678080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 22:52:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498253857198080[0;39m 生成今日电子书快照开始
2022-04-18 22:52:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498253857198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498253857198080[0;39m ==> Parameters: 
2022-04-18 22:52:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498253857198080[0;39m <==    Updates: 0
2022-04-18 22:52:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498253857198080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:52:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498274832912384[0;39m 生成今日电子书快照开始
2022-04-18 22:52:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498274832912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:52:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498274832912384[0;39m ==> Parameters: 
2022-04-18 22:52:55.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498274832912384[0;39m <==    Updates: 0
2022-04-18 22:52:55.045 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498274832912384[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 22:53:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498295808626688[0;39m 生成今日电子书快照开始
2022-04-18 22:53:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498295808626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498295808626688[0;39m ==> Parameters: 
2022-04-18 22:53:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498295808626688[0;39m <==    Updates: 0
2022-04-18 22:53:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498295808626688[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:53:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498316767563776[0;39m 生成今日电子书快照开始
2022-04-18 22:53:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498316767563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498316767563776[0;39m ==> Parameters: 
2022-04-18 22:53:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498316767563776[0;39m <==    Updates: 0
2022-04-18 22:53:05.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498316767563776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:53:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498316998250496[0;39m start updating Ebook doc
2022-04-18 22:53:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498316998250496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:53:05.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498316998250496[0;39m ==> Parameters: 
2022-04-18 22:53:05.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498316998250496[0;39m <==    Updates: 1
2022-04-18 22:53:05.089 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498316998250496[0;39m update ends, take 32 millisecs
2022-04-18 22:53:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498337743278080[0;39m 生成今日电子书快照开始
2022-04-18 22:53:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498337743278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498337743278080[0;39m ==> Parameters: 
2022-04-18 22:53:10.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498337743278080[0;39m <==    Updates: 0
2022-04-18 22:53:10.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498337743278080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:53:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498358702215168[0;39m 生成今日电子书快照开始
2022-04-18 22:53:15.014 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498358702215168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:15.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498358702215168[0;39m ==> Parameters: 
2022-04-18 22:53:15.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498358702215168[0;39m <==    Updates: 0
2022-04-18 22:53:15.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498358702215168[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:53:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498379677929472[0;39m 生成今日电子书快照开始
2022-04-18 22:53:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498379677929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498379677929472[0;39m ==> Parameters: 
2022-04-18 22:53:20.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498379677929472[0;39m <==    Updates: 0
2022-04-18 22:53:20.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498379677929472[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 22:53:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498400653643776[0;39m 生成今日电子书快照开始
2022-04-18 22:53:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498400653643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498400653643776[0;39m ==> Parameters: 
2022-04-18 22:53:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498400653643776[0;39m <==    Updates: 0
2022-04-18 22:53:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498400653643776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:53:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498421629358080[0;39m 生成今日电子书快照开始
2022-04-18 22:53:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498421629358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498421629358080[0;39m ==> Parameters: 
2022-04-18 22:53:30.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498421629358080[0;39m <==    Updates: 0
2022-04-18 22:53:30.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498421629358080[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 22:53:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498442600878080[0;39m 生成今日电子书快照开始
2022-04-18 22:53:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498442600878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498442600878080[0;39m ==> Parameters: 
2022-04-18 22:53:35.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498442600878080[0;39m <==    Updates: 0
2022-04-18 22:53:35.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498442600878080[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:53:35.053 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498442810593280[0;39m start updating Ebook doc
2022-04-18 22:53:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498442810593280[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:53:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498442810593280[0;39m ==> Parameters: 
2022-04-18 22:53:35.083 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498442810593280[0;39m <==    Updates: 1
2022-04-18 22:53:35.084 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498442810593280[0;39m update ends, take 30 millisecs
2022-04-18 22:53:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498463568203776[0;39m 生成今日电子书快照开始
2022-04-18 22:53:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498463568203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498463568203776[0;39m ==> Parameters: 
2022-04-18 22:53:40.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498463568203776[0;39m <==    Updates: 0
2022-04-18 22:53:40.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498463568203776[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 22:53:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498484548112384[0;39m 生成今日电子书快照开始
2022-04-18 22:53:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498484548112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498484548112384[0;39m ==> Parameters: 
2022-04-18 22:53:45.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498484548112384[0;39m <==    Updates: 0
2022-04-18 22:53:45.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498484548112384[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 22:53:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498505507049472[0;39m 生成今日电子书快照开始
2022-04-18 22:53:50.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498505507049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:50.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498505507049472[0;39m ==> Parameters: 
2022-04-18 22:53:50.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498505507049472[0;39m <==    Updates: 0
2022-04-18 22:53:50.043 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498505507049472[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:53:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498526495346688[0;39m 生成今日电子书快照开始
2022-04-18 22:53:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498526495346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:53:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498526495346688[0;39m ==> Parameters: 
2022-04-18 22:53:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498526495346688[0;39m <==    Updates: 0
2022-04-18 22:53:55.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498526495346688[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:54:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498547445895168[0;39m 生成今日电子书快照开始
2022-04-18 22:54:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498547445895168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498547445895168[0;39m ==> Parameters: 
2022-04-18 22:54:00.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498547445895168[0;39m <==    Updates: 0
2022-04-18 22:54:00.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498547445895168[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:54:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498568425803776[0;39m start updating Ebook doc
2022-04-18 22:54:05.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498568425803776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:54:05.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498568425803776[0;39m ==> Parameters: 
2022-04-18 22:54:05.044 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498568425803776[0;39m <==    Updates: 1
2022-04-18 22:54:05.044 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498568425803776[0;39m update ends, take 42 millisecs
2022-04-18 22:54:05.044 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498568601964544[0;39m 生成今日电子书快照开始
2022-04-18 22:54:05.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498568601964544[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:05.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498568601964544[0;39m ==> Parameters: 
2022-04-18 22:54:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498568601964544[0;39m <==    Updates: 0
2022-04-18 22:54:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498568601964544[0;39m 生成今日电子书快照结束，耗时：27毫秒
2022-04-18 22:54:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498589401518080[0;39m 生成今日电子书快照开始
2022-04-18 22:54:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498589401518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498589401518080[0;39m ==> Parameters: 
2022-04-18 22:54:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498589401518080[0;39m <==    Updates: 0
2022-04-18 22:54:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498589401518080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:54:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498610381426688[0;39m 生成今日电子书快照开始
2022-04-18 22:54:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498610381426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498610381426688[0;39m ==> Parameters: 
2022-04-18 22:54:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498610381426688[0;39m <==    Updates: 0
2022-04-18 22:54:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498610381426688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:54:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498631344558080[0;39m 生成今日电子书快照开始
2022-04-18 22:54:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498631344558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498631344558080[0;39m ==> Parameters: 
2022-04-18 22:54:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498631344558080[0;39m <==    Updates: 0
2022-04-18 22:54:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498631344558080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:54:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498652311883776[0;39m 生成今日电子书快照开始
2022-04-18 22:54:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498652311883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498652311883776[0;39m ==> Parameters: 
2022-04-18 22:54:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498652311883776[0;39m <==    Updates: 0
2022-04-18 22:54:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498652311883776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:54:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498673287598080[0;39m 生成今日电子书快照开始
2022-04-18 22:54:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498673287598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498673287598080[0;39m ==> Parameters: 
2022-04-18 22:54:30.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498673287598080[0;39m <==    Updates: 0
2022-04-18 22:54:30.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498673287598080[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:54:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498694259118080[0;39m 生成今日电子书快照开始
2022-04-18 22:54:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498694259118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498694259118080[0;39m ==> Parameters: 
2022-04-18 22:54:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498694259118080[0;39m <==    Updates: 0
2022-04-18 22:54:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498694259118080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:54:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498694477221888[0;39m start updating Ebook doc
2022-04-18 22:54:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498694477221888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:54:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498694477221888[0;39m ==> Parameters: 
2022-04-18 22:54:35.090 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498694477221888[0;39m <==    Updates: 1
2022-04-18 22:54:35.090 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498694477221888[0;39m update ends, take 35 millisecs
2022-04-18 22:54:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498715218055168[0;39m 生成今日电子书快照开始
2022-04-18 22:54:40.152 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498715218055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:40.152 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498715218055168[0;39m ==> Parameters: 
2022-04-18 22:54:40.323 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498715218055168[0;39m <==    Updates: 0
2022-04-18 22:54:40.324 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498715218055168[0;39m 生成今日电子书快照结束，耗时：324毫秒
2022-04-18 22:54:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498736210546688[0;39m 生成今日电子书快照开始
2022-04-18 22:54:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498736210546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498736210546688[0;39m ==> Parameters: 
2022-04-18 22:54:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498736210546688[0;39m <==    Updates: 0
2022-04-18 22:54:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498736210546688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:54:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498757182066688[0;39m 生成今日电子书快照开始
2022-04-18 22:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498757182066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498757182066688[0;39m ==> Parameters: 
2022-04-18 22:54:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498757182066688[0;39m <==    Updates: 0
2022-04-18 22:54:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498757182066688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:54:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498778141003776[0;39m 生成今日电子书快照开始
2022-04-18 22:54:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498778141003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:54:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498778141003776[0;39m ==> Parameters: 
2022-04-18 22:54:55.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498778141003776[0;39m <==    Updates: 0
2022-04-18 22:54:55.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498778141003776[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 22:55:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498799120912384[0;39m 生成今日电子书快照开始
2022-04-18 22:55:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498799120912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498799120912384[0;39m ==> Parameters: 
2022-04-18 22:55:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498799120912384[0;39m <==    Updates: 0
2022-04-18 22:55:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498799120912384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 22:55:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498820079849472[0;39m 生成今日电子书快照开始
2022-04-18 22:55:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498820079849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498820079849472[0;39m ==> Parameters: 
2022-04-18 22:55:05.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498820079849472[0;39m <==    Updates: 0
2022-04-18 22:55:05.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498820079849472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:55:05.053 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498820297953280[0;39m start updating Ebook doc
2022-04-18 22:55:05.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498820297953280[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:55:05.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498820297953280[0;39m ==> Parameters: 
2022-04-18 22:55:05.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498820297953280[0;39m <==    Updates: 1
2022-04-18 22:55:05.095 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498820297953280[0;39m update ends, take 42 millisecs
2022-04-18 22:55:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498841068146688[0;39m 生成今日电子书快照开始
2022-04-18 22:55:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498841068146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498841068146688[0;39m ==> Parameters: 
2022-04-18 22:55:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498841068146688[0;39m <==    Updates: 0
2022-04-18 22:55:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498841068146688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:55:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498862027083776[0;39m 生成今日电子书快照开始
2022-04-18 22:55:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498862027083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498862027083776[0;39m ==> Parameters: 
2022-04-18 22:55:15.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498862027083776[0;39m <==    Updates: 0
2022-04-18 22:55:15.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498862027083776[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:55:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498882998603776[0;39m 生成今日电子书快照开始
2022-04-18 22:55:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498882998603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498882998603776[0;39m ==> Parameters: 
2022-04-18 22:55:20.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498882998603776[0;39m <==    Updates: 0
2022-04-18 22:55:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498882998603776[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:55:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498903965929472[0;39m 生成今日电子书快照开始
2022-04-18 22:55:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498903965929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498903965929472[0;39m ==> Parameters: 
2022-04-18 22:55:25.169 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498903965929472[0;39m <==    Updates: 0
2022-04-18 22:55:25.169 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498903965929472[0;39m 生成今日电子书快照结束，耗时：167毫秒
2022-04-18 22:55:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498924950032384[0;39m 生成今日电子书快照开始
2022-04-18 22:55:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498924950032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498924950032384[0;39m ==> Parameters: 
2022-04-18 22:55:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498924950032384[0;39m <==    Updates: 0
2022-04-18 22:55:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498924950032384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:55:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498945917358080[0;39m 生成今日电子书快照开始
2022-04-18 22:55:35.147 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498945917358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:35.148 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498945917358080[0;39m ==> Parameters: 
2022-04-18 22:55:35.426 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498945917358080[0;39m <==    Updates: 0
2022-04-18 22:55:35.426 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498945917358080[0;39m 生成今日电子书快照结束，耗时：423毫秒
2022-04-18 22:55:35.426 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171498947691548672[0;39m start updating Ebook doc
2022-04-18 22:55:35.427 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498947691548672[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:55:35.427 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498947691548672[0;39m ==> Parameters: 
2022-04-18 22:55:35.518 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171498947691548672[0;39m <==    Updates: 1
2022-04-18 22:55:35.519 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171498947691548672[0;39m update ends, take 93 millisecs
2022-04-18 22:55:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498966880489472[0;39m 生成今日电子书快照开始
2022-04-18 22:55:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498966880489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498966880489472[0;39m ==> Parameters: 
2022-04-18 22:55:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498966880489472[0;39m <==    Updates: 0
2022-04-18 22:55:40.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498966880489472[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:55:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171498987860398080[0;39m 生成今日电子书快照开始
2022-04-18 22:55:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498987860398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498987860398080[0;39m ==> Parameters: 
2022-04-18 22:55:45.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171498987860398080[0;39m <==    Updates: 0
2022-04-18 22:55:45.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171498987860398080[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 22:55:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499008831918080[0;39m 生成今日电子书快照开始
2022-04-18 22:55:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499008831918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499008831918080[0;39m ==> Parameters: 
2022-04-18 22:55:50.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499008831918080[0;39m <==    Updates: 0
2022-04-18 22:55:50.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499008831918080[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 22:55:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499029790855168[0;39m 生成今日电子书快照开始
2022-04-18 22:55:55.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499029790855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:55:55.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499029790855168[0;39m ==> Parameters: 
2022-04-18 22:55:55.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499029790855168[0;39m <==    Updates: 0
2022-04-18 22:55:55.043 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499029790855168[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:56:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499050762375168[0;39m 生成今日电子书快照开始
2022-04-18 22:56:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499050762375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499050762375168[0;39m ==> Parameters: 
2022-04-18 22:56:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499050762375168[0;39m <==    Updates: 0
2022-04-18 22:56:00.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499050762375168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:56:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499071742283776[0;39m start updating Ebook doc
2022-04-18 22:56:05.018 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499071742283776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:56:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499071742283776[0;39m ==> Parameters: 
2022-04-18 22:56:05.045 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499071742283776[0;39m <==    Updates: 1
2022-04-18 22:56:05.046 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499071742283776[0;39m update ends, take 43 millisecs
2022-04-18 22:56:05.046 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499071926833152[0;39m 生成今日电子书快照开始
2022-04-18 22:56:05.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499071926833152[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:05.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499071926833152[0;39m ==> Parameters: 
2022-04-18 22:56:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499071926833152[0;39m <==    Updates: 0
2022-04-18 22:56:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499071926833152[0;39m 生成今日电子书快照结束，耗时：25毫秒
2022-04-18 22:56:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499092705415168[0;39m 生成今日电子书快照开始
2022-04-18 22:56:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499092705415168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499092705415168[0;39m ==> Parameters: 
2022-04-18 22:56:10.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499092705415168[0;39m <==    Updates: 0
2022-04-18 22:56:10.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499092705415168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 22:56:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499113689518080[0;39m 生成今日电子书快照开始
2022-04-18 22:56:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499113689518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499113689518080[0;39m ==> Parameters: 
2022-04-18 22:56:15.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499113689518080[0;39m <==    Updates: 0
2022-04-18 22:56:15.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499113689518080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 22:56:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499134669426688[0;39m 生成今日电子书快照开始
2022-04-18 22:56:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499134669426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499134669426688[0;39m ==> Parameters: 
2022-04-18 22:56:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499134669426688[0;39m <==    Updates: 0
2022-04-18 22:56:20.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499134669426688[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:56:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499155632558080[0;39m 生成今日电子书快照开始
2022-04-18 22:56:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499155632558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499155632558080[0;39m ==> Parameters: 
2022-04-18 22:56:25.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499155632558080[0;39m <==    Updates: 0
2022-04-18 22:56:25.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499155632558080[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 22:56:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499176612466688[0;39m 生成今日电子书快照开始
2022-04-18 22:56:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499176612466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499176612466688[0;39m ==> Parameters: 
2022-04-18 22:56:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499176612466688[0;39m <==    Updates: 0
2022-04-18 22:56:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499176612466688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 22:56:35.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499197563015168[0;39m start updating Ebook doc
2022-04-18 22:56:35.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499197563015168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:56:35.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499197563015168[0;39m ==> Parameters: 
2022-04-18 22:56:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499197563015168[0;39m <==    Updates: 1
2022-04-18 22:56:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499197563015168[0;39m update ends, take 66 millisecs
2022-04-18 22:56:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499197844033536[0;39m 生成今日电子书快照开始
2022-04-18 22:56:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499197844033536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499197844033536[0;39m ==> Parameters: 
2022-04-18 22:56:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499197844033536[0;39m <==    Updates: 0
2022-04-18 22:56:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499197844033536[0;39m 生成今日电子书快照结束，耗时：32毫秒
2022-04-18 22:56:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499218542923776[0;39m 生成今日电子书快照开始
2022-04-18 22:56:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499218542923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499218542923776[0;39m ==> Parameters: 
2022-04-18 22:56:40.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499218542923776[0;39m <==    Updates: 0
2022-04-18 22:56:40.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499218542923776[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 22:56:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499239527026688[0;39m 生成今日电子书快照开始
2022-04-18 22:56:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499239527026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499239527026688[0;39m ==> Parameters: 
2022-04-18 22:56:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499239527026688[0;39m <==    Updates: 0
2022-04-18 22:56:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499239527026688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 22:56:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499260494352384[0;39m 生成今日电子书快照开始
2022-04-18 22:56:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499260494352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499260494352384[0;39m ==> Parameters: 
2022-04-18 22:56:50.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499260494352384[0;39m <==    Updates: 0
2022-04-18 22:56:50.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499260494352384[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 22:56:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499281457483776[0;39m 生成今日电子书快照开始
2022-04-18 22:56:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499281457483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:56:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499281457483776[0;39m ==> Parameters: 
2022-04-18 22:56:55.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499281457483776[0;39m <==    Updates: 0
2022-04-18 22:56:55.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499281457483776[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:57:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499302433198080[0;39m 生成今日电子书快照开始
2022-04-18 22:57:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499302433198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499302433198080[0;39m ==> Parameters: 
2022-04-18 22:57:00.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499302433198080[0;39m <==    Updates: 0
2022-04-18 22:57:00.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499302433198080[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 22:57:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499323396329472[0;39m start updating Ebook doc
2022-04-18 22:57:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499323396329472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:57:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499323396329472[0;39m ==> Parameters: 
2022-04-18 22:57:05.050 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499323396329472[0;39m <==    Updates: 1
2022-04-18 22:57:05.050 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499323396329472[0;39m update ends, take 49 millisecs
2022-04-18 22:57:05.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499323606044672[0;39m 生成今日电子书快照开始
2022-04-18 22:57:05.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499323606044672[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:05.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499323606044672[0;39m ==> Parameters: 
2022-04-18 22:57:05.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499323606044672[0;39m <==    Updates: 0
2022-04-18 22:57:05.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499323606044672[0;39m 生成今日电子书快照结束，耗时：29毫秒
2022-04-18 22:57:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499344363655168[0;39m 生成今日电子书快照开始
2022-04-18 22:57:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499344363655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499344363655168[0;39m ==> Parameters: 
2022-04-18 22:57:10.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499344363655168[0;39m <==    Updates: 0
2022-04-18 22:57:10.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499344363655168[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:57:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499365347758080[0;39m 生成今日电子书快照开始
2022-04-18 22:57:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499365347758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499365347758080[0;39m ==> Parameters: 
2022-04-18 22:57:15.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499365347758080[0;39m <==    Updates: 0
2022-04-18 22:57:15.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499365347758080[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 22:57:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499386323472384[0;39m 生成今日电子书快照开始
2022-04-18 22:57:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499386323472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499386323472384[0;39m ==> Parameters: 
2022-04-18 22:57:20.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499386323472384[0;39m <==    Updates: 0
2022-04-18 22:57:20.046 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499386323472384[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 22:57:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499407286603776[0;39m 生成今日电子书快照开始
2022-04-18 22:57:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499407286603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499407286603776[0;39m ==> Parameters: 
2022-04-18 22:57:25.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499407286603776[0;39m <==    Updates: 0
2022-04-18 22:57:25.046 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499407286603776[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 22:57:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499428270706688[0;39m 生成今日电子书快照开始
2022-04-18 22:57:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499428270706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499428270706688[0;39m ==> Parameters: 
2022-04-18 22:57:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499428270706688[0;39m <==    Updates: 0
2022-04-18 22:57:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499428270706688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:57:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499449242226688[0;39m start updating Ebook doc
2022-04-18 22:57:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499449242226688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:57:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499449242226688[0;39m ==> Parameters: 
2022-04-18 22:57:35.049 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499449242226688[0;39m <==    Updates: 1
2022-04-18 22:57:35.049 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499449242226688[0;39m update ends, take 44 millisecs
2022-04-18 22:57:35.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499449430970368[0;39m 生成今日电子书快照开始
2022-04-18 22:57:35.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499449430970368[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:35.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499449430970368[0;39m ==> Parameters: 
2022-04-18 22:57:35.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499449430970368[0;39m <==    Updates: 0
2022-04-18 22:57:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499449430970368[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 22:57:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499470192775168[0;39m 生成今日电子书快照开始
2022-04-18 22:57:40.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499470192775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499470192775168[0;39m ==> Parameters: 
2022-04-18 22:57:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499470192775168[0;39m <==    Updates: 0
2022-04-18 22:57:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499470192775168[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 22:57:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499491185266688[0;39m 生成今日电子书快照开始
2022-04-18 22:57:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499491185266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499491185266688[0;39m ==> Parameters: 
2022-04-18 22:57:45.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499491185266688[0;39m <==    Updates: 0
2022-04-18 22:57:45.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499491185266688[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 22:57:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499512148398080[0;39m 生成今日电子书快照开始
2022-04-18 22:57:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499512148398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499512148398080[0;39m ==> Parameters: 
2022-04-18 22:57:50.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499512148398080[0;39m <==    Updates: 0
2022-04-18 22:57:50.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499512148398080[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 22:57:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499533124112384[0;39m 生成今日电子书快照开始
2022-04-18 22:57:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499533124112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:57:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499533124112384[0;39m ==> Parameters: 
2022-04-18 22:57:55.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499533124112384[0;39m <==    Updates: 0
2022-04-18 22:57:55.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499533124112384[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 22:58:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499554091438080[0;39m 生成今日电子书快照开始
2022-04-18 22:58:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499554091438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499554091438080[0;39m ==> Parameters: 
2022-04-18 22:58:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499554091438080[0;39m <==    Updates: 0
2022-04-18 22:58:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499554091438080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:58:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499575058763776[0;39m start updating Ebook doc
2022-04-18 22:58:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499575058763776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:58:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499575058763776[0;39m ==> Parameters: 
2022-04-18 22:58:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499575058763776[0;39m <==    Updates: 1
2022-04-18 22:58:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499575058763776[0;39m update ends, take 61 millisecs
2022-04-18 22:58:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499575314616320[0;39m 生成今日电子书快照开始
2022-04-18 22:58:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499575314616320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499575314616320[0;39m ==> Parameters: 
2022-04-18 22:58:05.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499575314616320[0;39m <==    Updates: 0
2022-04-18 22:58:05.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499575314616320[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 22:58:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499596034478080[0;39m 生成今日电子书快照开始
2022-04-18 22:58:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499596034478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499596034478080[0;39m ==> Parameters: 
2022-04-18 22:58:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499596034478080[0;39m <==    Updates: 0
2022-04-18 22:58:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499596034478080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 22:58:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499617005998080[0;39m 生成今日电子书快照开始
2022-04-18 22:58:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499617005998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499617005998080[0;39m ==> Parameters: 
2022-04-18 22:58:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499617005998080[0;39m <==    Updates: 0
2022-04-18 22:58:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499617005998080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:58:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499637964935168[0;39m 生成今日电子书快照开始
2022-04-18 22:58:20.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499637964935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499637964935168[0;39m ==> Parameters: 
2022-04-18 22:58:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499637964935168[0;39m <==    Updates: 0
2022-04-18 22:58:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499637964935168[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 22:58:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499658953232384[0;39m 生成今日电子书快照开始
2022-04-18 22:58:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499658953232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499658953232384[0;39m ==> Parameters: 
2022-04-18 22:58:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499658953232384[0;39m <==    Updates: 0
2022-04-18 22:58:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499658953232384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 22:58:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499679924752384[0;39m 生成今日电子书快照开始
2022-04-18 22:58:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499679924752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499679924752384[0;39m ==> Parameters: 
2022-04-18 22:58:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499679924752384[0;39m <==    Updates: 0
2022-04-18 22:58:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499679924752384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:58:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499700892078080[0;39m start updating Ebook doc
2022-04-18 22:58:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499700892078080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:58:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499700892078080[0;39m ==> Parameters: 
2022-04-18 22:58:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499700892078080[0;39m <==    Updates: 1
2022-04-18 22:58:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499700892078080[0;39m update ends, take 54 millisecs
2022-04-18 22:58:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499701122764800[0;39m 生成今日电子书快照开始
2022-04-18 22:58:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499701122764800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499701122764800[0;39m ==> Parameters: 
2022-04-18 22:58:35.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499701122764800[0;39m <==    Updates: 0
2022-04-18 22:58:35.102 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499701122764800[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 22:58:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499721871986688[0;39m 生成今日电子书快照开始
2022-04-18 22:58:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499721871986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499721871986688[0;39m ==> Parameters: 
2022-04-18 22:58:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499721871986688[0;39m <==    Updates: 0
2022-04-18 22:58:40.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499721871986688[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 22:58:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499742830923776[0;39m 生成今日电子书快照开始
2022-04-18 22:58:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499742830923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499742830923776[0;39m ==> Parameters: 
2022-04-18 22:58:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499742830923776[0;39m <==    Updates: 0
2022-04-18 22:58:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499742830923776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:58:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499763815026688[0;39m 生成今日电子书快照开始
2022-04-18 22:58:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499763815026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499763815026688[0;39m ==> Parameters: 
2022-04-18 22:58:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499763815026688[0;39m <==    Updates: 0
2022-04-18 22:58:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499763815026688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 22:58:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499784782352384[0;39m 生成今日电子书快照开始
2022-04-18 22:58:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499784782352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:58:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499784782352384[0;39m ==> Parameters: 
2022-04-18 22:58:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499784782352384[0;39m <==    Updates: 0
2022-04-18 22:58:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499784782352384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:59:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499805753872384[0;39m 生成今日电子书快照开始
2022-04-18 22:59:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499805753872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499805753872384[0;39m ==> Parameters: 
2022-04-18 22:59:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499805753872384[0;39m <==    Updates: 0
2022-04-18 22:59:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499805753872384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 22:59:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499826721198080[0;39m 生成今日电子书快照开始
2022-04-18 22:59:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499826721198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499826721198080[0;39m ==> Parameters: 
2022-04-18 22:59:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499826721198080[0;39m <==    Updates: 0
2022-04-18 22:59:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499826721198080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 22:59:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499826998022144[0;39m start updating Ebook doc
2022-04-18 22:59:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499826998022144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:59:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499826998022144[0;39m ==> Parameters: 
2022-04-18 22:59:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499826998022144[0;39m <==    Updates: 1
2022-04-18 22:59:05.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499826998022144[0;39m update ends, take 44 millisecs
2022-04-18 22:59:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499847696912384[0;39m 生成今日电子书快照开始
2022-04-18 22:59:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499847696912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499847696912384[0;39m ==> Parameters: 
2022-04-18 22:59:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499847696912384[0;39m <==    Updates: 0
2022-04-18 22:59:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499847696912384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 22:59:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499868668432384[0;39m 生成今日电子书快照开始
2022-04-18 22:59:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499868668432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499868668432384[0;39m ==> Parameters: 
2022-04-18 22:59:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499868668432384[0;39m <==    Updates: 0
2022-04-18 22:59:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499868668432384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 22:59:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499889639952384[0;39m 生成今日电子书快照开始
2022-04-18 22:59:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499889639952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499889639952384[0;39m ==> Parameters: 
2022-04-18 22:59:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499889639952384[0;39m <==    Updates: 0
2022-04-18 22:59:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499889639952384[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 22:59:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499910611472384[0;39m 生成今日电子书快照开始
2022-04-18 22:59:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499910611472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499910611472384[0;39m ==> Parameters: 
2022-04-18 22:59:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499910611472384[0;39m <==    Updates: 0
2022-04-18 22:59:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499910611472384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 22:59:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499931582992384[0;39m 生成今日电子书快照开始
2022-04-18 22:59:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499931582992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499931582992384[0;39m ==> Parameters: 
2022-04-18 22:59:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499931582992384[0;39m <==    Updates: 0
2022-04-18 22:59:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499931582992384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:59:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499952558706688[0;39m 生成今日电子书快照开始
2022-04-18 22:59:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499952558706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499952558706688[0;39m ==> Parameters: 
2022-04-18 22:59:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499952558706688[0;39m <==    Updates: 0
2022-04-18 22:59:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499952558706688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 22:59:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171499952827142144[0;39m start updating Ebook doc
2022-04-18 22:59:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499952827142144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 22:59:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499952827142144[0;39m ==> Parameters: 
2022-04-18 22:59:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171499952827142144[0;39m <==    Updates: 1
2022-04-18 22:59:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171499952827142144[0;39m update ends, take 39 millisecs
2022-04-18 22:59:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499973521838080[0;39m 生成今日电子书快照开始
2022-04-18 22:59:40.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499973521838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:40.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499973521838080[0;39m ==> Parameters: 
2022-04-18 22:59:40.258 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499973521838080[0;39m <==    Updates: 0
2022-04-18 22:59:40.258 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499973521838080[0;39m 生成今日电子书快照结束，耗时：255毫秒
2022-04-18 22:59:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171499994489163776[0;39m 生成今日电子书快照开始
2022-04-18 22:59:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499994489163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499994489163776[0;39m ==> Parameters: 
2022-04-18 22:59:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171499994489163776[0;39m <==    Updates: 0
2022-04-18 22:59:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171499994489163776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 22:59:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500015460683776[0;39m 生成今日电子书快照开始
2022-04-18 22:59:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500015460683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500015460683776[0;39m ==> Parameters: 
2022-04-18 22:59:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500015460683776[0;39m <==    Updates: 0
2022-04-18 22:59:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500015460683776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 22:59:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500036436398080[0;39m 生成今日电子书快照开始
2022-04-18 22:59:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500036436398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 22:59:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500036436398080[0;39m ==> Parameters: 
2022-04-18 22:59:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500036436398080[0;39m <==    Updates: 0
2022-04-18 22:59:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500036436398080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:00:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500057395335168[0;39m 生成今日电子书快照开始
2022-04-18 23:00:00.355 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500057395335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:00.356 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500057395335168[0;39m ==> Parameters: 
2022-04-18 23:00:00.401 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500057395335168[0;39m <==    Updates: 0
2022-04-18 23:00:00.402 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500057395335168[0;39m 生成今日电子书快照结束，耗时：402毫秒
2022-04-18 23:00:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500078375243776[0;39m 生成今日电子书快照开始
2022-04-18 23:00:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500078375243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500078375243776[0;39m ==> Parameters: 
2022-04-18 23:00:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500078375243776[0;39m <==    Updates: 0
2022-04-18 23:00:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500078375243776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:00:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500078660456448[0;39m start updating Ebook doc
2022-04-18 23:00:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500078660456448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:00:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500078660456448[0;39m ==> Parameters: 
2022-04-18 23:00:05.133 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500078660456448[0;39m <==    Updates: 1
2022-04-18 23:00:05.133 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500078660456448[0;39m update ends, take 62 millisecs
2022-04-18 23:00:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500099359346688[0;39m 生成今日电子书快照开始
2022-04-18 23:00:10.263 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500099359346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:10.264 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500099359346688[0;39m ==> Parameters: 
2022-04-18 23:00:10.305 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500099359346688[0;39m <==    Updates: 0
2022-04-18 23:00:10.305 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500099359346688[0;39m 生成今日电子书快照结束，耗时：299毫秒
2022-04-18 23:00:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500120309895168[0;39m 生成今日电子书快照开始
2022-04-18 23:00:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500120309895168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500120309895168[0;39m ==> Parameters: 
2022-04-18 23:00:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500120309895168[0;39m <==    Updates: 0
2022-04-18 23:00:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500120309895168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:00:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500141302386688[0;39m 生成今日电子书快照开始
2022-04-18 23:00:20.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500141302386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:20.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500141302386688[0;39m ==> Parameters: 
2022-04-18 23:00:20.150 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500141302386688[0;39m <==    Updates: 0
2022-04-18 23:00:20.150 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500141302386688[0;39m 生成今日电子书快照结束，耗时：145毫秒
2022-04-18 23:00:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500162257129472[0;39m 生成今日电子书快照开始
2022-04-18 23:00:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500162257129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500162257129472[0;39m ==> Parameters: 
2022-04-18 23:00:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500162257129472[0;39m <==    Updates: 0
2022-04-18 23:00:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500162257129472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:00:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500183228649472[0;39m 生成今日电子书快照开始
2022-04-18 23:00:30.199 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500183228649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:30.199 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500183228649472[0;39m ==> Parameters: 
2022-04-18 23:00:30.242 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500183228649472[0;39m <==    Updates: 0
2022-04-18 23:00:30.242 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500183228649472[0;39m 生成今日电子书快照结束，耗时：241毫秒
2022-04-18 23:00:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500204208558080[0;39m start updating Ebook doc
2022-04-18 23:00:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500204208558080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:00:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500204208558080[0;39m ==> Parameters: 
2022-04-18 23:00:35.246 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500204208558080[0;39m <==    Updates: 1
2022-04-18 23:00:35.246 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500204208558080[0;39m update ends, take 243 millisecs
2022-04-18 23:00:35.246 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500205227773952[0;39m 生成今日电子书快照开始
2022-04-18 23:00:35.247 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500205227773952[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:35.247 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500205227773952[0;39m ==> Parameters: 
2022-04-18 23:00:35.287 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500205227773952[0;39m <==    Updates: 0
2022-04-18 23:00:35.287 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500205227773952[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:00:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500225171689472[0;39m 生成今日电子书快照开始
2022-04-18 23:00:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500225171689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500225171689472[0;39m ==> Parameters: 
2022-04-18 23:00:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500225171689472[0;39m <==    Updates: 0
2022-04-18 23:00:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500225171689472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:00:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500246143209472[0;39m 生成今日电子书快照开始
2022-04-18 23:00:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500246143209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500246143209472[0;39m ==> Parameters: 
2022-04-18 23:00:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500246143209472[0;39m <==    Updates: 0
2022-04-18 23:00:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500246143209472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:00:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500267131506688[0;39m 生成今日电子书快照开始
2022-04-18 23:00:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500267131506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500267131506688[0;39m ==> Parameters: 
2022-04-18 23:00:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500267131506688[0;39m <==    Updates: 0
2022-04-18 23:00:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500267131506688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:00:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500288086249472[0;39m 生成今日电子书快照开始
2022-04-18 23:00:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500288086249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:00:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500288086249472[0;39m ==> Parameters: 
2022-04-18 23:00:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500288086249472[0;39m <==    Updates: 0
2022-04-18 23:00:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500288086249472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:01:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500309053575168[0;39m 生成今日电子书快照开始
2022-04-18 23:01:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500309053575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500309053575168[0;39m ==> Parameters: 
2022-04-18 23:01:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500309053575168[0;39m <==    Updates: 0
2022-04-18 23:01:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500309053575168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:01:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500330037678080[0;39m 生成今日电子书快照开始
2022-04-18 23:01:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500330037678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500330037678080[0;39m ==> Parameters: 
2022-04-18 23:01:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500330037678080[0;39m <==    Updates: 0
2022-04-18 23:01:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500330037678080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:01:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500330293530624[0;39m start updating Ebook doc
2022-04-18 23:01:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500330293530624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:01:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500330293530624[0;39m ==> Parameters: 
2022-04-18 23:01:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500330293530624[0;39m <==    Updates: 1
2022-04-18 23:01:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500330293530624[0;39m update ends, take 38 millisecs
2022-04-18 23:01:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500351013392384[0;39m 生成今日电子书快照开始
2022-04-18 23:01:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500351013392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500351013392384[0;39m ==> Parameters: 
2022-04-18 23:01:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500351013392384[0;39m <==    Updates: 0
2022-04-18 23:01:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500351013392384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:01:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500371976523776[0;39m 生成今日电子书快照开始
2022-04-18 23:01:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500371976523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500371976523776[0;39m ==> Parameters: 
2022-04-18 23:01:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500371976523776[0;39m <==    Updates: 0
2022-04-18 23:01:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500371976523776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:01:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500392956432384[0;39m 生成今日电子书快照开始
2022-04-18 23:01:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500392956432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500392956432384[0;39m ==> Parameters: 
2022-04-18 23:01:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500392956432384[0;39m <==    Updates: 0
2022-04-18 23:01:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500392956432384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:01:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500413919563776[0;39m 生成今日电子书快照开始
2022-04-18 23:01:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500413919563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500413919563776[0;39m ==> Parameters: 
2022-04-18 23:01:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500413919563776[0;39m <==    Updates: 0
2022-04-18 23:01:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500413919563776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:01:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500434891083776[0;39m 生成今日电子书快照开始
2022-04-18 23:01:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500434891083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500434891083776[0;39m ==> Parameters: 
2022-04-18 23:01:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500434891083776[0;39m <==    Updates: 0
2022-04-18 23:01:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500434891083776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:01:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500455866798080[0;39m 生成今日电子书快照开始
2022-04-18 23:01:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500455866798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500455866798080[0;39m ==> Parameters: 
2022-04-18 23:01:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500455866798080[0;39m <==    Updates: 0
2022-04-18 23:01:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500455866798080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:01:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500456114262016[0;39m start updating Ebook doc
2022-04-18 23:01:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500456114262016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:01:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500456114262016[0;39m ==> Parameters: 
2022-04-18 23:01:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500456114262016[0;39m <==    Updates: 1
2022-04-18 23:01:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500456114262016[0;39m update ends, take 38 millisecs
2022-04-18 23:01:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500476846706688[0;39m 生成今日电子书快照开始
2022-04-18 23:01:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500476846706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500476846706688[0;39m ==> Parameters: 
2022-04-18 23:01:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500476846706688[0;39m <==    Updates: 0
2022-04-18 23:01:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500476846706688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:01:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500497814032384[0;39m 生成今日电子书快照开始
2022-04-18 23:01:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500497814032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500497814032384[0;39m ==> Parameters: 
2022-04-18 23:01:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500497814032384[0;39m <==    Updates: 0
2022-04-18 23:01:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500497814032384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:01:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500518772969472[0;39m 生成今日电子书快照开始
2022-04-18 23:01:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500518772969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500518772969472[0;39m ==> Parameters: 
2022-04-18 23:01:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500518772969472[0;39m <==    Updates: 0
2022-04-18 23:01:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500518772969472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:01:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500539748683776[0;39m 生成今日电子书快照开始
2022-04-18 23:01:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500539748683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:01:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500539748683776[0;39m ==> Parameters: 
2022-04-18 23:01:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500539748683776[0;39m <==    Updates: 0
2022-04-18 23:01:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500539748683776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:02:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500560716009472[0;39m 生成今日电子书快照开始
2022-04-18 23:02:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500560716009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500560716009472[0;39m ==> Parameters: 
2022-04-18 23:02:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500560716009472[0;39m <==    Updates: 0
2022-04-18 23:02:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500560716009472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:02:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500581691723776[0;39m start updating Ebook doc
2022-04-18 23:02:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500581691723776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:02:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500581691723776[0;39m ==> Parameters: 
2022-04-18 23:02:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500581691723776[0;39m <==    Updates: 1
2022-04-18 23:02:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500581691723776[0;39m update ends, take 60 millisecs
2022-04-18 23:02:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500581943382016[0;39m 生成今日电子书快照开始
2022-04-18 23:02:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500581943382016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500581943382016[0;39m ==> Parameters: 
2022-04-18 23:02:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500581943382016[0;39m <==    Updates: 0
2022-04-18 23:02:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500581943382016[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:02:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500602671632384[0;39m 生成今日电子书快照开始
2022-04-18 23:02:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500602671632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500602671632384[0;39m ==> Parameters: 
2022-04-18 23:02:10.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500602671632384[0;39m <==    Updates: 0
2022-04-18 23:02:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500602671632384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:02:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500623643152384[0;39m 生成今日电子书快照开始
2022-04-18 23:02:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500623643152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500623643152384[0;39m ==> Parameters: 
2022-04-18 23:02:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500623643152384[0;39m <==    Updates: 0
2022-04-18 23:02:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500623643152384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:02:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500644614672384[0;39m 生成今日电子书快照开始
2022-04-18 23:02:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500644614672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500644614672384[0;39m ==> Parameters: 
2022-04-18 23:02:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500644614672384[0;39m <==    Updates: 0
2022-04-18 23:02:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500644614672384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:02:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500665586192384[0;39m 生成今日电子书快照开始
2022-04-18 23:02:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500665586192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500665586192384[0;39m ==> Parameters: 
2022-04-18 23:02:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500665586192384[0;39m <==    Updates: 0
2022-04-18 23:02:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500665586192384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:02:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500686553518080[0;39m 生成今日电子书快照开始
2022-04-18 23:02:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500686553518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500686553518080[0;39m ==> Parameters: 
2022-04-18 23:02:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500686553518080[0;39m <==    Updates: 0
2022-04-18 23:02:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500686553518080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:02:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500707525038080[0;39m 生成今日电子书快照开始
2022-04-18 23:02:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500707525038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500707525038080[0;39m ==> Parameters: 
2022-04-18 23:02:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500707525038080[0;39m <==    Updates: 0
2022-04-18 23:02:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500707525038080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:02:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500707759919104[0;39m start updating Ebook doc
2022-04-18 23:02:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500707759919104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:02:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500707759919104[0;39m ==> Parameters: 
2022-04-18 23:02:35.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500707759919104[0;39m <==    Updates: 1
2022-04-18 23:02:35.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500707759919104[0;39m update ends, take 38 millisecs
2022-04-18 23:02:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500728504946688[0;39m 生成今日电子书快照开始
2022-04-18 23:02:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500728504946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500728504946688[0;39m ==> Parameters: 
2022-04-18 23:02:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500728504946688[0;39m <==    Updates: 0
2022-04-18 23:02:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500728504946688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:02:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500749472272384[0;39m 生成今日电子书快照开始
2022-04-18 23:02:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500749472272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500749472272384[0;39m ==> Parameters: 
2022-04-18 23:02:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500749472272384[0;39m <==    Updates: 0
2022-04-18 23:02:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500749472272384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:02:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500770443792384[0;39m 生成今日电子书快照开始
2022-04-18 23:02:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500770443792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500770443792384[0;39m ==> Parameters: 
2022-04-18 23:02:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500770443792384[0;39m <==    Updates: 0
2022-04-18 23:02:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500770443792384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:02:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500791419506688[0;39m 生成今日电子书快照开始
2022-04-18 23:02:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500791419506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:02:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500791419506688[0;39m ==> Parameters: 
2022-04-18 23:02:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500791419506688[0;39m <==    Updates: 0
2022-04-18 23:02:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500791419506688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:03:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500812386832384[0;39m 生成今日电子书快照开始
2022-04-18 23:03:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500812386832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500812386832384[0;39m ==> Parameters: 
2022-04-18 23:03:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500812386832384[0;39m <==    Updates: 0
2022-04-18 23:03:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500812386832384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:03:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500833358352384[0;39m start updating Ebook doc
2022-04-18 23:03:05.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500833358352384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:03:05.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500833358352384[0;39m ==> Parameters: 
2022-04-18 23:03:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500833358352384[0;39m <==    Updates: 1
2022-04-18 23:03:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500833358352384[0;39m update ends, take 55 millisecs
2022-04-18 23:03:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500833589039104[0;39m 生成今日电子书快照开始
2022-04-18 23:03:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500833589039104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500833589039104[0;39m ==> Parameters: 
2022-04-18 23:03:05.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500833589039104[0;39m <==    Updates: 0
2022-04-18 23:03:05.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500833589039104[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:03:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500854317289472[0;39m 生成今日电子书快照开始
2022-04-18 23:03:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500854317289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500854317289472[0;39m ==> Parameters: 
2022-04-18 23:03:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500854317289472[0;39m <==    Updates: 0
2022-04-18 23:03:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500854317289472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:03:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500875288809472[0;39m 生成今日电子书快照开始
2022-04-18 23:03:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500875288809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500875288809472[0;39m ==> Parameters: 
2022-04-18 23:03:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500875288809472[0;39m <==    Updates: 0
2022-04-18 23:03:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500875288809472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:03:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500896272912384[0;39m 生成今日电子书快照开始
2022-04-18 23:03:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500896272912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500896272912384[0;39m ==> Parameters: 
2022-04-18 23:03:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500896272912384[0;39m <==    Updates: 0
2022-04-18 23:03:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500896272912384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:03:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500917227655168[0;39m 生成今日电子书快照开始
2022-04-18 23:03:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500917227655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500917227655168[0;39m ==> Parameters: 
2022-04-18 23:03:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500917227655168[0;39m <==    Updates: 0
2022-04-18 23:03:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500917227655168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:03:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500938203369472[0;39m 生成今日电子书快照开始
2022-04-18 23:03:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500938203369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500938203369472[0;39m ==> Parameters: 
2022-04-18 23:03:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500938203369472[0;39m <==    Updates: 0
2022-04-18 23:03:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500938203369472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:03:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500959170695168[0;39m 生成今日电子书快照开始
2022-04-18 23:03:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500959170695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500959170695168[0;39m ==> Parameters: 
2022-04-18 23:03:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500959170695168[0;39m <==    Updates: 0
2022-04-18 23:03:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500959170695168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:03:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171500959418159104[0;39m start updating Ebook doc
2022-04-18 23:03:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500959418159104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:03:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500959418159104[0;39m ==> Parameters: 
2022-04-18 23:03:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171500959418159104[0;39m <==    Updates: 1
2022-04-18 23:03:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171500959418159104[0;39m update ends, take 39 millisecs
2022-04-18 23:03:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171500980154798080[0;39m 生成今日电子书快照开始
2022-04-18 23:03:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500980154798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500980154798080[0;39m ==> Parameters: 
2022-04-18 23:03:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171500980154798080[0;39m <==    Updates: 0
2022-04-18 23:03:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171500980154798080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:03:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501001130512384[0;39m 生成今日电子书快照开始
2022-04-18 23:03:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501001130512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501001130512384[0;39m ==> Parameters: 
2022-04-18 23:03:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501001130512384[0;39m <==    Updates: 0
2022-04-18 23:03:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501001130512384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:03:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501022102032384[0;39m 生成今日电子书快照开始
2022-04-18 23:03:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501022102032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501022102032384[0;39m ==> Parameters: 
2022-04-18 23:03:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501022102032384[0;39m <==    Updates: 0
2022-04-18 23:03:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501022102032384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:03:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501043073552384[0;39m 生成今日电子书快照开始
2022-04-18 23:03:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501043073552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:03:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501043073552384[0;39m ==> Parameters: 
2022-04-18 23:03:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501043073552384[0;39m <==    Updates: 0
2022-04-18 23:03:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501043073552384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:04:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501064032489472[0;39m 生成今日电子书快照开始
2022-04-18 23:04:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501064032489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501064032489472[0;39m ==> Parameters: 
2022-04-18 23:04:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501064032489472[0;39m <==    Updates: 0
2022-04-18 23:04:00.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501064032489472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:04:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501085008203776[0;39m 生成今日电子书快照开始
2022-04-18 23:04:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501085008203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501085008203776[0;39m ==> Parameters: 
2022-04-18 23:04:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501085008203776[0;39m <==    Updates: 0
2022-04-18 23:04:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501085008203776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:04:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501085285027840[0;39m start updating Ebook doc
2022-04-18 23:04:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501085285027840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:04:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501085285027840[0;39m ==> Parameters: 
2022-04-18 23:04:05.111 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501085285027840[0;39m <==    Updates: 1
2022-04-18 23:04:05.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501085285027840[0;39m update ends, take 43 millisecs
2022-04-18 23:04:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501105979723776[0;39m 生成今日电子书快照开始
2022-04-18 23:04:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501105979723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501105979723776[0;39m ==> Parameters: 
2022-04-18 23:04:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501105979723776[0;39m <==    Updates: 0
2022-04-18 23:04:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501105979723776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:04:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501126959632384[0;39m 生成今日电子书快照开始
2022-04-18 23:04:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501126959632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501126959632384[0;39m ==> Parameters: 
2022-04-18 23:04:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501126959632384[0;39m <==    Updates: 0
2022-04-18 23:04:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501126959632384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:04:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501147931152384[0;39m 生成今日电子书快照开始
2022-04-18 23:04:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501147931152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501147931152384[0;39m ==> Parameters: 
2022-04-18 23:04:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501147931152384[0;39m <==    Updates: 0
2022-04-18 23:04:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501147931152384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:04:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501168898478080[0;39m 生成今日电子书快照开始
2022-04-18 23:04:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501168898478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501168898478080[0;39m ==> Parameters: 
2022-04-18 23:04:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501168898478080[0;39m <==    Updates: 0
2022-04-18 23:04:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501168898478080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:04:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501189878386688[0;39m 生成今日电子书快照开始
2022-04-18 23:04:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501189878386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501189878386688[0;39m ==> Parameters: 
2022-04-18 23:04:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501189878386688[0;39m <==    Updates: 0
2022-04-18 23:04:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501189878386688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:04:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501210833129472[0;39m start updating Ebook doc
2022-04-18 23:04:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501210833129472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:04:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501210833129472[0;39m ==> Parameters: 
2022-04-18 23:04:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501210833129472[0;39m <==    Updates: 1
2022-04-18 23:04:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501210833129472[0;39m update ends, take 53 millisecs
2022-04-18 23:04:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501211055427584[0;39m 生成今日电子书快照开始
2022-04-18 23:04:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501211055427584[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501211055427584[0;39m ==> Parameters: 
2022-04-18 23:04:35.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501211055427584[0;39m <==    Updates: 0
2022-04-18 23:04:35.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501211055427584[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:04:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501231813038080[0;39m 生成今日电子书快照开始
2022-04-18 23:04:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501231813038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501231813038080[0;39m ==> Parameters: 
2022-04-18 23:04:40.218 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501231813038080[0;39m <==    Updates: 0
2022-04-18 23:04:40.218 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501231813038080[0;39m 生成今日电子书快照结束，耗时：214毫秒
2022-04-18 23:04:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501252776169472[0;39m 生成今日电子书快照开始
2022-04-18 23:04:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501252776169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501252776169472[0;39m ==> Parameters: 
2022-04-18 23:04:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501252776169472[0;39m <==    Updates: 0
2022-04-18 23:04:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501252776169472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:04:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501273747689472[0;39m 生成今日电子书快照开始
2022-04-18 23:04:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501273747689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501273747689472[0;39m ==> Parameters: 
2022-04-18 23:04:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501273747689472[0;39m <==    Updates: 0
2022-04-18 23:04:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501273747689472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:04:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501294723403776[0;39m 生成今日电子书快照开始
2022-04-18 23:04:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501294723403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:04:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501294723403776[0;39m ==> Parameters: 
2022-04-18 23:04:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501294723403776[0;39m <==    Updates: 0
2022-04-18 23:04:55.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501294723403776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:05:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501315707506688[0;39m 生成今日电子书快照开始
2022-04-18 23:05:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501315707506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501315707506688[0;39m ==> Parameters: 
2022-04-18 23:05:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501315707506688[0;39m <==    Updates: 0
2022-04-18 23:05:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501315707506688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:05:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501336666443776[0;39m 生成今日电子书快照开始
2022-04-18 23:05:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501336666443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501336666443776[0;39m ==> Parameters: 
2022-04-18 23:05:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501336666443776[0;39m <==    Updates: 0
2022-04-18 23:05:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501336666443776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:05:05.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501336964239360[0;39m start updating Ebook doc
2022-04-18 23:05:05.090 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501336964239360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:05:05.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501336964239360[0;39m ==> Parameters: 
2022-04-18 23:05:05.128 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501336964239360[0;39m <==    Updates: 1
2022-04-18 23:05:05.128 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501336964239360[0;39m update ends, take 55 millisecs
2022-04-18 23:05:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501357642158080[0;39m 生成今日电子书快照开始
2022-04-18 23:05:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501357642158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501357642158080[0;39m ==> Parameters: 
2022-04-18 23:05:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501357642158080[0;39m <==    Updates: 0
2022-04-18 23:05:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501357642158080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:05:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501378609483776[0;39m 生成今日电子书快照开始
2022-04-18 23:05:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501378609483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501378609483776[0;39m ==> Parameters: 
2022-04-18 23:05:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501378609483776[0;39m <==    Updates: 0
2022-04-18 23:05:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501378609483776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:05:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501399581003776[0;39m 生成今日电子书快照开始
2022-04-18 23:05:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501399581003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501399581003776[0;39m ==> Parameters: 
2022-04-18 23:05:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501399581003776[0;39m <==    Updates: 0
2022-04-18 23:05:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501399581003776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:05:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501420556718080[0;39m 生成今日电子书快照开始
2022-04-18 23:05:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501420556718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501420556718080[0;39m ==> Parameters: 
2022-04-18 23:05:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501420556718080[0;39m <==    Updates: 0
2022-04-18 23:05:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501420556718080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:05:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501441532432384[0;39m 生成今日电子书快照开始
2022-04-18 23:05:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501441532432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501441532432384[0;39m ==> Parameters: 
2022-04-18 23:05:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501441532432384[0;39m <==    Updates: 0
2022-04-18 23:05:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501441532432384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:05:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501462487175168[0;39m 生成今日电子书快照开始
2022-04-18 23:05:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501462487175168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501462487175168[0;39m ==> Parameters: 
2022-04-18 23:05:35.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501462487175168[0;39m <==    Updates: 0
2022-04-18 23:05:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501462487175168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:05:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501462722056192[0;39m start updating Ebook doc
2022-04-18 23:05:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501462722056192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:05:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501462722056192[0;39m ==> Parameters: 
2022-04-18 23:05:35.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501462722056192[0;39m <==    Updates: 1
2022-04-18 23:05:35.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501462722056192[0;39m update ends, take 38 millisecs
2022-04-18 23:05:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501483467083776[0;39m 生成今日电子书快照开始
2022-04-18 23:05:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501483467083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501483467083776[0;39m ==> Parameters: 
2022-04-18 23:05:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501483467083776[0;39m <==    Updates: 0
2022-04-18 23:05:40.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501483467083776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:05:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501504451186688[0;39m 生成今日电子书快照开始
2022-04-18 23:05:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501504451186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501504451186688[0;39m ==> Parameters: 
2022-04-18 23:05:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501504451186688[0;39m <==    Updates: 0
2022-04-18 23:05:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501504451186688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:05:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501525422706688[0;39m 生成今日电子书快照开始
2022-04-18 23:05:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501525422706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501525422706688[0;39m ==> Parameters: 
2022-04-18 23:05:50.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501525422706688[0;39m <==    Updates: 0
2022-04-18 23:05:50.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501525422706688[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 23:05:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501546381643776[0;39m 生成今日电子书快照开始
2022-04-18 23:05:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501546381643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:05:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501546381643776[0;39m ==> Parameters: 
2022-04-18 23:05:55.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501546381643776[0;39m <==    Updates: 0
2022-04-18 23:05:55.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501546381643776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:06:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501567353163776[0;39m 生成今日电子书快照开始
2022-04-18 23:06:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501567353163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501567353163776[0;39m ==> Parameters: 
2022-04-18 23:06:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501567353163776[0;39m <==    Updates: 0
2022-04-18 23:06:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501567353163776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:06:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501588324683776[0;39m 生成今日电子书快照开始
2022-04-18 23:06:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501588324683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501588324683776[0;39m ==> Parameters: 
2022-04-18 23:06:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501588324683776[0;39m <==    Updates: 0
2022-04-18 23:06:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501588324683776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:06:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501588601507840[0;39m start updating Ebook doc
2022-04-18 23:06:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501588601507840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:06:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501588601507840[0;39m ==> Parameters: 
2022-04-18 23:06:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501588601507840[0;39m <==    Updates: 1
2022-04-18 23:06:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501588601507840[0;39m update ends, take 37 millisecs
2022-04-18 23:06:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501609300398080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501609300398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501609300398080[0;39m ==> Parameters: 
2022-04-18 23:06:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501609300398080[0;39m <==    Updates: 0
2022-04-18 23:06:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501609300398080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:06:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501630271918080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501630271918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501630271918080[0;39m ==> Parameters: 
2022-04-18 23:06:15.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501630271918080[0;39m <==    Updates: 0
2022-04-18 23:06:15.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501630271918080[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 23:06:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501651239243776[0;39m 生成今日电子书快照开始
2022-04-18 23:06:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501651239243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:20.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501651239243776[0;39m ==> Parameters: 
2022-04-18 23:06:20.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501651239243776[0;39m <==    Updates: 0
2022-04-18 23:06:20.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501651239243776[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 23:06:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501672214958080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501672214958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501672214958080[0;39m ==> Parameters: 
2022-04-18 23:06:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501672214958080[0;39m <==    Updates: 0
2022-04-18 23:06:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501672214958080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:06:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501693190672384[0;39m 生成今日电子书快照开始
2022-04-18 23:06:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501693190672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501693190672384[0;39m ==> Parameters: 
2022-04-18 23:06:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501693190672384[0;39m <==    Updates: 0
2022-04-18 23:06:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501693190672384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:06:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501714153803776[0;39m 生成今日电子书快照开始
2022-04-18 23:06:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501714153803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501714153803776[0;39m ==> Parameters: 
2022-04-18 23:06:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501714153803776[0;39m <==    Updates: 0
2022-04-18 23:06:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501714153803776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:06:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501714422239232[0;39m start updating Ebook doc
2022-04-18 23:06:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501714422239232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:06:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501714422239232[0;39m ==> Parameters: 
2022-04-18 23:06:35.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501714422239232[0;39m <==    Updates: 1
2022-04-18 23:06:35.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501714422239232[0;39m update ends, take 36 millisecs
2022-04-18 23:06:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501735129518080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501735129518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501735129518080[0;39m ==> Parameters: 
2022-04-18 23:06:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501735129518080[0;39m <==    Updates: 0
2022-04-18 23:06:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501735129518080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:06:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501756101038080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501756101038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501756101038080[0;39m ==> Parameters: 
2022-04-18 23:06:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501756101038080[0;39m <==    Updates: 0
2022-04-18 23:06:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501756101038080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:06:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501777072558080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501777072558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501777072558080[0;39m ==> Parameters: 
2022-04-18 23:06:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501777072558080[0;39m <==    Updates: 0
2022-04-18 23:06:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501777072558080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:06:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501798044078080[0;39m 生成今日电子书快照开始
2022-04-18 23:06:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501798044078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:06:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501798044078080[0;39m ==> Parameters: 
2022-04-18 23:06:55.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501798044078080[0;39m <==    Updates: 0
2022-04-18 23:06:55.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501798044078080[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 23:07:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501819011403776[0;39m 生成今日电子书快照开始
2022-04-18 23:07:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501819011403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501819011403776[0;39m ==> Parameters: 
2022-04-18 23:07:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501819011403776[0;39m <==    Updates: 0
2022-04-18 23:07:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501819011403776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:07:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501839982923776[0;39m 生成今日电子书快照开始
2022-04-18 23:07:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501839982923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501839982923776[0;39m ==> Parameters: 
2022-04-18 23:07:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501839982923776[0;39m <==    Updates: 0
2022-04-18 23:07:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501839982923776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:07:05.087 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501840339439616[0;39m start updating Ebook doc
2022-04-18 23:07:05.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501840339439616[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:07:05.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501840339439616[0;39m ==> Parameters: 
2022-04-18 23:07:05.123 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501840339439616[0;39m <==    Updates: 1
2022-04-18 23:07:05.124 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501840339439616[0;39m update ends, take 36 millisecs
2022-04-18 23:07:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501860958638080[0;39m 生成今日电子书快照开始
2022-04-18 23:07:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501860958638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501860958638080[0;39m ==> Parameters: 
2022-04-18 23:07:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501860958638080[0;39m <==    Updates: 0
2022-04-18 23:07:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501860958638080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:07:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501881930158080[0;39m 生成今日电子书快照开始
2022-04-18 23:07:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501881930158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501881930158080[0;39m ==> Parameters: 
2022-04-18 23:07:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501881930158080[0;39m <==    Updates: 0
2022-04-18 23:07:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501881930158080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:07:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501902901678080[0;39m 生成今日电子书快照开始
2022-04-18 23:07:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501902901678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501902901678080[0;39m ==> Parameters: 
2022-04-18 23:07:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501902901678080[0;39m <==    Updates: 0
2022-04-18 23:07:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501902901678080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:07:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501923869003776[0;39m 生成今日电子书快照开始
2022-04-18 23:07:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501923869003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501923869003776[0;39m ==> Parameters: 
2022-04-18 23:07:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501923869003776[0;39m <==    Updates: 0
2022-04-18 23:07:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501923869003776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:07:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501944844718080[0;39m 生成今日电子书快照开始
2022-04-18 23:07:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501944844718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501944844718080[0;39m ==> Parameters: 
2022-04-18 23:07:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501944844718080[0;39m <==    Updates: 0
2022-04-18 23:07:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501944844718080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:07:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171501965820432384[0;39m start updating Ebook doc
2022-04-18 23:07:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501965820432384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:07:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501965820432384[0;39m ==> Parameters: 
2022-04-18 23:07:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171501965820432384[0;39m <==    Updates: 1
2022-04-18 23:07:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171501965820432384[0;39m update ends, take 55 millisecs
2022-04-18 23:07:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501966055313408[0;39m 生成今日电子书快照开始
2022-04-18 23:07:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501966055313408[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501966055313408[0;39m ==> Parameters: 
2022-04-18 23:07:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501966055313408[0;39m <==    Updates: 0
2022-04-18 23:07:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501966055313408[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 23:07:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171501986787758080[0;39m 生成今日电子书快照开始
2022-04-18 23:07:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501986787758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501986787758080[0;39m ==> Parameters: 
2022-04-18 23:07:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171501986787758080[0;39m <==    Updates: 0
2022-04-18 23:07:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171501986787758080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:07:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502007759278080[0;39m 生成今日电子书快照开始
2022-04-18 23:07:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502007759278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502007759278080[0;39m ==> Parameters: 
2022-04-18 23:07:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502007759278080[0;39m <==    Updates: 0
2022-04-18 23:07:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502007759278080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:07:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502028734992384[0;39m 生成今日电子书快照开始
2022-04-18 23:07:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502028734992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502028734992384[0;39m ==> Parameters: 
2022-04-18 23:07:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502028734992384[0;39m <==    Updates: 0
2022-04-18 23:07:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502028734992384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:07:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502049706512384[0;39m 生成今日电子书快照开始
2022-04-18 23:07:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502049706512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:07:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502049706512384[0;39m ==> Parameters: 
2022-04-18 23:07:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502049706512384[0;39m <==    Updates: 0
2022-04-18 23:07:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502049706512384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:08:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502070682226688[0;39m 生成今日电子书快照开始
2022-04-18 23:08:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502070682226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502070682226688[0;39m ==> Parameters: 
2022-04-18 23:08:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502070682226688[0;39m <==    Updates: 0
2022-04-18 23:08:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502070682226688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:08:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502091641163776[0;39m 生成今日电子书快照开始
2022-04-18 23:08:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502091641163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502091641163776[0;39m ==> Parameters: 
2022-04-18 23:08:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502091641163776[0;39m <==    Updates: 0
2022-04-18 23:08:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502091641163776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:08:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502091888627712[0;39m start updating Ebook doc
2022-04-18 23:08:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502091888627712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:08:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502091888627712[0;39m ==> Parameters: 
2022-04-18 23:08:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502091888627712[0;39m <==    Updates: 1
2022-04-18 23:08:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502091888627712[0;39m update ends, take 38 millisecs
2022-04-18 23:08:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502112616878080[0;39m 生成今日电子书快照开始
2022-04-18 23:08:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502112616878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502112616878080[0;39m ==> Parameters: 
2022-04-18 23:08:10.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502112616878080[0;39m <==    Updates: 0
2022-04-18 23:08:10.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502112616878080[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:08:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502133592592384[0;39m 生成今日电子书快照开始
2022-04-18 23:08:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502133592592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502133592592384[0;39m ==> Parameters: 
2022-04-18 23:08:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502133592592384[0;39m <==    Updates: 0
2022-04-18 23:08:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502133592592384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:08:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502154564112384[0;39m 生成今日电子书快照开始
2022-04-18 23:08:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502154564112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502154564112384[0;39m ==> Parameters: 
2022-04-18 23:08:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502154564112384[0;39m <==    Updates: 0
2022-04-18 23:08:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502154564112384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:08:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502175531438080[0;39m 生成今日电子书快照开始
2022-04-18 23:08:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502175531438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502175531438080[0;39m ==> Parameters: 
2022-04-18 23:08:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502175531438080[0;39m <==    Updates: 0
2022-04-18 23:08:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502175531438080[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:08:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502196494569472[0;39m 生成今日电子书快照开始
2022-04-18 23:08:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502196494569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502196494569472[0;39m ==> Parameters: 
2022-04-18 23:08:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502196494569472[0;39m <==    Updates: 0
2022-04-18 23:08:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502196494569472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:08:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502217478672384[0;39m 生成今日电子书快照开始
2022-04-18 23:08:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502217478672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502217478672384[0;39m ==> Parameters: 
2022-04-18 23:08:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502217478672384[0;39m <==    Updates: 0
2022-04-18 23:08:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502217478672384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:08:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502217734524928[0;39m start updating Ebook doc
2022-04-18 23:08:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502217734524928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:08:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502217734524928[0;39m ==> Parameters: 
2022-04-18 23:08:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502217734524928[0;39m <==    Updates: 1
2022-04-18 23:08:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502217734524928[0;39m update ends, take 43 millisecs
2022-04-18 23:08:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502238450192384[0;39m 生成今日电子书快照开始
2022-04-18 23:08:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502238450192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502238450192384[0;39m ==> Parameters: 
2022-04-18 23:08:40.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502238450192384[0;39m <==    Updates: 0
2022-04-18 23:08:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502238450192384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:08:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502259421712384[0;39m 生成今日电子书快照开始
2022-04-18 23:08:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502259421712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502259421712384[0;39m ==> Parameters: 
2022-04-18 23:08:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502259421712384[0;39m <==    Updates: 0
2022-04-18 23:08:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502259421712384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:08:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502280389038080[0;39m 生成今日电子书快照开始
2022-04-18 23:08:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502280389038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502280389038080[0;39m ==> Parameters: 
2022-04-18 23:08:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502280389038080[0;39m <==    Updates: 0
2022-04-18 23:08:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502280389038080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:08:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502301364752384[0;39m 生成今日电子书快照开始
2022-04-18 23:08:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502301364752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:08:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502301364752384[0;39m ==> Parameters: 
2022-04-18 23:08:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502301364752384[0;39m <==    Updates: 0
2022-04-18 23:08:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502301364752384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:09:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502322336272384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502322336272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502322336272384[0;39m ==> Parameters: 
2022-04-18 23:09:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502322336272384[0;39m <==    Updates: 0
2022-04-18 23:09:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502322336272384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:09:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502343307792384[0;39m start updating Ebook doc
2022-04-18 23:09:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502343307792384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:09:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502343307792384[0;39m ==> Parameters: 
2022-04-18 23:09:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502343307792384[0;39m <==    Updates: 1
2022-04-18 23:09:05.073 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502343307792384[0;39m update ends, take 69 millisecs
2022-04-18 23:09:05.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502343597199360[0;39m 生成今日电子书快照开始
2022-04-18 23:09:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502343597199360[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502343597199360[0;39m ==> Parameters: 
2022-04-18 23:09:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502343597199360[0;39m <==    Updates: 0
2022-04-18 23:09:05.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502343597199360[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-18 23:09:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502364279312384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502364279312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502364279312384[0;39m ==> Parameters: 
2022-04-18 23:09:10.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502364279312384[0;39m <==    Updates: 0
2022-04-18 23:09:10.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502364279312384[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:09:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502385246638080[0;39m 生成今日电子书快照开始
2022-04-18 23:09:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502385246638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502385246638080[0;39m ==> Parameters: 
2022-04-18 23:09:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502385246638080[0;39m <==    Updates: 0
2022-04-18 23:09:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502385246638080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:09:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502406222352384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502406222352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502406222352384[0;39m ==> Parameters: 
2022-04-18 23:09:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502406222352384[0;39m <==    Updates: 0
2022-04-18 23:09:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502406222352384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:09:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502427189678080[0;39m 生成今日电子书快照开始
2022-04-18 23:09:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502427189678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502427189678080[0;39m ==> Parameters: 
2022-04-18 23:09:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502427189678080[0;39m <==    Updates: 0
2022-04-18 23:09:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502427189678080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:09:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502448161198080[0;39m 生成今日电子书快照开始
2022-04-18 23:09:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502448161198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502448161198080[0;39m ==> Parameters: 
2022-04-18 23:09:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502448161198080[0;39m <==    Updates: 0
2022-04-18 23:09:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502448161198080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:09:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502469136912384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502469136912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502469136912384[0;39m ==> Parameters: 
2022-04-18 23:09:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502469136912384[0;39m <==    Updates: 0
2022-04-18 23:09:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502469136912384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:09:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502469388570624[0;39m start updating Ebook doc
2022-04-18 23:09:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502469388570624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:09:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502469388570624[0;39m ==> Parameters: 
2022-04-18 23:09:35.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502469388570624[0;39m <==    Updates: 1
2022-04-18 23:09:35.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502469388570624[0;39m update ends, take 32 millisecs
2022-04-18 23:09:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502490108432384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:40.153 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502490108432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:40.154 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502490108432384[0;39m ==> Parameters: 
2022-04-18 23:09:40.332 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502490108432384[0;39m <==    Updates: 0
2022-04-18 23:09:40.333 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502490108432384[0;39m 生成今日电子书快照结束，耗时：328毫秒
2022-04-18 23:09:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502511079952384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502511079952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502511079952384[0;39m ==> Parameters: 
2022-04-18 23:09:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502511079952384[0;39m <==    Updates: 0
2022-04-18 23:09:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502511079952384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:09:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502532047278080[0;39m 生成今日电子书快照开始
2022-04-18 23:09:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502532047278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502532047278080[0;39m ==> Parameters: 
2022-04-18 23:09:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502532047278080[0;39m <==    Updates: 0
2022-04-18 23:09:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502532047278080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:09:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502553022992384[0;39m 生成今日电子书快照开始
2022-04-18 23:09:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502553022992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:09:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502553022992384[0;39m ==> Parameters: 
2022-04-18 23:09:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502553022992384[0;39m <==    Updates: 0
2022-04-18 23:09:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502553022992384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:10:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502573994512384[0;39m 生成今日电子书快照开始
2022-04-18 23:10:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502573994512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502573994512384[0;39m ==> Parameters: 
2022-04-18 23:10:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502573994512384[0;39m <==    Updates: 0
2022-04-18 23:10:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502573994512384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:10:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502594970226688[0;39m 生成今日电子书快照开始
2022-04-18 23:10:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502594970226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502594970226688[0;39m ==> Parameters: 
2022-04-18 23:10:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502594970226688[0;39m <==    Updates: 0
2022-04-18 23:10:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502594970226688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:10:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502595242856448[0;39m start updating Ebook doc
2022-04-18 23:10:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502595242856448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:10:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502595242856448[0;39m ==> Parameters: 
2022-04-18 23:10:05.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502595242856448[0;39m <==    Updates: 1
2022-04-18 23:10:05.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502595242856448[0;39m update ends, take 38 millisecs
2022-04-18 23:10:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502615933358080[0;39m 生成今日电子书快照开始
2022-04-18 23:10:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502615933358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502615933358080[0;39m ==> Parameters: 
2022-04-18 23:10:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502615933358080[0;39m <==    Updates: 0
2022-04-18 23:10:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502615933358080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:10:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502636909072384[0;39m 生成今日电子书快照开始
2022-04-18 23:10:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502636909072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502636909072384[0;39m ==> Parameters: 
2022-04-18 23:10:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502636909072384[0;39m <==    Updates: 0
2022-04-18 23:10:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502636909072384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:10:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502657868009472[0;39m 生成今日电子书快照开始
2022-04-18 23:10:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502657868009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502657868009472[0;39m ==> Parameters: 
2022-04-18 23:10:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502657868009472[0;39m <==    Updates: 0
2022-04-18 23:10:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502657868009472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:10:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502678856306688[0;39m 生成今日电子书快照开始
2022-04-18 23:10:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502678856306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502678856306688[0;39m ==> Parameters: 
2022-04-18 23:10:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502678856306688[0;39m <==    Updates: 0
2022-04-18 23:10:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502678856306688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:10:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502699823632384[0;39m 生成今日电子书快照开始
2022-04-18 23:10:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502699823632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502699823632384[0;39m ==> Parameters: 
2022-04-18 23:10:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502699823632384[0;39m <==    Updates: 0
2022-04-18 23:10:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502699823632384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:10:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502720799346688[0;39m 生成今日电子书快照开始
2022-04-18 23:10:35.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502720799346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:35.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502720799346688[0;39m ==> Parameters: 
2022-04-18 23:10:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502720799346688[0;39m <==    Updates: 0
2022-04-18 23:10:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502720799346688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:10:35.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502721088753664[0;39m start updating Ebook doc
2022-04-18 23:10:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502721088753664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:10:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502721088753664[0;39m ==> Parameters: 
2022-04-18 23:10:35.115 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502721088753664[0;39m <==    Updates: 1
2022-04-18 23:10:35.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502721088753664[0;39m update ends, take 41 millisecs
2022-04-18 23:10:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502741770866688[0;39m 生成今日电子书快照开始
2022-04-18 23:10:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502741770866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502741770866688[0;39m ==> Parameters: 
2022-04-18 23:10:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502741770866688[0;39m <==    Updates: 0
2022-04-18 23:10:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502741770866688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:10:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502762742386688[0;39m 生成今日电子书快照开始
2022-04-18 23:10:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502762742386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502762742386688[0;39m ==> Parameters: 
2022-04-18 23:10:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502762742386688[0;39m <==    Updates: 0
2022-04-18 23:10:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502762742386688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:10:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502783709712384[0;39m 生成今日电子书快照开始
2022-04-18 23:10:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502783709712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502783709712384[0;39m ==> Parameters: 
2022-04-18 23:10:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502783709712384[0;39m <==    Updates: 0
2022-04-18 23:10:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502783709712384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:10:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502804685426688[0;39m 生成今日电子书快照开始
2022-04-18 23:10:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502804685426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:10:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502804685426688[0;39m ==> Parameters: 
2022-04-18 23:10:55.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502804685426688[0;39m <==    Updates: 0
2022-04-18 23:10:55.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502804685426688[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 23:11:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502825635975168[0;39m 生成今日电子书快照开始
2022-04-18 23:11:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502825635975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502825635975168[0;39m ==> Parameters: 
2022-04-18 23:11:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502825635975168[0;39m <==    Updates: 0
2022-04-18 23:11:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502825635975168[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:11:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502846615883776[0;39m 生成今日电子书快照开始
2022-04-18 23:11:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502846615883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502846615883776[0;39m ==> Parameters: 
2022-04-18 23:11:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502846615883776[0;39m <==    Updates: 0
2022-04-18 23:11:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502846615883776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:11:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502846896902144[0;39m start updating Ebook doc
2022-04-18 23:11:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502846896902144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:11:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502846896902144[0;39m ==> Parameters: 
2022-04-18 23:11:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502846896902144[0;39m <==    Updates: 1
2022-04-18 23:11:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502846896902144[0;39m update ends, take 35 millisecs
2022-04-18 23:11:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502867599986688[0;39m 生成今日电子书快照开始
2022-04-18 23:11:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502867599986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502867599986688[0;39m ==> Parameters: 
2022-04-18 23:11:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502867599986688[0;39m <==    Updates: 0
2022-04-18 23:11:10.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502867599986688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:11:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502888554729472[0;39m 生成今日电子书快照开始
2022-04-18 23:11:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502888554729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502888554729472[0;39m ==> Parameters: 
2022-04-18 23:11:15.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502888554729472[0;39m <==    Updates: 0
2022-04-18 23:11:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502888554729472[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-18 23:11:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502909543026688[0;39m 生成今日电子书快照开始
2022-04-18 23:11:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502909543026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502909543026688[0;39m ==> Parameters: 
2022-04-18 23:11:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502909543026688[0;39m <==    Updates: 0
2022-04-18 23:11:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502909543026688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:11:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502930514546688[0;39m 生成今日电子书快照开始
2022-04-18 23:11:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502930514546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502930514546688[0;39m ==> Parameters: 
2022-04-18 23:11:25.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502930514546688[0;39m <==    Updates: 0
2022-04-18 23:11:25.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502930514546688[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 23:11:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502951498649600[0;39m 生成今日电子书快照开始
2022-04-18 23:11:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502951498649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502951498649600[0;39m ==> Parameters: 
2022-04-18 23:11:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502951498649600[0;39m <==    Updates: 0
2022-04-18 23:11:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502951498649600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:11:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171502972461780992[0;39m start updating Ebook doc
2022-04-18 23:11:35.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502972461780992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:11:35.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502972461780992[0;39m ==> Parameters: 
2022-04-18 23:11:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171502972461780992[0;39m <==    Updates: 1
2022-04-18 23:11:35.077 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171502972461780992[0;39m update ends, take 70 millisecs
2022-04-18 23:11:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502972759576576[0;39m 生成今日电子书快照开始
2022-04-18 23:11:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502972759576576[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502972759576576[0;39m ==> Parameters: 
2022-04-18 23:11:35.126 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502972759576576[0;39m <==    Updates: 0
2022-04-18 23:11:35.127 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502972759576576[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:11:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171502993445883904[0;39m 生成今日电子书快照开始
2022-04-18 23:11:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502993445883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502993445883904[0;39m ==> Parameters: 
2022-04-18 23:11:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171502993445883904[0;39m <==    Updates: 0
2022-04-18 23:11:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171502993445883904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:11:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503014404820992[0;39m 生成今日电子书快照开始
2022-04-18 23:11:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503014404820992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503014404820992[0;39m ==> Parameters: 
2022-04-18 23:11:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503014404820992[0;39m <==    Updates: 0
2022-04-18 23:11:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503014404820992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:11:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503035376340992[0;39m 生成今日电子书快照开始
2022-04-18 23:11:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503035376340992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503035376340992[0;39m ==> Parameters: 
2022-04-18 23:11:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503035376340992[0;39m <==    Updates: 0
2022-04-18 23:11:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503035376340992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:11:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503056347860992[0;39m 生成今日电子书快照开始
2022-04-18 23:11:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503056347860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:11:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503056347860992[0;39m ==> Parameters: 
2022-04-18 23:11:55.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503056347860992[0;39m <==    Updates: 0
2022-04-18 23:11:55.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503056347860992[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 23:12:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503077327769600[0;39m 生成今日电子书快照开始
2022-04-18 23:12:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503077327769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503077327769600[0;39m ==> Parameters: 
2022-04-18 23:12:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503077327769600[0;39m <==    Updates: 0
2022-04-18 23:12:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503077327769600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:12:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503098274123776[0;39m start updating Ebook doc
2022-04-18 23:12:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503098274123776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:12:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503098274123776[0;39m ==> Parameters: 
2022-04-18 23:12:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503098274123776[0;39m <==    Updates: 1
2022-04-18 23:12:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503098274123776[0;39m update ends, take 68 millisecs
2022-04-18 23:12:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503098563530752[0;39m 生成今日电子书快照开始
2022-04-18 23:12:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503098563530752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503098563530752[0;39m ==> Parameters: 
2022-04-18 23:12:05.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503098563530752[0;39m <==    Updates: 0
2022-04-18 23:12:05.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503098563530752[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:12:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503119275003904[0;39m 生成今日电子书快照开始
2022-04-18 23:12:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503119275003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:10.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503119275003904[0;39m ==> Parameters: 
2022-04-18 23:12:10.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503119275003904[0;39m <==    Updates: 0
2022-04-18 23:12:10.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503119275003904[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-18 23:12:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503140246523904[0;39m 生成今日电子书快照开始
2022-04-18 23:12:15.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503140246523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:15.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503140246523904[0;39m ==> Parameters: 
2022-04-18 23:12:15.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503140246523904[0;39m <==    Updates: 0
2022-04-18 23:12:15.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503140246523904[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 23:12:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503161209655296[0;39m 生成今日电子书快照开始
2022-04-18 23:12:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503161209655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503161209655296[0;39m ==> Parameters: 
2022-04-18 23:12:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503161209655296[0;39m <==    Updates: 0
2022-04-18 23:12:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503161209655296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:12:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503182181175296[0;39m 生成今日电子书快照开始
2022-04-18 23:12:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503182181175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503182181175296[0;39m ==> Parameters: 
2022-04-18 23:12:25.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503182181175296[0;39m <==    Updates: 0
2022-04-18 23:12:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503182181175296[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:12:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503203152695296[0;39m 生成今日电子书快照开始
2022-04-18 23:12:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503203152695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503203152695296[0;39m ==> Parameters: 
2022-04-18 23:12:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503203152695296[0;39m <==    Updates: 0
2022-04-18 23:12:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503203152695296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:12:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503224115826688[0;39m start updating Ebook doc
2022-04-18 23:12:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503224115826688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:12:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503224115826688[0;39m ==> Parameters: 
2022-04-18 23:12:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503224115826688[0;39m <==    Updates: 1
2022-04-18 23:12:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503224115826688[0;39m update ends, take 61 millisecs
2022-04-18 23:12:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503224371679232[0;39m 生成今日电子书快照开始
2022-04-18 23:12:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503224371679232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503224371679232[0;39m ==> Parameters: 
2022-04-18 23:12:35.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503224371679232[0;39m <==    Updates: 0
2022-04-18 23:12:35.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503224371679232[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 23:12:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503245087346688[0;39m 生成今日电子书快照开始
2022-04-18 23:12:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503245087346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503245087346688[0;39m ==> Parameters: 
2022-04-18 23:12:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503245087346688[0;39m <==    Updates: 0
2022-04-18 23:12:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503245087346688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:12:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503266067255296[0;39m 生成今日电子书快照开始
2022-04-18 23:12:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503266067255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503266067255296[0;39m ==> Parameters: 
2022-04-18 23:12:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503266067255296[0;39m <==    Updates: 0
2022-04-18 23:12:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503266067255296[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:12:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503287038775296[0;39m 生成今日电子书快照开始
2022-04-18 23:12:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503287038775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503287038775296[0;39m ==> Parameters: 
2022-04-18 23:12:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503287038775296[0;39m <==    Updates: 0
2022-04-18 23:12:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503287038775296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:12:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503308010295296[0;39m 生成今日电子书快照开始
2022-04-18 23:12:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503308010295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:12:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503308010295296[0;39m ==> Parameters: 
2022-04-18 23:12:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503308010295296[0;39m <==    Updates: 0
2022-04-18 23:12:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503308010295296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:13:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503328986009600[0;39m 生成今日电子书快照开始
2022-04-18 23:13:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503328986009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503328986009600[0;39m ==> Parameters: 
2022-04-18 23:13:00.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503328986009600[0;39m <==    Updates: 0
2022-04-18 23:13:00.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503328986009600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:13:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503349944946688[0;39m 生成今日电子书快照开始
2022-04-18 23:13:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503349944946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503349944946688[0;39m ==> Parameters: 
2022-04-18 23:13:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503349944946688[0;39m <==    Updates: 0
2022-04-18 23:13:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503349944946688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:13:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503350238547968[0;39m start updating Ebook doc
2022-04-18 23:13:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503350238547968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:13:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503350238547968[0;39m ==> Parameters: 
2022-04-18 23:13:05.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503350238547968[0;39m <==    Updates: 1
2022-04-18 23:13:05.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503350238547968[0;39m update ends, take 41 millisecs
2022-04-18 23:13:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503370895495168[0;39m 生成今日电子书快照开始
2022-04-18 23:13:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503370895495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503370895495168[0;39m ==> Parameters: 
2022-04-18 23:13:10.209 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503370895495168[0;39m <==    Updates: 0
2022-04-18 23:13:10.209 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503370895495168[0;39m 生成今日电子书快照结束，耗时：208毫秒
2022-04-18 23:13:15.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503391913152512[0;39m 生成今日电子书快照开始
2022-04-18 23:13:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503391913152512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503391913152512[0;39m ==> Parameters: 
2022-04-18 23:13:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503391913152512[0;39m <==    Updates: 0
2022-04-18 23:13:15.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503391913152512[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:13:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503412859506688[0;39m 生成今日电子书快照开始
2022-04-18 23:13:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503412859506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503412859506688[0;39m ==> Parameters: 
2022-04-18 23:13:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503412859506688[0;39m <==    Updates: 0
2022-04-18 23:13:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503412859506688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:13:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503433843609600[0;39m 生成今日电子书快照开始
2022-04-18 23:13:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503433843609600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503433843609600[0;39m ==> Parameters: 
2022-04-18 23:13:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503433843609600[0;39m <==    Updates: 0
2022-04-18 23:13:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503433843609600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:13:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503454819323904[0;39m 生成今日电子书快照开始
2022-04-18 23:13:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503454819323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503454819323904[0;39m ==> Parameters: 
2022-04-18 23:13:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503454819323904[0;39m <==    Updates: 0
2022-04-18 23:13:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503454819323904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:13:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503475761483776[0;39m 生成今日电子书快照开始
2022-04-18 23:13:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503475761483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503475761483776[0;39m ==> Parameters: 
2022-04-18 23:13:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503475761483776[0;39m <==    Updates: 0
2022-04-18 23:13:35.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503475761483776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:13:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503475987976192[0;39m start updating Ebook doc
2022-04-18 23:13:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503475987976192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:13:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503475987976192[0;39m ==> Parameters: 
2022-04-18 23:13:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503475987976192[0;39m <==    Updates: 1
2022-04-18 23:13:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503475987976192[0;39m update ends, take 42 millisecs
2022-04-18 23:13:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503496749780992[0;39m 生成今日电子书快照开始
2022-04-18 23:13:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503496749780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503496749780992[0;39m ==> Parameters: 
2022-04-18 23:13:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503496749780992[0;39m <==    Updates: 0
2022-04-18 23:13:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503496749780992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:13:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503517721300992[0;39m 生成今日电子书快照开始
2022-04-18 23:13:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503517721300992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503517721300992[0;39m ==> Parameters: 
2022-04-18 23:13:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503517721300992[0;39m <==    Updates: 0
2022-04-18 23:13:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503517721300992[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:13:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503538701209600[0;39m 生成今日电子书快照开始
2022-04-18 23:13:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503538701209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503538701209600[0;39m ==> Parameters: 
2022-04-18 23:13:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503538701209600[0;39m <==    Updates: 0
2022-04-18 23:13:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503538701209600[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:13:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503559672729600[0;39m 生成今日电子书快照开始
2022-04-18 23:13:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503559672729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:13:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503559672729600[0;39m ==> Parameters: 
2022-04-18 23:13:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503559672729600[0;39m <==    Updates: 0
2022-04-18 23:13:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503559672729600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:14:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503580640055296[0;39m 生成今日电子书快照开始
2022-04-18 23:14:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503580640055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503580640055296[0;39m ==> Parameters: 
2022-04-18 23:14:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503580640055296[0;39m <==    Updates: 0
2022-04-18 23:14:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503580640055296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:14:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503601598992384[0;39m 生成今日电子书快照开始
2022-04-18 23:14:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503601598992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503601598992384[0;39m ==> Parameters: 
2022-04-18 23:14:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503601598992384[0;39m <==    Updates: 0
2022-04-18 23:14:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503601598992384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:14:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503601829679104[0;39m start updating Ebook doc
2022-04-18 23:14:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503601829679104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:14:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503601829679104[0;39m ==> Parameters: 
2022-04-18 23:14:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503601829679104[0;39m <==    Updates: 1
2022-04-18 23:14:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503601829679104[0;39m update ends, take 45 millisecs
2022-04-18 23:14:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503622578900992[0;39m 生成今日电子书快照开始
2022-04-18 23:14:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503622578900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503622578900992[0;39m ==> Parameters: 
2022-04-18 23:14:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503622578900992[0;39m <==    Updates: 0
2022-04-18 23:14:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503622578900992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:14:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503643554615296[0;39m 生成今日电子书快照开始
2022-04-18 23:14:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503643554615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503643554615296[0;39m ==> Parameters: 
2022-04-18 23:14:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503643554615296[0;39m <==    Updates: 0
2022-04-18 23:14:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503643554615296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:14:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503664530329600[0;39m 生成今日电子书快照开始
2022-04-18 23:14:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503664530329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503664530329600[0;39m ==> Parameters: 
2022-04-18 23:14:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503664530329600[0;39m <==    Updates: 0
2022-04-18 23:14:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503664530329600[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:14:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503685497655296[0;39m 生成今日电子书快照开始
2022-04-18 23:14:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503685497655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503685497655296[0;39m ==> Parameters: 
2022-04-18 23:14:25.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503685497655296[0;39m <==    Updates: 0
2022-04-18 23:14:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503685497655296[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:14:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503706473369600[0;39m 生成今日电子书快照开始
2022-04-18 23:14:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503706473369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503706473369600[0;39m ==> Parameters: 
2022-04-18 23:14:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503706473369600[0;39m <==    Updates: 0
2022-04-18 23:14:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503706473369600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:14:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503727423918080[0;39m start updating Ebook doc
2022-04-18 23:14:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503727423918080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:14:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503727423918080[0;39m ==> Parameters: 
2022-04-18 23:14:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503727423918080[0;39m <==    Updates: 1
2022-04-18 23:14:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503727423918080[0;39m update ends, take 64 millisecs
2022-04-18 23:14:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503727696547840[0;39m 生成今日电子书快照开始
2022-04-18 23:14:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503727696547840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503727696547840[0;39m ==> Parameters: 
2022-04-18 23:14:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503727696547840[0;39m <==    Updates: 0
2022-04-18 23:14:35.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503727696547840[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-18 23:14:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503748395438080[0;39m 生成今日电子书快照开始
2022-04-18 23:14:40.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503748395438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:40.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503748395438080[0;39m ==> Parameters: 
2022-04-18 23:14:40.273 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503748395438080[0;39m <==    Updates: 0
2022-04-18 23:14:40.273 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503748395438080[0;39m 生成今日电子书快照结束，耗时：269毫秒
2022-04-18 23:14:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503769383735296[0;39m 生成今日电子书快照开始
2022-04-18 23:14:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503769383735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503769383735296[0;39m ==> Parameters: 
2022-04-18 23:14:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503769383735296[0;39m <==    Updates: 0
2022-04-18 23:14:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503769383735296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:14:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503790355255296[0;39m 生成今日电子书快照开始
2022-04-18 23:14:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503790355255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503790355255296[0;39m ==> Parameters: 
2022-04-18 23:14:50.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503790355255296[0;39m <==    Updates: 0
2022-04-18 23:14:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503790355255296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:14:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503811330969600[0;39m 生成今日电子书快照开始
2022-04-18 23:14:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503811330969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:14:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503811330969600[0;39m ==> Parameters: 
2022-04-18 23:14:55.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503811330969600[0;39m <==    Updates: 0
2022-04-18 23:14:55.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503811330969600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:15:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503832281518080[0;39m 生成今日电子书快照开始
2022-04-18 23:15:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503832281518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503832281518080[0;39m ==> Parameters: 
2022-04-18 23:15:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503832281518080[0;39m <==    Updates: 0
2022-04-18 23:15:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503832281518080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:15:05.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503853274009600[0;39m start updating Ebook doc
2022-04-18 23:15:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503853274009600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:15:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503853274009600[0;39m ==> Parameters: 
2022-04-18 23:15:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503853274009600[0;39m <==    Updates: 1
2022-04-18 23:15:05.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503853274009600[0;39m update ends, take 54 millisecs
2022-04-18 23:15:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503853504696320[0;39m 生成今日电子书快照开始
2022-04-18 23:15:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503853504696320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503853504696320[0;39m ==> Parameters: 
2022-04-18 23:15:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503853504696320[0;39m <==    Updates: 0
2022-04-18 23:15:05.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503853504696320[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:15:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503874245529600[0;39m 生成今日电子书快照开始
2022-04-18 23:15:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503874245529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503874245529600[0;39m ==> Parameters: 
2022-04-18 23:15:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503874245529600[0;39m <==    Updates: 0
2022-04-18 23:15:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503874245529600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:15:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503895212855296[0;39m 生成今日电子书快照开始
2022-04-18 23:15:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503895212855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:15.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503895212855296[0;39m ==> Parameters: 
2022-04-18 23:15:15.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503895212855296[0;39m <==    Updates: 0
2022-04-18 23:15:15.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503895212855296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 23:15:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503916188569600[0;39m 生成今日电子书快照开始
2022-04-18 23:15:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503916188569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503916188569600[0;39m ==> Parameters: 
2022-04-18 23:15:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503916188569600[0;39m <==    Updates: 0
2022-04-18 23:15:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503916188569600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:15:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503937155895296[0;39m 生成今日电子书快照开始
2022-04-18 23:15:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503937155895296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503937155895296[0;39m ==> Parameters: 
2022-04-18 23:15:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503937155895296[0;39m <==    Updates: 0
2022-04-18 23:15:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503937155895296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:15:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503958131609600[0;39m 生成今日电子书快照开始
2022-04-18 23:15:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503958131609600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503958131609600[0;39m ==> Parameters: 
2022-04-18 23:15:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503958131609600[0;39m <==    Updates: 0
2022-04-18 23:15:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503958131609600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:15:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171503979103129600[0;39m 生成今日电子书快照开始
2022-04-18 23:15:35.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503979103129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:35.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503979103129600[0;39m ==> Parameters: 
2022-04-18 23:15:35.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171503979103129600[0;39m <==    Updates: 0
2022-04-18 23:15:35.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171503979103129600[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 23:15:35.081 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171503979409313792[0;39m start updating Ebook doc
2022-04-18 23:15:35.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503979409313792[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:15:35.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503979409313792[0;39m ==> Parameters: 
2022-04-18 23:15:35.124 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171503979409313792[0;39m <==    Updates: 1
2022-04-18 23:15:35.124 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171503979409313792[0;39m update ends, take 43 millisecs
2022-04-18 23:15:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504000062066688[0;39m 生成今日电子书快照开始
2022-04-18 23:15:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504000062066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504000062066688[0;39m ==> Parameters: 
2022-04-18 23:15:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504000062066688[0;39m <==    Updates: 0
2022-04-18 23:15:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504000062066688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:15:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504021041975296[0;39m 生成今日电子书快照开始
2022-04-18 23:15:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504021041975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504021041975296[0;39m ==> Parameters: 
2022-04-18 23:15:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504021041975296[0;39m <==    Updates: 0
2022-04-18 23:15:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504021041975296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:15:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504042013495296[0;39m 生成今日电子书快照开始
2022-04-18 23:15:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504042013495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504042013495296[0;39m ==> Parameters: 
2022-04-18 23:15:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504042013495296[0;39m <==    Updates: 0
2022-04-18 23:15:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504042013495296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:15:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504062993403904[0;39m 生成今日电子书快照开始
2022-04-18 23:15:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504062993403904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:15:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504062993403904[0;39m ==> Parameters: 
2022-04-18 23:15:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504062993403904[0;39m <==    Updates: 0
2022-04-18 23:15:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504062993403904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:16:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504083964923904[0;39m 生成今日电子书快照开始
2022-04-18 23:16:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504083964923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504083964923904[0;39m ==> Parameters: 
2022-04-18 23:16:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504083964923904[0;39m <==    Updates: 0
2022-04-18 23:16:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504083964923904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:16:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504104915472384[0;39m start updating Ebook doc
2022-04-18 23:16:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504104915472384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:16:05.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504104915472384[0;39m ==> Parameters: 
2022-04-18 23:16:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504104915472384[0;39m <==    Updates: 1
2022-04-18 23:16:05.078 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504104915472384[0;39m update ends, take 73 millisecs
2022-04-18 23:16:05.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504105230045184[0;39m 生成今日电子书快照开始
2022-04-18 23:16:05.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504105230045184[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:05.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504105230045184[0;39m ==> Parameters: 
2022-04-18 23:16:05.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504105230045184[0;39m <==    Updates: 0
2022-04-18 23:16:05.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504105230045184[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 23:16:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504125899575296[0;39m 生成今日电子书快照开始
2022-04-18 23:16:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504125899575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504125899575296[0;39m ==> Parameters: 
2022-04-18 23:16:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504125899575296[0;39m <==    Updates: 0
2022-04-18 23:16:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504125899575296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:16:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504146862706688[0;39m 生成今日电子书快照开始
2022-04-18 23:16:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504146862706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504146862706688[0;39m ==> Parameters: 
2022-04-18 23:16:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504146862706688[0;39m <==    Updates: 0
2022-04-18 23:16:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504146862706688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:16:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504167851003904[0;39m 生成今日电子书快照开始
2022-04-18 23:16:20.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504167851003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:20.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504167851003904[0;39m ==> Parameters: 
2022-04-18 23:16:20.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504167851003904[0;39m <==    Updates: 0
2022-04-18 23:16:20.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504167851003904[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:16:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504188809940992[0;39m 生成今日电子书快照开始
2022-04-18 23:16:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504188809940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504188809940992[0;39m ==> Parameters: 
2022-04-18 23:16:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504188809940992[0;39m <==    Updates: 0
2022-04-18 23:16:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504188809940992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:16:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504209798238208[0;39m 生成今日电子书快照开始
2022-04-18 23:16:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504209798238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504209798238208[0;39m ==> Parameters: 
2022-04-18 23:16:30.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504209798238208[0;39m <==    Updates: 0
2022-04-18 23:16:30.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504209798238208[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 23:16:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504230752980992[0;39m start updating Ebook doc
2022-04-18 23:16:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504230752980992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:16:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504230752980992[0;39m ==> Parameters: 
2022-04-18 23:16:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504230752980992[0;39m <==    Updates: 1
2022-04-18 23:16:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504230752980992[0;39m update ends, take 60 millisecs
2022-04-18 23:16:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504231004639232[0;39m 生成今日电子书快照开始
2022-04-18 23:16:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504231004639232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504231004639232[0;39m ==> Parameters: 
2022-04-18 23:16:35.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504231004639232[0;39m <==    Updates: 0
2022-04-18 23:16:35.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504231004639232[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:16:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504251716112384[0;39m 生成今日电子书快照开始
2022-04-18 23:16:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504251716112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504251716112384[0;39m ==> Parameters: 
2022-04-18 23:16:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504251716112384[0;39m <==    Updates: 0
2022-04-18 23:16:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504251716112384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:16:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504272712798208[0;39m 生成今日电子书快照开始
2022-04-18 23:16:45.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504272712798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:45.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504272712798208[0;39m ==> Parameters: 
2022-04-18 23:16:45.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504272712798208[0;39m <==    Updates: 0
2022-04-18 23:16:45.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504272712798208[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:16:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504293671735296[0;39m 生成今日电子书快照开始
2022-04-18 23:16:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504293671735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504293671735296[0;39m ==> Parameters: 
2022-04-18 23:16:50.090 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504293671735296[0;39m <==    Updates: 0
2022-04-18 23:16:50.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504293671735296[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-18 23:16:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504314643255296[0;39m 生成今日电子书快照开始
2022-04-18 23:16:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504314643255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:16:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504314643255296[0;39m ==> Parameters: 
2022-04-18 23:16:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504314643255296[0;39m <==    Updates: 0
2022-04-18 23:16:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504314643255296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:17:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504335623163904[0;39m 生成今日电子书快照开始
2022-04-18 23:17:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504335623163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504335623163904[0;39m ==> Parameters: 
2022-04-18 23:17:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504335623163904[0;39m <==    Updates: 0
2022-04-18 23:17:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504335623163904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:17:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504356573712384[0;39m start updating Ebook doc
2022-04-18 23:17:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504356573712384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:17:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504356573712384[0;39m ==> Parameters: 
2022-04-18 23:17:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504356573712384[0;39m <==    Updates: 1
2022-04-18 23:17:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504356573712384[0;39m update ends, take 67 millisecs
2022-04-18 23:17:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504356854730752[0;39m 生成今日电子书快照开始
2022-04-18 23:17:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504356854730752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504356854730752[0;39m ==> Parameters: 
2022-04-18 23:17:05.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504356854730752[0;39m <==    Updates: 0
2022-04-18 23:17:05.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504356854730752[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 23:17:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504377562009600[0;39m 生成今日电子书快照开始
2022-04-18 23:17:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504377562009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504377562009600[0;39m ==> Parameters: 
2022-04-18 23:17:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504377562009600[0;39m <==    Updates: 0
2022-04-18 23:17:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504377562009600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:17:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504398529335296[0;39m 生成今日电子书快照开始
2022-04-18 23:17:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504398529335296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504398529335296[0;39m ==> Parameters: 
2022-04-18 23:17:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504398529335296[0;39m <==    Updates: 0
2022-04-18 23:17:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504398529335296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:17:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504419513438208[0;39m 生成今日电子书快照开始
2022-04-18 23:17:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504419513438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504419513438208[0;39m ==> Parameters: 
2022-04-18 23:17:20.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504419513438208[0;39m <==    Updates: 0
2022-04-18 23:17:20.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504419513438208[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:17:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504440463986688[0;39m 生成今日电子书快照开始
2022-04-18 23:17:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504440463986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504440463986688[0;39m ==> Parameters: 
2022-04-18 23:17:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504440463986688[0;39m <==    Updates: 0
2022-04-18 23:17:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504440463986688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:17:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504461456478208[0;39m 生成今日电子书快照开始
2022-04-18 23:17:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504461456478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504461456478208[0;39m ==> Parameters: 
2022-04-18 23:17:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504461456478208[0;39m <==    Updates: 0
2022-04-18 23:17:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504461456478208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:17:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504482402832384[0;39m 生成今日电子书快照开始
2022-04-18 23:17:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504482402832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504482402832384[0;39m ==> Parameters: 
2022-04-18 23:17:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504482402832384[0;39m <==    Updates: 0
2022-04-18 23:17:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504482402832384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:17:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504482671267840[0;39m start updating Ebook doc
2022-04-18 23:17:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504482671267840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:17:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504482671267840[0;39m ==> Parameters: 
2022-04-18 23:17:35.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504482671267840[0;39m <==    Updates: 1
2022-04-18 23:17:35.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504482671267840[0;39m update ends, take 42 millisecs
2022-04-18 23:17:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504503382740992[0;39m 生成今日电子书快照开始
2022-04-18 23:17:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504503382740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504503382740992[0;39m ==> Parameters: 
2022-04-18 23:17:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504503382740992[0;39m <==    Updates: 0
2022-04-18 23:17:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504503382740992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:17:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504524333289472[0;39m 生成今日电子书快照开始
2022-04-18 23:17:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504524333289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504524333289472[0;39m ==> Parameters: 
2022-04-18 23:17:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504524333289472[0;39m <==    Updates: 0
2022-04-18 23:17:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504524333289472[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:17:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504545325780992[0;39m 生成今日电子书快照开始
2022-04-18 23:17:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504545325780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504545325780992[0;39m ==> Parameters: 
2022-04-18 23:17:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504545325780992[0;39m <==    Updates: 0
2022-04-18 23:17:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504545325780992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:17:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504566309883904[0;39m 生成今日电子书快照开始
2022-04-18 23:17:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504566309883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:17:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504566309883904[0;39m ==> Parameters: 
2022-04-18 23:17:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504566309883904[0;39m <==    Updates: 0
2022-04-18 23:17:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504566309883904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:18:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504587277209600[0;39m 生成今日电子书快照开始
2022-04-18 23:18:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504587277209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504587277209600[0;39m ==> Parameters: 
2022-04-18 23:18:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504587277209600[0;39m <==    Updates: 0
2022-04-18 23:18:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504587277209600[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:18:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504608257118208[0;39m 生成今日电子书快照开始
2022-04-18 23:18:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504608257118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504608257118208[0;39m ==> Parameters: 
2022-04-18 23:18:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504608257118208[0;39m <==    Updates: 0
2022-04-18 23:18:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504608257118208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:18:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504608504582144[0;39m start updating Ebook doc
2022-04-18 23:18:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504608504582144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:18:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504608504582144[0;39m ==> Parameters: 
2022-04-18 23:18:05.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504608504582144[0;39m <==    Updates: 1
2022-04-18 23:18:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504608504582144[0;39m update ends, take 35 millisecs
2022-04-18 23:18:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504629228638208[0;39m 生成今日电子书快照开始
2022-04-18 23:18:10.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504629228638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:10.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504629228638208[0;39m ==> Parameters: 
2022-04-18 23:18:10.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504629228638208[0;39m <==    Updates: 0
2022-04-18 23:18:10.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504629228638208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:18:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504650183380992[0;39m 生成今日电子书快照开始
2022-04-18 23:18:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504650183380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504650183380992[0;39m ==> Parameters: 
2022-04-18 23:18:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504650183380992[0;39m <==    Updates: 0
2022-04-18 23:18:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504650183380992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:18:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504671142318080[0;39m 生成今日电子书快照开始
2022-04-18 23:18:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504671142318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504671142318080[0;39m ==> Parameters: 
2022-04-18 23:18:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504671142318080[0;39m <==    Updates: 0
2022-04-18 23:18:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504671142318080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:18:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504692134809600[0;39m 生成今日电子书快照开始
2022-04-18 23:18:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504692134809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504692134809600[0;39m ==> Parameters: 
2022-04-18 23:18:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504692134809600[0;39m <==    Updates: 0
2022-04-18 23:18:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504692134809600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:18:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504713097940992[0;39m 生成今日电子书快照开始
2022-04-18 23:18:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504713097940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504713097940992[0;39m ==> Parameters: 
2022-04-18 23:18:30.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504713097940992[0;39m <==    Updates: 0
2022-04-18 23:18:30.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504713097940992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:18:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504734073655296[0;39m start updating Ebook doc
2022-04-18 23:18:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504734073655296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:18:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504734073655296[0;39m ==> Parameters: 
2022-04-18 23:18:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504734073655296[0;39m <==    Updates: 1
2022-04-18 23:18:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504734073655296[0;39m update ends, take 57 millisecs
2022-04-18 23:18:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504734312730624[0;39m 生成今日电子书快照开始
2022-04-18 23:18:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504734312730624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504734312730624[0;39m ==> Parameters: 
2022-04-18 23:18:35.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504734312730624[0;39m <==    Updates: 0
2022-04-18 23:18:35.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504734312730624[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 23:18:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504755020009472[0;39m 生成今日电子书快照开始
2022-04-18 23:18:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504755020009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504755020009472[0;39m ==> Parameters: 
2022-04-18 23:18:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504755020009472[0;39m <==    Updates: 0
2022-04-18 23:18:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504755020009472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:18:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504775991529472[0;39m 生成今日电子书快照开始
2022-04-18 23:18:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504775991529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504775991529472[0;39m ==> Parameters: 
2022-04-18 23:18:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504775991529472[0;39m <==    Updates: 0
2022-04-18 23:18:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504775991529472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:18:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504796988215296[0;39m 生成今日电子书快照开始
2022-04-18 23:18:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504796988215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504796988215296[0;39m ==> Parameters: 
2022-04-18 23:18:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504796988215296[0;39m <==    Updates: 0
2022-04-18 23:18:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504796988215296[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:18:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504817955540992[0;39m 生成今日电子书快照开始
2022-04-18 23:18:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504817955540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:18:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504817955540992[0;39m ==> Parameters: 
2022-04-18 23:18:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504817955540992[0;39m <==    Updates: 0
2022-04-18 23:18:55.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504817955540992[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:19:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504838906089472[0;39m 生成今日电子书快照开始
2022-04-18 23:19:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504838906089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504838906089472[0;39m ==> Parameters: 
2022-04-18 23:19:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504838906089472[0;39m <==    Updates: 0
2022-04-18 23:19:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504838906089472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:19:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504859902775296[0;39m 生成今日电子书快照开始
2022-04-18 23:19:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504859902775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504859902775296[0;39m ==> Parameters: 
2022-04-18 23:19:05.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504859902775296[0;39m <==    Updates: 0
2022-04-18 23:19:05.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504859902775296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:19:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504860183793664[0;39m start updating Ebook doc
2022-04-18 23:19:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504860183793664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:19:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504860183793664[0;39m ==> Parameters: 
2022-04-18 23:19:05.121 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504860183793664[0;39m <==    Updates: 1
2022-04-18 23:19:05.121 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504860183793664[0;39m update ends, take 47 millisecs
2022-04-18 23:19:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504880886878208[0;39m 生成今日电子书快照开始
2022-04-18 23:19:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504880886878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504880886878208[0;39m ==> Parameters: 
2022-04-18 23:19:10.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504880886878208[0;39m <==    Updates: 0
2022-04-18 23:19:10.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504880886878208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:19:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504901845815296[0;39m 生成今日电子书快照开始
2022-04-18 23:19:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504901845815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504901845815296[0;39m ==> Parameters: 
2022-04-18 23:19:15.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504901845815296[0;39m <==    Updates: 0
2022-04-18 23:19:15.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504901845815296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 23:19:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504922808946688[0;39m 生成今日电子书快照开始
2022-04-18 23:19:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504922808946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504922808946688[0;39m ==> Parameters: 
2022-04-18 23:19:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504922808946688[0;39m <==    Updates: 0
2022-04-18 23:19:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504922808946688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:19:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504943801438208[0;39m 生成今日电子书快照开始
2022-04-18 23:19:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504943801438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504943801438208[0;39m ==> Parameters: 
2022-04-18 23:19:25.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504943801438208[0;39m <==    Updates: 0
2022-04-18 23:19:25.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504943801438208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:19:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504964760375296[0;39m 生成今日电子书快照开始
2022-04-18 23:19:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504964760375296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504964760375296[0;39m ==> Parameters: 
2022-04-18 23:19:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504964760375296[0;39m <==    Updates: 0
2022-04-18 23:19:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504964760375296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:19:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171504985719312384[0;39m start updating Ebook doc
2022-04-18 23:19:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504985719312384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:19:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504985719312384[0;39m ==> Parameters: 
2022-04-18 23:19:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171504985719312384[0;39m <==    Updates: 1
2022-04-18 23:19:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171504985719312384[0;39m update ends, take 58 millisecs
2022-04-18 23:19:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171504985966776320[0;39m 生成今日电子书快照开始
2022-04-18 23:19:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504985966776320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504985966776320[0;39m ==> Parameters: 
2022-04-18 23:19:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171504985966776320[0;39m <==    Updates: 0
2022-04-18 23:19:35.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171504985966776320[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 23:19:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505006715998208[0;39m 生成今日电子书快照开始
2022-04-18 23:19:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505006715998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:40.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505006715998208[0;39m ==> Parameters: 
2022-04-18 23:19:40.123 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505006715998208[0;39m <==    Updates: 0
2022-04-18 23:19:40.123 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505006715998208[0;39m 生成今日电子书快照结束，耗时：113毫秒
2022-04-18 23:19:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505027649769472[0;39m 生成今日电子书快照开始
2022-04-18 23:19:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505027649769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505027649769472[0;39m ==> Parameters: 
2022-04-18 23:19:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505027649769472[0;39m <==    Updates: 0
2022-04-18 23:19:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505027649769472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:19:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505048654843904[0;39m 生成今日电子书快照开始
2022-04-18 23:19:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505048654843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505048654843904[0;39m ==> Parameters: 
2022-04-18 23:19:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505048654843904[0;39m <==    Updates: 0
2022-04-18 23:19:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505048654843904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:19:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505069613780992[0;39m 生成今日电子书快照开始
2022-04-18 23:19:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505069613780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:19:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505069613780992[0;39m ==> Parameters: 
2022-04-18 23:19:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505069613780992[0;39m <==    Updates: 0
2022-04-18 23:19:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505069613780992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:20:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505090585300992[0;39m 生成今日电子书快照开始
2022-04-18 23:20:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505090585300992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505090585300992[0;39m ==> Parameters: 
2022-04-18 23:20:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505090585300992[0;39m <==    Updates: 0
2022-04-18 23:20:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505090585300992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:20:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505111561015296[0;39m 生成今日电子书快照开始
2022-04-18 23:20:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505111561015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505111561015296[0;39m ==> Parameters: 
2022-04-18 23:20:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505111561015296[0;39m <==    Updates: 0
2022-04-18 23:20:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505111561015296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:20:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505111812673536[0;39m start updating Ebook doc
2022-04-18 23:20:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505111812673536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:20:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505111812673536[0;39m ==> Parameters: 
2022-04-18 23:20:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505111812673536[0;39m <==    Updates: 1
2022-04-18 23:20:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505111812673536[0;39m update ends, take 37 millisecs
2022-04-18 23:20:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505132545118208[0;39m 生成今日电子书快照开始
2022-04-18 23:20:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505132545118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505132545118208[0;39m ==> Parameters: 
2022-04-18 23:20:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505132545118208[0;39m <==    Updates: 0
2022-04-18 23:20:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505132545118208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:20:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505153483083776[0;39m 生成今日电子书快照开始
2022-04-18 23:20:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505153483083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505153483083776[0;39m ==> Parameters: 
2022-04-18 23:20:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505153483083776[0;39m <==    Updates: 0
2022-04-18 23:20:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505153483083776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:20:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505174462992384[0;39m 生成今日电子书快照开始
2022-04-18 23:20:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505174462992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505174462992384[0;39m ==> Parameters: 
2022-04-18 23:20:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505174462992384[0;39m <==    Updates: 0
2022-04-18 23:20:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505174462992384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:20:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505195451289600[0;39m 生成今日电子书快照开始
2022-04-18 23:20:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505195451289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505195451289600[0;39m ==> Parameters: 
2022-04-18 23:20:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505195451289600[0;39m <==    Updates: 0
2022-04-18 23:20:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505195451289600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:20:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505216422809600[0;39m 生成今日电子书快照开始
2022-04-18 23:20:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505216422809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505216422809600[0;39m ==> Parameters: 
2022-04-18 23:20:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505216422809600[0;39m <==    Updates: 0
2022-04-18 23:20:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505216422809600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:20:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505237390135296[0;39m 生成今日电子书快照开始
2022-04-18 23:20:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505237390135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:35.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505237390135296[0;39m ==> Parameters: 
2022-04-18 23:20:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505237390135296[0;39m <==    Updates: 0
2022-04-18 23:20:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505237390135296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:20:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505237675347968[0;39m start updating Ebook doc
2022-04-18 23:20:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505237675347968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:20:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505237675347968[0;39m ==> Parameters: 
2022-04-18 23:20:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505237675347968[0;39m <==    Updates: 1
2022-04-18 23:20:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505237675347968[0;39m update ends, take 37 millisecs
2022-04-18 23:20:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505258361655296[0;39m 生成今日电子书快照开始
2022-04-18 23:20:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505258361655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505258361655296[0;39m ==> Parameters: 
2022-04-18 23:20:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505258361655296[0;39m <==    Updates: 0
2022-04-18 23:20:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505258361655296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:20:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505279312203776[0;39m 生成今日电子书快照开始
2022-04-18 23:20:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505279312203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505279312203776[0;39m ==> Parameters: 
2022-04-18 23:20:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505279312203776[0;39m <==    Updates: 0
2022-04-18 23:20:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505279312203776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:20:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505300287918080[0;39m 生成今日电子书快照开始
2022-04-18 23:20:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505300287918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505300287918080[0;39m ==> Parameters: 
2022-04-18 23:20:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505300287918080[0;39m <==    Updates: 0
2022-04-18 23:20:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505300287918080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:20:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505321272020992[0;39m 生成今日电子书快照开始
2022-04-18 23:20:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505321272020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:20:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505321272020992[0;39m ==> Parameters: 
2022-04-18 23:20:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505321272020992[0;39m <==    Updates: 0
2022-04-18 23:20:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505321272020992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:21:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505342247735296[0;39m 生成今日电子书快照开始
2022-04-18 23:21:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505342247735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505342247735296[0;39m ==> Parameters: 
2022-04-18 23:21:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505342247735296[0;39m <==    Updates: 0
2022-04-18 23:21:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505342247735296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:21:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505363219255296[0;39m 生成今日电子书快照开始
2022-04-18 23:21:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505363219255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505363219255296[0;39m ==> Parameters: 
2022-04-18 23:21:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505363219255296[0;39m <==    Updates: 0
2022-04-18 23:21:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505363219255296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:21:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505363504467968[0;39m start updating Ebook doc
2022-04-18 23:21:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505363504467968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:21:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505363504467968[0;39m ==> Parameters: 
2022-04-18 23:21:05.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505363504467968[0;39m <==    Updates: 1
2022-04-18 23:21:05.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505363504467968[0;39m update ends, take 42 millisecs
2022-04-18 23:21:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505384190775296[0;39m 生成今日电子书快照开始
2022-04-18 23:21:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505384190775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505384190775296[0;39m ==> Parameters: 
2022-04-18 23:21:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505384190775296[0;39m <==    Updates: 0
2022-04-18 23:21:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505384190775296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:21:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505405141323776[0;39m 生成今日电子书快照开始
2022-04-18 23:21:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505405141323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505405141323776[0;39m ==> Parameters: 
2022-04-18 23:21:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505405141323776[0;39m <==    Updates: 0
2022-04-18 23:21:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505405141323776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:21:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505426108649472[0;39m 生成今日电子书快照开始
2022-04-18 23:21:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505426108649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505426108649472[0;39m ==> Parameters: 
2022-04-18 23:21:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505426108649472[0;39m <==    Updates: 0
2022-04-18 23:21:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505426108649472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:21:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505447113723904[0;39m 生成今日电子书快照开始
2022-04-18 23:21:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505447113723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505447113723904[0;39m ==> Parameters: 
2022-04-18 23:21:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505447113723904[0;39m <==    Updates: 0
2022-04-18 23:21:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505447113723904[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:21:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505468068466688[0;39m 生成今日电子书快照开始
2022-04-18 23:21:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505468068466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505468068466688[0;39m ==> Parameters: 
2022-04-18 23:21:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505468068466688[0;39m <==    Updates: 0
2022-04-18 23:21:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505468068466688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:21:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505489039986688[0;39m 生成今日电子书快照开始
2022-04-18 23:21:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505489039986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505489039986688[0;39m ==> Parameters: 
2022-04-18 23:21:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505489039986688[0;39m <==    Updates: 0
2022-04-18 23:21:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505489039986688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:21:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505489312616448[0;39m start updating Ebook doc
2022-04-18 23:21:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505489312616448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:21:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505489312616448[0;39m ==> Parameters: 
2022-04-18 23:21:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505489312616448[0;39m <==    Updates: 1
2022-04-18 23:21:35.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505489312616448[0;39m update ends, take 39 millisecs
2022-04-18 23:21:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505510011506688[0;39m 生成今日电子书快照开始
2022-04-18 23:21:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505510011506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505510011506688[0;39m ==> Parameters: 
2022-04-18 23:21:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505510011506688[0;39m <==    Updates: 0
2022-04-18 23:21:40.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505510011506688[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 23:21:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505530995609600[0;39m 生成今日电子书快照开始
2022-04-18 23:21:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505530995609600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505530995609600[0;39m ==> Parameters: 
2022-04-18 23:21:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505530995609600[0;39m <==    Updates: 0
2022-04-18 23:21:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505530995609600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:21:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505551967129600[0;39m 生成今日电子书快照开始
2022-04-18 23:21:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505551967129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505551967129600[0;39m ==> Parameters: 
2022-04-18 23:21:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505551967129600[0;39m <==    Updates: 0
2022-04-18 23:21:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505551967129600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:21:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505572942843904[0;39m 生成今日电子书快照开始
2022-04-18 23:21:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505572942843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:21:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505572942843904[0;39m ==> Parameters: 
2022-04-18 23:21:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505572942843904[0;39m <==    Updates: 0
2022-04-18 23:21:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505572942843904[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:22:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505593880809472[0;39m 生成今日电子书快照开始
2022-04-18 23:22:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505593880809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505593880809472[0;39m ==> Parameters: 
2022-04-18 23:22:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505593880809472[0;39m <==    Updates: 0
2022-04-18 23:22:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505593880809472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:22:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505614869106688[0;39m start updating Ebook doc
2022-04-18 23:22:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505614869106688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:22:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505614869106688[0;39m ==> Parameters: 
2022-04-18 23:22:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505614869106688[0;39m <==    Updates: 1
2022-04-18 23:22:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505614869106688[0;39m update ends, take 64 millisecs
2022-04-18 23:22:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505615137542144[0;39m 生成今日电子书快照开始
2022-04-18 23:22:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505615137542144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505615137542144[0;39m ==> Parameters: 
2022-04-18 23:22:05.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505615137542144[0;39m <==    Updates: 0
2022-04-18 23:22:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505615137542144[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 23:22:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505635849015296[0;39m 生成今日电子书快照开始
2022-04-18 23:22:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505635849015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505635849015296[0;39m ==> Parameters: 
2022-04-18 23:22:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505635849015296[0;39m <==    Updates: 0
2022-04-18 23:22:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505635849015296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:22:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505656824729600[0;39m 生成今日电子书快照开始
2022-04-18 23:22:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505656824729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505656824729600[0;39m ==> Parameters: 
2022-04-18 23:22:15.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505656824729600[0;39m <==    Updates: 0
2022-04-18 23:22:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505656824729600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:22:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505677796249600[0;39m 生成今日电子书快照开始
2022-04-18 23:22:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505677796249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505677796249600[0;39m ==> Parameters: 
2022-04-18 23:22:20.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505677796249600[0;39m <==    Updates: 0
2022-04-18 23:22:20.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505677796249600[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:22:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505698738409472[0;39m 生成今日电子书快照开始
2022-04-18 23:22:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505698738409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505698738409472[0;39m ==> Parameters: 
2022-04-18 23:22:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505698738409472[0;39m <==    Updates: 0
2022-04-18 23:22:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505698738409472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:22:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505719747678208[0;39m 生成今日电子书快照开始
2022-04-18 23:22:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505719747678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:30.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505719747678208[0;39m ==> Parameters: 
2022-04-18 23:22:30.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505719747678208[0;39m <==    Updates: 0
2022-04-18 23:22:30.102 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505719747678208[0;39m 生成今日电子书快照结束，耗时：92毫秒
2022-04-18 23:22:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505740681449472[0;39m 生成今日电子书快照开始
2022-04-18 23:22:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505740681449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505740681449472[0;39m ==> Parameters: 
2022-04-18 23:22:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505740681449472[0;39m <==    Updates: 0
2022-04-18 23:22:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505740681449472[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:22:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505740991827968[0;39m start updating Ebook doc
2022-04-18 23:22:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505740991827968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:22:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505740991827968[0;39m ==> Parameters: 
2022-04-18 23:22:35.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505740991827968[0;39m <==    Updates: 1
2022-04-18 23:22:35.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505740991827968[0;39m update ends, take 40 millisecs
2022-04-18 23:22:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505761665552384[0;39m 生成今日电子书快照开始
2022-04-18 23:22:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505761665552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505761665552384[0;39m ==> Parameters: 
2022-04-18 23:22:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505761665552384[0;39m <==    Updates: 0
2022-04-18 23:22:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505761665552384[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:22:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505782628683776[0;39m 生成今日电子书快照开始
2022-04-18 23:22:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505782628683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505782628683776[0;39m ==> Parameters: 
2022-04-18 23:22:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505782628683776[0;39m <==    Updates: 0
2022-04-18 23:22:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505782628683776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:22:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505803633758208[0;39m 生成今日电子书快照开始
2022-04-18 23:22:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505803633758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505803633758208[0;39m ==> Parameters: 
2022-04-18 23:22:50.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505803633758208[0;39m <==    Updates: 0
2022-04-18 23:22:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505803633758208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:22:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505824588500992[0;39m 生成今日电子书快照开始
2022-04-18 23:22:55.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505824588500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:22:55.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505824588500992[0;39m ==> Parameters: 
2022-04-18 23:22:55.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505824588500992[0;39m <==    Updates: 0
2022-04-18 23:22:55.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505824588500992[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-18 23:23:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505845576798208[0;39m 生成今日电子书快照开始
2022-04-18 23:23:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505845576798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:00.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505845576798208[0;39m ==> Parameters: 
2022-04-18 23:23:00.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505845576798208[0;39m <==    Updates: 0
2022-04-18 23:23:00.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505845576798208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:23:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505866548318208[0;39m 生成今日电子书快照开始
2022-04-18 23:23:05.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505866548318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:05.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505866548318208[0;39m ==> Parameters: 
2022-04-18 23:23:05.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505866548318208[0;39m <==    Updates: 0
2022-04-18 23:23:05.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505866548318208[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:23:05.081 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505866846113792[0;39m start updating Ebook doc
2022-04-18 23:23:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505866846113792[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:23:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505866846113792[0;39m ==> Parameters: 
2022-04-18 23:23:05.125 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505866846113792[0;39m <==    Updates: 1
2022-04-18 23:23:05.125 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505866846113792[0;39m update ends, take 44 millisecs
2022-04-18 23:23:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505887519838208[0;39m 生成今日电子书快照开始
2022-04-18 23:23:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505887519838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505887519838208[0;39m ==> Parameters: 
2022-04-18 23:23:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505887519838208[0;39m <==    Updates: 0
2022-04-18 23:23:10.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505887519838208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:23:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505908466192384[0;39m 生成今日电子书快照开始
2022-04-18 23:23:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505908466192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505908466192384[0;39m ==> Parameters: 
2022-04-18 23:23:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505908466192384[0;39m <==    Updates: 0
2022-04-18 23:23:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505908466192384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:23:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505929441906688[0;39m 生成今日电子书快照开始
2022-04-18 23:23:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505929441906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505929441906688[0;39m ==> Parameters: 
2022-04-18 23:23:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505929441906688[0;39m <==    Updates: 0
2022-04-18 23:23:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505929441906688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:23:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505950434398208[0;39m 生成今日电子书快照开始
2022-04-18 23:23:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505950434398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505950434398208[0;39m ==> Parameters: 
2022-04-18 23:23:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505950434398208[0;39m <==    Updates: 0
2022-04-18 23:23:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505950434398208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:23:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505971393335296[0;39m 生成今日电子书快照开始
2022-04-18 23:23:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505971393335296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:30.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505971393335296[0;39m ==> Parameters: 
2022-04-18 23:23:30.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505971393335296[0;39m <==    Updates: 0
2022-04-18 23:23:30.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505971393335296[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-18 23:23:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171505992377438208[0;39m start updating Ebook doc
2022-04-18 23:23:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505992377438208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:23:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505992377438208[0;39m ==> Parameters: 
2022-04-18 23:23:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171505992377438208[0;39m <==    Updates: 1
2022-04-18 23:23:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171505992377438208[0;39m update ends, take 65 millisecs
2022-04-18 23:23:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171505992654262272[0;39m 生成今日电子书快照开始
2022-04-18 23:23:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505992654262272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505992654262272[0;39m ==> Parameters: 
2022-04-18 23:23:35.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171505992654262272[0;39m <==    Updates: 0
2022-04-18 23:23:35.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171505992654262272[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:23:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506013348958208[0;39m 生成今日电子书快照开始
2022-04-18 23:23:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506013348958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506013348958208[0;39m ==> Parameters: 
2022-04-18 23:23:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506013348958208[0;39m <==    Updates: 0
2022-04-18 23:23:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506013348958208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:23:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506034312089600[0;39m 生成今日电子书快照开始
2022-04-18 23:23:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506034312089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506034312089600[0;39m ==> Parameters: 
2022-04-18 23:23:45.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506034312089600[0;39m <==    Updates: 0
2022-04-18 23:23:45.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506034312089600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:23:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506055291998208[0;39m 生成今日电子书快照开始
2022-04-18 23:23:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506055291998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506055291998208[0;39m ==> Parameters: 
2022-04-18 23:23:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506055291998208[0;39m <==    Updates: 0
2022-04-18 23:23:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506055291998208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:23:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506076255129600[0;39m 生成今日电子书快照开始
2022-04-18 23:23:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506076255129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:23:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506076255129600[0;39m ==> Parameters: 
2022-04-18 23:23:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506076255129600[0;39m <==    Updates: 0
2022-04-18 23:23:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506076255129600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:24:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506097226649600[0;39m 生成今日电子书快照开始
2022-04-18 23:24:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506097226649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506097226649600[0;39m ==> Parameters: 
2022-04-18 23:24:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506097226649600[0;39m <==    Updates: 0
2022-04-18 23:24:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506097226649600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:24:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506118181392384[0;39m start updating Ebook doc
2022-04-18 23:24:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506118181392384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:24:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506118181392384[0;39m ==> Parameters: 
2022-04-18 23:24:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506118181392384[0;39m <==    Updates: 1
2022-04-18 23:24:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506118181392384[0;39m update ends, take 63 millisecs
2022-04-18 23:24:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506118445633536[0;39m 生成今日电子书快照开始
2022-04-18 23:24:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506118445633536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506118445633536[0;39m ==> Parameters: 
2022-04-18 23:24:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506118445633536[0;39m <==    Updates: 0
2022-04-18 23:24:05.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506118445633536[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 23:24:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506139165495296[0;39m 生成今日电子书快照开始
2022-04-18 23:24:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506139165495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506139165495296[0;39m ==> Parameters: 
2022-04-18 23:24:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506139165495296[0;39m <==    Updates: 0
2022-04-18 23:24:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506139165495296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:24:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506160120238080[0;39m 生成今日电子书快照开始
2022-04-18 23:24:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506160120238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506160120238080[0;39m ==> Parameters: 
2022-04-18 23:24:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506160120238080[0;39m <==    Updates: 0
2022-04-18 23:24:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506160120238080[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:24:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506181108535296[0;39m 生成今日电子书快照开始
2022-04-18 23:24:20.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506181108535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:20.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506181108535296[0;39m ==> Parameters: 
2022-04-18 23:24:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506181108535296[0;39m <==    Updates: 0
2022-04-18 23:24:20.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506181108535296[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 23:24:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506202059083776[0;39m 生成今日电子书快照开始
2022-04-18 23:24:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506202059083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506202059083776[0;39m ==> Parameters: 
2022-04-18 23:24:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506202059083776[0;39m <==    Updates: 0
2022-04-18 23:24:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506202059083776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:24:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506223055769600[0;39m 生成今日电子书快照开始
2022-04-18 23:24:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506223055769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506223055769600[0;39m ==> Parameters: 
2022-04-18 23:24:30.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506223055769600[0;39m <==    Updates: 0
2022-04-18 23:24:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506223055769600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:24:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506244006318080[0;39m start updating Ebook doc
2022-04-18 23:24:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506244006318080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:24:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506244006318080[0;39m ==> Parameters: 
2022-04-18 23:24:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506244006318080[0;39m <==    Updates: 1
2022-04-18 23:24:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506244006318080[0;39m update ends, take 63 millisecs
2022-04-18 23:24:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506244270559232[0;39m 生成今日电子书快照开始
2022-04-18 23:24:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506244270559232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506244270559232[0;39m ==> Parameters: 
2022-04-18 23:24:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506244270559232[0;39m <==    Updates: 0
2022-04-18 23:24:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506244270559232[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 23:24:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506264969449472[0;39m 生成今日电子书快照开始
2022-04-18 23:24:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506264969449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:40.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506264969449472[0;39m ==> Parameters: 
2022-04-18 23:24:40.123 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506264969449472[0;39m <==    Updates: 0
2022-04-18 23:24:40.123 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506264969449472[0;39m 生成今日电子书快照结束，耗时：122毫秒
2022-04-18 23:24:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506285961940992[0;39m 生成今日电子书快照开始
2022-04-18 23:24:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506285961940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506285961940992[0;39m ==> Parameters: 
2022-04-18 23:24:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506285961940992[0;39m <==    Updates: 0
2022-04-18 23:24:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506285961940992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:24:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506306950238208[0;39m 生成今日电子书快照开始
2022-04-18 23:24:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506306950238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506306950238208[0;39m ==> Parameters: 
2022-04-18 23:24:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506306950238208[0;39m <==    Updates: 0
2022-04-18 23:24:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506306950238208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:24:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506327909175296[0;39m 生成今日电子书快照开始
2022-04-18 23:24:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506327909175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:24:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506327909175296[0;39m ==> Parameters: 
2022-04-18 23:24:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506327909175296[0;39m <==    Updates: 0
2022-04-18 23:24:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506327909175296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:25:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506348855529472[0;39m 生成今日电子书快照开始
2022-04-18 23:25:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506348855529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506348855529472[0;39m ==> Parameters: 
2022-04-18 23:25:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506348855529472[0;39m <==    Updates: 0
2022-04-18 23:25:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506348855529472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:25:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506369843826688[0;39m 生成今日电子书快照开始
2022-04-18 23:25:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506369843826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506369843826688[0;39m ==> Parameters: 
2022-04-18 23:25:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506369843826688[0;39m <==    Updates: 0
2022-04-18 23:25:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506369843826688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:25:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506370103873536[0;39m start updating Ebook doc
2022-04-18 23:25:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506370103873536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:25:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506370103873536[0;39m ==> Parameters: 
2022-04-18 23:25:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506370103873536[0;39m <==    Updates: 1
2022-04-18 23:25:05.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506370103873536[0;39m update ends, take 48 millisecs
2022-04-18 23:25:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506390832123904[0;39m 生成今日电子书快照开始
2022-04-18 23:25:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506390832123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506390832123904[0;39m ==> Parameters: 
2022-04-18 23:25:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506390832123904[0;39m <==    Updates: 0
2022-04-18 23:25:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506390832123904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:25:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506411803643904[0;39m 生成今日电子书快照开始
2022-04-18 23:25:15.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506411803643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:15.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506411803643904[0;39m ==> Parameters: 
2022-04-18 23:25:15.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506411803643904[0;39m <==    Updates: 0
2022-04-18 23:25:15.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506411803643904[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 23:25:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506432745803776[0;39m 生成今日电子书快照开始
2022-04-18 23:25:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506432745803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506432745803776[0;39m ==> Parameters: 
2022-04-18 23:25:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506432745803776[0;39m <==    Updates: 0
2022-04-18 23:25:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506432745803776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:25:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506453729906688[0;39m 生成今日电子书快照开始
2022-04-18 23:25:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506453729906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506453729906688[0;39m ==> Parameters: 
2022-04-18 23:25:25.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506453729906688[0;39m <==    Updates: 0
2022-04-18 23:25:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506453729906688[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:25:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506474705620992[0;39m 生成今日电子书快照开始
2022-04-18 23:25:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506474705620992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506474705620992[0;39m ==> Parameters: 
2022-04-18 23:25:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506474705620992[0;39m <==    Updates: 0
2022-04-18 23:25:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506474705620992[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:25:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506495668752384[0;39m start updating Ebook doc
2022-04-18 23:25:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506495668752384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:25:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506495668752384[0;39m ==> Parameters: 
2022-04-18 23:25:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506495668752384[0;39m <==    Updates: 1
2022-04-18 23:25:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506495668752384[0;39m update ends, take 61 millisecs
2022-04-18 23:25:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506495928799232[0;39m 生成今日电子书快照开始
2022-04-18 23:25:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506495928799232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506495928799232[0;39m ==> Parameters: 
2022-04-18 23:25:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506495928799232[0;39m <==    Updates: 0
2022-04-18 23:25:35.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506495928799232[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 23:25:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506516652855296[0;39m 生成今日电子书快照开始
2022-04-18 23:25:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506516652855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506516652855296[0;39m ==> Parameters: 
2022-04-18 23:25:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506516652855296[0;39m <==    Updates: 0
2022-04-18 23:25:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506516652855296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:25:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506537632763904[0;39m 生成今日电子书快照开始
2022-04-18 23:25:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506537632763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506537632763904[0;39m ==> Parameters: 
2022-04-18 23:25:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506537632763904[0;39m <==    Updates: 0
2022-04-18 23:25:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506537632763904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:25:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506558583312384[0;39m 生成今日电子书快照开始
2022-04-18 23:25:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506558583312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506558583312384[0;39m ==> Parameters: 
2022-04-18 23:25:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506558583312384[0;39m <==    Updates: 0
2022-04-18 23:25:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506558583312384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:25:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506579563220992[0;39m 生成今日电子书快照开始
2022-04-18 23:25:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506579563220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:25:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506579563220992[0;39m ==> Parameters: 
2022-04-18 23:25:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506579563220992[0;39m <==    Updates: 0
2022-04-18 23:25:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506579563220992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:26:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506600543129600[0;39m 生成今日电子书快照开始
2022-04-18 23:26:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506600543129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506600543129600[0;39m ==> Parameters: 
2022-04-18 23:26:00.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506600543129600[0;39m <==    Updates: 0
2022-04-18 23:26:00.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506600543129600[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 23:26:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506621506260992[0;39m start updating Ebook doc
2022-04-18 23:26:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506621506260992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:26:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506621506260992[0;39m ==> Parameters: 
2022-04-18 23:26:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506621506260992[0;39m <==    Updates: 1
2022-04-18 23:26:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506621506260992[0;39m update ends, take 62 millisecs
2022-04-18 23:26:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506621770502144[0;39m 生成今日电子书快照开始
2022-04-18 23:26:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506621770502144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506621770502144[0;39m ==> Parameters: 
2022-04-18 23:26:05.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506621770502144[0;39m <==    Updates: 0
2022-04-18 23:26:05.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506621770502144[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:26:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506642494558208[0;39m 生成今日电子书快照开始
2022-04-18 23:26:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506642494558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506642494558208[0;39m ==> Parameters: 
2022-04-18 23:26:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506642494558208[0;39m <==    Updates: 0
2022-04-18 23:26:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506642494558208[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:26:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506663466078208[0;39m 生成今日电子书快照开始
2022-04-18 23:26:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506663466078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506663466078208[0;39m ==> Parameters: 
2022-04-18 23:26:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506663466078208[0;39m <==    Updates: 0
2022-04-18 23:26:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506663466078208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:26:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506684429209600[0;39m 生成今日电子书快照开始
2022-04-18 23:26:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506684429209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506684429209600[0;39m ==> Parameters: 
2022-04-18 23:26:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506684429209600[0;39m <==    Updates: 0
2022-04-18 23:26:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506684429209600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:26:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506705396535296[0;39m 生成今日电子书快照开始
2022-04-18 23:26:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506705396535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506705396535296[0;39m ==> Parameters: 
2022-04-18 23:26:25.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506705396535296[0;39m <==    Updates: 0
2022-04-18 23:26:25.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506705396535296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:26:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506726347083776[0;39m 生成今日电子书快照开始
2022-04-18 23:26:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506726347083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506726347083776[0;39m ==> Parameters: 
2022-04-18 23:26:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506726347083776[0;39m <==    Updates: 0
2022-04-18 23:26:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506726347083776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:26:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506747331186688[0;39m 生成今日电子书快照开始
2022-04-18 23:26:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506747331186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506747331186688[0;39m ==> Parameters: 
2022-04-18 23:26:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506747331186688[0;39m <==    Updates: 0
2022-04-18 23:26:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506747331186688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:26:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506747574456320[0;39m start updating Ebook doc
2022-04-18 23:26:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506747574456320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:26:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506747574456320[0;39m ==> Parameters: 
2022-04-18 23:26:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506747574456320[0;39m <==    Updates: 1
2022-04-18 23:26:35.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506747574456320[0;39m update ends, take 47 millisecs
2022-04-18 23:26:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506768294318080[0;39m 生成今日电子书快照开始
2022-04-18 23:26:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506768294318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506768294318080[0;39m ==> Parameters: 
2022-04-18 23:26:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506768294318080[0;39m <==    Updates: 0
2022-04-18 23:26:40.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506768294318080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:26:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506789278420992[0;39m 生成今日电子书快照开始
2022-04-18 23:26:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506789278420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506789278420992[0;39m ==> Parameters: 
2022-04-18 23:26:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506789278420992[0;39m <==    Updates: 0
2022-04-18 23:26:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506789278420992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:26:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506810254135296[0;39m 生成今日电子书快照开始
2022-04-18 23:26:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506810254135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506810254135296[0;39m ==> Parameters: 
2022-04-18 23:26:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506810254135296[0;39m <==    Updates: 0
2022-04-18 23:26:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506810254135296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:26:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506831204683776[0;39m 生成今日电子书快照开始
2022-04-18 23:26:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506831204683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:26:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506831204683776[0;39m ==> Parameters: 
2022-04-18 23:26:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506831204683776[0;39m <==    Updates: 0
2022-04-18 23:26:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506831204683776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:27:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506852167815168[0;39m 生成今日电子书快照开始
2022-04-18 23:27:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506852167815168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506852167815168[0;39m ==> Parameters: 
2022-04-18 23:27:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506852167815168[0;39m <==    Updates: 0
2022-04-18 23:27:00.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506852167815168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:27:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506873160306688[0;39m 生成今日电子书快照开始
2022-04-18 23:27:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506873160306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506873160306688[0;39m ==> Parameters: 
2022-04-18 23:27:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506873160306688[0;39m <==    Updates: 0
2022-04-18 23:27:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506873160306688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:27:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506873424547840[0;39m start updating Ebook doc
2022-04-18 23:27:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506873424547840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:27:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506873424547840[0;39m ==> Parameters: 
2022-04-18 23:27:05.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506873424547840[0;39m <==    Updates: 1
2022-04-18 23:27:05.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506873424547840[0;39m update ends, take 40 millisecs
2022-04-18 23:27:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506894136020992[0;39m 生成今日电子书快照开始
2022-04-18 23:27:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506894136020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506894136020992[0;39m ==> Parameters: 
2022-04-18 23:27:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506894136020992[0;39m <==    Updates: 0
2022-04-18 23:27:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506894136020992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:27:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506915120123904[0;39m 生成今日电子书快照开始
2022-04-18 23:27:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506915120123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506915120123904[0;39m ==> Parameters: 
2022-04-18 23:27:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506915120123904[0;39m <==    Updates: 0
2022-04-18 23:27:15.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506915120123904[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:27:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506936074866688[0;39m 生成今日电子书快照开始
2022-04-18 23:27:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506936074866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506936074866688[0;39m ==> Parameters: 
2022-04-18 23:27:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506936074866688[0;39m <==    Updates: 0
2022-04-18 23:27:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506936074866688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:27:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506957063163904[0;39m 生成今日电子书快照开始
2022-04-18 23:27:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506957063163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506957063163904[0;39m ==> Parameters: 
2022-04-18 23:27:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506957063163904[0;39m <==    Updates: 0
2022-04-18 23:27:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506957063163904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:27:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506978026295296[0;39m 生成今日电子书快照开始
2022-04-18 23:27:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506978026295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506978026295296[0;39m ==> Parameters: 
2022-04-18 23:27:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506978026295296[0;39m <==    Updates: 0
2022-04-18 23:27:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506978026295296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:27:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171506998989426688[0;39m start updating Ebook doc
2022-04-18 23:27:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506998989426688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:27:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506998989426688[0;39m ==> Parameters: 
2022-04-18 23:27:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171506998989426688[0;39m <==    Updates: 1
2022-04-18 23:27:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171506998989426688[0;39m update ends, take 61 millisecs
2022-04-18 23:27:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171506999249473536[0;39m 生成今日电子书快照开始
2022-04-18 23:27:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506999249473536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506999249473536[0;39m ==> Parameters: 
2022-04-18 23:27:35.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171506999249473536[0;39m <==    Updates: 0
2022-04-18 23:27:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171506999249473536[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 23:27:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507019977723904[0;39m 生成今日电子书快照开始
2022-04-18 23:27:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507019977723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507019977723904[0;39m ==> Parameters: 
2022-04-18 23:27:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507019977723904[0;39m <==    Updates: 0
2022-04-18 23:27:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507019977723904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:27:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507040911495168[0;39m 生成今日电子书快照开始
2022-04-18 23:27:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507040911495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507040911495168[0;39m ==> Parameters: 
2022-04-18 23:27:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507040911495168[0;39m <==    Updates: 0
2022-04-18 23:27:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507040911495168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:27:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507061924958208[0;39m 生成今日电子书快照开始
2022-04-18 23:27:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507061924958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507061924958208[0;39m ==> Parameters: 
2022-04-18 23:27:50.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507061924958208[0;39m <==    Updates: 0
2022-04-18 23:27:50.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507061924958208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:27:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507082879700992[0;39m 生成今日电子书快照开始
2022-04-18 23:27:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507082879700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:27:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507082879700992[0;39m ==> Parameters: 
2022-04-18 23:27:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507082879700992[0;39m <==    Updates: 0
2022-04-18 23:27:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507082879700992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:28:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507103863803904[0;39m 生成今日电子书快照开始
2022-04-18 23:28:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507103863803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507103863803904[0;39m ==> Parameters: 
2022-04-18 23:28:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507103863803904[0;39m <==    Updates: 0
2022-04-18 23:28:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507103863803904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:28:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507124826935296[0;39m 生成今日电子书快照开始
2022-04-18 23:28:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507124826935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507124826935296[0;39m ==> Parameters: 
2022-04-18 23:28:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507124826935296[0;39m <==    Updates: 0
2022-04-18 23:28:05.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507124826935296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:28:05.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507125120536576[0;39m start updating Ebook doc
2022-04-18 23:28:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507125120536576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:28:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507125120536576[0;39m ==> Parameters: 
2022-04-18 23:28:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507125120536576[0;39m <==    Updates: 1
2022-04-18 23:28:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507125120536576[0;39m update ends, take 37 millisecs
2022-04-18 23:28:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507145773289472[0;39m 生成今日电子书快照开始
2022-04-18 23:28:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507145773289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507145773289472[0;39m ==> Parameters: 
2022-04-18 23:28:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507145773289472[0;39m <==    Updates: 0
2022-04-18 23:28:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507145773289472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:28:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507166753198080[0;39m 生成今日电子书快照开始
2022-04-18 23:28:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507166753198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507166753198080[0;39m ==> Parameters: 
2022-04-18 23:28:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507166753198080[0;39m <==    Updates: 0
2022-04-18 23:28:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507166753198080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:28:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507187754078208[0;39m 生成今日电子书快照开始
2022-04-18 23:28:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507187754078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507187754078208[0;39m ==> Parameters: 
2022-04-18 23:28:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507187754078208[0;39m <==    Updates: 0
2022-04-18 23:28:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507187754078208[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:28:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507208704626688[0;39m 生成今日电子书快照开始
2022-04-18 23:28:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507208704626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507208704626688[0;39m ==> Parameters: 
2022-04-18 23:28:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507208704626688[0;39m <==    Updates: 0
2022-04-18 23:28:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507208704626688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:28:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507229684535296[0;39m 生成今日电子书快照开始
2022-04-18 23:28:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507229684535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507229684535296[0;39m ==> Parameters: 
2022-04-18 23:28:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507229684535296[0;39m <==    Updates: 0
2022-04-18 23:28:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507229684535296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:28:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507250626695168[0;39m 生成今日电子书快照开始
2022-04-18 23:28:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507250626695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507250626695168[0;39m ==> Parameters: 
2022-04-18 23:28:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507250626695168[0;39m <==    Updates: 0
2022-04-18 23:28:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507250626695168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:28:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507250874159104[0;39m start updating Ebook doc
2022-04-18 23:28:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507250874159104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:28:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507250874159104[0;39m ==> Parameters: 
2022-04-18 23:28:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507250874159104[0;39m <==    Updates: 1
2022-04-18 23:28:35.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507250874159104[0;39m update ends, take 37 millisecs
2022-04-18 23:28:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507271623380992[0;39m 生成今日电子书快照开始
2022-04-18 23:28:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507271623380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507271623380992[0;39m ==> Parameters: 
2022-04-18 23:28:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507271623380992[0;39m <==    Updates: 0
2022-04-18 23:28:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507271623380992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:28:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507292603289600[0;39m 生成今日电子书快照开始
2022-04-18 23:28:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507292603289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507292603289600[0;39m ==> Parameters: 
2022-04-18 23:28:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507292603289600[0;39m <==    Updates: 0
2022-04-18 23:28:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507292603289600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:28:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507313570615296[0;39m 生成今日电子书快照开始
2022-04-18 23:28:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507313570615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507313570615296[0;39m ==> Parameters: 
2022-04-18 23:28:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507313570615296[0;39m <==    Updates: 0
2022-04-18 23:28:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507313570615296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:28:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507334516969472[0;39m 生成今日电子书快照开始
2022-04-18 23:28:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507334516969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:28:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507334516969472[0;39m ==> Parameters: 
2022-04-18 23:28:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507334516969472[0;39m <==    Updates: 0
2022-04-18 23:28:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507334516969472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:29:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507355484295168[0;39m 生成今日电子书快照开始
2022-04-18 23:29:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507355484295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507355484295168[0;39m ==> Parameters: 
2022-04-18 23:29:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507355484295168[0;39m <==    Updates: 0
2022-04-18 23:29:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507355484295168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:29:05.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507376485175296[0;39m start updating Ebook doc
2022-04-18 23:29:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507376485175296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:29:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507376485175296[0;39m ==> Parameters: 
2022-04-18 23:29:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507376485175296[0;39m <==    Updates: 1
2022-04-18 23:29:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507376485175296[0;39m update ends, take 54 millisecs
2022-04-18 23:29:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507376715862016[0;39m 生成今日电子书快照开始
2022-04-18 23:29:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507376715862016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507376715862016[0;39m ==> Parameters: 
2022-04-18 23:29:05.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507376715862016[0;39m <==    Updates: 0
2022-04-18 23:29:05.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507376715862016[0;39m 生成今日电子书快照结束，耗时：33毫秒
2022-04-18 23:29:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507397448306688[0;39m 生成今日电子书快照开始
2022-04-18 23:29:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507397448306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507397448306688[0;39m ==> Parameters: 
2022-04-18 23:29:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507397448306688[0;39m <==    Updates: 0
2022-04-18 23:29:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507397448306688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:29:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507418424020992[0;39m 生成今日电子书快照开始
2022-04-18 23:29:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507418424020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507418424020992[0;39m ==> Parameters: 
2022-04-18 23:29:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507418424020992[0;39m <==    Updates: 0
2022-04-18 23:29:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507418424020992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:29:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507439412318208[0;39m 生成今日电子书快照开始
2022-04-18 23:29:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507439412318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507439412318208[0;39m ==> Parameters: 
2022-04-18 23:29:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507439412318208[0;39m <==    Updates: 0
2022-04-18 23:29:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507439412318208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:29:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507460379643904[0;39m 生成今日电子书快照开始
2022-04-18 23:29:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507460379643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507460379643904[0;39m ==> Parameters: 
2022-04-18 23:29:25.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507460379643904[0;39m <==    Updates: 0
2022-04-18 23:29:25.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507460379643904[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:29:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507481334386688[0;39m 生成今日电子书快照开始
2022-04-18 23:29:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507481334386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507481334386688[0;39m ==> Parameters: 
2022-04-18 23:29:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507481334386688[0;39m <==    Updates: 0
2022-04-18 23:29:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507481334386688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:29:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507502310100992[0;39m start updating Ebook doc
2022-04-18 23:29:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507502310100992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:29:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507502310100992[0;39m ==> Parameters: 
2022-04-18 23:29:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507502310100992[0;39m <==    Updates: 1
2022-04-18 23:29:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507502310100992[0;39m update ends, take 63 millisecs
2022-04-18 23:29:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507502578536448[0;39m 生成今日电子书快照开始
2022-04-18 23:29:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507502578536448[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507502578536448[0;39m ==> Parameters: 
2022-04-18 23:29:35.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507502578536448[0;39m <==    Updates: 0
2022-04-18 23:29:35.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507502578536448[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:29:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507523273232384[0;39m 生成今日电子书快照开始
2022-04-18 23:29:40.126 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507523273232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:40.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507523273232384[0;39m ==> Parameters: 
2022-04-18 23:29:40.238 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507523273232384[0;39m <==    Updates: 0
2022-04-18 23:29:40.239 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507523273232384[0;39m 生成今日电子书快照结束，耗时：235毫秒
2022-04-18 23:29:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507544253140992[0;39m 生成今日电子书快照开始
2022-04-18 23:29:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507544253140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507544253140992[0;39m ==> Parameters: 
2022-04-18 23:29:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507544253140992[0;39m <==    Updates: 0
2022-04-18 23:29:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507544253140992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:29:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507565224660992[0;39m 生成今日电子书快照开始
2022-04-18 23:29:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507565224660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507565224660992[0;39m ==> Parameters: 
2022-04-18 23:29:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507565224660992[0;39m <==    Updates: 0
2022-04-18 23:29:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507565224660992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:29:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507586204569600[0;39m 生成今日电子书快照开始
2022-04-18 23:29:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507586204569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:29:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507586204569600[0;39m ==> Parameters: 
2022-04-18 23:29:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507586204569600[0;39m <==    Updates: 0
2022-04-18 23:29:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507586204569600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:30:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507607142535168[0;39m 生成今日电子书快照开始
2022-04-18 23:30:00.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507607142535168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507607142535168[0;39m ==> Parameters: 
2022-04-18 23:30:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507607142535168[0;39m <==    Updates: 0
2022-04-18 23:30:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507607142535168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:30:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507628139220992[0;39m start updating Ebook doc
2022-04-18 23:30:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507628139220992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:30:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507628139220992[0;39m ==> Parameters: 
2022-04-18 23:30:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507628139220992[0;39m <==    Updates: 1
2022-04-18 23:30:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507628139220992[0;39m update ends, take 60 millisecs
2022-04-18 23:30:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507628390879232[0;39m 生成今日电子书快照开始
2022-04-18 23:30:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507628390879232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507628390879232[0;39m ==> Parameters: 
2022-04-18 23:30:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507628390879232[0;39m <==    Updates: 0
2022-04-18 23:30:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507628390879232[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 23:30:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507649127518208[0;39m 生成今日电子书快照开始
2022-04-18 23:30:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507649127518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507649127518208[0;39m ==> Parameters: 
2022-04-18 23:30:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507649127518208[0;39m <==    Updates: 0
2022-04-18 23:30:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507649127518208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:30:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507670082260992[0;39m 生成今日电子书快照开始
2022-04-18 23:30:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507670082260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507670082260992[0;39m ==> Parameters: 
2022-04-18 23:30:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507670082260992[0;39m <==    Updates: 0
2022-04-18 23:30:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507670082260992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:30:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507691037003776[0;39m 生成今日电子书快照开始
2022-04-18 23:30:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507691037003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507691037003776[0;39m ==> Parameters: 
2022-04-18 23:30:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507691037003776[0;39m <==    Updates: 0
2022-04-18 23:30:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507691037003776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:30:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507712042078208[0;39m 生成今日电子书快照开始
2022-04-18 23:30:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507712042078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507712042078208[0;39m ==> Parameters: 
2022-04-18 23:30:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507712042078208[0;39m <==    Updates: 0
2022-04-18 23:30:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507712042078208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:30:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507732996820992[0;39m 生成今日电子书快照开始
2022-04-18 23:30:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507732996820992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507732996820992[0;39m ==> Parameters: 
2022-04-18 23:30:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507732996820992[0;39m <==    Updates: 0
2022-04-18 23:30:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507732996820992[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:30:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507753943175168[0;39m 生成今日电子书快照开始
2022-04-18 23:30:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507753943175168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507753943175168[0;39m ==> Parameters: 
2022-04-18 23:30:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507753943175168[0;39m <==    Updates: 0
2022-04-18 23:30:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507753943175168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:30:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507754190639104[0;39m start updating Ebook doc
2022-04-18 23:30:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507754190639104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:30:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507754190639104[0;39m ==> Parameters: 
2022-04-18 23:30:35.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507754190639104[0;39m <==    Updates: 1
2022-04-18 23:30:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507754190639104[0;39m update ends, take 39 millisecs
2022-04-18 23:30:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507774952443904[0;39m 生成今日电子书快照开始
2022-04-18 23:30:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507774952443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507774952443904[0;39m ==> Parameters: 
2022-04-18 23:30:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507774952443904[0;39m <==    Updates: 0
2022-04-18 23:30:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507774952443904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:30:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507795928158208[0;39m 生成今日电子书快照开始
2022-04-18 23:30:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507795928158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507795928158208[0;39m ==> Parameters: 
2022-04-18 23:30:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507795928158208[0;39m <==    Updates: 0
2022-04-18 23:30:45.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507795928158208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:30:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507816870318080[0;39m 生成今日电子书快照开始
2022-04-18 23:30:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507816870318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507816870318080[0;39m ==> Parameters: 
2022-04-18 23:30:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507816870318080[0;39m <==    Updates: 0
2022-04-18 23:30:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507816870318080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:30:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507837871198208[0;39m 生成今日电子书快照开始
2022-04-18 23:30:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507837871198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:30:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507837871198208[0;39m ==> Parameters: 
2022-04-18 23:30:55.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507837871198208[0;39m <==    Updates: 0
2022-04-18 23:30:55.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507837871198208[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:31:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507858817552384[0;39m 生成今日电子书快照开始
2022-04-18 23:31:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507858817552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507858817552384[0;39m ==> Parameters: 
2022-04-18 23:31:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507858817552384[0;39m <==    Updates: 0
2022-04-18 23:31:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507858817552384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:31:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507879776489472[0;39m 生成今日电子书快照开始
2022-04-18 23:31:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507879776489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:05.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507879776489472[0;39m ==> Parameters: 
2022-04-18 23:31:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507879776489472[0;39m <==    Updates: 0
2022-04-18 23:31:05.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507879776489472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 23:31:05.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171507880095256576[0;39m start updating Ebook doc
2022-04-18 23:31:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507880095256576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:31:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507880095256576[0;39m ==> Parameters: 
2022-04-18 23:31:05.120 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171507880095256576[0;39m <==    Updates: 1
2022-04-18 23:31:05.120 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171507880095256576[0;39m update ends, take 43 millisecs
2022-04-18 23:31:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507900768980992[0;39m 生成今日电子书快照开始
2022-04-18 23:31:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507900768980992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507900768980992[0;39m ==> Parameters: 
2022-04-18 23:31:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507900768980992[0;39m <==    Updates: 0
2022-04-18 23:31:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507900768980992[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:31:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507921727918080[0;39m 生成今日电子书快照开始
2022-04-18 23:31:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507921727918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507921727918080[0;39m ==> Parameters: 
2022-04-18 23:31:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507921727918080[0;39m <==    Updates: 0
2022-04-18 23:31:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507921727918080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:31:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507942691049472[0;39m 生成今日电子书快照开始
2022-04-18 23:31:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507942691049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507942691049472[0;39m ==> Parameters: 
2022-04-18 23:31:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507942691049472[0;39m <==    Updates: 0
2022-04-18 23:31:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507942691049472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:31:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507963658375168[0;39m 生成今日电子书快照开始
2022-04-18 23:31:25.014 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507963658375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:25.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507963658375168[0;39m ==> Parameters: 
2022-04-18 23:31:25.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507963658375168[0;39m <==    Updates: 0
2022-04-18 23:31:25.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507963658375168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:31:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171507984629895168[0;39m 生成今日电子书快照开始
2022-04-18 23:31:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507984629895168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507984629895168[0;39m ==> Parameters: 
2022-04-18 23:31:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171507984629895168[0;39m <==    Updates: 0
2022-04-18 23:31:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171507984629895168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:31:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508005605609472[0;39m 生成今日电子书快照开始
2022-04-18 23:31:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508005605609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508005605609472[0;39m ==> Parameters: 
2022-04-18 23:31:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508005605609472[0;39m <==    Updates: 0
2022-04-18 23:31:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508005605609472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:31:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508005865656320[0;39m start updating Ebook doc
2022-04-18 23:31:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508005865656320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:31:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508005865656320[0;39m ==> Parameters: 
2022-04-18 23:31:35.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508005865656320[0;39m <==    Updates: 1
2022-04-18 23:31:35.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508005865656320[0;39m update ends, take 39 millisecs
2022-04-18 23:31:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508026577129472[0;39m 生成今日电子书快照开始
2022-04-18 23:31:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508026577129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508026577129472[0;39m ==> Parameters: 
2022-04-18 23:31:40.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508026577129472[0;39m <==    Updates: 0
2022-04-18 23:31:40.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508026577129472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:31:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508047586398208[0;39m 生成今日电子书快照开始
2022-04-18 23:31:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508047586398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508047586398208[0;39m ==> Parameters: 
2022-04-18 23:31:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508047586398208[0;39m <==    Updates: 0
2022-04-18 23:31:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508047586398208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:31:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508068520169472[0;39m 生成今日电子书快照开始
2022-04-18 23:31:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508068520169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508068520169472[0;39m ==> Parameters: 
2022-04-18 23:31:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508068520169472[0;39m <==    Updates: 0
2022-04-18 23:31:50.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508068520169472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:31:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508089487495168[0;39m 生成今日电子书快照开始
2022-04-18 23:31:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508089487495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:31:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508089487495168[0;39m ==> Parameters: 
2022-04-18 23:31:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508089487495168[0;39m <==    Updates: 0
2022-04-18 23:31:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508089487495168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:32:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508110484180992[0;39m 生成今日电子书快照开始
2022-04-18 23:32:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508110484180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508110484180992[0;39m ==> Parameters: 
2022-04-18 23:32:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508110484180992[0;39m <==    Updates: 0
2022-04-18 23:32:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508110484180992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:32:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508131468283904[0;39m 生成今日电子书快照开始
2022-04-18 23:32:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508131468283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508131468283904[0;39m ==> Parameters: 
2022-04-18 23:32:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508131468283904[0;39m <==    Updates: 0
2022-04-18 23:32:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508131468283904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:32:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508131728330752[0;39m start updating Ebook doc
2022-04-18 23:32:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508131728330752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:32:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508131728330752[0;39m ==> Parameters: 
2022-04-18 23:32:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508131728330752[0;39m <==    Updates: 1
2022-04-18 23:32:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508131728330752[0;39m update ends, take 35 millisecs
2022-04-18 23:32:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508152423026688[0;39m 生成今日电子书快照开始
2022-04-18 23:32:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508152423026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508152423026688[0;39m ==> Parameters: 
2022-04-18 23:32:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508152423026688[0;39m <==    Updates: 0
2022-04-18 23:32:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508152423026688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:32:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508173407129600[0;39m 生成今日电子书快照开始
2022-04-18 23:32:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508173407129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508173407129600[0;39m ==> Parameters: 
2022-04-18 23:32:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508173407129600[0;39m <==    Updates: 0
2022-04-18 23:32:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508173407129600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:32:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508194387038208[0;39m 生成今日电子书快照开始
2022-04-18 23:32:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508194387038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508194387038208[0;39m ==> Parameters: 
2022-04-18 23:32:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508194387038208[0;39m <==    Updates: 0
2022-04-18 23:32:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508194387038208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:32:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508215333392384[0;39m 生成今日电子书快照开始
2022-04-18 23:32:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508215333392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508215333392384[0;39m ==> Parameters: 
2022-04-18 23:32:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508215333392384[0;39m <==    Updates: 0
2022-04-18 23:32:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508215333392384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:32:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508236292329472[0;39m 生成今日电子书快照开始
2022-04-18 23:32:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508236292329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508236292329472[0;39m ==> Parameters: 
2022-04-18 23:32:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508236292329472[0;39m <==    Updates: 0
2022-04-18 23:32:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508236292329472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:32:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508257272238080[0;39m start updating Ebook doc
2022-04-18 23:32:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508257272238080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:32:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508257272238080[0;39m ==> Parameters: 
2022-04-18 23:32:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508257272238080[0;39m <==    Updates: 1
2022-04-18 23:32:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508257272238080[0;39m update ends, take 56 millisecs
2022-04-18 23:32:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508257507119104[0;39m 生成今日电子书快照开始
2022-04-18 23:32:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508257507119104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508257507119104[0;39m ==> Parameters: 
2022-04-18 23:32:35.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508257507119104[0;39m <==    Updates: 0
2022-04-18 23:32:35.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508257507119104[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:32:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508278252146688[0;39m 生成今日电子书快照开始
2022-04-18 23:32:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508278252146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508278252146688[0;39m ==> Parameters: 
2022-04-18 23:32:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508278252146688[0;39m <==    Updates: 0
2022-04-18 23:32:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508278252146688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:32:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508299244638208[0;39m 生成今日电子书快照开始
2022-04-18 23:32:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508299244638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508299244638208[0;39m ==> Parameters: 
2022-04-18 23:32:45.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508299244638208[0;39m <==    Updates: 0
2022-04-18 23:32:45.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508299244638208[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 23:32:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508320182603776[0;39m 生成今日电子书快照开始
2022-04-18 23:32:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508320182603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508320182603776[0;39m ==> Parameters: 
2022-04-18 23:32:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508320182603776[0;39m <==    Updates: 0
2022-04-18 23:32:50.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508320182603776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:32:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508341179289600[0;39m 生成今日电子书快照开始
2022-04-18 23:32:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508341179289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:32:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508341179289600[0;39m ==> Parameters: 
2022-04-18 23:32:55.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508341179289600[0;39m <==    Updates: 0
2022-04-18 23:32:55.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508341179289600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:33:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508362138226688[0;39m 生成今日电子书快照开始
2022-04-18 23:33:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508362138226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508362138226688[0;39m ==> Parameters: 
2022-04-18 23:33:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508362138226688[0;39m <==    Updates: 0
2022-04-18 23:33:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508362138226688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:33:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508383113940992[0;39m 生成今日电子书快照开始
2022-04-18 23:33:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508383113940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508383113940992[0;39m ==> Parameters: 
2022-04-18 23:33:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508383113940992[0;39m <==    Updates: 0
2022-04-18 23:33:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508383113940992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:33:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508383373987840[0;39m start updating Ebook doc
2022-04-18 23:33:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508383373987840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:33:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508383373987840[0;39m ==> Parameters: 
2022-04-18 23:33:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508383373987840[0;39m <==    Updates: 1
2022-04-18 23:33:05.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508383373987840[0;39m update ends, take 42 millisecs
2022-04-18 23:33:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508404089655296[0;39m 生成今日电子书快照开始
2022-04-18 23:33:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508404089655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508404089655296[0;39m ==> Parameters: 
2022-04-18 23:33:10.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508404089655296[0;39m <==    Updates: 0
2022-04-18 23:33:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508404089655296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:33:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508425052786688[0;39m 生成今日电子书快照开始
2022-04-18 23:33:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508425052786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508425052786688[0;39m ==> Parameters: 
2022-04-18 23:33:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508425052786688[0;39m <==    Updates: 0
2022-04-18 23:33:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508425052786688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:33:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508446028500992[0;39m 生成今日电子书快照开始
2022-04-18 23:33:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508446028500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508446028500992[0;39m ==> Parameters: 
2022-04-18 23:33:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508446028500992[0;39m <==    Updates: 0
2022-04-18 23:33:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508446028500992[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:33:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508467008409600[0;39m 生成今日电子书快照开始
2022-04-18 23:33:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508467008409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508467008409600[0;39m ==> Parameters: 
2022-04-18 23:33:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508467008409600[0;39m <==    Updates: 0
2022-04-18 23:33:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508467008409600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:33:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508487984123904[0;39m 生成今日电子书快照开始
2022-04-18 23:33:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508487984123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508487984123904[0;39m ==> Parameters: 
2022-04-18 23:33:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508487984123904[0;39m <==    Updates: 0
2022-04-18 23:33:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508487984123904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:33:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508508959838208[0;39m 生成今日电子书快照开始
2022-04-18 23:33:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508508959838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508508959838208[0;39m ==> Parameters: 
2022-04-18 23:33:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508508959838208[0;39m <==    Updates: 0
2022-04-18 23:33:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508508959838208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:33:35.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508509240856576[0;39m start updating Ebook doc
2022-04-18 23:33:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508509240856576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:33:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508509240856576[0;39m ==> Parameters: 
2022-04-18 23:33:35.123 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508509240856576[0;39m <==    Updates: 1
2022-04-18 23:33:35.123 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508509240856576[0;39m update ends, take 46 millisecs
2022-04-18 23:33:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508529927163904[0;39m 生成今日电子书快照开始
2022-04-18 23:33:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508529927163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508529927163904[0;39m ==> Parameters: 
2022-04-18 23:33:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508529927163904[0;39m <==    Updates: 0
2022-04-18 23:33:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508529927163904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:33:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508550886100992[0;39m 生成今日电子书快照开始
2022-04-18 23:33:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508550886100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508550886100992[0;39m ==> Parameters: 
2022-04-18 23:33:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508550886100992[0;39m <==    Updates: 0
2022-04-18 23:33:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508550886100992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:33:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508571861815296[0;39m 生成今日电子书快照开始
2022-04-18 23:33:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508571861815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508571861815296[0;39m ==> Parameters: 
2022-04-18 23:33:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508571861815296[0;39m <==    Updates: 0
2022-04-18 23:33:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508571861815296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:33:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508592845918208[0;39m 生成今日电子书快照开始
2022-04-18 23:33:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508592845918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:33:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508592845918208[0;39m ==> Parameters: 
2022-04-18 23:33:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508592845918208[0;39m <==    Updates: 0
2022-04-18 23:33:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508592845918208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:34:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508613809049600[0;39m 生成今日电子书快照开始
2022-04-18 23:34:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508613809049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508613809049600[0;39m ==> Parameters: 
2022-04-18 23:34:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508613809049600[0;39m <==    Updates: 0
2022-04-18 23:34:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508613809049600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:34:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508634780569600[0;39m 生成今日电子书快照开始
2022-04-18 23:34:05.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508634780569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:05.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508634780569600[0;39m ==> Parameters: 
2022-04-18 23:34:05.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508634780569600[0;39m <==    Updates: 0
2022-04-18 23:34:05.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508634780569600[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 23:34:05.086 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508635107725312[0;39m start updating Ebook doc
2022-04-18 23:34:05.086 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508635107725312[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:34:05.087 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508635107725312[0;39m ==> Parameters: 
2022-04-18 23:34:05.129 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508635107725312[0;39m <==    Updates: 1
2022-04-18 23:34:05.129 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508635107725312[0;39m update ends, take 43 millisecs
2022-04-18 23:34:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508655747895296[0;39m 生成今日电子书快照开始
2022-04-18 23:34:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508655747895296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508655747895296[0;39m ==> Parameters: 
2022-04-18 23:34:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508655747895296[0;39m <==    Updates: 0
2022-04-18 23:34:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508655747895296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:34:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508676702638080[0;39m 生成今日电子书快照开始
2022-04-18 23:34:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508676702638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508676702638080[0;39m ==> Parameters: 
2022-04-18 23:34:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508676702638080[0;39m <==    Updates: 0
2022-04-18 23:34:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508676702638080[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:34:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508697703518208[0;39m 生成今日电子书快照开始
2022-04-18 23:34:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508697703518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508697703518208[0;39m ==> Parameters: 
2022-04-18 23:34:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508697703518208[0;39m <==    Updates: 0
2022-04-18 23:34:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508697703518208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:34:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508718675038208[0;39m 生成今日电子书快照开始
2022-04-18 23:34:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508718675038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508718675038208[0;39m ==> Parameters: 
2022-04-18 23:34:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508718675038208[0;39m <==    Updates: 0
2022-04-18 23:34:25.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508718675038208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:34:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508739638169600[0;39m 生成今日电子书快照开始
2022-04-18 23:34:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508739638169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508739638169600[0;39m ==> Parameters: 
2022-04-18 23:34:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508739638169600[0;39m <==    Updates: 0
2022-04-18 23:34:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508739638169600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:34:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508760605495296[0;39m start updating Ebook doc
2022-04-18 23:34:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508760605495296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:34:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508760605495296[0;39m ==> Parameters: 
2022-04-18 23:34:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508760605495296[0;39m <==    Updates: 1
2022-04-18 23:34:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508760605495296[0;39m update ends, take 56 millisecs
2022-04-18 23:34:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508760840376320[0;39m 生成今日电子书快照开始
2022-04-18 23:34:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508760840376320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508760840376320[0;39m ==> Parameters: 
2022-04-18 23:34:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508760840376320[0;39m <==    Updates: 0
2022-04-18 23:34:35.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508760840376320[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:34:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508781581209600[0;39m 生成今日电子书快照开始
2022-04-18 23:34:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508781581209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508781581209600[0;39m ==> Parameters: 
2022-04-18 23:34:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508781581209600[0;39m <==    Updates: 0
2022-04-18 23:34:40.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508781581209600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:34:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508802556923904[0;39m 生成今日电子书快照开始
2022-04-18 23:34:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508802556923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508802556923904[0;39m ==> Parameters: 
2022-04-18 23:34:45.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508802556923904[0;39m <==    Updates: 0
2022-04-18 23:34:45.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508802556923904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:34:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508823524249600[0;39m 生成今日电子书快照开始
2022-04-18 23:34:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508823524249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508823524249600[0;39m ==> Parameters: 
2022-04-18 23:34:50.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508823524249600[0;39m <==    Updates: 0
2022-04-18 23:34:50.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508823524249600[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-18 23:34:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508844491575296[0;39m 生成今日电子书快照开始
2022-04-18 23:34:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508844491575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:34:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508844491575296[0;39m ==> Parameters: 
2022-04-18 23:34:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508844491575296[0;39m <==    Updates: 0
2022-04-18 23:34:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508844491575296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:35:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508865446318080[0;39m 生成今日电子书快照开始
2022-04-18 23:35:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508865446318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508865446318080[0;39m ==> Parameters: 
2022-04-18 23:35:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508865446318080[0;39m <==    Updates: 0
2022-04-18 23:35:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508865446318080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:35:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508886417838080[0;39m 生成今日电子书快照开始
2022-04-18 23:35:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508886417838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508886417838080[0;39m ==> Parameters: 
2022-04-18 23:35:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508886417838080[0;39m <==    Updates: 0
2022-04-18 23:35:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508886417838080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:35:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171508886661107712[0;39m start updating Ebook doc
2022-04-18 23:35:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508886661107712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:35:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508886661107712[0;39m ==> Parameters: 
2022-04-18 23:35:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171508886661107712[0;39m <==    Updates: 1
2022-04-18 23:35:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171508886661107712[0;39m update ends, take 43 millisecs
2022-04-18 23:35:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508907406135296[0;39m 生成今日电子书快照开始
2022-04-18 23:35:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508907406135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508907406135296[0;39m ==> Parameters: 
2022-04-18 23:35:10.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508907406135296[0;39m <==    Updates: 0
2022-04-18 23:35:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508907406135296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:35:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508928365072384[0;39m 生成今日电子书快照开始
2022-04-18 23:35:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508928365072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508928365072384[0;39m ==> Parameters: 
2022-04-18 23:35:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508928365072384[0;39m <==    Updates: 0
2022-04-18 23:35:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508928365072384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:35:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508949361758208[0;39m 生成今日电子书快照开始
2022-04-18 23:35:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508949361758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508949361758208[0;39m ==> Parameters: 
2022-04-18 23:35:20.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508949361758208[0;39m <==    Updates: 0
2022-04-18 23:35:20.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508949361758208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:35:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508970333278208[0;39m 生成今日电子书快照开始
2022-04-18 23:35:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508970333278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508970333278208[0;39m ==> Parameters: 
2022-04-18 23:35:25.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508970333278208[0;39m <==    Updates: 0
2022-04-18 23:35:25.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508970333278208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:35:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171508991304798208[0;39m 生成今日电子书快照开始
2022-04-18 23:35:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508991304798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508991304798208[0;39m ==> Parameters: 
2022-04-18 23:35:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171508991304798208[0;39m <==    Updates: 0
2022-04-18 23:35:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171508991304798208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:35:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509012276318208[0;39m 生成今日电子书快照开始
2022-04-18 23:35:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509012276318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509012276318208[0;39m ==> Parameters: 
2022-04-18 23:35:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509012276318208[0;39m <==    Updates: 0
2022-04-18 23:35:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509012276318208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:35:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509012553142272[0;39m start updating Ebook doc
2022-04-18 23:35:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509012553142272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:35:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509012553142272[0;39m ==> Parameters: 
2022-04-18 23:35:35.115 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509012553142272[0;39m <==    Updates: 1
2022-04-18 23:35:35.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509012553142272[0;39m update ends, take 39 millisecs
2022-04-18 23:35:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509033243643904[0;39m 生成今日电子书快照开始
2022-04-18 23:35:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509033243643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509033243643904[0;39m ==> Parameters: 
2022-04-18 23:35:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509033243643904[0;39m <==    Updates: 0
2022-04-18 23:35:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509033243643904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:35:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509054219358208[0;39m 生成今日电子书快照开始
2022-04-18 23:35:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509054219358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509054219358208[0;39m ==> Parameters: 
2022-04-18 23:35:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509054219358208[0;39m <==    Updates: 0
2022-04-18 23:35:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509054219358208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:35:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509075157323776[0;39m 生成今日电子书快照开始
2022-04-18 23:35:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509075157323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509075157323776[0;39m ==> Parameters: 
2022-04-18 23:35:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509075157323776[0;39m <==    Updates: 0
2022-04-18 23:35:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509075157323776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:35:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509096145620992[0;39m 生成今日电子书快照开始
2022-04-18 23:35:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509096145620992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:35:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509096145620992[0;39m ==> Parameters: 
2022-04-18 23:35:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509096145620992[0;39m <==    Updates: 0
2022-04-18 23:35:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509096145620992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:36:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509117117140992[0;39m 生成今日电子书快照开始
2022-04-18 23:36:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509117117140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509117117140992[0;39m ==> Parameters: 
2022-04-18 23:36:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509117117140992[0;39m <==    Updates: 0
2022-04-18 23:36:00.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509117117140992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:36:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509138097049600[0;39m 生成今日电子书快照开始
2022-04-18 23:36:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509138097049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509138097049600[0;39m ==> Parameters: 
2022-04-18 23:36:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509138097049600[0;39m <==    Updates: 0
2022-04-18 23:36:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509138097049600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:36:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509138382262272[0;39m start updating Ebook doc
2022-04-18 23:36:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509138382262272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:36:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509138382262272[0;39m ==> Parameters: 
2022-04-18 23:36:05.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509138382262272[0;39m <==    Updates: 1
2022-04-18 23:36:05.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509138382262272[0;39m update ends, take 41 millisecs
2022-04-18 23:36:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509159072763904[0;39m 生成今日电子书快照开始
2022-04-18 23:36:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509159072763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509159072763904[0;39m ==> Parameters: 
2022-04-18 23:36:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509159072763904[0;39m <==    Updates: 0
2022-04-18 23:36:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509159072763904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:36:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509180044283904[0;39m 生成今日电子书快照开始
2022-04-18 23:36:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509180044283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509180044283904[0;39m ==> Parameters: 
2022-04-18 23:36:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509180044283904[0;39m <==    Updates: 0
2022-04-18 23:36:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509180044283904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:36:20.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509201024192512[0;39m 生成今日电子书快照开始
2022-04-18 23:36:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509201024192512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509201024192512[0;39m ==> Parameters: 
2022-04-18 23:36:20.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509201024192512[0;39m <==    Updates: 0
2022-04-18 23:36:20.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509201024192512[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-18 23:36:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509221983129600[0;39m 生成今日电子书快照开始
2022-04-18 23:36:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509221983129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509221983129600[0;39m ==> Parameters: 
2022-04-18 23:36:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509221983129600[0;39m <==    Updates: 0
2022-04-18 23:36:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509221983129600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:36:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509242946260992[0;39m 生成今日电子书快照开始
2022-04-18 23:36:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509242946260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509242946260992[0;39m ==> Parameters: 
2022-04-18 23:36:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509242946260992[0;39m <==    Updates: 0
2022-04-18 23:36:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509242946260992[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:36:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509263905198080[0;39m 生成今日电子书快照开始
2022-04-18 23:36:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509263905198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509263905198080[0;39m ==> Parameters: 
2022-04-18 23:36:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509263905198080[0;39m <==    Updates: 0
2022-04-18 23:36:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509263905198080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:36:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509264156856320[0;39m start updating Ebook doc
2022-04-18 23:36:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509264156856320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:36:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509264156856320[0;39m ==> Parameters: 
2022-04-18 23:36:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509264156856320[0;39m <==    Updates: 1
2022-04-18 23:36:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509264156856320[0;39m update ends, take 37 millisecs
2022-04-18 23:36:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509284872523776[0;39m 生成今日电子书快照开始
2022-04-18 23:36:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509284872523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509284872523776[0;39m ==> Parameters: 
2022-04-18 23:36:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509284872523776[0;39m <==    Updates: 0
2022-04-18 23:36:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509284872523776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:36:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509305852432384[0;39m 生成今日电子书快照开始
2022-04-18 23:36:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509305852432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509305852432384[0;39m ==> Parameters: 
2022-04-18 23:36:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509305852432384[0;39m <==    Updates: 0
2022-04-18 23:36:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509305852432384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:36:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509326819758080[0;39m 生成今日电子书快照开始
2022-04-18 23:36:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509326819758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509326819758080[0;39m ==> Parameters: 
2022-04-18 23:36:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509326819758080[0;39m <==    Updates: 0
2022-04-18 23:36:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509326819758080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:36:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509347820638208[0;39m 生成今日电子书快照开始
2022-04-18 23:36:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509347820638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:36:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509347820638208[0;39m ==> Parameters: 
2022-04-18 23:36:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509347820638208[0;39m <==    Updates: 0
2022-04-18 23:36:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509347820638208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:37:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509368779575296[0;39m 生成今日电子书快照开始
2022-04-18 23:37:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509368779575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509368779575296[0;39m ==> Parameters: 
2022-04-18 23:37:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509368779575296[0;39m <==    Updates: 0
2022-04-18 23:37:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509368779575296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:37:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509389759483904[0;39m 生成今日电子书快照开始
2022-04-18 23:37:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509389759483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509389759483904[0;39m ==> Parameters: 
2022-04-18 23:37:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509389759483904[0;39m <==    Updates: 0
2022-04-18 23:37:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509389759483904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:37:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509390019530752[0;39m start updating Ebook doc
2022-04-18 23:37:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509390019530752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:37:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509390019530752[0;39m ==> Parameters: 
2022-04-18 23:37:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509390019530752[0;39m <==    Updates: 1
2022-04-18 23:37:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509390019530752[0;39m update ends, take 36 millisecs
2022-04-18 23:37:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509410731003904[0;39m 生成今日电子书快照开始
2022-04-18 23:37:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509410731003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509410731003904[0;39m ==> Parameters: 
2022-04-18 23:37:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509410731003904[0;39m <==    Updates: 0
2022-04-18 23:37:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509410731003904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:37:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509431706718208[0;39m 生成今日电子书快照开始
2022-04-18 23:37:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509431706718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509431706718208[0;39m ==> Parameters: 
2022-04-18 23:37:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509431706718208[0;39m <==    Updates: 0
2022-04-18 23:37:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509431706718208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:37:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509452665655296[0;39m 生成今日电子书快照开始
2022-04-18 23:37:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509452665655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509452665655296[0;39m ==> Parameters: 
2022-04-18 23:37:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509452665655296[0;39m <==    Updates: 0
2022-04-18 23:37:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509452665655296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:37:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509473620398080[0;39m 生成今日电子书快照开始
2022-04-18 23:37:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509473620398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509473620398080[0;39m ==> Parameters: 
2022-04-18 23:37:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509473620398080[0;39m <==    Updates: 0
2022-04-18 23:37:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509473620398080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:37:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509494600306688[0;39m 生成今日电子书快照开始
2022-04-18 23:37:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509494600306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509494600306688[0;39m ==> Parameters: 
2022-04-18 23:37:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509494600306688[0;39m <==    Updates: 0
2022-04-18 23:37:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509494600306688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:37:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509515559243776[0;39m start updating Ebook doc
2022-04-18 23:37:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509515559243776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:37:35.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509515559243776[0;39m ==> Parameters: 
2022-04-18 23:37:35.043 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509515559243776[0;39m <==    Updates: 1
2022-04-18 23:37:35.044 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509515559243776[0;39m update ends, take 41 millisecs
2022-04-18 23:37:35.044 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509515735404544[0;39m 生成今日电子书快照开始
2022-04-18 23:37:35.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509515735404544[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:35.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509515735404544[0;39m ==> Parameters: 
2022-04-18 23:37:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509515735404544[0;39m <==    Updates: 0
2022-04-18 23:37:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509515735404544[0;39m 生成今日电子书快照结束，耗时：27毫秒
2022-04-18 23:37:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509536560123904[0;39m 生成今日电子书快照开始
2022-04-18 23:37:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509536560123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509536560123904[0;39m ==> Parameters: 
2022-04-18 23:37:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509536560123904[0;39m <==    Updates: 0
2022-04-18 23:37:40.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509536560123904[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:37:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509557523255296[0;39m 生成今日电子书快照开始
2022-04-18 23:37:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509557523255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509557523255296[0;39m ==> Parameters: 
2022-04-18 23:37:45.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509557523255296[0;39m <==    Updates: 0
2022-04-18 23:37:45.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509557523255296[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-18 23:37:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509578498969600[0;39m 生成今日电子书快照开始
2022-04-18 23:37:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509578498969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509578498969600[0;39m ==> Parameters: 
2022-04-18 23:37:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509578498969600[0;39m <==    Updates: 0
2022-04-18 23:37:50.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509578498969600[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:37:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509599478878208[0;39m 生成今日电子书快照开始
2022-04-18 23:37:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509599478878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:37:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509599478878208[0;39m ==> Parameters: 
2022-04-18 23:37:55.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509599478878208[0;39m <==    Updates: 0
2022-04-18 23:37:55.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509599478878208[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:38:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509620442009600[0;39m 生成今日电子书快照开始
2022-04-18 23:38:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509620442009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509620442009600[0;39m ==> Parameters: 
2022-04-18 23:38:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509620442009600[0;39m <==    Updates: 0
2022-04-18 23:38:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509620442009600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:38:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509641421918208[0;39m start updating Ebook doc
2022-04-18 23:38:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509641421918208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:38:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509641421918208[0;39m ==> Parameters: 
2022-04-18 23:38:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509641421918208[0;39m <==    Updates: 1
2022-04-18 23:38:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509641421918208[0;39m update ends, take 51 millisecs
2022-04-18 23:38:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509641635827712[0;39m 生成今日电子书快照开始
2022-04-18 23:38:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509641635827712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509641635827712[0;39m ==> Parameters: 
2022-04-18 23:38:05.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509641635827712[0;39m <==    Updates: 0
2022-04-18 23:38:05.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509641635827712[0;39m 生成今日电子书快照结束，耗时：25毫秒
2022-04-18 23:38:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509662368272384[0;39m 生成今日电子书快照开始
2022-04-18 23:38:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509662368272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509662368272384[0;39m ==> Parameters: 
2022-04-18 23:38:10.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509662368272384[0;39m <==    Updates: 0
2022-04-18 23:38:10.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509662368272384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:38:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509683335598080[0;39m 生成今日电子书快照开始
2022-04-18 23:38:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509683335598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509683335598080[0;39m ==> Parameters: 
2022-04-18 23:38:15.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509683335598080[0;39m <==    Updates: 0
2022-04-18 23:38:15.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509683335598080[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:38:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509704336478208[0;39m 生成今日电子书快照开始
2022-04-18 23:38:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509704336478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509704336478208[0;39m ==> Parameters: 
2022-04-18 23:38:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509704336478208[0;39m <==    Updates: 0
2022-04-18 23:38:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509704336478208[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:38:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509725274443776[0;39m 生成今日电子书快照开始
2022-04-18 23:38:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509725274443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509725274443776[0;39m ==> Parameters: 
2022-04-18 23:38:25.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509725274443776[0;39m <==    Updates: 0
2022-04-18 23:38:25.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509725274443776[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:38:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509746279518208[0;39m 生成今日电子书快照开始
2022-04-18 23:38:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509746279518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509746279518208[0;39m ==> Parameters: 
2022-04-18 23:38:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509746279518208[0;39m <==    Updates: 0
2022-04-18 23:38:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509746279518208[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:38:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509767251038208[0;39m 生成今日电子书快照开始
2022-04-18 23:38:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509767251038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509767251038208[0;39m ==> Parameters: 
2022-04-18 23:38:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509767251038208[0;39m <==    Updates: 0
2022-04-18 23:38:35.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509767251038208[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:38:35.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509767448170496[0;39m start updating Ebook doc
2022-04-18 23:38:35.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509767448170496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:38:35.057 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509767448170496[0;39m ==> Parameters: 
2022-04-18 23:38:35.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509767448170496[0;39m <==    Updates: 1
2022-04-18 23:38:35.089 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509767448170496[0;39m update ends, take 32 millisecs
2022-04-18 23:38:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509788222558208[0;39m 生成今日电子书快照开始
2022-04-18 23:38:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509788222558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509788222558208[0;39m ==> Parameters: 
2022-04-18 23:38:40.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509788222558208[0;39m <==    Updates: 0
2022-04-18 23:38:40.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509788222558208[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:38:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509809181495296[0;39m 生成今日电子书快照开始
2022-04-18 23:38:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509809181495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509809181495296[0;39m ==> Parameters: 
2022-04-18 23:38:45.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509809181495296[0;39m <==    Updates: 0
2022-04-18 23:38:45.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509809181495296[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 23:38:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509830165598208[0;39m 生成今日电子书快照开始
2022-04-18 23:38:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509830165598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509830165598208[0;39m ==> Parameters: 
2022-04-18 23:38:50.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509830165598208[0;39m <==    Updates: 0
2022-04-18 23:38:50.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509830165598208[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:38:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509851137118208[0;39m 生成今日电子书快照开始
2022-04-18 23:38:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509851137118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:38:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509851137118208[0;39m ==> Parameters: 
2022-04-18 23:38:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509851137118208[0;39m <==    Updates: 0
2022-04-18 23:38:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509851137118208[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:39:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509872091860992[0;39m 生成今日电子书快照开始
2022-04-18 23:39:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509872091860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509872091860992[0;39m ==> Parameters: 
2022-04-18 23:39:00.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509872091860992[0;39m <==    Updates: 0
2022-04-18 23:39:00.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509872091860992[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 23:39:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509893042409472[0;39m 生成今日电子书快照开始
2022-04-18 23:39:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509893042409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509893042409472[0;39m ==> Parameters: 
2022-04-18 23:39:05.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509893042409472[0;39m <==    Updates: 0
2022-04-18 23:39:05.044 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509893042409472[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:39:05.044 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171509893222764544[0;39m start updating Ebook doc
2022-04-18 23:39:05.045 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509893222764544[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:39:05.045 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509893222764544[0;39m ==> Parameters: 
2022-04-18 23:39:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171509893222764544[0;39m <==    Updates: 1
2022-04-18 23:39:05.078 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171509893222764544[0;39m update ends, take 33 millisecs
2022-04-18 23:39:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509914022318080[0;39m 生成今日电子书快照开始
2022-04-18 23:39:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509914022318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509914022318080[0;39m ==> Parameters: 
2022-04-18 23:39:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509914022318080[0;39m <==    Updates: 0
2022-04-18 23:39:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509914022318080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:39:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509934985449472[0;39m 生成今日电子书快照开始
2022-04-18 23:39:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509934985449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509934985449472[0;39m ==> Parameters: 
2022-04-18 23:39:15.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509934985449472[0;39m <==    Updates: 0
2022-04-18 23:39:15.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509934985449472[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 23:39:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509955977940992[0;39m 生成今日电子书快照开始
2022-04-18 23:39:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509955977940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509955977940992[0;39m ==> Parameters: 
2022-04-18 23:39:20.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509955977940992[0;39m <==    Updates: 0
2022-04-18 23:39:20.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509955977940992[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:39:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509976957849600[0;39m 生成今日电子书快照开始
2022-04-18 23:39:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509976957849600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509976957849600[0;39m ==> Parameters: 
2022-04-18 23:39:25.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509976957849600[0;39m <==    Updates: 0
2022-04-18 23:39:25.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509976957849600[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:39:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171509997933563904[0;39m 生成今日电子书快照开始
2022-04-18 23:39:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509997933563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509997933563904[0;39m ==> Parameters: 
2022-04-18 23:39:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171509997933563904[0;39m <==    Updates: 0
2022-04-18 23:39:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171509997933563904[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:39:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510018900889600[0;39m 生成今日电子书快照开始
2022-04-18 23:39:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510018900889600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510018900889600[0;39m ==> Parameters: 
2022-04-18 23:39:35.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510018900889600[0;39m <==    Updates: 0
2022-04-18 23:39:35.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510018900889600[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 23:39:35.050 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510019077050368[0;39m start updating Ebook doc
2022-04-18 23:39:35.050 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510019077050368[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:39:35.051 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510019077050368[0;39m ==> Parameters: 
2022-04-18 23:39:35.086 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510019077050368[0;39m <==    Updates: 1
2022-04-18 23:39:35.086 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510019077050368[0;39m update ends, take 36 millisecs
2022-04-18 23:39:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510039880798208[0;39m 生成今日电子书快照开始
2022-04-18 23:39:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510039880798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510039880798208[0;39m ==> Parameters: 
2022-04-18 23:39:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510039880798208[0;39m <==    Updates: 0
2022-04-18 23:39:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510039880798208[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:39:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510060852318208[0;39m 生成今日电子书快照开始
2022-04-18 23:39:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510060852318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510060852318208[0;39m ==> Parameters: 
2022-04-18 23:39:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510060852318208[0;39m <==    Updates: 0
2022-04-18 23:39:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510060852318208[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:39:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510081815449600[0;39m 生成今日电子书快照开始
2022-04-18 23:39:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510081815449600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510081815449600[0;39m ==> Parameters: 
2022-04-18 23:39:50.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510081815449600[0;39m <==    Updates: 0
2022-04-18 23:39:50.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510081815449600[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:39:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510102791163904[0;39m 生成今日电子书快照开始
2022-04-18 23:39:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510102791163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:39:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510102791163904[0;39m ==> Parameters: 
2022-04-18 23:39:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510102791163904[0;39m <==    Updates: 0
2022-04-18 23:39:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510102791163904[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:40:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510123745906688[0;39m 生成今日电子书快照开始
2022-04-18 23:40:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510123745906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510123745906688[0;39m ==> Parameters: 
2022-04-18 23:40:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510123745906688[0;39m <==    Updates: 0
2022-04-18 23:40:00.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510123745906688[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:40:05.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510144730009600[0;39m start updating Ebook doc
2022-04-18 23:40:05.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510144730009600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:40:05.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510144730009600[0;39m ==> Parameters: 
2022-04-18 23:40:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510144730009600[0;39m <==    Updates: 1
2022-04-18 23:40:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510144730009600[0;39m update ends, take 57 millisecs
2022-04-18 23:40:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510144973279232[0;39m 生成今日电子书快照开始
2022-04-18 23:40:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510144973279232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510144973279232[0;39m ==> Parameters: 
2022-04-18 23:40:05.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510144973279232[0;39m <==    Updates: 0
2022-04-18 23:40:05.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510144973279232[0;39m 生成今日电子书快照结束，耗时：33毫秒
2022-04-18 23:40:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510165709918208[0;39m 生成今日电子书快照开始
2022-04-18 23:40:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510165709918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510165709918208[0;39m ==> Parameters: 
2022-04-18 23:40:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510165709918208[0;39m <==    Updates: 0
2022-04-18 23:40:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510165709918208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:40:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510186681438208[0;39m 生成今日电子书快照开始
2022-04-18 23:40:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510186681438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510186681438208[0;39m ==> Parameters: 
2022-04-18 23:40:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510186681438208[0;39m <==    Updates: 0
2022-04-18 23:40:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510186681438208[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:40:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510207644569600[0;39m 生成今日电子书快照开始
2022-04-18 23:40:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510207644569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510207644569600[0;39m ==> Parameters: 
2022-04-18 23:40:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510207644569600[0;39m <==    Updates: 0
2022-04-18 23:40:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510207644569600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:40:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510228590923776[0;39m 生成今日电子书快照开始
2022-04-18 23:40:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510228590923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510228590923776[0;39m ==> Parameters: 
2022-04-18 23:40:25.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510228590923776[0;39m <==    Updates: 0
2022-04-18 23:40:25.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510228590923776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:40:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510249575026688[0;39m 生成今日电子书快照开始
2022-04-18 23:40:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510249575026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510249575026688[0;39m ==> Parameters: 
2022-04-18 23:40:30.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510249575026688[0;39m <==    Updates: 0
2022-04-18 23:40:30.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510249575026688[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 23:40:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510270567518208[0;39m start updating Ebook doc
2022-04-18 23:40:35.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510270567518208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:40:35.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510270567518208[0;39m ==> Parameters: 
2022-04-18 23:40:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510270567518208[0;39m <==    Updates: 1
2022-04-18 23:40:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510270567518208[0;39m update ends, take 51 millisecs
2022-04-18 23:40:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510270781427712[0;39m 生成今日电子书快照开始
2022-04-18 23:40:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510270781427712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510270781427712[0;39m ==> Parameters: 
2022-04-18 23:40:35.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510270781427712[0;39m <==    Updates: 0
2022-04-18 23:40:35.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510270781427712[0;39m 生成今日电子书快照结束，耗时：26毫秒
2022-04-18 23:40:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510291534843904[0;39m 生成今日电子书快照开始
2022-04-18 23:40:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510291534843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510291534843904[0;39m ==> Parameters: 
2022-04-18 23:40:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510291534843904[0;39m <==    Updates: 0
2022-04-18 23:40:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510291534843904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:40:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510312510558208[0;39m 生成今日电子书快照开始
2022-04-18 23:40:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510312510558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510312510558208[0;39m ==> Parameters: 
2022-04-18 23:40:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510312510558208[0;39m <==    Updates: 0
2022-04-18 23:40:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510312510558208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:40:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510333482078208[0;39m 生成今日电子书快照开始
2022-04-18 23:40:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510333482078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510333482078208[0;39m ==> Parameters: 
2022-04-18 23:40:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510333482078208[0;39m <==    Updates: 0
2022-04-18 23:40:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510333482078208[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:40:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510354415849472[0;39m 生成今日电子书快照开始
2022-04-18 23:40:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510354415849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:40:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510354415849472[0;39m ==> Parameters: 
2022-04-18 23:40:55.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510354415849472[0;39m <==    Updates: 0
2022-04-18 23:40:55.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510354415849472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:41:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510375416729600[0;39m 生成今日电子书快照开始
2022-04-18 23:41:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510375416729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510375416729600[0;39m ==> Parameters: 
2022-04-18 23:41:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510375416729600[0;39m <==    Updates: 0
2022-04-18 23:41:00.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510375416729600[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:41:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510396363083776[0;39m 生成今日电子书快照开始
2022-04-18 23:41:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510396363083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510396363083776[0;39m ==> Parameters: 
2022-04-18 23:41:05.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510396363083776[0;39m <==    Updates: 0
2022-04-18 23:41:05.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510396363083776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:41:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510396585381888[0;39m start updating Ebook doc
2022-04-18 23:41:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510396585381888[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:41:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510396585381888[0;39m ==> Parameters: 
2022-04-18 23:41:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510396585381888[0;39m <==    Updates: 1
2022-04-18 23:41:05.081 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510396585381888[0;39m update ends, take 26 millisecs
2022-04-18 23:41:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510417368158208[0;39m 生成今日电子书快照开始
2022-04-18 23:41:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510417368158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510417368158208[0;39m ==> Parameters: 
2022-04-18 23:41:10.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510417368158208[0;39m <==    Updates: 0
2022-04-18 23:41:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510417368158208[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:41:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510438339678208[0;39m 生成今日电子书快照开始
2022-04-18 23:41:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510438339678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510438339678208[0;39m ==> Parameters: 
2022-04-18 23:41:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510438339678208[0;39m <==    Updates: 0
2022-04-18 23:41:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510438339678208[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 23:41:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510459311198208[0;39m 生成今日电子书快照开始
2022-04-18 23:41:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510459311198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510459311198208[0;39m ==> Parameters: 
2022-04-18 23:41:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510459311198208[0;39m <==    Updates: 0
2022-04-18 23:41:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510459311198208[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:41:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510480282718208[0;39m 生成今日电子书快照开始
2022-04-18 23:41:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510480282718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510480282718208[0;39m ==> Parameters: 
2022-04-18 23:41:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510480282718208[0;39m <==    Updates: 0
2022-04-18 23:41:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510480282718208[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:41:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510501224878080[0;39m 生成今日电子书快照开始
2022-04-18 23:41:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510501224878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510501224878080[0;39m ==> Parameters: 
2022-04-18 23:41:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510501224878080[0;39m <==    Updates: 0
2022-04-18 23:41:30.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510501224878080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:41:35.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510522183815168[0;39m start updating Ebook doc
2022-04-18 23:41:35.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510522183815168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:41:35.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510522183815168[0;39m ==> Parameters: 
2022-04-18 23:41:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510522183815168[0;39m <==    Updates: 1
2022-04-18 23:41:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510522183815168[0;39m update ends, take 62 millisecs
2022-04-18 23:41:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510522443862016[0;39m 生成今日电子书快照开始
2022-04-18 23:41:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510522443862016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510522443862016[0;39m ==> Parameters: 
2022-04-18 23:41:35.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510522443862016[0;39m <==    Updates: 0
2022-04-18 23:41:35.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510522443862016[0;39m 生成今日电子书快照结束，耗时：27毫秒
2022-04-18 23:41:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510543172112384[0;39m 生成今日电子书快照开始
2022-04-18 23:41:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510543172112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510543172112384[0;39m ==> Parameters: 
2022-04-18 23:41:40.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510543172112384[0;39m <==    Updates: 0
2022-04-18 23:41:40.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510543172112384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:41:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510564168798208[0;39m 生成今日电子书快照开始
2022-04-18 23:41:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510564168798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510564168798208[0;39m ==> Parameters: 
2022-04-18 23:41:45.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510564168798208[0;39m <==    Updates: 0
2022-04-18 23:41:45.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510564168798208[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 23:41:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510585119346688[0;39m 生成今日电子书快照开始
2022-04-18 23:41:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510585119346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510585119346688[0;39m ==> Parameters: 
2022-04-18 23:41:50.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510585119346688[0;39m <==    Updates: 0
2022-04-18 23:41:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510585119346688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:41:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510606078283776[0;39m 生成今日电子书快照开始
2022-04-18 23:41:55.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510606078283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:41:55.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510606078283776[0;39m ==> Parameters: 
2022-04-18 23:41:55.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510606078283776[0;39m <==    Updates: 0
2022-04-18 23:41:55.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510606078283776[0;39m 生成今日电子书快照结束，耗时：105毫秒
2022-04-18 23:42:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510627074969600[0;39m 生成今日电子书快照开始
2022-04-18 23:42:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510627074969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510627074969600[0;39m ==> Parameters: 
2022-04-18 23:42:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510627074969600[0;39m <==    Updates: 0
2022-04-18 23:42:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510627074969600[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:42:05.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510648042295296[0;39m start updating Ebook doc
2022-04-18 23:42:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510648042295296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:42:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510648042295296[0;39m ==> Parameters: 
2022-04-18 23:42:05.048 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510648042295296[0;39m <==    Updates: 1
2022-04-18 23:42:05.048 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510648042295296[0;39m update ends, take 41 millisecs
2022-04-18 23:42:05.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510648214261760[0;39m 生成今日电子书快照开始
2022-04-18 23:42:05.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510648214261760[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:05.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510648214261760[0;39m ==> Parameters: 
2022-04-18 23:42:05.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510648214261760[0;39m <==    Updates: 0
2022-04-18 23:42:05.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510648214261760[0;39m 生成今日电子书快照结束，耗时：32毫秒
2022-04-18 23:42:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510669001232384[0;39m 生成今日电子书快照开始
2022-04-18 23:42:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510669001232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510669001232384[0;39m ==> Parameters: 
2022-04-18 23:42:10.145 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510669001232384[0;39m <==    Updates: 0
2022-04-18 23:42:10.145 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510669001232384[0;39m 生成今日电子书快照结束，耗时：141毫秒
2022-04-18 23:42:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510689976946688[0;39m 生成今日电子书快照开始
2022-04-18 23:42:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510689976946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510689976946688[0;39m ==> Parameters: 
2022-04-18 23:42:15.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510689976946688[0;39m <==    Updates: 0
2022-04-18 23:42:15.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510689976946688[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:42:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510710952660992[0;39m 生成今日电子书快照开始
2022-04-18 23:42:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510710952660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510710952660992[0;39m ==> Parameters: 
2022-04-18 23:42:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510710952660992[0;39m <==    Updates: 0
2022-04-18 23:42:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510710952660992[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:42:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510731924180992[0;39m 生成今日电子书快照开始
2022-04-18 23:42:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510731924180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510731924180992[0;39m ==> Parameters: 
2022-04-18 23:42:25.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510731924180992[0;39m <==    Updates: 0
2022-04-18 23:42:25.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510731924180992[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:42:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510752912478208[0;39m 生成今日电子书快照开始
2022-04-18 23:42:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510752912478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510752912478208[0;39m ==> Parameters: 
2022-04-18 23:42:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510752912478208[0;39m <==    Updates: 0
2022-04-18 23:42:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510752912478208[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 23:42:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510773850443776[0;39m 生成今日电子书快照开始
2022-04-18 23:42:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510773850443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510773850443776[0;39m ==> Parameters: 
2022-04-18 23:42:35.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510773850443776[0;39m <==    Updates: 0
2022-04-18 23:42:35.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510773850443776[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:42:35.048 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510774043381760[0;39m start updating Ebook doc
2022-04-18 23:42:35.048 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510774043381760[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:42:35.048 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510774043381760[0;39m ==> Parameters: 
2022-04-18 23:42:35.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510774043381760[0;39m <==    Updates: 1
2022-04-18 23:42:35.081 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510774043381760[0;39m update ends, take 33 millisecs
2022-04-18 23:42:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510794830352384[0;39m 生成今日电子书快照开始
2022-04-18 23:42:40.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510794830352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:40.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510794830352384[0;39m ==> Parameters: 
2022-04-18 23:42:40.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510794830352384[0;39m <==    Updates: 0
2022-04-18 23:42:40.118 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510794830352384[0;39m 生成今日电子书快照结束，耗时：114毫秒
2022-04-18 23:42:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510815814455296[0;39m 生成今日电子书快照开始
2022-04-18 23:42:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510815814455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510815814455296[0;39m ==> Parameters: 
2022-04-18 23:42:45.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510815814455296[0;39m <==    Updates: 0
2022-04-18 23:42:45.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510815814455296[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 23:42:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510836794363904[0;39m 生成今日电子书快照开始
2022-04-18 23:42:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510836794363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510836794363904[0;39m ==> Parameters: 
2022-04-18 23:42:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510836794363904[0;39m <==    Updates: 0
2022-04-18 23:42:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510836794363904[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:42:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510857740718080[0;39m 生成今日电子书快照开始
2022-04-18 23:42:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510857740718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:42:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510857740718080[0;39m ==> Parameters: 
2022-04-18 23:42:55.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510857740718080[0;39m <==    Updates: 0
2022-04-18 23:42:55.048 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510857740718080[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:43:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510878716432384[0;39m 生成今日电子书快照开始
2022-04-18 23:43:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510878716432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510878716432384[0;39m ==> Parameters: 
2022-04-18 23:43:00.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510878716432384[0;39m <==    Updates: 0
2022-04-18 23:43:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510878716432384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:43:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510899683758080[0;39m 生成今日电子书快照开始
2022-04-18 23:43:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510899683758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510899683758080[0;39m ==> Parameters: 
2022-04-18 23:43:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510899683758080[0;39m <==    Updates: 0
2022-04-18 23:43:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510899683758080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:43:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171510899939610624[0;39m start updating Ebook doc
2022-04-18 23:43:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510899939610624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:43:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510899939610624[0;39m ==> Parameters: 
2022-04-18 23:43:05.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171510899939610624[0;39m <==    Updates: 1
2022-04-18 23:43:05.091 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171510899939610624[0;39m update ends, take 27 millisecs
2022-04-18 23:43:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510920663666688[0;39m 生成今日电子书快照开始
2022-04-18 23:43:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510920663666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510920663666688[0;39m ==> Parameters: 
2022-04-18 23:43:10.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510920663666688[0;39m <==    Updates: 0
2022-04-18 23:43:10.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510920663666688[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:43:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510941656158208[0;39m 生成今日电子书快照开始
2022-04-18 23:43:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510941656158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510941656158208[0;39m ==> Parameters: 
2022-04-18 23:43:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510941656158208[0;39m <==    Updates: 0
2022-04-18 23:43:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510941656158208[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:43:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510962610900992[0;39m 生成今日电子书快照开始
2022-04-18 23:43:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510962610900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510962610900992[0;39m ==> Parameters: 
2022-04-18 23:43:20.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510962610900992[0;39m <==    Updates: 0
2022-04-18 23:43:20.046 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510962610900992[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:43:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171510983590809600[0;39m 生成今日电子书快照开始
2022-04-18 23:43:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510983590809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510983590809600[0;39m ==> Parameters: 
2022-04-18 23:43:25.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171510983590809600[0;39m <==    Updates: 0
2022-04-18 23:43:25.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171510983590809600[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-18 23:43:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511004570718208[0;39m 生成今日电子书快照开始
2022-04-18 23:43:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511004570718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511004570718208[0;39m ==> Parameters: 
2022-04-18 23:43:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511004570718208[0;39m <==    Updates: 0
2022-04-18 23:43:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511004570718208[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:43:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511025517072384[0;39m 生成今日电子书快照开始
2022-04-18 23:43:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511025517072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511025517072384[0;39m ==> Parameters: 
2022-04-18 23:43:35.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511025517072384[0;39m <==    Updates: 0
2022-04-18 23:43:35.042 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511025517072384[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 23:43:35.042 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511025676455936[0;39m start updating Ebook doc
2022-04-18 23:43:35.042 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511025676455936[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:43:35.043 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511025676455936[0;39m ==> Parameters: 
2022-04-18 23:43:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511025676455936[0;39m <==    Updates: 1
2022-04-18 23:43:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511025676455936[0;39m update ends, take 33 millisecs
2022-04-18 23:43:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511046505369600[0;39m 生成今日电子书快照开始
2022-04-18 23:43:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511046505369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511046505369600[0;39m ==> Parameters: 
2022-04-18 23:43:40.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511046505369600[0;39m <==    Updates: 0
2022-04-18 23:43:40.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511046505369600[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-18 23:43:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511067485278208[0;39m 生成今日电子书快照开始
2022-04-18 23:43:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511067485278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511067485278208[0;39m ==> Parameters: 
2022-04-18 23:43:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511067485278208[0;39m <==    Updates: 0
2022-04-18 23:43:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511067485278208[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:43:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511088444215296[0;39m 生成今日电子书快照开始
2022-04-18 23:43:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511088444215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511088444215296[0;39m ==> Parameters: 
2022-04-18 23:43:50.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511088444215296[0;39m <==    Updates: 0
2022-04-18 23:43:50.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511088444215296[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-18 23:43:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511109407346688[0;39m 生成今日电子书快照开始
2022-04-18 23:43:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511109407346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:43:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511109407346688[0;39m ==> Parameters: 
2022-04-18 23:43:55.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511109407346688[0;39m <==    Updates: 0
2022-04-18 23:43:55.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511109407346688[0;39m 生成今日电子书快照结束，耗时：89毫秒
2022-04-18 23:44:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511130391449600[0;39m 生成今日电子书快照开始
2022-04-18 23:44:00.231 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511130391449600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:00.232 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511130391449600[0;39m ==> Parameters: 
2022-04-18 23:44:00.268 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511130391449600[0;39m <==    Updates: 0
2022-04-18 23:44:00.269 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511130391449600[0;39m 生成今日电子书快照结束，耗时：261毫秒
2022-04-18 23:44:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511151367163904[0;39m 生成今日电子书快照开始
2022-04-18 23:44:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511151367163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511151367163904[0;39m ==> Parameters: 
2022-04-18 23:44:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511151367163904[0;39m <==    Updates: 0
2022-04-18 23:44:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511151367163904[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:44:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511151581073408[0;39m start updating Ebook doc
2022-04-18 23:44:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511151581073408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:44:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511151581073408[0;39m ==> Parameters: 
2022-04-18 23:44:05.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511151581073408[0;39m <==    Updates: 1
2022-04-18 23:44:05.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511151581073408[0;39m update ends, take 36 millisecs
2022-04-18 23:44:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511172309323776[0;39m 生成今日电子书快照开始
2022-04-18 23:44:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511172309323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511172309323776[0;39m ==> Parameters: 
2022-04-18 23:44:10.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511172309323776[0;39m <==    Updates: 0
2022-04-18 23:44:10.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511172309323776[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-18 23:44:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511193314398208[0;39m 生成今日电子书快照开始
2022-04-18 23:44:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511193314398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511193314398208[0;39m ==> Parameters: 
2022-04-18 23:44:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511193314398208[0;39m <==    Updates: 0
2022-04-18 23:44:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511193314398208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:44:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511214252363776[0;39m 生成今日电子书快照开始
2022-04-18 23:44:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511214252363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511214252363776[0;39m ==> Parameters: 
2022-04-18 23:44:20.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511214252363776[0;39m <==    Updates: 0
2022-04-18 23:44:20.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511214252363776[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:44:25.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511235261632512[0;39m 生成今日电子书快照开始
2022-04-18 23:44:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511235261632512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511235261632512[0;39m ==> Parameters: 
2022-04-18 23:44:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511235261632512[0;39m <==    Updates: 0
2022-04-18 23:44:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511235261632512[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:44:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511256199598080[0;39m 生成今日电子书快照开始
2022-04-18 23:44:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511256199598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511256199598080[0;39m ==> Parameters: 
2022-04-18 23:44:30.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511256199598080[0;39m <==    Updates: 0
2022-04-18 23:44:30.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511256199598080[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:44:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511277187895296[0;39m start updating Ebook doc
2022-04-18 23:44:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511277187895296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:44:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511277187895296[0;39m ==> Parameters: 
2022-04-18 23:44:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511277187895296[0;39m <==    Updates: 1
2022-04-18 23:44:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511277187895296[0;39m update ends, take 48 millisecs
2022-04-18 23:44:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511277389221888[0;39m 生成今日电子书快照开始
2022-04-18 23:44:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511277389221888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511277389221888[0;39m ==> Parameters: 
2022-04-18 23:44:35.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511277389221888[0;39m <==    Updates: 0
2022-04-18 23:44:35.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511277389221888[0;39m 生成今日电子书快照结束，耗时：29毫秒
2022-04-18 23:44:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511298167803904[0;39m 生成今日电子书快照开始
2022-04-18 23:44:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511298167803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511298167803904[0;39m ==> Parameters: 
2022-04-18 23:44:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511298167803904[0;39m <==    Updates: 0
2022-04-18 23:44:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511298167803904[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:44:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511319126740992[0;39m 生成今日电子书快照开始
2022-04-18 23:44:45.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511319126740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:45.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511319126740992[0;39m ==> Parameters: 
2022-04-18 23:44:45.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511319126740992[0;39m <==    Updates: 0
2022-04-18 23:44:45.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511319126740992[0;39m 生成今日电子书快照结束，耗时：104毫秒
2022-04-18 23:44:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511340115038208[0;39m 生成今日电子书快照开始
2022-04-18 23:44:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511340115038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511340115038208[0;39m ==> Parameters: 
2022-04-18 23:44:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511340115038208[0;39m <==    Updates: 0
2022-04-18 23:44:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511340115038208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:44:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511361048809472[0;39m 生成今日电子书快照开始
2022-04-18 23:44:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511361048809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:44:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511361048809472[0;39m ==> Parameters: 
2022-04-18 23:44:55.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511361048809472[0;39m <==    Updates: 0
2022-04-18 23:44:55.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511361048809472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:45:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511382016135168[0;39m 生成今日电子书快照开始
2022-04-18 23:45:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511382016135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511382016135168[0;39m ==> Parameters: 
2022-04-18 23:45:00.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511382016135168[0;39m <==    Updates: 0
2022-04-18 23:45:00.045 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511382016135168[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 23:45:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511403012820992[0;39m start updating Ebook doc
2022-04-18 23:45:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511403012820992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:45:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511403012820992[0;39m ==> Parameters: 
2022-04-18 23:45:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511403012820992[0;39m <==    Updates: 1
2022-04-18 23:45:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511403012820992[0;39m update ends, take 52 millisecs
2022-04-18 23:45:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511403235119104[0;39m 生成今日电子书快照开始
2022-04-18 23:45:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511403235119104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511403235119104[0;39m ==> Parameters: 
2022-04-18 23:45:05.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511403235119104[0;39m <==    Updates: 0
2022-04-18 23:45:05.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511403235119104[0;39m 生成今日电子书快照结束，耗时：28毫秒
2022-04-18 23:45:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511423975952384[0;39m 生成今日电子书快照开始
2022-04-18 23:45:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511423975952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:10.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511423975952384[0;39m ==> Parameters: 
2022-04-18 23:45:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511423975952384[0;39m <==    Updates: 0
2022-04-18 23:45:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511423975952384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:45:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511444947472384[0;39m 生成今日电子书快照开始
2022-04-18 23:45:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511444947472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511444947472384[0;39m ==> Parameters: 
2022-04-18 23:45:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511444947472384[0;39m <==    Updates: 0
2022-04-18 23:45:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511444947472384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:45:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511465906409472[0;39m 生成今日电子书快照开始
2022-04-18 23:45:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511465906409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511465906409472[0;39m ==> Parameters: 
2022-04-18 23:45:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511465906409472[0;39m <==    Updates: 0
2022-04-18 23:45:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511465906409472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:45:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511486903095296[0;39m 生成今日电子书快照开始
2022-04-18 23:45:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511486903095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511486903095296[0;39m ==> Parameters: 
2022-04-18 23:45:25.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511486903095296[0;39m <==    Updates: 0
2022-04-18 23:45:25.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511486903095296[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-18 23:45:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511507883003904[0;39m 生成今日电子书快照开始
2022-04-18 23:45:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511507883003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511507883003904[0;39m ==> Parameters: 
2022-04-18 23:45:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511507883003904[0;39m <==    Updates: 0
2022-04-18 23:45:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511507883003904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:45:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511528858718208[0;39m 生成今日电子书快照开始
2022-04-18 23:45:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511528858718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511528858718208[0;39m ==> Parameters: 
2022-04-18 23:45:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511528858718208[0;39m <==    Updates: 0
2022-04-18 23:45:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511528858718208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:45:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511529085210624[0;39m start updating Ebook doc
2022-04-18 23:45:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511529085210624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:45:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511529085210624[0;39m ==> Parameters: 
2022-04-18 23:45:35.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511529085210624[0;39m <==    Updates: 1
2022-04-18 23:45:35.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511529085210624[0;39m update ends, take 29 millisecs
2022-04-18 23:45:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511549813460992[0;39m 生成今日电子书快照开始
2022-04-18 23:45:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511549813460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511549813460992[0;39m ==> Parameters: 
2022-04-18 23:45:40.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511549813460992[0;39m <==    Updates: 0
2022-04-18 23:45:40.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511549813460992[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-18 23:45:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511570772398080[0;39m 生成今日电子书快照开始
2022-04-18 23:45:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511570772398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511570772398080[0;39m ==> Parameters: 
2022-04-18 23:45:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511570772398080[0;39m <==    Updates: 0
2022-04-18 23:45:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511570772398080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:45:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511591743918080[0;39m 生成今日电子书快照开始
2022-04-18 23:45:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511591743918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511591743918080[0;39m ==> Parameters: 
2022-04-18 23:45:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511591743918080[0;39m <==    Updates: 0
2022-04-18 23:45:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511591743918080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:45:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511612744798208[0;39m 生成今日电子书快照开始
2022-04-18 23:45:55.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511612744798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:45:55.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511612744798208[0;39m ==> Parameters: 
2022-04-18 23:45:55.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511612744798208[0;39m <==    Updates: 0
2022-04-18 23:45:55.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511612744798208[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:46:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511633703735296[0;39m 生成今日电子书快照开始
2022-04-18 23:46:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511633703735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511633703735296[0;39m ==> Parameters: 
2022-04-18 23:46:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511633703735296[0;39m <==    Updates: 0
2022-04-18 23:46:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511633703735296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:46:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511654654283776[0;39m 生成今日电子书快照开始
2022-04-18 23:46:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511654654283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511654654283776[0;39m ==> Parameters: 
2022-04-18 23:46:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511654654283776[0;39m <==    Updates: 0
2022-04-18 23:46:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511654654283776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:46:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511654901747712[0;39m start updating Ebook doc
2022-04-18 23:46:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511654901747712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:46:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511654901747712[0;39m ==> Parameters: 
2022-04-18 23:46:05.091 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511654901747712[0;39m <==    Updates: 1
2022-04-18 23:46:05.091 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511654901747712[0;39m update ends, take 30 millisecs
2022-04-18 23:46:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511675655163904[0;39m 生成今日电子书快照开始
2022-04-18 23:46:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511675655163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511675655163904[0;39m ==> Parameters: 
2022-04-18 23:46:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511675655163904[0;39m <==    Updates: 0
2022-04-18 23:46:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511675655163904[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:46:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511696622489600[0;39m 生成今日电子书快照开始
2022-04-18 23:46:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511696622489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511696622489600[0;39m ==> Parameters: 
2022-04-18 23:46:15.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511696622489600[0;39m <==    Updates: 0
2022-04-18 23:46:15.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511696622489600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:46:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511717568843776[0;39m 生成今日电子书快照开始
2022-04-18 23:46:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511717568843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511717568843776[0;39m ==> Parameters: 
2022-04-18 23:46:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511717568843776[0;39m <==    Updates: 0
2022-04-18 23:46:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511717568843776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:46:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511738557140992[0;39m 生成今日电子书快照开始
2022-04-18 23:46:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511738557140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511738557140992[0;39m ==> Parameters: 
2022-04-18 23:46:25.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511738557140992[0;39m <==    Updates: 0
2022-04-18 23:46:25.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511738557140992[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:46:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511759537049600[0;39m 生成今日电子书快照开始
2022-04-18 23:46:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511759537049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511759537049600[0;39m ==> Parameters: 
2022-04-18 23:46:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511759537049600[0;39m <==    Updates: 0
2022-04-18 23:46:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511759537049600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:46:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511780500180992[0;39m start updating Ebook doc
2022-04-18 23:46:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511780500180992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:46:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511780500180992[0;39m ==> Parameters: 
2022-04-18 23:46:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511780500180992[0;39m <==    Updates: 1
2022-04-18 23:46:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511780500180992[0;39m update ends, take 64 millisecs
2022-04-18 23:46:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511780768616448[0;39m 生成今日电子书快照开始
2022-04-18 23:46:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511780768616448[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511780768616448[0;39m ==> Parameters: 
2022-04-18 23:46:35.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511780768616448[0;39m <==    Updates: 0
2022-04-18 23:46:35.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511780768616448[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-18 23:46:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511801467506688[0;39m 生成今日电子书快照开始
2022-04-18 23:46:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511801467506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511801467506688[0;39m ==> Parameters: 
2022-04-18 23:46:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511801467506688[0;39m <==    Updates: 0
2022-04-18 23:46:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511801467506688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:46:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511822426443776[0;39m 生成今日电子书快照开始
2022-04-18 23:46:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511822426443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511822426443776[0;39m ==> Parameters: 
2022-04-18 23:46:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511822426443776[0;39m <==    Updates: 0
2022-04-18 23:46:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511822426443776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:46:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511843418935296[0;39m 生成今日电子书快照开始
2022-04-18 23:46:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511843418935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511843418935296[0;39m ==> Parameters: 
2022-04-18 23:46:50.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511843418935296[0;39m <==    Updates: 0
2022-04-18 23:46:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511843418935296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:46:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511864403038208[0;39m 生成今日电子书快照开始
2022-04-18 23:46:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511864403038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:46:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511864403038208[0;39m ==> Parameters: 
2022-04-18 23:46:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511864403038208[0;39m <==    Updates: 0
2022-04-18 23:46:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511864403038208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:47:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511885374558208[0;39m 生成今日电子书快照开始
2022-04-18 23:47:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511885374558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511885374558208[0;39m ==> Parameters: 
2022-04-18 23:47:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511885374558208[0;39m <==    Updates: 0
2022-04-18 23:47:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511885374558208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:47:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511906312523776[0;39m 生成今日电子书快照开始
2022-04-18 23:47:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511906312523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511906312523776[0;39m ==> Parameters: 
2022-04-18 23:47:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511906312523776[0;39m <==    Updates: 0
2022-04-18 23:47:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511906312523776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:47:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171511906576764928[0;39m start updating Ebook doc
2022-04-18 23:47:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511906576764928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:47:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511906576764928[0;39m ==> Parameters: 
2022-04-18 23:47:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171511906576764928[0;39m <==    Updates: 1
2022-04-18 23:47:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171511906576764928[0;39m update ends, take 39 millisecs
2022-04-18 23:47:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511927288238080[0;39m 生成今日电子书快照开始
2022-04-18 23:47:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511927288238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511927288238080[0;39m ==> Parameters: 
2022-04-18 23:47:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511927288238080[0;39m <==    Updates: 0
2022-04-18 23:47:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511927288238080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:47:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511948263952384[0;39m 生成今日电子书快照开始
2022-04-18 23:47:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511948263952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511948263952384[0;39m ==> Parameters: 
2022-04-18 23:47:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511948263952384[0;39m <==    Updates: 0
2022-04-18 23:47:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511948263952384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:47:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511969227083776[0;39m 生成今日电子书快照开始
2022-04-18 23:47:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511969227083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511969227083776[0;39m ==> Parameters: 
2022-04-18 23:47:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511969227083776[0;39m <==    Updates: 0
2022-04-18 23:47:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511969227083776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:47:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171511990202798080[0;39m 生成今日电子书快照开始
2022-04-18 23:47:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511990202798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511990202798080[0;39m ==> Parameters: 
2022-04-18 23:47:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171511990202798080[0;39m <==    Updates: 0
2022-04-18 23:47:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171511990202798080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:47:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512011165929472[0;39m 生成今日电子书快照开始
2022-04-18 23:47:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512011165929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512011165929472[0;39m ==> Parameters: 
2022-04-18 23:47:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512011165929472[0;39m <==    Updates: 0
2022-04-18 23:47:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512011165929472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:47:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512032158420992[0;39m 生成今日电子书快照开始
2022-04-18 23:47:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512032158420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512032158420992[0;39m ==> Parameters: 
2022-04-18 23:47:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512032158420992[0;39m <==    Updates: 0
2022-04-18 23:47:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512032158420992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:47:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512032410079232[0;39m start updating Ebook doc
2022-04-18 23:47:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512032410079232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:47:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512032410079232[0;39m ==> Parameters: 
2022-04-18 23:47:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512032410079232[0;39m <==    Updates: 1
2022-04-18 23:47:35.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512032410079232[0;39m update ends, take 41 millisecs
2022-04-18 23:47:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512053125746688[0;39m 生成今日电子书快照开始
2022-04-18 23:47:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512053125746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512053125746688[0;39m ==> Parameters: 
2022-04-18 23:47:40.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512053125746688[0;39m <==    Updates: 0
2022-04-18 23:47:40.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512053125746688[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 23:47:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512074118238208[0;39m 生成今日电子书快照开始
2022-04-18 23:47:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512074118238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512074118238208[0;39m ==> Parameters: 
2022-04-18 23:47:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512074118238208[0;39m <==    Updates: 0
2022-04-18 23:47:45.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512074118238208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:47:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512095089758208[0;39m 生成今日电子书快照开始
2022-04-18 23:47:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512095089758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512095089758208[0;39m ==> Parameters: 
2022-04-18 23:47:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512095089758208[0;39m <==    Updates: 0
2022-04-18 23:47:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512095089758208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:47:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512116031918080[0;39m 生成今日电子书快照开始
2022-04-18 23:47:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512116031918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:47:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512116031918080[0;39m ==> Parameters: 
2022-04-18 23:47:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512116031918080[0;39m <==    Updates: 0
2022-04-18 23:47:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512116031918080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:48:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512137024409600[0;39m 生成今日电子书快照开始
2022-04-18 23:48:00.124 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512137024409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:00.125 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512137024409600[0;39m ==> Parameters: 
2022-04-18 23:48:00.163 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512137024409600[0;39m <==    Updates: 0
2022-04-18 23:48:00.164 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512137024409600[0;39m 生成今日电子书快照结束，耗时：156毫秒
2022-04-18 23:48:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512157995929600[0;39m 生成今日电子书快照开始
2022-04-18 23:48:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512157995929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512157995929600[0;39m ==> Parameters: 
2022-04-18 23:48:05.331 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512157995929600[0;39m <==    Updates: 0
2022-04-18 23:48:05.331 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512157995929600[0;39m 生成今日电子书快照结束，耗时：322毫秒
2022-04-18 23:48:05.332 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512159354884096[0;39m start updating Ebook doc
2022-04-18 23:48:05.332 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512159354884096[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:48:05.332 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512159354884096[0;39m ==> Parameters: 
2022-04-18 23:48:05.372 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512159354884096[0;39m <==    Updates: 1
2022-04-18 23:48:05.373 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512159354884096[0;39m update ends, take 41 millisecs
2022-04-18 23:48:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512178971643904[0;39m 生成今日电子书快照开始
2022-04-18 23:48:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512178971643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512178971643904[0;39m ==> Parameters: 
2022-04-18 23:48:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512178971643904[0;39m <==    Updates: 0
2022-04-18 23:48:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512178971643904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:48:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512199934775296[0;39m 生成今日电子书快照开始
2022-04-18 23:48:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512199934775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512199934775296[0;39m ==> Parameters: 
2022-04-18 23:48:15.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512199934775296[0;39m <==    Updates: 0
2022-04-18 23:48:15.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512199934775296[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-18 23:48:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512220897906688[0;39m 生成今日电子书快照开始
2022-04-18 23:48:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512220897906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512220897906688[0;39m ==> Parameters: 
2022-04-18 23:48:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512220897906688[0;39m <==    Updates: 0
2022-04-18 23:48:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512220897906688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:48:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512241882009600[0;39m 生成今日电子书快照开始
2022-04-18 23:48:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512241882009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512241882009600[0;39m ==> Parameters: 
2022-04-18 23:48:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512241882009600[0;39m <==    Updates: 0
2022-04-18 23:48:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512241882009600[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:48:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512262853529600[0;39m 生成今日电子书快照开始
2022-04-18 23:48:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512262853529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512262853529600[0;39m ==> Parameters: 
2022-04-18 23:48:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512262853529600[0;39m <==    Updates: 0
2022-04-18 23:48:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512262853529600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:48:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512283820855296[0;39m 生成今日电子书快照开始
2022-04-18 23:48:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512283820855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512283820855296[0;39m ==> Parameters: 
2022-04-18 23:48:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512283820855296[0;39m <==    Updates: 0
2022-04-18 23:48:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512283820855296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:48:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512284076707840[0;39m start updating Ebook doc
2022-04-18 23:48:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512284076707840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:48:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512284076707840[0;39m ==> Parameters: 
2022-04-18 23:48:35.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512284076707840[0;39m <==    Updates: 1
2022-04-18 23:48:35.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512284076707840[0;39m update ends, take 35 millisecs
2022-04-18 23:48:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512304804958208[0;39m 生成今日电子书快照开始
2022-04-18 23:48:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512304804958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512304804958208[0;39m ==> Parameters: 
2022-04-18 23:48:40.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512304804958208[0;39m <==    Updates: 0
2022-04-18 23:48:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512304804958208[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:48:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512325751312384[0;39m 生成今日电子书快照开始
2022-04-18 23:48:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512325751312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512325751312384[0;39m ==> Parameters: 
2022-04-18 23:48:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512325751312384[0;39m <==    Updates: 0
2022-04-18 23:48:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512325751312384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:48:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512346743803904[0;39m 生成今日电子书快照开始
2022-04-18 23:48:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512346743803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512346743803904[0;39m ==> Parameters: 
2022-04-18 23:48:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512346743803904[0;39m <==    Updates: 0
2022-04-18 23:48:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512346743803904[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:48:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512367719518208[0;39m 生成今日电子书快照开始
2022-04-18 23:48:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512367719518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:48:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512367719518208[0;39m ==> Parameters: 
2022-04-18 23:48:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512367719518208[0;39m <==    Updates: 0
2022-04-18 23:48:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512367719518208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:49:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512388674260992[0;39m 生成今日电子书快照开始
2022-04-18 23:49:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512388674260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512388674260992[0;39m ==> Parameters: 
2022-04-18 23:49:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512388674260992[0;39m <==    Updates: 0
2022-04-18 23:49:00.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512388674260992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:49:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512409658363904[0;39m 生成今日电子书快照开始
2022-04-18 23:49:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512409658363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512409658363904[0;39m ==> Parameters: 
2022-04-18 23:49:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512409658363904[0;39m <==    Updates: 0
2022-04-18 23:49:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512409658363904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:49:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512409914216448[0;39m start updating Ebook doc
2022-04-18 23:49:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512409914216448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:49:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512409914216448[0;39m ==> Parameters: 
2022-04-18 23:49:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512409914216448[0;39m <==    Updates: 1
2022-04-18 23:49:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512409914216448[0;39m update ends, take 35 millisecs
2022-04-18 23:49:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512430621495296[0;39m 生成今日电子书快照开始
2022-04-18 23:49:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512430621495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512430621495296[0;39m ==> Parameters: 
2022-04-18 23:49:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512430621495296[0;39m <==    Updates: 0
2022-04-18 23:49:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512430621495296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:49:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512451576238080[0;39m 生成今日电子书快照开始
2022-04-18 23:49:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512451576238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512451576238080[0;39m ==> Parameters: 
2022-04-18 23:49:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512451576238080[0;39m <==    Updates: 0
2022-04-18 23:49:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512451576238080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:49:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512472577118208[0;39m 生成今日电子书快照开始
2022-04-18 23:49:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512472577118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512472577118208[0;39m ==> Parameters: 
2022-04-18 23:49:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512472577118208[0;39m <==    Updates: 0
2022-04-18 23:49:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512472577118208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:49:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512493548638208[0;39m 生成今日电子书快照开始
2022-04-18 23:49:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512493548638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512493548638208[0;39m ==> Parameters: 
2022-04-18 23:49:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512493548638208[0;39m <==    Updates: 0
2022-04-18 23:49:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512493548638208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:49:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512514520158208[0;39m 生成今日电子书快照开始
2022-04-18 23:49:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512514520158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512514520158208[0;39m ==> Parameters: 
2022-04-18 23:49:30.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512514520158208[0;39m <==    Updates: 0
2022-04-18 23:49:30.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512514520158208[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:49:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512535491678208[0;39m 生成今日电子书快照开始
2022-04-18 23:49:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512535491678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512535491678208[0;39m ==> Parameters: 
2022-04-18 23:49:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512535491678208[0;39m <==    Updates: 0
2022-04-18 23:49:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512535491678208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:49:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512535743336448[0;39m start updating Ebook doc
2022-04-18 23:49:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512535743336448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:49:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512535743336448[0;39m ==> Parameters: 
2022-04-18 23:49:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512535743336448[0;39m <==    Updates: 1
2022-04-18 23:49:35.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512535743336448[0;39m update ends, take 37 millisecs
2022-04-18 23:49:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512556442226688[0;39m 生成今日电子书快照开始
2022-04-18 23:49:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512556442226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512556442226688[0;39m ==> Parameters: 
2022-04-18 23:49:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512556442226688[0;39m <==    Updates: 0
2022-04-18 23:49:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512556442226688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:49:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512577405358080[0;39m 生成今日电子书快照开始
2022-04-18 23:49:45.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512577405358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:45.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512577405358080[0;39m ==> Parameters: 
2022-04-18 23:49:45.263 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512577405358080[0;39m <==    Updates: 0
2022-04-18 23:49:45.263 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512577405358080[0;39m 生成今日电子书快照结束，耗时：260毫秒
2022-04-18 23:49:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512598402043904[0;39m 生成今日电子书快照开始
2022-04-18 23:49:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512598402043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512598402043904[0;39m ==> Parameters: 
2022-04-18 23:49:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512598402043904[0;39m <==    Updates: 0
2022-04-18 23:49:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512598402043904[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:49:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512619377758208[0;39m 生成今日电子书快照开始
2022-04-18 23:49:55.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512619377758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:49:55.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512619377758208[0;39m ==> Parameters: 
2022-04-18 23:49:55.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512619377758208[0;39m <==    Updates: 0
2022-04-18 23:49:55.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512619377758208[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 23:50:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512640328306688[0;39m 生成今日电子书快照开始
2022-04-18 23:50:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512640328306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512640328306688[0;39m ==> Parameters: 
2022-04-18 23:50:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512640328306688[0;39m <==    Updates: 0
2022-04-18 23:50:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512640328306688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-18 23:50:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512661320798208[0;39m start updating Ebook doc
2022-04-18 23:50:05.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512661320798208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:50:05.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512661320798208[0;39m ==> Parameters: 
2022-04-18 23:50:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512661320798208[0;39m <==    Updates: 1
2022-04-18 23:50:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512661320798208[0;39m update ends, take 60 millisecs
2022-04-18 23:50:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512661572456448[0;39m 生成今日电子书快照开始
2022-04-18 23:50:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512661572456448[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512661572456448[0;39m ==> Parameters: 
2022-04-18 23:50:05.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512661572456448[0;39m <==    Updates: 0
2022-04-18 23:50:05.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512661572456448[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:50:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512682292318208[0;39m 生成今日电子书快照开始
2022-04-18 23:50:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512682292318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:10.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512682292318208[0;39m ==> Parameters: 
2022-04-18 23:50:10.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512682292318208[0;39m <==    Updates: 0
2022-04-18 23:50:10.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512682292318208[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-18 23:50:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512703247060992[0;39m 生成今日电子书快照开始
2022-04-18 23:50:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512703247060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512703247060992[0;39m ==> Parameters: 
2022-04-18 23:50:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512703247060992[0;39m <==    Updates: 0
2022-04-18 23:50:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512703247060992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:50:20.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512724239552512[0;39m 生成今日电子书快照开始
2022-04-18 23:50:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512724239552512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:20.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512724239552512[0;39m ==> Parameters: 
2022-04-18 23:50:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512724239552512[0;39m <==    Updates: 0
2022-04-18 23:50:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512724239552512[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:50:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512745198489600[0;39m 生成今日电子书快照开始
2022-04-18 23:50:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512745198489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512745198489600[0;39m ==> Parameters: 
2022-04-18 23:50:25.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512745198489600[0;39m <==    Updates: 0
2022-04-18 23:50:25.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512745198489600[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 23:50:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512766153232384[0;39m 生成今日电子书快照开始
2022-04-18 23:50:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512766153232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512766153232384[0;39m ==> Parameters: 
2022-04-18 23:50:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512766153232384[0;39m <==    Updates: 0
2022-04-18 23:50:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512766153232384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:50:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512787137335296[0;39m start updating Ebook doc
2022-04-18 23:50:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512787137335296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:50:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512787137335296[0;39m ==> Parameters: 
2022-04-18 23:50:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512787137335296[0;39m <==    Updates: 1
2022-04-18 23:50:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512787137335296[0;39m update ends, take 51 millisecs
2022-04-18 23:50:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512787351244800[0;39m 生成今日电子书快照开始
2022-04-18 23:50:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512787351244800[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512787351244800[0;39m ==> Parameters: 
2022-04-18 23:50:35.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512787351244800[0;39m <==    Updates: 0
2022-04-18 23:50:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512787351244800[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:50:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512808096272384[0;39m 生成今日电子书快照开始
2022-04-18 23:50:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512808096272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512808096272384[0;39m ==> Parameters: 
2022-04-18 23:50:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512808096272384[0;39m <==    Updates: 0
2022-04-18 23:50:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512808096272384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:50:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512829088763904[0;39m 生成今日电子书快照开始
2022-04-18 23:50:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512829088763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512829088763904[0;39m ==> Parameters: 
2022-04-18 23:50:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512829088763904[0;39m <==    Updates: 0
2022-04-18 23:50:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512829088763904[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:50:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512850043506688[0;39m 生成今日电子书快照开始
2022-04-18 23:50:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512850043506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512850043506688[0;39m ==> Parameters: 
2022-04-18 23:50:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512850043506688[0;39m <==    Updates: 0
2022-04-18 23:50:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512850043506688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:50:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512871002443776[0;39m 生成今日电子书快照开始
2022-04-18 23:50:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512871002443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:50:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512871002443776[0;39m ==> Parameters: 
2022-04-18 23:50:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512871002443776[0;39m <==    Updates: 0
2022-04-18 23:50:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512871002443776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:51:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512891965575168[0;39m 生成今日电子书快照开始
2022-04-18 23:51:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512891965575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512891965575168[0;39m ==> Parameters: 
2022-04-18 23:51:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512891965575168[0;39m <==    Updates: 0
2022-04-18 23:51:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512891965575168[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:51:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512912962260992[0;39m 生成今日电子书快照开始
2022-04-18 23:51:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512912962260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512912962260992[0;39m ==> Parameters: 
2022-04-18 23:51:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512912962260992[0;39m <==    Updates: 0
2022-04-18 23:51:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512912962260992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:51:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171512913197142016[0;39m start updating Ebook doc
2022-04-18 23:51:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512913197142016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:51:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512913197142016[0;39m ==> Parameters: 
2022-04-18 23:51:05.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171512913197142016[0;39m <==    Updates: 1
2022-04-18 23:51:05.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171512913197142016[0;39m update ends, take 36 millisecs
2022-04-18 23:51:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512933912809472[0;39m 生成今日电子书快照开始
2022-04-18 23:51:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512933912809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512933912809472[0;39m ==> Parameters: 
2022-04-18 23:51:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512933912809472[0;39m <==    Updates: 0
2022-04-18 23:51:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512933912809472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:51:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512954884329472[0;39m 生成今日电子书快照开始
2022-04-18 23:51:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512954884329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512954884329472[0;39m ==> Parameters: 
2022-04-18 23:51:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512954884329472[0;39m <==    Updates: 0
2022-04-18 23:51:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512954884329472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:51:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512975893598208[0;39m 生成今日电子书快照开始
2022-04-18 23:51:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512975893598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512975893598208[0;39m ==> Parameters: 
2022-04-18 23:51:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512975893598208[0;39m <==    Updates: 0
2022-04-18 23:51:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512975893598208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:51:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171512996844146688[0;39m 生成今日电子书快照开始
2022-04-18 23:51:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512996844146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512996844146688[0;39m ==> Parameters: 
2022-04-18 23:51:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171512996844146688[0;39m <==    Updates: 0
2022-04-18 23:51:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171512996844146688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:51:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513017798889472[0;39m 生成今日电子书快照开始
2022-04-18 23:51:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513017798889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513017798889472[0;39m ==> Parameters: 
2022-04-18 23:51:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513017798889472[0;39m <==    Updates: 0
2022-04-18 23:51:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513017798889472[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-18 23:51:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513038787186688[0;39m start updating Ebook doc
2022-04-18 23:51:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513038787186688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:51:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513038787186688[0;39m ==> Parameters: 
2022-04-18 23:51:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513038787186688[0;39m <==    Updates: 1
2022-04-18 23:51:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513038787186688[0;39m update ends, take 62 millisecs
2022-04-18 23:51:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513039051427840[0;39m 生成今日电子书快照开始
2022-04-18 23:51:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513039051427840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513039051427840[0;39m ==> Parameters: 
2022-04-18 23:51:35.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513039051427840[0;39m <==    Updates: 0
2022-04-18 23:51:35.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513039051427840[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:51:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513059762900992[0;39m 生成今日电子书快照开始
2022-04-18 23:51:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513059762900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513059762900992[0;39m ==> Parameters: 
2022-04-18 23:51:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513059762900992[0;39m <==    Updates: 0
2022-04-18 23:51:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513059762900992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:51:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513080751198208[0;39m 生成今日电子书快照开始
2022-04-18 23:51:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513080751198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513080751198208[0;39m ==> Parameters: 
2022-04-18 23:51:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513080751198208[0;39m <==    Updates: 0
2022-04-18 23:51:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513080751198208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:51:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513101722718208[0;39m 生成今日电子书快照开始
2022-04-18 23:51:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513101722718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513101722718208[0;39m ==> Parameters: 
2022-04-18 23:51:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513101722718208[0;39m <==    Updates: 0
2022-04-18 23:51:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513101722718208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:51:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513122656489472[0;39m 生成今日电子书快照开始
2022-04-18 23:51:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513122656489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:51:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513122656489472[0;39m ==> Parameters: 
2022-04-18 23:51:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513122656489472[0;39m <==    Updates: 0
2022-04-18 23:51:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513122656489472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:52:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513143644786688[0;39m 生成今日电子书快照开始
2022-04-18 23:52:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513143644786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513143644786688[0;39m ==> Parameters: 
2022-04-18 23:52:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513143644786688[0;39m <==    Updates: 0
2022-04-18 23:52:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513143644786688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:52:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513164603723776[0;39m 生成今日电子书快照开始
2022-04-18 23:52:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513164603723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513164603723776[0;39m ==> Parameters: 
2022-04-18 23:52:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513164603723776[0;39m <==    Updates: 0
2022-04-18 23:52:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513164603723776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:52:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513164855382016[0;39m start updating Ebook doc
2022-04-18 23:52:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513164855382016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:52:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513164855382016[0;39m ==> Parameters: 
2022-04-18 23:52:05.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513164855382016[0;39m <==    Updates: 1
2022-04-18 23:52:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513164855382016[0;39m update ends, take 40 millisecs
2022-04-18 23:52:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513185608798208[0;39m 生成今日电子书快照开始
2022-04-18 23:52:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513185608798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513185608798208[0;39m ==> Parameters: 
2022-04-18 23:52:10.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513185608798208[0;39m <==    Updates: 0
2022-04-18 23:52:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513185608798208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:52:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513206567735296[0;39m 生成今日电子书快照开始
2022-04-18 23:52:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513206567735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513206567735296[0;39m ==> Parameters: 
2022-04-18 23:52:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513206567735296[0;39m <==    Updates: 0
2022-04-18 23:52:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513206567735296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:52:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513227518283776[0;39m 生成今日电子书快照开始
2022-04-18 23:52:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513227518283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513227518283776[0;39m ==> Parameters: 
2022-04-18 23:52:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513227518283776[0;39m <==    Updates: 0
2022-04-18 23:52:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513227518283776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:52:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513248506580992[0;39m 生成今日电子书快照开始
2022-04-18 23:52:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513248506580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513248506580992[0;39m ==> Parameters: 
2022-04-18 23:52:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513248506580992[0;39m <==    Updates: 0
2022-04-18 23:52:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513248506580992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:52:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513269478100992[0;39m 生成今日电子书快照开始
2022-04-18 23:52:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513269478100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513269478100992[0;39m ==> Parameters: 
2022-04-18 23:52:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513269478100992[0;39m <==    Updates: 0
2022-04-18 23:52:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513269478100992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:52:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513290466398208[0;39m start updating Ebook doc
2022-04-18 23:52:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513290466398208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:52:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513290466398208[0;39m ==> Parameters: 
2022-04-18 23:52:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513290466398208[0;39m <==    Updates: 1
2022-04-18 23:52:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513290466398208[0;39m update ends, take 58 millisecs
2022-04-18 23:52:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513290709667840[0;39m 生成今日电子书快照开始
2022-04-18 23:52:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513290709667840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513290709667840[0;39m ==> Parameters: 
2022-04-18 23:52:35.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513290709667840[0;39m <==    Updates: 0
2022-04-18 23:52:35.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513290709667840[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 23:52:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513311412752384[0;39m 生成今日电子书快照开始
2022-04-18 23:52:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513311412752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513311412752384[0;39m ==> Parameters: 
2022-04-18 23:52:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513311412752384[0;39m <==    Updates: 0
2022-04-18 23:52:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513311412752384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:52:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513332392660992[0;39m 生成今日电子书快照开始
2022-04-18 23:52:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513332392660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513332392660992[0;39m ==> Parameters: 
2022-04-18 23:52:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513332392660992[0;39m <==    Updates: 0
2022-04-18 23:52:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513332392660992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:52:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513353372569600[0;39m 生成今日电子书快照开始
2022-04-18 23:52:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513353372569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513353372569600[0;39m ==> Parameters: 
2022-04-18 23:52:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513353372569600[0;39m <==    Updates: 0
2022-04-18 23:52:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513353372569600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:52:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513374327312384[0;39m 生成今日电子书快照开始
2022-04-18 23:52:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513374327312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:52:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513374327312384[0;39m ==> Parameters: 
2022-04-18 23:52:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513374327312384[0;39m <==    Updates: 0
2022-04-18 23:52:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513374327312384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:53:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513395298832384[0;39m 生成今日电子书快照开始
2022-04-18 23:53:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513395298832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513395298832384[0;39m ==> Parameters: 
2022-04-18 23:53:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513395298832384[0;39m <==    Updates: 0
2022-04-18 23:53:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513395298832384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:53:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513416278740992[0;39m 生成今日电子书快照开始
2022-04-18 23:53:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513416278740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513416278740992[0;39m ==> Parameters: 
2022-04-18 23:53:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513416278740992[0;39m <==    Updates: 0
2022-04-18 23:53:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513416278740992[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:53:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513416572342272[0;39m start updating Ebook doc
2022-04-18 23:53:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513416572342272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:53:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513416572342272[0;39m ==> Parameters: 
2022-04-18 23:53:05.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513416572342272[0;39m <==    Updates: 1
2022-04-18 23:53:05.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513416572342272[0;39m update ends, take 40 millisecs
2022-04-18 23:53:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513437258649600[0;39m 生成今日电子书快照开始
2022-04-18 23:53:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513437258649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513437258649600[0;39m ==> Parameters: 
2022-04-18 23:53:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513437258649600[0;39m <==    Updates: 0
2022-04-18 23:53:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513437258649600[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:53:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513458200809472[0;39m 生成今日电子书快照开始
2022-04-18 23:53:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513458200809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513458200809472[0;39m ==> Parameters: 
2022-04-18 23:53:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513458200809472[0;39m <==    Updates: 0
2022-04-18 23:53:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513458200809472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:53:20.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513479214272512[0;39m 生成今日电子书快照开始
2022-04-18 23:53:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513479214272512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513479214272512[0;39m ==> Parameters: 
2022-04-18 23:53:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513479214272512[0;39m <==    Updates: 0
2022-04-18 23:53:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513479214272512[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:53:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513500152238080[0;39m 生成今日电子书快照开始
2022-04-18 23:53:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513500152238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513500152238080[0;39m ==> Parameters: 
2022-04-18 23:53:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513500152238080[0;39m <==    Updates: 0
2022-04-18 23:53:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513500152238080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:53:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513521140535296[0;39m 生成今日电子书快照开始
2022-04-18 23:53:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513521140535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513521140535296[0;39m ==> Parameters: 
2022-04-18 23:53:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513521140535296[0;39m <==    Updates: 0
2022-04-18 23:53:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513521140535296[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-18 23:53:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513542124638208[0;39m start updating Ebook doc
2022-04-18 23:53:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513542124638208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:53:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513542124638208[0;39m ==> Parameters: 
2022-04-18 23:53:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513542124638208[0;39m <==    Updates: 1
2022-04-18 23:53:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513542124638208[0;39m update ends, take 61 millisecs
2022-04-18 23:53:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513542380490752[0;39m 生成今日电子书快照开始
2022-04-18 23:53:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513542380490752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513542380490752[0;39m ==> Parameters: 
2022-04-18 23:53:35.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513542380490752[0;39m <==    Updates: 0
2022-04-18 23:53:35.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513542380490752[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-18 23:53:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513563083575296[0;39m 生成今日电子书快照开始
2022-04-18 23:53:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513563083575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513563083575296[0;39m ==> Parameters: 
2022-04-18 23:53:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513563083575296[0;39m <==    Updates: 0
2022-04-18 23:53:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513563083575296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:53:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513584067678208[0;39m 生成今日电子书快照开始
2022-04-18 23:53:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513584067678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513584067678208[0;39m ==> Parameters: 
2022-04-18 23:53:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513584067678208[0;39m <==    Updates: 0
2022-04-18 23:53:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513584067678208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:53:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513605039198208[0;39m 生成今日电子书快照开始
2022-04-18 23:53:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513605039198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513605039198208[0;39m ==> Parameters: 
2022-04-18 23:53:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513605039198208[0;39m <==    Updates: 0
2022-04-18 23:53:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513605039198208[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:53:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513626006523904[0;39m 生成今日电子书快照开始
2022-04-18 23:53:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513626006523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:53:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513626006523904[0;39m ==> Parameters: 
2022-04-18 23:53:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513626006523904[0;39m <==    Updates: 0
2022-04-18 23:53:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513626006523904[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-18 23:54:00.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513646986432512[0;39m 生成今日电子书快照开始
2022-04-18 23:54:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513646986432512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513646986432512[0;39m ==> Parameters: 
2022-04-18 23:54:00.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513646986432512[0;39m <==    Updates: 0
2022-04-18 23:54:00.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513646986432512[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:54:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513667920203776[0;39m start updating Ebook doc
2022-04-18 23:54:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513667920203776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:54:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513667920203776[0;39m ==> Parameters: 
2022-04-18 23:54:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513667920203776[0;39m <==    Updates: 1
2022-04-18 23:54:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513667920203776[0;39m update ends, take 65 millisecs
2022-04-18 23:54:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513668192833536[0;39m 生成今日电子书快照开始
2022-04-18 23:54:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513668192833536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513668192833536[0;39m ==> Parameters: 
2022-04-18 23:54:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513668192833536[0;39m <==    Updates: 0
2022-04-18 23:54:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513668192833536[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-18 23:54:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513688895918080[0;39m 生成今日电子书快照开始
2022-04-18 23:54:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513688895918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513688895918080[0;39m ==> Parameters: 
2022-04-18 23:54:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513688895918080[0;39m <==    Updates: 0
2022-04-18 23:54:10.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513688895918080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:54:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513709896798208[0;39m 生成今日电子书快照开始
2022-04-18 23:54:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513709896798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513709896798208[0;39m ==> Parameters: 
2022-04-18 23:54:15.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513709896798208[0;39m <==    Updates: 0
2022-04-18 23:54:15.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513709896798208[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-18 23:54:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513730864123904[0;39m 生成今日电子书快照开始
2022-04-18 23:54:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513730864123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513730864123904[0;39m ==> Parameters: 
2022-04-18 23:54:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513730864123904[0;39m <==    Updates: 0
2022-04-18 23:54:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513730864123904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:54:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513751823060992[0;39m 生成今日电子书快照开始
2022-04-18 23:54:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513751823060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513751823060992[0;39m ==> Parameters: 
2022-04-18 23:54:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513751823060992[0;39m <==    Updates: 0
2022-04-18 23:54:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513751823060992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:54:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513772811358208[0;39m 生成今日电子书快照开始
2022-04-18 23:54:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513772811358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513772811358208[0;39m ==> Parameters: 
2022-04-18 23:54:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513772811358208[0;39m <==    Updates: 0
2022-04-18 23:54:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513772811358208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:54:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513793753518080[0;39m 生成今日电子书快照开始
2022-04-18 23:54:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513793753518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513793753518080[0;39m ==> Parameters: 
2022-04-18 23:54:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513793753518080[0;39m <==    Updates: 0
2022-04-18 23:54:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513793753518080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:54:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513794034536448[0;39m start updating Ebook doc
2022-04-18 23:54:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513794034536448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:54:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513794034536448[0;39m ==> Parameters: 
2022-04-18 23:54:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513794034536448[0;39m <==    Updates: 1
2022-04-18 23:54:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513794034536448[0;39m update ends, take 38 millisecs
2022-04-18 23:54:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513814754398208[0;39m 生成今日电子书快照开始
2022-04-18 23:54:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513814754398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513814754398208[0;39m ==> Parameters: 
2022-04-18 23:54:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513814754398208[0;39m <==    Updates: 0
2022-04-18 23:54:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513814754398208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:54:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513835696558080[0;39m 生成今日电子书快照开始
2022-04-18 23:54:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513835696558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513835696558080[0;39m ==> Parameters: 
2022-04-18 23:54:45.189 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513835696558080[0;39m <==    Updates: 0
2022-04-18 23:54:45.189 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513835696558080[0;39m 生成今日电子书快照结束，耗时：186毫秒
2022-04-18 23:54:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513856689049600[0;39m 生成今日电子书快照开始
2022-04-18 23:54:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513856689049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513856689049600[0;39m ==> Parameters: 
2022-04-18 23:54:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513856689049600[0;39m <==    Updates: 0
2022-04-18 23:54:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513856689049600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:54:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513877631209472[0;39m 生成今日电子书快照开始
2022-04-18 23:54:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513877631209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:54:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513877631209472[0;39m ==> Parameters: 
2022-04-18 23:54:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513877631209472[0;39m <==    Updates: 0
2022-04-18 23:54:55.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513877631209472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:55:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513898598535168[0;39m 生成今日电子书快照开始
2022-04-18 23:55:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513898598535168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513898598535168[0;39m ==> Parameters: 
2022-04-18 23:55:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513898598535168[0;39m <==    Updates: 0
2022-04-18 23:55:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513898598535168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:55:05.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171513919607803904[0;39m start updating Ebook doc
2022-04-18 23:55:05.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513919607803904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:55:05.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513919607803904[0;39m ==> Parameters: 
2022-04-18 23:55:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171513919607803904[0;39m <==    Updates: 1
2022-04-18 23:55:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171513919607803904[0;39m update ends, take 66 millisecs
2022-04-18 23:55:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513919888822272[0;39m 生成今日电子书快照开始
2022-04-18 23:55:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513919888822272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513919888822272[0;39m ==> Parameters: 
2022-04-18 23:55:05.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513919888822272[0;39m <==    Updates: 0
2022-04-18 23:55:05.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513919888822272[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:55:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513940579323904[0;39m 生成今日电子书快照开始
2022-04-18 23:55:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513940579323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513940579323904[0;39m ==> Parameters: 
2022-04-18 23:55:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513940579323904[0;39m <==    Updates: 0
2022-04-18 23:55:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513940579323904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:55:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513961525678080[0;39m 生成今日电子书快照开始
2022-04-18 23:55:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513961525678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513961525678080[0;39m ==> Parameters: 
2022-04-18 23:55:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513961525678080[0;39m <==    Updates: 0
2022-04-18 23:55:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513961525678080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:55:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171513982509780992[0;39m 生成今日电子书快照开始
2022-04-18 23:55:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513982509780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513982509780992[0;39m ==> Parameters: 
2022-04-18 23:55:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171513982509780992[0;39m <==    Updates: 0
2022-04-18 23:55:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171513982509780992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:55:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514003460329472[0;39m 生成今日电子书快照开始
2022-04-18 23:55:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514003460329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514003460329472[0;39m ==> Parameters: 
2022-04-18 23:55:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514003460329472[0;39m <==    Updates: 0
2022-04-18 23:55:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514003460329472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:55:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514024461209600[0;39m 生成今日电子书快照开始
2022-04-18 23:55:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514024461209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514024461209600[0;39m ==> Parameters: 
2022-04-18 23:55:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514024461209600[0;39m <==    Updates: 0
2022-04-18 23:55:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514024461209600[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-18 23:55:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514045436923904[0;39m 生成今日电子书快照开始
2022-04-18 23:55:35.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514045436923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:35.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514045436923904[0;39m ==> Parameters: 
2022-04-18 23:55:35.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514045436923904[0;39m <==    Updates: 0
2022-04-18 23:55:35.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514045436923904[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-18 23:55:35.088 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514045768273920[0;39m start updating Ebook doc
2022-04-18 23:55:35.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514045768273920[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:55:35.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514045768273920[0;39m ==> Parameters: 
2022-04-18 23:55:35.123 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514045768273920[0;39m <==    Updates: 1
2022-04-18 23:55:35.124 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514045768273920[0;39m update ends, take 36 millisecs
2022-04-18 23:55:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514066408443904[0;39m 生成今日电子书快照开始
2022-04-18 23:55:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514066408443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514066408443904[0;39m ==> Parameters: 
2022-04-18 23:55:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514066408443904[0;39m <==    Updates: 0
2022-04-18 23:55:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514066408443904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:55:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514087379963904[0;39m 生成今日电子书快照开始
2022-04-18 23:55:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514087379963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514087379963904[0;39m ==> Parameters: 
2022-04-18 23:55:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514087379963904[0;39m <==    Updates: 0
2022-04-18 23:55:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514087379963904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:55:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514108343095296[0;39m 生成今日电子书快照开始
2022-04-18 23:55:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514108343095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514108343095296[0;39m ==> Parameters: 
2022-04-18 23:55:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514108343095296[0;39m <==    Updates: 0
2022-04-18 23:55:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514108343095296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:55:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514129289449472[0;39m 生成今日电子书快照开始
2022-04-18 23:55:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514129289449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:55:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514129289449472[0;39m ==> Parameters: 
2022-04-18 23:55:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514129289449472[0;39m <==    Updates: 0
2022-04-18 23:55:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514129289449472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:56:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514150281940992[0;39m 生成今日电子书快照开始
2022-04-18 23:56:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514150281940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514150281940992[0;39m ==> Parameters: 
2022-04-18 23:56:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514150281940992[0;39m <==    Updates: 0
2022-04-18 23:56:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514150281940992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:56:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514171253460992[0;39m start updating Ebook doc
2022-04-18 23:56:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514171253460992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:56:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514171253460992[0;39m ==> Parameters: 
2022-04-18 23:56:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514171253460992[0;39m <==    Updates: 1
2022-04-18 23:56:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514171253460992[0;39m update ends, take 58 millisecs
2022-04-18 23:56:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514171496730624[0;39m 生成今日电子书快照开始
2022-04-18 23:56:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514171496730624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514171496730624[0;39m ==> Parameters: 
2022-04-18 23:56:05.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514171496730624[0;39m <==    Updates: 0
2022-04-18 23:56:05.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514171496730624[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-18 23:56:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514192208203776[0;39m 生成今日电子书快照开始
2022-04-18 23:56:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514192208203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514192208203776[0;39m ==> Parameters: 
2022-04-18 23:56:10.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514192208203776[0;39m <==    Updates: 0
2022-04-18 23:56:10.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514192208203776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-18 23:56:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514213196500992[0;39m 生成今日电子书快照开始
2022-04-18 23:56:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514213196500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514213196500992[0;39m ==> Parameters: 
2022-04-18 23:56:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514213196500992[0;39m <==    Updates: 0
2022-04-18 23:56:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514213196500992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:56:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514234159632384[0;39m 生成今日电子书快照开始
2022-04-18 23:56:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514234159632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514234159632384[0;39m ==> Parameters: 
2022-04-18 23:56:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514234159632384[0;39m <==    Updates: 0
2022-04-18 23:56:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514234159632384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:56:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514255143735296[0;39m 生成今日电子书快照开始
2022-04-18 23:56:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514255143735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514255143735296[0;39m ==> Parameters: 
2022-04-18 23:56:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514255143735296[0;39m <==    Updates: 0
2022-04-18 23:56:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514255143735296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:56:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514276111060992[0;39m 生成今日电子书快照开始
2022-04-18 23:56:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514276111060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514276111060992[0;39m ==> Parameters: 
2022-04-18 23:56:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514276111060992[0;39m <==    Updates: 0
2022-04-18 23:56:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514276111060992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:56:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514297082580992[0;39m 生成今日电子书快照开始
2022-04-18 23:56:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514297082580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514297082580992[0;39m ==> Parameters: 
2022-04-18 23:56:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514297082580992[0;39m <==    Updates: 0
2022-04-18 23:56:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514297082580992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:56:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514297342627840[0;39m start updating Ebook doc
2022-04-18 23:56:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514297342627840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:56:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514297342627840[0;39m ==> Parameters: 
2022-04-18 23:56:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514297342627840[0;39m <==    Updates: 1
2022-04-18 23:56:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514297342627840[0;39m update ends, take 40 millisecs
2022-04-18 23:56:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514318037323776[0;39m 生成今日电子书快照开始
2022-04-18 23:56:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514318037323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514318037323776[0;39m ==> Parameters: 
2022-04-18 23:56:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514318037323776[0;39m <==    Updates: 0
2022-04-18 23:56:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514318037323776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:56:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514339034009600[0;39m 生成今日电子书快照开始
2022-04-18 23:56:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514339034009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514339034009600[0;39m ==> Parameters: 
2022-04-18 23:56:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514339034009600[0;39m <==    Updates: 0
2022-04-18 23:56:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514339034009600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:56:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514360005529600[0;39m 生成今日电子书快照开始
2022-04-18 23:56:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514360005529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514360005529600[0;39m ==> Parameters: 
2022-04-18 23:56:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514360005529600[0;39m <==    Updates: 0
2022-04-18 23:56:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514360005529600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-18 23:56:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514380972855296[0;39m 生成今日电子书快照开始
2022-04-18 23:56:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514380972855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:56:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514380972855296[0;39m ==> Parameters: 
2022-04-18 23:56:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514380972855296[0;39m <==    Updates: 0
2022-04-18 23:56:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514380972855296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:57:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514401944375296[0;39m 生成今日电子书快照开始
2022-04-18 23:57:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514401944375296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514401944375296[0;39m ==> Parameters: 
2022-04-18 23:57:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514401944375296[0;39m <==    Updates: 0
2022-04-18 23:57:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514401944375296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-18 23:57:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514422894923776[0;39m 生成今日电子书快照开始
2022-04-18 23:57:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514422894923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514422894923776[0;39m ==> Parameters: 
2022-04-18 23:57:05.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514422894923776[0;39m <==    Updates: 0
2022-04-18 23:57:05.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514422894923776[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-18 23:57:05.082 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514423230468096[0;39m start updating Ebook doc
2022-04-18 23:57:05.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514423230468096[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:57:05.083 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514423230468096[0;39m ==> Parameters: 
2022-04-18 23:57:05.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514423230468096[0;39m <==    Updates: 1
2022-04-18 23:57:05.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514423230468096[0;39m update ends, take 35 millisecs
2022-04-18 23:57:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514443895803904[0;39m 生成今日电子书快照开始
2022-04-18 23:57:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514443895803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514443895803904[0;39m ==> Parameters: 
2022-04-18 23:57:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514443895803904[0;39m <==    Updates: 0
2022-04-18 23:57:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514443895803904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:57:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514464833769472[0;39m 生成今日电子书快照开始
2022-04-18 23:57:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514464833769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514464833769472[0;39m ==> Parameters: 
2022-04-18 23:57:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514464833769472[0;39m <==    Updates: 0
2022-04-18 23:57:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514464833769472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:57:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514485813678080[0;39m 生成今日电子书快照开始
2022-04-18 23:57:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514485813678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514485813678080[0;39m ==> Parameters: 
2022-04-18 23:57:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514485813678080[0;39m <==    Updates: 0
2022-04-18 23:57:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514485813678080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:57:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514506801975296[0;39m 生成今日电子书快照开始
2022-04-18 23:57:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514506801975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514506801975296[0;39m ==> Parameters: 
2022-04-18 23:57:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514506801975296[0;39m <==    Updates: 0
2022-04-18 23:57:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514506801975296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:57:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514527773495296[0;39m 生成今日电子书快照开始
2022-04-18 23:57:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514527773495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514527773495296[0;39m ==> Parameters: 
2022-04-18 23:57:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514527773495296[0;39m <==    Updates: 0
2022-04-18 23:57:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514527773495296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-18 23:57:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514548719849472[0;39m 生成今日电子书快照开始
2022-04-18 23:57:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514548719849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514548719849472[0;39m ==> Parameters: 
2022-04-18 23:57:35.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514548719849472[0;39m <==    Updates: 0
2022-04-18 23:57:35.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514548719849472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-18 23:57:35.053 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514548937953280[0;39m start updating Ebook doc
2022-04-18 23:57:35.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514548937953280[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:57:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514548937953280[0;39m ==> Parameters: 
2022-04-18 23:57:35.092 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514548937953280[0;39m <==    Updates: 1
2022-04-18 23:57:35.092 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514548937953280[0;39m update ends, take 39 millisecs
2022-04-18 23:57:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514569716535296[0;39m 生成今日电子书快照开始
2022-04-18 23:57:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514569716535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514569716535296[0;39m ==> Parameters: 
2022-04-18 23:57:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514569716535296[0;39m <==    Updates: 0
2022-04-18 23:57:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514569716535296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-18 23:57:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514590692249600[0;39m 生成今日电子书快照开始
2022-04-18 23:57:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514590692249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514590692249600[0;39m ==> Parameters: 
2022-04-18 23:57:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514590692249600[0;39m <==    Updates: 0
2022-04-18 23:57:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514590692249600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-18 23:57:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514611659575296[0;39m 生成今日电子书快照开始
2022-04-18 23:57:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514611659575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514611659575296[0;39m ==> Parameters: 
2022-04-18 23:57:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514611659575296[0;39m <==    Updates: 0
2022-04-18 23:57:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514611659575296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:57:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514632643678208[0;39m 生成今日电子书快照开始
2022-04-18 23:57:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514632643678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:57:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514632643678208[0;39m ==> Parameters: 
2022-04-18 23:57:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514632643678208[0;39m <==    Updates: 0
2022-04-18 23:57:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514632643678208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:58:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514653606809600[0;39m 生成今日电子书快照开始
2022-04-18 23:58:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514653606809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514653606809600[0;39m ==> Parameters: 
2022-04-18 23:58:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514653606809600[0;39m <==    Updates: 0
2022-04-18 23:58:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514653606809600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:58:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514674565746688[0;39m 生成今日电子书快照开始
2022-04-18 23:58:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514674565746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514674565746688[0;39m ==> Parameters: 
2022-04-18 23:58:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514674565746688[0;39m <==    Updates: 0
2022-04-18 23:58:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514674565746688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:58:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514674800627712[0;39m start updating Ebook doc
2022-04-18 23:58:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514674800627712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:58:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514674800627712[0;39m ==> Parameters: 
2022-04-18 23:58:05.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514674800627712[0;39m <==    Updates: 1
2022-04-18 23:58:05.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514674800627712[0;39m update ends, take 33 millisecs
2022-04-18 23:58:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514695545655296[0;39m 生成今日电子书快照开始
2022-04-18 23:58:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514695545655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514695545655296[0;39m ==> Parameters: 
2022-04-18 23:58:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514695545655296[0;39m <==    Updates: 0
2022-04-18 23:58:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514695545655296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:58:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514716492009472[0;39m 生成今日电子书快照开始
2022-04-18 23:58:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514716492009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514716492009472[0;39m ==> Parameters: 
2022-04-18 23:58:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514716492009472[0;39m <==    Updates: 0
2022-04-18 23:58:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514716492009472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-18 23:58:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514737492889600[0;39m 生成今日电子书快照开始
2022-04-18 23:58:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514737492889600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514737492889600[0;39m ==> Parameters: 
2022-04-18 23:58:20.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514737492889600[0;39m <==    Updates: 0
2022-04-18 23:58:20.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514737492889600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-18 23:58:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514758451826688[0;39m 生成今日电子书快照开始
2022-04-18 23:58:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514758451826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514758451826688[0;39m ==> Parameters: 
2022-04-18 23:58:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514758451826688[0;39m <==    Updates: 0
2022-04-18 23:58:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514758451826688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:58:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514779406569472[0;39m 生成今日电子书快照开始
2022-04-18 23:58:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514779406569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514779406569472[0;39m ==> Parameters: 
2022-04-18 23:58:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514779406569472[0;39m <==    Updates: 0
2022-04-18 23:58:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514779406569472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-18 23:58:35.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514800415838208[0;39m 生成今日电子书快照开始
2022-04-18 23:58:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514800415838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514800415838208[0;39m ==> Parameters: 
2022-04-18 23:58:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514800415838208[0;39m <==    Updates: 0
2022-04-18 23:58:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514800415838208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:58:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514800659107840[0;39m start updating Ebook doc
2022-04-18 23:58:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514800659107840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:58:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514800659107840[0;39m ==> Parameters: 
2022-04-18 23:58:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514800659107840[0;39m <==    Updates: 1
2022-04-18 23:58:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514800659107840[0;39m update ends, take 38 millisecs
2022-04-18 23:58:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514821383163904[0;39m 生成今日电子书快照开始
2022-04-18 23:58:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514821383163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514821383163904[0;39m ==> Parameters: 
2022-04-18 23:58:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514821383163904[0;39m <==    Updates: 0
2022-04-18 23:58:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514821383163904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:58:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514842337906688[0;39m 生成今日电子书快照开始
2022-04-18 23:58:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514842337906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514842337906688[0;39m ==> Parameters: 
2022-04-18 23:58:45.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514842337906688[0;39m <==    Updates: 0
2022-04-18 23:58:45.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514842337906688[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-18 23:58:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514863309426688[0;39m 生成今日电子书快照开始
2022-04-18 23:58:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514863309426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514863309426688[0;39m ==> Parameters: 
2022-04-18 23:58:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514863309426688[0;39m <==    Updates: 0
2022-04-18 23:58:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514863309426688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:58:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514884297723904[0;39m 生成今日电子书快照开始
2022-04-18 23:58:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514884297723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:58:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514884297723904[0;39m ==> Parameters: 
2022-04-18 23:58:55.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514884297723904[0;39m <==    Updates: 0
2022-04-18 23:58:55.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514884297723904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-18 23:59:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514905265049600[0;39m 生成今日电子书快照开始
2022-04-18 23:59:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514905265049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514905265049600[0;39m ==> Parameters: 
2022-04-18 23:59:00.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514905265049600[0;39m <==    Updates: 0
2022-04-18 23:59:00.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514905265049600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-18 23:59:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171514926228180992[0;39m start updating Ebook doc
2022-04-18 23:59:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514926228180992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:59:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514926228180992[0;39m ==> Parameters: 
2022-04-18 23:59:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171514926228180992[0;39m <==    Updates: 1
2022-04-18 23:59:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171514926228180992[0;39m update ends, take 59 millisecs
2022-04-18 23:59:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514926475644928[0;39m 生成今日电子书快照开始
2022-04-18 23:59:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514926475644928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514926475644928[0;39m ==> Parameters: 
2022-04-18 23:59:05.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514926475644928[0;39m <==    Updates: 0
2022-04-18 23:59:05.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514926475644928[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-18 23:59:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514947199700992[0;39m 生成今日电子书快照开始
2022-04-18 23:59:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514947199700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514947199700992[0;39m ==> Parameters: 
2022-04-18 23:59:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514947199700992[0;39m <==    Updates: 0
2022-04-18 23:59:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514947199700992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-18 23:59:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514968154443776[0;39m 生成今日电子书快照开始
2022-04-18 23:59:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514968154443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514968154443776[0;39m ==> Parameters: 
2022-04-18 23:59:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514968154443776[0;39m <==    Updates: 0
2022-04-18 23:59:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514968154443776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-18 23:59:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171514989151129600[0;39m 生成今日电子书快照开始
2022-04-18 23:59:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514989151129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514989151129600[0;39m ==> Parameters: 
2022-04-18 23:59:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171514989151129600[0;39m <==    Updates: 0
2022-04-18 23:59:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171514989151129600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-18 23:59:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515010126843904[0;39m 生成今日电子书快照开始
2022-04-18 23:59:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515010126843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515010126843904[0;39m ==> Parameters: 
2022-04-18 23:59:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515010126843904[0;39m <==    Updates: 0
2022-04-18 23:59:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515010126843904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-18 23:59:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515031064809472[0;39m 生成今日电子书快照开始
2022-04-18 23:59:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515031064809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515031064809472[0;39m ==> Parameters: 
2022-04-18 23:59:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515031064809472[0;39m <==    Updates: 0
2022-04-18 23:59:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515031064809472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:59:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515052065689600[0;39m 生成今日电子书快照开始
2022-04-18 23:59:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515052065689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515052065689600[0;39m ==> Parameters: 
2022-04-18 23:59:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515052065689600[0;39m <==    Updates: 0
2022-04-18 23:59:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515052065689600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-18 23:59:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m171515052308959232[0;39m start updating Ebook doc
2022-04-18 23:59:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171515052308959232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-18 23:59:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171515052308959232[0;39m ==> Parameters: 
2022-04-18 23:59:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m171515052308959232[0;39m <==    Updates: 1
2022-04-18 23:59:35.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m171515052308959232[0;39m update ends, take 39 millisecs
2022-04-18 23:59:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515073045598208[0;39m 生成今日电子书快照开始
2022-04-18 23:59:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515073045598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515073045598208[0;39m ==> Parameters: 
2022-04-18 23:59:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515073045598208[0;39m <==    Updates: 0
2022-04-18 23:59:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515073045598208[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-18 23:59:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515094017118208[0;39m 生成今日电子书快照开始
2022-04-18 23:59:45.137 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515094017118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:45.138 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515094017118208[0;39m ==> Parameters: 
2022-04-18 23:59:45.305 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515094017118208[0;39m <==    Updates: 0
2022-04-18 23:59:45.305 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515094017118208[0;39m 生成今日电子书快照结束，耗时：295毫秒
2022-04-18 23:59:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515114988638208[0;39m 生成今日电子书快照开始
2022-04-18 23:59:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515114988638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515114988638208[0;39m ==> Parameters: 
2022-04-18 23:59:50.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515114988638208[0;39m <==    Updates: 0
2022-04-18 23:59:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515114988638208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-18 23:59:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m171515135960158208[0;39m 生成今日电子书快照开始
2022-04-18 23:59:55.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515135960158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-18 23:59:55.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515135960158208[0;39m ==> Parameters: 
2022-04-18 23:59:55.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m171515135960158208[0;39m <==    Updates: 0
2022-04-18 23:59:55.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m171515135960158208[0;39m 生成今日电子书快照结束，耗时：68毫秒
