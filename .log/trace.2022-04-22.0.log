2022-04-22 21:44:20.094 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2022-04-22 21:44:20.103 INFO  com.ameliawiki.wiki.config.WikiApplication        :55   [32m                  [0;39m Starting WikiApplication using Java 1.8.0_322 on sunarkedeMacBook-Pro.local with PID 99881 (/Users/sunarke/Downloads/wiki 5/target/classes started by sunarke in /Users/sunarke/Downloads/wiki 5)
2022-04-22 21:44:20.104 INFO  com.ameliawiki.wiki.config.WikiApplication        :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2022-04-22 21:44:20.168 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-04-22 21:44:20.168 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-04-22 21:44:21.111 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2022-04-22 21:44:21.114 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-04-22 21:44:21.139 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2022-04-22 21:44:21.891 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8080 (http)
2022-04-22 21:44:21.901 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8080"]
2022-04-22 21:44:21.902 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2022-04-22 21:44:21.903 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2022-04-22 21:44:21.966 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2022-04-22 21:44:21.966 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1797 ms
2022-04-22 21:44:23.015 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2022-04-22 21:44:23.361 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2022-04-22 21:44:23.417 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2022-04-22 21:44:23.440 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8080"]
2022-04-22 21:44:23.466 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8080 (http) with context path ''
2022-04-22 21:44:23.482 INFO  com.ameliawiki.wiki.config.WikiApplication        :61   [32m                  [0;39m Started WikiApplication in 3.932 seconds (JVM running for 4.58)
2022-04-22 21:44:23.485 INFO  com.ameliawiki.wiki.config.WikiApplication        :26   [32m                  [0;39m launch success!!!!!!!!YEA!!!
2022-04-22 21:44:23.485 INFO  com.ameliawiki.wiki.config.WikiApplication        :27   [32m                  [0;39m address: 	http://127.0.0.1:8080
2022-04-22 21:44:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930587701678080[0;39m 生成今日电子书快照开始
2022-04-22 21:44:25.020 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m172930587701678080[0;39m HikariPool-1 - Starting...
2022-04-22 21:44:26.086 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m172930587701678080[0;39m HikariPool-1 - Start completed.
2022-04-22 21:44:26.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930587701678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:26.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930587701678080[0;39m ==> Parameters: 
2022-04-22 21:44:26.297 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930587701678080[0;39m <==    Updates: 0
2022-04-22 21:44:26.299 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930587701678080[0;39m 生成今日电子书快照结束，耗时：1295毫秒
2022-04-22 21:44:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930608673198080[0;39m 生成今日电子书快照开始
2022-04-22 21:44:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930608673198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930608673198080[0;39m ==> Parameters: 
2022-04-22 21:44:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930608673198080[0;39m <==    Updates: 0
2022-04-22 21:44:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930608673198080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 21:44:31.664 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-04-22 21:44:31.665 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2022-04-22 21:44:31.668 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 3 ms
2022-04-22 21:44:31.692 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:31.693 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:31.693 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:31.694 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:33.939 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:33.939 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:33.939 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:33.940 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:34.430 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:34.431 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:34.431 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:34.431 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:34.611 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:34.611 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:34.611 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:34.612 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:34.792 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:34.792 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:34.793 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:34.793 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:34.969 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:34.969 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:34.969 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:34.970 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930629648912384[0;39m 生成今日电子书快照开始
2022-04-22 21:44:35.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930629648912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:35.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930629648912384[0;39m ==> Parameters: 
2022-04-22 21:44:35.144 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930629648912384[0;39m <==    Updates: 0
2022-04-22 21:44:35.145 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930629648912384[0;39m 生成今日电子书快照结束，耗时：141毫秒
2022-04-22 21:44:35.145 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172930630240309248[0;39m start updating Ebook doc
2022-04-22 21:44:35.149 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930630240309248[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:44:35.150 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930630240309248[0;39m ==> Parameters: 
2022-04-22 21:44:35.180 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930630240309248[0;39m <==    Updates: 1
2022-04-22 21:44:35.180 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172930630240309248[0;39m update ends, take 35 millisecs
2022-04-22 21:44:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930650603655168[0;39m 生成今日电子书快照开始
2022-04-22 21:44:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930650603655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930650603655168[0;39m ==> Parameters: 
2022-04-22 21:44:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930650603655168[0;39m <==    Updates: 0
2022-04-22 21:44:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930650603655168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:44:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930671596146688[0;39m 生成今日电子书快照开始
2022-04-22 21:44:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930671596146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930671596146688[0;39m ==> Parameters: 
2022-04-22 21:44:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930671596146688[0;39m <==    Updates: 0
2022-04-22 21:44:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930671596146688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:44:46.694 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:46.695 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:46.695 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:46.695 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:46.926 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:46.926 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/apple-touch-icon-precomposed.png
2022-04-22 21:44:46.927 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:46.927 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:46.930 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:46.930 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/apple-touch-icon.png
2022-04-22 21:44:46.930 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:46.931 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930692550889472[0;39m 生成今日电子书快照开始
2022-04-22 21:44:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930692550889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930692550889472[0;39m ==> Parameters: 
2022-04-22 21:44:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930692550889472[0;39m <==    Updates: 0
2022-04-22 21:44:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930692550889472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:44:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930713526603776[0;39m 生成今日电子书快照开始
2022-04-22 21:44:55.245 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930713526603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:44:55.245 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930713526603776[0;39m ==> Parameters: 
2022-04-22 21:44:55.278 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930713526603776[0;39m <==    Updates: 0
2022-04-22 21:44:55.278 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930713526603776[0;39m 生成今日电子书快照结束，耗时：275毫秒
2022-04-22 21:44:58.208 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:58.208 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:58.208 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:58.209 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:59.504 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:59.504 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:59.504 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:59.504 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:44:59.776 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:44:59.776 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:44:59.776 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:44:59.776 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:45:00.002 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:45:00.002 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:45:00.003 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:45:00.003 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:45:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930734506512384[0;39m 生成今日电子书快照开始
2022-04-22 21:45:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930734506512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930734506512384[0;39m ==> Parameters: 
2022-04-22 21:45:00.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930734506512384[0;39m <==    Updates: 0
2022-04-22 21:45:00.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930734506512384[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-22 21:45:00.225 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:45:00.225 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:45:00.225 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:45:00.225 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:45:00.462 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:45:00.462 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:45:00.462 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:45:00.462 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:45:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172930755473838080[0;39m start updating Ebook doc
2022-04-22 21:45:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930755473838080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:45:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930755473838080[0;39m ==> Parameters: 
2022-04-22 21:45:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930755473838080[0;39m <==    Updates: 1
2022-04-22 21:45:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172930755473838080[0;39m update ends, take 63 millisecs
2022-04-22 21:45:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930755746467840[0;39m 生成今日电子书快照开始
2022-04-22 21:45:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930755746467840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930755746467840[0;39m ==> Parameters: 
2022-04-22 21:45:05.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930755746467840[0;39m <==    Updates: 0
2022-04-22 21:45:05.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930755746467840[0;39m 生成今日电子书快照结束，耗时：29毫秒
2022-04-22 21:45:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930776436969472[0;39m 生成今日电子书快照开始
2022-04-22 21:45:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930776436969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930776436969472[0;39m ==> Parameters: 
2022-04-22 21:45:10.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930776436969472[0;39m <==    Updates: 0
2022-04-22 21:45:10.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930776436969472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 21:45:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930797425266688[0;39m 生成今日电子书快照开始
2022-04-22 21:45:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930797425266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930797425266688[0;39m ==> Parameters: 
2022-04-22 21:45:15.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930797425266688[0;39m <==    Updates: 0
2022-04-22 21:45:15.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930797425266688[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-22 21:45:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930818396786688[0;39m 生成今日电子书快照开始
2022-04-22 21:45:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930818396786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930818396786688[0;39m ==> Parameters: 
2022-04-22 21:45:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930818396786688[0;39m <==    Updates: 0
2022-04-22 21:45:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930818396786688[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 21:45:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930839364112384[0;39m 生成今日电子书快照开始
2022-04-22 21:45:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930839364112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930839364112384[0;39m ==> Parameters: 
2022-04-22 21:45:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930839364112384[0;39m <==    Updates: 0
2022-04-22 21:45:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930839364112384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 21:45:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930860344020992[0;39m 生成今日电子书快照开始
2022-04-22 21:45:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930860344020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930860344020992[0;39m ==> Parameters: 
2022-04-22 21:45:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930860344020992[0;39m <==    Updates: 0
2022-04-22 21:45:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930860344020992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 21:45:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172930881311346688[0;39m start updating Ebook doc
2022-04-22 21:45:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930881311346688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:45:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930881311346688[0;39m ==> Parameters: 
2022-04-22 21:45:35.053 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172930881311346688[0;39m <==    Updates: 1
2022-04-22 21:45:35.053 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172930881311346688[0;39m update ends, take 48 millisecs
2022-04-22 21:45:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930881516867584[0;39m 生成今日电子书快照开始
2022-04-22 21:45:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930881516867584[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930881516867584[0;39m ==> Parameters: 
2022-04-22 21:45:35.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930881516867584[0;39m <==    Updates: 0
2022-04-22 21:45:35.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930881516867584[0;39m 生成今日电子书快照结束，耗时：31毫秒
2022-04-22 21:45:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930902278672384[0;39m 生成今日电子书快照开始
2022-04-22 21:45:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930902278672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930902278672384[0;39m ==> Parameters: 
2022-04-22 21:45:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930902278672384[0;39m <==    Updates: 0
2022-04-22 21:45:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930902278672384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:45:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930923254386688[0;39m 生成今日电子书快照开始
2022-04-22 21:45:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930923254386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:45.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930923254386688[0;39m ==> Parameters: 
2022-04-22 21:45:45.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930923254386688[0;39m <==    Updates: 0
2022-04-22 21:45:45.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930923254386688[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 21:45:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930944209129472[0;39m 生成今日电子书快照开始
2022-04-22 21:45:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930944209129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930944209129472[0;39m ==> Parameters: 
2022-04-22 21:45:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930944209129472[0;39m <==    Updates: 0
2022-04-22 21:45:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930944209129472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:45:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930965189038080[0;39m 生成今日电子书快照开始
2022-04-22 21:45:55.205 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930965189038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:45:55.205 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930965189038080[0;39m ==> Parameters: 
2022-04-22 21:45:55.273 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930965189038080[0;39m <==    Updates: 0
2022-04-22 21:45:55.274 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930965189038080[0;39m 生成今日电子书快照结束，耗时：271毫秒
2022-04-22 21:46:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172930986152169472[0;39m 生成今日电子书快照开始
2022-04-22 21:46:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930986152169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930986152169472[0;39m ==> Parameters: 
2022-04-22 21:46:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172930986152169472[0;39m <==    Updates: 0
2022-04-22 21:46:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172930986152169472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:46:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931007132078080[0;39m start updating Ebook doc
2022-04-22 21:46:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931007132078080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:46:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931007132078080[0;39m ==> Parameters: 
2022-04-22 21:46:05.145 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931007132078080[0;39m <==    Updates: 1
2022-04-22 21:46:05.145 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931007132078080[0;39m update ends, take 141 millisecs
2022-04-22 21:46:05.145 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931007727669248[0;39m 生成今日电子书快照开始
2022-04-22 21:46:05.146 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931007727669248[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:05.146 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931007727669248[0;39m ==> Parameters: 
2022-04-22 21:46:05.186 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931007727669248[0;39m <==    Updates: 0
2022-04-22 21:46:05.186 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931007727669248[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 21:46:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931028095209472[0;39m 生成今日电子书快照开始
2022-04-22 21:46:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931028095209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931028095209472[0;39m ==> Parameters: 
2022-04-22 21:46:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931028095209472[0;39m <==    Updates: 0
2022-04-22 21:46:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931028095209472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 21:46:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931049083506688[0;39m 生成今日电子书快照开始
2022-04-22 21:46:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931049083506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931049083506688[0;39m ==> Parameters: 
2022-04-22 21:46:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931049083506688[0;39m <==    Updates: 0
2022-04-22 21:46:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931049083506688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 21:46:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931070050832384[0;39m 生成今日电子书快照开始
2022-04-22 21:46:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931070050832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931070050832384[0;39m ==> Parameters: 
2022-04-22 21:46:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931070050832384[0;39m <==    Updates: 0
2022-04-22 21:46:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931070050832384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:46:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931091009769472[0;39m 生成今日电子书快照开始
2022-04-22 21:46:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931091009769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931091009769472[0;39m ==> Parameters: 
2022-04-22 21:46:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931091009769472[0;39m <==    Updates: 0
2022-04-22 21:46:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931091009769472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:46:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931111977095168[0;39m 生成今日电子书快照开始
2022-04-22 21:46:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931111977095168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931111977095168[0;39m ==> Parameters: 
2022-04-22 21:46:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931111977095168[0;39m <==    Updates: 0
2022-04-22 21:46:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931111977095168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 21:46:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931132973780992[0;39m 生成今日电子书快照开始
2022-04-22 21:46:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931132973780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931132973780992[0;39m ==> Parameters: 
2022-04-22 21:46:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931132973780992[0;39m <==    Updates: 0
2022-04-22 21:46:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931132973780992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 21:46:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931133242216448[0;39m start updating Ebook doc
2022-04-22 21:46:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931133242216448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:46:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931133242216448[0;39m ==> Parameters: 
2022-04-22 21:46:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931133242216448[0;39m <==    Updates: 1
2022-04-22 21:46:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931133242216448[0;39m update ends, take 38 millisecs
2022-04-22 21:46:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931153945300992[0;39m 生成今日电子书快照开始
2022-04-22 21:46:40.217 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931153945300992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:40.218 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931153945300992[0;39m ==> Parameters: 
2022-04-22 21:46:40.256 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931153945300992[0;39m <==    Updates: 0
2022-04-22 21:46:40.256 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931153945300992[0;39m 生成今日电子书快照结束，耗时：250毫秒
2022-04-22 21:46:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931174904238080[0;39m 生成今日电子书快照开始
2022-04-22 21:46:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931174904238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931174904238080[0;39m ==> Parameters: 
2022-04-22 21:46:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931174904238080[0;39m <==    Updates: 0
2022-04-22 21:46:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931174904238080[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 21:46:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931195867369472[0;39m 生成今日电子书快照开始
2022-04-22 21:46:50.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931195867369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:50.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931195867369472[0;39m ==> Parameters: 
2022-04-22 21:46:50.125 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931195867369472[0;39m <==    Updates: 0
2022-04-22 21:46:50.126 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931195867369472[0;39m 生成今日电子书快照结束，耗时：124毫秒
2022-04-22 21:46:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931216838889472[0;39m 生成今日电子书快照开始
2022-04-22 21:46:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931216838889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:46:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931216838889472[0;39m ==> Parameters: 
2022-04-22 21:46:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931216838889472[0;39m <==    Updates: 0
2022-04-22 21:46:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931216838889472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 21:47:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931237822992384[0;39m 生成今日电子书快照开始
2022-04-22 21:47:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931237822992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931237822992384[0;39m ==> Parameters: 
2022-04-22 21:47:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931237822992384[0;39m <==    Updates: 0
2022-04-22 21:47:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931237822992384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:47:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931258781929472[0;39m 生成今日电子书快照开始
2022-04-22 21:47:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931258781929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931258781929472[0;39m ==> Parameters: 
2022-04-22 21:47:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931258781929472[0;39m <==    Updates: 0
2022-04-22 21:47:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931258781929472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:47:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931259050364928[0;39m start updating Ebook doc
2022-04-22 21:47:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931259050364928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:47:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931259050364928[0;39m ==> Parameters: 
2022-04-22 21:47:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931259050364928[0;39m <==    Updates: 1
2022-04-22 21:47:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931259050364928[0;39m update ends, take 40 millisecs
2022-04-22 21:47:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931279761838080[0;39m 生成今日电子书快照开始
2022-04-22 21:47:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931279761838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931279761838080[0;39m ==> Parameters: 
2022-04-22 21:47:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931279761838080[0;39m <==    Updates: 0
2022-04-22 21:47:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931279761838080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:47:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931300729163776[0;39m 生成今日电子书快照开始
2022-04-22 21:47:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931300729163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931300729163776[0;39m ==> Parameters: 
2022-04-22 21:47:15.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931300729163776[0;39m <==    Updates: 0
2022-04-22 21:47:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931300729163776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 21:47:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931321704878080[0;39m 生成今日电子书快照开始
2022-04-22 21:47:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931321704878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931321704878080[0;39m ==> Parameters: 
2022-04-22 21:47:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931321704878080[0;39m <==    Updates: 0
2022-04-22 21:47:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931321704878080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:47:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931342668009472[0;39m 生成今日电子书快照开始
2022-04-22 21:47:25.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931342668009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:25.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931342668009472[0;39m ==> Parameters: 
2022-04-22 21:47:25.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931342668009472[0;39m <==    Updates: 0
2022-04-22 21:47:25.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931342668009472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:47:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931363643723776[0;39m 生成今日电子书快照开始
2022-04-22 21:47:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931363643723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931363643723776[0;39m ==> Parameters: 
2022-04-22 21:47:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931363643723776[0;39m <==    Updates: 0
2022-04-22 21:47:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931363643723776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 21:47:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931384615243776[0;39m 生成今日电子书快照开始
2022-04-22 21:47:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931384615243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931384615243776[0;39m ==> Parameters: 
2022-04-22 21:47:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931384615243776[0;39m <==    Updates: 0
2022-04-22 21:47:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931384615243776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 21:47:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931384900456448[0;39m start updating Ebook doc
2022-04-22 21:47:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931384900456448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:47:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931384900456448[0;39m ==> Parameters: 
2022-04-22 21:47:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931384900456448[0;39m <==    Updates: 1
2022-04-22 21:47:35.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931384900456448[0;39m update ends, take 38 millisecs
2022-04-22 21:47:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931405590958080[0;39m 生成今日电子书快照开始
2022-04-22 21:47:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931405590958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931405590958080[0;39m ==> Parameters: 
2022-04-22 21:47:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931405590958080[0;39m <==    Updates: 0
2022-04-22 21:47:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931405590958080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:47:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931426570866688[0;39m 生成今日电子书快照开始
2022-04-22 21:47:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931426570866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931426570866688[0;39m ==> Parameters: 
2022-04-22 21:47:45.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931426570866688[0;39m <==    Updates: 0
2022-04-22 21:47:45.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931426570866688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 21:47:45.221 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:47:45.221 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:47:45.221 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:47:45.221 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:47:48.595 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:47:48.595 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8080/
2022-04-22 21:47:48.595 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：null
2022-04-22 21:47:48.595 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :46   [32m                  [0;39m token为空，请求被拦截
2022-04-22 21:47:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931447525609472[0;39m 生成今日电子书快照开始
2022-04-22 21:47:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931447525609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:47:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931447525609472[0;39m ==> Parameters: 
2022-04-22 21:47:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931447525609472[0;39m <==    Updates: 0
2022-04-22 21:47:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931447525609472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:47:54.998 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :218  [32m                  [0;39m Shutting down ExecutorService 'taskScheduler'
2022-04-22 21:47:54.999 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :218  [32m                  [0;39m Shutting down ExecutorService 'applicationTaskExecutor'
2022-04-22 21:47:55.000 INFO  com.zaxxer.hikari.HikariDataSource                :350  [32m                  [0;39m HikariPool-1 - Shutdown initiated...
2022-04-22 21:47:55.009 INFO  com.zaxxer.hikari.HikariDataSource                :352  [32m                  [0;39m HikariPool-1 - Shutdown completed.
2022-04-22 21:48:08.448 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2022-04-22 21:48:08.452 INFO  com.ameliawiki.wiki.config.WikiApplication        :55   [32m                  [0;39m Starting WikiApplication using Java 1.8.0_322 on sunarkedeMacBook-Pro.local with PID 1972 (/Users/sunarke/Downloads/wiki 5/target/classes started by sunarke in /Users/sunarke/Downloads/wiki 5)
2022-04-22 21:48:08.453 INFO  com.ameliawiki.wiki.config.WikiApplication        :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2022-04-22 21:48:08.494 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-04-22 21:48:08.494 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-04-22 21:48:09.125 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2022-04-22 21:48:09.127 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-04-22 21:48:09.141 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2022-04-22 21:48:09.722 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8080 (http)
2022-04-22 21:48:09.730 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8080"]
2022-04-22 21:48:09.730 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2022-04-22 21:48:09.731 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2022-04-22 21:48:09.778 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2022-04-22 21:48:09.778 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1283 ms
2022-04-22 21:48:10.582 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2022-04-22 21:48:10.839 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2022-04-22 21:48:10.874 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2022-04-22 21:48:10.888 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8080"]
2022-04-22 21:48:10.904 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8080 (http) with context path ''
2022-04-22 21:48:10.913 INFO  com.ameliawiki.wiki.config.WikiApplication        :61   [32m                  [0;39m Started WikiApplication in 2.957 seconds (JVM running for 3.34)
2022-04-22 21:48:10.915 INFO  com.ameliawiki.wiki.config.WikiApplication        :26   [32m                  [0;39m launch success!!!!!!!!YEA!!!
2022-04-22 21:48:10.915 INFO  com.ameliawiki.wiki.config.WikiApplication        :27   [32m                  [0;39m address: 	http://127.0.0.1:8080
2022-04-22 21:48:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931552383209472[0;39m 生成今日电子书快照开始
2022-04-22 21:48:15.013 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m172931552383209472[0;39m HikariPool-1 - Starting...
2022-04-22 21:48:15.397 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m172931552383209472[0;39m HikariPool-1 - Start completed.
2022-04-22 21:48:15.405 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931552383209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:15.424 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931552383209472[0;39m ==> Parameters: 
2022-04-22 21:48:15.456 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931552383209472[0;39m <==    Updates: 0
2022-04-22 21:48:15.458 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931552383209472[0;39m 生成今日电子书快照结束，耗时：457毫秒
2022-04-22 21:48:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931573358923776[0;39m 生成今日电子书快照开始
2022-04-22 21:48:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931573358923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931573358923776[0;39m ==> Parameters: 
2022-04-22 21:48:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931573358923776[0;39m <==    Updates: 0
2022-04-22 21:48:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931573358923776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:48:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931594322055168[0;39m 生成今日电子书快照开始
2022-04-22 21:48:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931594322055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931594322055168[0;39m ==> Parameters: 
2022-04-22 21:48:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931594322055168[0;39m <==    Updates: 0
2022-04-22 21:48:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931594322055168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:48:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931615301963776[0;39m 生成今日电子书快照开始
2022-04-22 21:48:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931615301963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931615301963776[0;39m ==> Parameters: 
2022-04-22 21:48:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931615301963776[0;39m <==    Updates: 0
2022-04-22 21:48:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931615301963776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:48:32.461 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-04-22 21:48:32.462 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2022-04-22 21:48:32.464 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 2 ms
2022-04-22 21:48:32.537 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172931625926135809[0;39m ------------- 开始 -------------
2022-04-22 21:48:32.537 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172931625926135810[0;39m ------------- 开始 -------------
2022-04-22 21:48:32.537 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172931625926135808[0;39m ------------- 开始 -------------
2022-04-22 21:48:32.538 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172931625926135809[0;39m 请求地址: http://127.0.0.1:8080/ebook-snapshot/get-statistic GET
2022-04-22 21:48:32.538 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172931625926135808[0;39m 请求地址: http://127.0.0.1:8080/ebook-snapshot/get-30-statistic GET
2022-04-22 21:48:32.538 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172931625926135810[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:48:32.539 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172931625926135809[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookSnapshotController.getStatistic
2022-04-22 21:48:32.539 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172931625926135808[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookSnapshotController.get30Statistic
2022-04-22 21:48:32.539 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172931625926135810[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:48:32.539 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172931625926135809[0;39m 远程地址: 127.0.0.1
2022-04-22 21:48:32.539 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172931625926135808[0;39m 远程地址: 127.0.0.1
2022-04-22 21:48:32.539 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172931625926135810[0;39m 远程地址: 127.0.0.1
2022-04-22 21:48:32.558 INFO  com.ameliawiki.wiki.websocket.WebSocketServer     :32   [32m                  [0;39m 有新连接：token：fEKlgDagzV，session id：0，当前连接数：1
2022-04-22 21:48:32.588 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172931625926135810[0;39m 请求参数: []
2022-04-22 21:48:32.588 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172931625926135809[0;39m 请求参数: []
2022-04-22 21:48:32.588 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172931625926135808[0;39m 请求参数: []
2022-04-22 21:48:32.613 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m172931625926135809[0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2022-04-22 21:48:32.613 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m172931625926135809[0;39m ==> Parameters: 
2022-04-22 21:48:32.615 DEBUG c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m172931625926135808[0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` between date_sub(curdate(), interval 30 day) and date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2022-04-22 21:48:32.616 DEBUG c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m172931625926135808[0;39m ==> Parameters: 
2022-04-22 21:48:32.629 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172931625926135810[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:48:32.629 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172931625926135810[0;39m ==> Parameters: 
2022-04-22 21:48:32.663 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:48:32.663 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==    Columns: date, viewIncrease, voteIncrease
2022-04-22 21:48:32.663 TRACE c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m172931625926135809[0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2022-04-22 21:48:32.664 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:48:32.664 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-15, 1430, 12
2022-04-22 21:48:32.664 TRACE c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m172931625926135809[0;39m <==        Row: 2022-04-21, 1724, 58, 0, 0
2022-04-22 21:48:32.665 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:48:32.665 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:48:32.666 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:48:32.666 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-16, 10, 23
2022-04-22 21:48:32.666 TRACE c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m172931625926135809[0;39m <==        Row: 2022-04-22, 1724, 58, 0, 0
2022-04-22 21:48:32.666 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:48:32.666 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-17, 284, 28
2022-04-22 21:48:32.666 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m172931625926135809[0;39m <==      Total: 2
2022-04-22 21:48:32.667 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-18, 0, 0
2022-04-22 21:48:32.667 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:48:32.668 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:48:32.668 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-19, 0, 0
2022-04-22 21:48:32.668 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:48:32.669 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-20, 0, 0
2022-04-22 21:48:32.669 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:48:32.669 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172931625926135808[0;39m <==        Row: 2022-04-21, 0, 0
2022-04-22 21:48:32.669 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:48:32.670 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:48:32.670 DEBUG c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m172931625926135808[0;39m <==      Total: 7
2022-04-22 21:48:32.670 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:48:32.671 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:48:32.671 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:48:32.672 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931625926135810[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:48:32.672 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172931625926135810[0;39m <==      Total: 15
2022-04-22 21:48:32.692 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172931625926135810[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:48:32.693 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172931625926135810[0;39m ------------- 结束 耗时：158 ms -------------
2022-04-22 21:48:32.694 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172931625926135809[0;39m 返回结果: {"content":[{"date":1650524400000,"viewCount":1724,"viewIncrease":0,"voteCount":58,"voteIncrease":0},{"date":1650610800000,"viewCount":1724,"viewIncrease":0,"voteCount":58,"voteIncrease":0}],"success":true}
2022-04-22 21:48:32.694 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172931625926135808[0;39m 返回结果: {"content":[{"date":1650006000000,"viewCount":0,"viewIncrease":1430,"voteCount":0,"voteIncrease":12},{"date":1650092400000,"viewCount":0,"viewIncrease":10,"voteCount":0,"voteIncrease":23},{"date":1650178800000,"viewCount":0,"viewIncrease":284,"voteCount":0,"voteIncrease":28},{"date":1650265200000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0},{"date":1650351600000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0},{"date":1650438000000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0},{"date":1650524400000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0}],"success":true}
2022-04-22 21:48:32.695 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172931625926135809[0;39m ------------- 结束 耗时：160 ms -------------
2022-04-22 21:48:32.695 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172931625926135808[0;39m ------------- 结束 耗时：160 ms -------------
2022-04-22 21:48:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931636277678080[0;39m 生成今日电子书快照开始
2022-04-22 21:48:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931636277678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931636277678080[0;39m ==> Parameters: 
2022-04-22 21:48:35.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931636277678080[0;39m <==    Updates: 0
2022-04-22 21:48:35.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931636277678080[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 21:48:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931636491587584[0;39m start updating Ebook doc
2022-04-22 21:48:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931636491587584[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:48:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931636491587584[0;39m ==> Parameters: 
2022-04-22 21:48:35.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931636491587584[0;39m <==    Updates: 1
2022-04-22 21:48:35.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931636491587584[0;39m update ends, take 40 millisecs
2022-04-22 21:48:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931657253392384[0;39m 生成今日电子书快照开始
2022-04-22 21:48:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931657253392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931657253392384[0;39m ==> Parameters: 
2022-04-22 21:48:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931657253392384[0;39m <==    Updates: 0
2022-04-22 21:48:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931657253392384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:48:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931678224912384[0;39m 生成今日电子书快照开始
2022-04-22 21:48:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931678224912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931678224912384[0;39m ==> Parameters: 
2022-04-22 21:48:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931678224912384[0;39m <==    Updates: 0
2022-04-22 21:48:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931678224912384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:48:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931699183849472[0;39m 生成今日电子书快照开始
2022-04-22 21:48:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931699183849472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931699183849472[0;39m ==> Parameters: 
2022-04-22 21:48:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931699183849472[0;39m <==    Updates: 0
2022-04-22 21:48:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931699183849472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:48:51.950 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:48:51.951 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :64   [32m                  [0;39m ------------- LoginInterceptor 结束 耗时：1 ms -------------
2022-04-22 21:48:51.955 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:48:51.956 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m                  [0;39m 接口登录拦截：，path：http://127.0.0.1:8080/user/list
2022-04-22 21:48:51.956 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m                  [0;39m 登录校验开始，token：171021810110959616
2022-04-22 21:48:52.992 WARN  com.ameliawiki.wiki.interceptor.LoginInterceptor  :52   [32m                  [0;39m token无效，请求被拦截
2022-04-22 21:48:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931720176340992[0;39m 生成今日电子书快照开始
2022-04-22 21:48:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931720176340992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:48:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931720176340992[0;39m ==> Parameters: 
2022-04-22 21:48:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931720176340992[0;39m <==    Updates: 0
2022-04-22 21:48:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931720176340992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:48:59.680 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172931739780517888[0;39m ------------- 开始 -------------
2022-04-22 21:48:59.680 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172931739780517888[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:48:59.680 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172931739780517888[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:48:59.681 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172931739780517888[0;39m 远程地址: 127.0.0.1
2022-04-22 21:48:59.681 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172931739780517888[0;39m 请求参数: []
2022-04-22 21:48:59.697 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172931739780517888[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:48:59.697 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172931739780517888[0;39m ==> Parameters: 
2022-04-22 21:48:59.715 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:48:59.716 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:48:59.718 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:48:59.719 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:48:59.720 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:48:59.720 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:48:59.721 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:48:59.721 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:48:59.722 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:48:59.722 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:48:59.722 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:48:59.723 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:48:59.723 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:48:59.723 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:48:59.724 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:48:59.724 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172931739780517888[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:48:59.724 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172931739780517888[0;39m <==      Total: 15
2022-04-22 21:48:59.727 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172931739780517888[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:48:59.727 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172931739780517888[0;39m ------------- 结束 耗时：47 ms -------------
2022-04-22 21:48:59.824 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172931740384497664[0;39m ------------- 开始 -------------
2022-04-22 21:48:59.825 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172931740384497664[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:48:59.825 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172931740384497664[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:48:59.825 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172931740384497664[0;39m 远程地址: 127.0.0.1
2022-04-22 21:48:59.827 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172931740384497664[0;39m 请求参数: [{"page":1,"size":10}]
2022-04-22 21:48:59.863 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172931740384497664[0;39m ==>  Preparing: SELECT count(0) FROM ebook
2022-04-22 21:48:59.864 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172931740384497664[0;39m ==> Parameters: 
2022-04-22 21:48:59.876 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172931740384497664[0;39m <==    Columns: count(0)
2022-04-22 21:48:59.877 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172931740384497664[0;39m <==        Row: 5
2022-04-22 21:48:59.878 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172931740384497664[0;39m <==      Total: 1
2022-04-22 21:48:59.880 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172931740384497664[0;39m ==>  Preparing: select id, `name`, category1_id, category2_id, description, cover, doc_count, view_count, vote_count from ebook LIMIT ?
2022-04-22 21:48:59.881 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172931740384497664[0;39m ==> Parameters: 10(Integer)
2022-04-22 21:48:59.897 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172931740384497664[0;39m <==    Columns: id, name, category1_id, category2_id, description, cover, doc_count, view_count, vote_count
2022-04-22 21:48:59.898 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172931740384497664[0;39m <==        Row: 1, SpringBoot Tutorial, 200, 202, Introduce how to create a SpringBoot project, null, 6, 69, 5
2022-04-22 21:48:59.898 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172931740384497664[0;39m <==        Row: 2, Vue Tutorial, 200, 201, Introduce how to build front end with Vue, null, 8, 136, 20
2022-04-22 21:48:59.899 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172931740384497664[0;39m <==        Row: 3, Python Tutorial, null, null, Introduction to programming with Python, null, 10, 75, 10
2022-04-22 21:48:59.899 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172931740384497664[0;39m <==        Row: 4, MySQL Tutorial, null, null, Introduction to mySQL database, null, 12, 321, 21
2022-04-22 21:48:59.900 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172931740384497664[0;39m <==        Row: 5, Oracle Tutorial, null, null, Introduction to Oracle, null, 11, 1123, 2
2022-04-22 21:48:59.900 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172931740384497664[0;39m <==      Total: 5
2022-04-22 21:48:59.901 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172931740384497664[0;39m total rows：5
2022-04-22 21:48:59.902 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172931740384497664[0;39m total pages：1
2022-04-22 21:48:59.910 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172931740384497664[0;39m 返回结果: {"content":{"list":[{"category1Id":200,"category2Id":202,"description":"Introduce how to create a SpringBoot project","docCount":6,"id":1,"name":"SpringBoot Tutorial","viewCount":69,"voteCount":5},{"category1Id":200,"category2Id":201,"description":"Introduce how to build front end with Vue","docCount":8,"id":2,"name":"Vue Tutorial","viewCount":136,"voteCount":20},{"description":"Introduction to programming with Python","docCount":10,"id":3,"name":"Python Tutorial","viewCount":75,"voteCount":10},{"description":"Introduction to mySQL database","docCount":12,"id":4,"name":"MySQL Tutorial","viewCount":321,"voteCount":21},{"description":"Introduction to Oracle","docCount":11,"id":5,"name":"Oracle Tutorial","viewCount":1123,"voteCount":2}],"total":5},"success":true}
2022-04-22 21:48:59.911 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172931740384497664[0;39m ------------- 结束 耗时：87 ms -------------
2022-04-22 21:49:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931741139472384[0;39m 生成今日电子书快照开始
2022-04-22 21:49:00.005 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931741139472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:00.005 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931741139472384[0;39m ==> Parameters: 
2022-04-22 21:49:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931741139472384[0;39m <==    Updates: 0
2022-04-22 21:49:00.036 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931741139472384[0;39m 生成今日电子书快照结束，耗时：32毫秒
2022-04-22 21:49:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931762102603776[0;39m 生成今日电子书快照开始
2022-04-22 21:49:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931762102603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931762102603776[0;39m ==> Parameters: 
2022-04-22 21:49:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931762102603776[0;39m <==    Updates: 0
2022-04-22 21:49:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931762102603776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 21:49:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931762375233536[0;39m start updating Ebook doc
2022-04-22 21:49:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931762375233536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:49:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931762375233536[0;39m ==> Parameters: 
2022-04-22 21:49:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931762375233536[0;39m <==    Updates: 1
2022-04-22 21:49:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931762375233536[0;39m update ends, take 40 millisecs
2022-04-22 21:49:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931783078318080[0;39m 生成今日电子书快照开始
2022-04-22 21:49:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931783078318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931783078318080[0;39m ==> Parameters: 
2022-04-22 21:49:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931783078318080[0;39m <==    Updates: 0
2022-04-22 21:49:10.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931783078318080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:49:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931804049838080[0;39m 生成今日电子书快照开始
2022-04-22 21:49:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931804049838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931804049838080[0;39m ==> Parameters: 
2022-04-22 21:49:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931804049838080[0;39m <==    Updates: 0
2022-04-22 21:49:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931804049838080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:49:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931825021358080[0;39m 生成今日电子书快照开始
2022-04-22 21:49:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931825021358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931825021358080[0;39m ==> Parameters: 
2022-04-22 21:49:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931825021358080[0;39m <==    Updates: 0
2022-04-22 21:49:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931825021358080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:49:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931845992878080[0;39m 生成今日电子书快照开始
2022-04-22 21:49:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931845992878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931845992878080[0;39m ==> Parameters: 
2022-04-22 21:49:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931845992878080[0;39m <==    Updates: 0
2022-04-22 21:49:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931845992878080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:49:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931866960203776[0;39m 生成今日电子书快照开始
2022-04-22 21:49:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931866960203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931866960203776[0;39m ==> Parameters: 
2022-04-22 21:49:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931866960203776[0;39m <==    Updates: 0
2022-04-22 21:49:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931866960203776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:49:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931887940112384[0;39m 生成今日电子书快照开始
2022-04-22 21:49:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931887940112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931887940112384[0;39m ==> Parameters: 
2022-04-22 21:49:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931887940112384[0;39m <==    Updates: 0
2022-04-22 21:49:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931887940112384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 21:49:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172931888237907968[0;39m start updating Ebook doc
2022-04-22 21:49:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931888237907968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:49:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931888237907968[0;39m ==> Parameters: 
2022-04-22 21:49:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172931888237907968[0;39m <==    Updates: 1
2022-04-22 21:49:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172931888237907968[0;39m update ends, take 37 millisecs
2022-04-22 21:49:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931908915826688[0;39m 生成今日电子书快照开始
2022-04-22 21:49:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931908915826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931908915826688[0;39m ==> Parameters: 
2022-04-22 21:49:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931908915826688[0;39m <==    Updates: 0
2022-04-22 21:49:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931908915826688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:49:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931929878958080[0;39m 生成今日电子书快照开始
2022-04-22 21:49:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931929878958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931929878958080[0;39m ==> Parameters: 
2022-04-22 21:49:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931929878958080[0;39m <==    Updates: 0
2022-04-22 21:49:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931929878958080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:49:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931950850478080[0;39m 生成今日电子书快照开始
2022-04-22 21:49:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931950850478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931950850478080[0;39m ==> Parameters: 
2022-04-22 21:49:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931950850478080[0;39m <==    Updates: 0
2022-04-22 21:49:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931950850478080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 21:49:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931971817803776[0;39m 生成今日电子书快照开始
2022-04-22 21:49:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931971817803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:49:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931971817803776[0;39m ==> Parameters: 
2022-04-22 21:49:55.185 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931971817803776[0;39m <==    Updates: 0
2022-04-22 21:49:55.186 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931971817803776[0;39m 生成今日电子书快照结束，耗时：183毫秒
2022-04-22 21:50:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172931992789323776[0;39m 生成今日电子书快照开始
2022-04-22 21:50:00.365 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931992789323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:00.366 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931992789323776[0;39m ==> Parameters: 
2022-04-22 21:50:00.403 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172931992789323776[0;39m <==    Updates: 0
2022-04-22 21:50:00.404 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172931992789323776[0;39m 生成今日电子书快照结束，耗时：401毫秒
2022-04-22 21:50:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932013769232384[0;39m 生成今日电子书快照开始
2022-04-22 21:50:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932013769232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932013769232384[0;39m ==> Parameters: 
2022-04-22 21:50:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932013769232384[0;39m <==    Updates: 0
2022-04-22 21:50:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932013769232384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:50:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932013999919104[0;39m start updating Ebook doc
2022-04-22 21:50:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932013999919104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:50:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932013999919104[0;39m ==> Parameters: 
2022-04-22 21:50:05.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932013999919104[0;39m <==    Updates: 1
2022-04-22 21:50:05.120 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932013999919104[0;39m update ends, take 61 millisecs
2022-04-22 21:50:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932034740752384[0;39m 生成今日电子书快照开始
2022-04-22 21:50:10.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932034740752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:10.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932034740752384[0;39m ==> Parameters: 
2022-04-22 21:50:10.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932034740752384[0;39m <==    Updates: 0
2022-04-22 21:50:10.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932034740752384[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 21:50:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932055708078080[0;39m 生成今日电子书快照开始
2022-04-22 21:50:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932055708078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932055708078080[0;39m ==> Parameters: 
2022-04-22 21:50:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932055708078080[0;39m <==    Updates: 0
2022-04-22 21:50:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932055708078080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:50:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932076679598080[0;39m 生成今日电子书快照开始
2022-04-22 21:50:20.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932076679598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:20.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932076679598080[0;39m ==> Parameters: 
2022-04-22 21:50:20.179 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932076679598080[0;39m <==    Updates: 0
2022-04-22 21:50:20.179 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932076679598080[0;39m 生成今日电子书快照结束，耗时：176毫秒
2022-04-22 21:50:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932097651118080[0;39m 生成今日电子书快照开始
2022-04-22 21:50:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932097651118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932097651118080[0;39m ==> Parameters: 
2022-04-22 21:50:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932097651118080[0;39m <==    Updates: 0
2022-04-22 21:50:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932097651118080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:50:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932118626832384[0;39m 生成今日电子书快照开始
2022-04-22 21:50:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932118626832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932118626832384[0;39m ==> Parameters: 
2022-04-22 21:50:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932118626832384[0;39m <==    Updates: 0
2022-04-22 21:50:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932118626832384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:50:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932139598352384[0;39m 生成今日电子书快照开始
2022-04-22 21:50:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932139598352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932139598352384[0;39m ==> Parameters: 
2022-04-22 21:50:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932139598352384[0;39m <==    Updates: 0
2022-04-22 21:50:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932139598352384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:50:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932139841622016[0;39m start updating Ebook doc
2022-04-22 21:50:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932139841622016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:50:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932139841622016[0;39m ==> Parameters: 
2022-04-22 21:50:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932139841622016[0;39m <==    Updates: 1
2022-04-22 21:50:35.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932139841622016[0;39m update ends, take 39 millisecs
2022-04-22 21:50:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932160565678080[0;39m 生成今日电子书快照开始
2022-04-22 21:50:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932160565678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932160565678080[0;39m ==> Parameters: 
2022-04-22 21:50:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932160565678080[0;39m <==    Updates: 0
2022-04-22 21:50:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932160565678080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 21:50:40.612 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932163120009216[0;39m ------------- 开始 -------------
2022-04-22 21:50:40.613 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932163120009216[0;39m 请求地址: http://127.0.0.1:8080/doc/all/1 GET
2022-04-22 21:50:40.613 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932163120009216[0;39m 类名方法: com.ameliawiki.wiki.controller.DocController.all
2022-04-22 21:50:40.613 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932163120009216[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:40.613 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932163120009216[0;39m 请求参数: [1]
2022-04-22 21:50:40.634 DEBUG c.ameliawiki.wiki.mapper.DocMapper.selectByExample:137  [32m172932163120009216[0;39m ==>  Preparing: select id, ebook_id, parent, `name`, sort, view_count, vote_count from doc WHERE ( ebook_id = ? ) order by sort asc
2022-04-22 21:50:40.635 DEBUG c.ameliawiki.wiki.mapper.DocMapper.selectByExample:137  [32m172932163120009216[0;39m ==> Parameters: 1(Long)
2022-04-22 21:50:40.652 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==    Columns: id, ebook_id, parent, name, sort, view_count, vote_count
2022-04-22 21:50:40.653 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==        Row: 1, 1, 0, Spring Boot, 1, 20, 1
2022-04-22 21:50:40.653 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==        Row: 2, 1, 1, Introduction, 1, 17, 1
2022-04-22 21:50:40.654 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==        Row: 4, 1, 3, Spring Cloud, 1, 14, 1
2022-04-22 21:50:40.654 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==        Row: 6, 1, 5, video, 1, 11, 1
2022-04-22 21:50:40.654 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==        Row: 3, 1, 0, Learn, 2, 3, 0
2022-04-22 21:50:40.655 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172932163120009216[0;39m <==        Row: 5, 1, 3, Video, 2, 4, 1
2022-04-22 21:50:40.655 DEBUG c.ameliawiki.wiki.mapper.DocMapper.selectByExample:137  [32m172932163120009216[0;39m <==      Total: 6
2022-04-22 21:50:40.662 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932163120009216[0;39m 返回结果: {"content":[{"ebookId":1,"id":1,"name":"Spring Boot","parent":0,"sort":1,"viewCount":20,"voteCount":1},{"ebookId":1,"id":2,"name":"Introduction","parent":1,"sort":1,"viewCount":17,"voteCount":1},{"ebookId":1,"id":4,"name":"Spring Cloud","parent":3,"sort":1,"viewCount":14,"voteCount":1},{"ebookId":1,"id":6,"name":"video","parent":5,"sort":1,"viewCount":11,"voteCount":1},{"ebookId":1,"id":3,"name":"Learn","parent":0,"sort":2,"viewCount":3,"voteCount":0},{"ebookId":1,"id":5,"name":"Video","parent":3,"sort":2,"viewCount":4,"voteCount":1}],"success":true}
2022-04-22 21:50:40.662 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932163120009216[0;39m ------------- 结束 耗时：50 ms -------------
2022-04-22 21:50:44.731 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932180396347392[0;39m ------------- 开始 -------------
2022-04-22 21:50:44.732 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932180396347392[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:50:44.732 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932180396347392[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:50:44.732 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932180396347392[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:44.732 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932180396347392[0;39m 请求参数: []
2022-04-22 21:50:44.746 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932180396347392[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:50:44.746 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932180396347392[0;39m ==> Parameters: 
2022-04-22 21:50:44.766 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:50:44.766 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:50:44.767 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:50:44.767 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:50:44.767 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:50:44.768 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:50:44.768 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:50:44.768 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:50:44.769 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:50:44.769 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:50:44.769 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:50:44.770 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:50:44.770 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:50:44.771 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:50:44.771 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:50:44.771 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932180396347392[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:50:44.772 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932180396347392[0;39m <==      Total: 15
2022-04-22 21:50:44.773 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932180396347392[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:50:44.773 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932180396347392[0;39m ------------- 结束 耗时：42 ms -------------
2022-04-22 21:50:44.815 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932180748668928[0;39m ------------- 开始 -------------
2022-04-22 21:50:44.815 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932180748668928[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:50:44.816 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932180748668928[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:50:44.816 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932180748668928[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:44.816 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932180748668928[0;39m 请求参数: [{"page":1,"size":10}]
2022-04-22 21:50:44.818 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172932180748668928[0;39m ==>  Preparing: SELECT count(0) FROM ebook
2022-04-22 21:50:44.818 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172932180748668928[0;39m ==> Parameters: 
2022-04-22 21:50:44.833 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172932180748668928[0;39m <==    Columns: count(0)
2022-04-22 21:50:44.834 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172932180748668928[0;39m <==        Row: 5
2022-04-22 21:50:44.834 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172932180748668928[0;39m <==      Total: 1
2022-04-22 21:50:44.835 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172932180748668928[0;39m ==>  Preparing: select id, `name`, category1_id, category2_id, description, cover, doc_count, view_count, vote_count from ebook LIMIT ?
2022-04-22 21:50:44.835 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172932180748668928[0;39m ==> Parameters: 10(Integer)
2022-04-22 21:50:44.854 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932180748668928[0;39m <==    Columns: id, name, category1_id, category2_id, description, cover, doc_count, view_count, vote_count
2022-04-22 21:50:44.855 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932180748668928[0;39m <==        Row: 1, SpringBoot Tutorial, 200, 202, Introduce how to create a SpringBoot project, null, 6, 69, 5
2022-04-22 21:50:44.856 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932180748668928[0;39m <==        Row: 2, Vue Tutorial, 200, 201, Introduce how to build front end with Vue, null, 8, 136, 20
2022-04-22 21:50:44.856 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932180748668928[0;39m <==        Row: 3, Python Tutorial, null, null, Introduction to programming with Python, null, 10, 75, 10
2022-04-22 21:50:44.857 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932180748668928[0;39m <==        Row: 4, MySQL Tutorial, null, null, Introduction to mySQL database, null, 12, 321, 21
2022-04-22 21:50:44.857 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932180748668928[0;39m <==        Row: 5, Oracle Tutorial, null, null, Introduction to Oracle, null, 11, 1123, 2
2022-04-22 21:50:44.858 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172932180748668928[0;39m <==      Total: 5
2022-04-22 21:50:44.858 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172932180748668928[0;39m total rows：5
2022-04-22 21:50:44.859 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172932180748668928[0;39m total pages：1
2022-04-22 21:50:44.859 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932180748668928[0;39m 返回结果: {"content":{"list":[{"category1Id":200,"category2Id":202,"description":"Introduce how to create a SpringBoot project","docCount":6,"id":1,"name":"SpringBoot Tutorial","viewCount":69,"voteCount":5},{"category1Id":200,"category2Id":201,"description":"Introduce how to build front end with Vue","docCount":8,"id":2,"name":"Vue Tutorial","viewCount":136,"voteCount":20},{"description":"Introduction to programming with Python","docCount":10,"id":3,"name":"Python Tutorial","viewCount":75,"voteCount":10},{"description":"Introduction to mySQL database","docCount":12,"id":4,"name":"MySQL Tutorial","viewCount":321,"voteCount":21},{"description":"Introduction to Oracle","docCount":11,"id":5,"name":"Oracle Tutorial","viewCount":1123,"voteCount":2}],"total":5},"success":true}
2022-04-22 21:50:44.860 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932180748668928[0;39m ------------- 结束 耗时：45 ms -------------
2022-04-22 21:50:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932181545586688[0;39m 生成今日电子书快照开始
2022-04-22 21:50:45.005 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932181545586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:45.006 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932181545586688[0;39m ==> Parameters: 
2022-04-22 21:50:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932181545586688[0;39m <==    Updates: 0
2022-04-22 21:50:45.040 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932181545586688[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-22 21:50:47.998 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932194099138560[0;39m ------------- 开始 -------------
2022-04-22 21:50:47.998 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932194099138560[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:50:47.999 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932194099138560[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:50:47.999 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932194099138560[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:47.999 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932194099138560[0;39m 请求参数: []
2022-04-22 21:50:48.027 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932194099138560[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:50:48.028 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932194099138560[0;39m ==> Parameters: 
2022-04-22 21:50:48.053 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:50:48.054 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:50:48.054 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:50:48.054 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:50:48.055 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:50:48.055 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:50:48.055 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:50:48.056 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:50:48.056 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:50:48.056 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:50:48.057 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:50:48.057 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:50:48.057 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:50:48.057 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:50:48.058 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:50:48.058 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932194099138560[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:50:48.058 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932194099138560[0;39m <==      Total: 15
2022-04-22 21:50:48.059 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932194099138560[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:50:48.060 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932194099138560[0;39m ------------- 结束 耗时：62 ms -------------
2022-04-22 21:50:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932202508718080[0;39m 生成今日电子书快照开始
2022-04-22 21:50:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932202508718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932202508718080[0;39m ==> Parameters: 
2022-04-22 21:50:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932202508718080[0;39m <==    Updates: 0
2022-04-22 21:50:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932202508718080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:50:52.341 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932212315000832[0;39m ------------- 开始 -------------
2022-04-22 21:50:52.342 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932212315000832[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:50:52.342 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932212315000832[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:50:52.342 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932212315000832[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:52.342 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932212315000832[0;39m 请求参数: []
2022-04-22 21:50:52.361 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932212315000832[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:50:52.361 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932212315000832[0;39m ==> Parameters: 
2022-04-22 21:50:52.380 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:50:52.381 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:50:52.381 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:50:52.381 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:50:52.382 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:50:52.382 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:50:52.383 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:50:52.383 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:50:52.383 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:50:52.384 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:50:52.384 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:50:52.384 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:50:52.384 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:50:52.385 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:50:52.385 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:50:52.386 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932212315000832[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:50:52.386 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932212315000832[0;39m <==      Total: 15
2022-04-22 21:50:52.387 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932212315000832[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:50:52.387 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932212315000832[0;39m ------------- 结束 耗时：46 ms -------------
2022-04-22 21:50:52.405 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932212583436288[0;39m ------------- 开始 -------------
2022-04-22 21:50:52.406 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932212583436288[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:50:52.406 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932212583436288[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:50:52.406 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932212583436288[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:52.406 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932212583436288[0;39m 请求参数: [{"page":1,"size":10}]
2022-04-22 21:50:52.407 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172932212583436288[0;39m ==>  Preparing: SELECT count(0) FROM ebook
2022-04-22 21:50:52.408 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172932212583436288[0;39m ==> Parameters: 
2022-04-22 21:50:52.424 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172932212583436288[0;39m <==    Columns: count(0)
2022-04-22 21:50:52.424 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172932212583436288[0;39m <==        Row: 5
2022-04-22 21:50:52.425 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172932212583436288[0;39m <==      Total: 1
2022-04-22 21:50:52.425 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172932212583436288[0;39m ==>  Preparing: select id, `name`, category1_id, category2_id, description, cover, doc_count, view_count, vote_count from ebook LIMIT ?
2022-04-22 21:50:52.425 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172932212583436288[0;39m ==> Parameters: 10(Integer)
2022-04-22 21:50:52.442 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932212583436288[0;39m <==    Columns: id, name, category1_id, category2_id, description, cover, doc_count, view_count, vote_count
2022-04-22 21:50:52.442 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932212583436288[0;39m <==        Row: 1, SpringBoot Tutorial, 200, 202, Introduce how to create a SpringBoot project, null, 6, 69, 5
2022-04-22 21:50:52.443 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932212583436288[0;39m <==        Row: 2, Vue Tutorial, 200, 201, Introduce how to build front end with Vue, null, 8, 136, 20
2022-04-22 21:50:52.443 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932212583436288[0;39m <==        Row: 3, Python Tutorial, null, null, Introduction to programming with Python, null, 10, 75, 10
2022-04-22 21:50:52.443 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932212583436288[0;39m <==        Row: 4, MySQL Tutorial, null, null, Introduction to mySQL database, null, 12, 321, 21
2022-04-22 21:50:52.443 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172932212583436288[0;39m <==        Row: 5, Oracle Tutorial, null, null, Introduction to Oracle, null, 11, 1123, 2
2022-04-22 21:50:52.443 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172932212583436288[0;39m <==      Total: 5
2022-04-22 21:50:52.444 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172932212583436288[0;39m total rows：5
2022-04-22 21:50:52.444 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172932212583436288[0;39m total pages：1
2022-04-22 21:50:52.444 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932212583436288[0;39m 返回结果: {"content":{"list":[{"category1Id":200,"category2Id":202,"description":"Introduce how to create a SpringBoot project","docCount":6,"id":1,"name":"SpringBoot Tutorial","viewCount":69,"voteCount":5},{"category1Id":200,"category2Id":201,"description":"Introduce how to build front end with Vue","docCount":8,"id":2,"name":"Vue Tutorial","viewCount":136,"voteCount":20},{"description":"Introduction to programming with Python","docCount":10,"id":3,"name":"Python Tutorial","viewCount":75,"voteCount":10},{"description":"Introduction to mySQL database","docCount":12,"id":4,"name":"MySQL Tutorial","viewCount":321,"voteCount":21},{"description":"Introduction to Oracle","docCount":11,"id":5,"name":"Oracle Tutorial","viewCount":1123,"voteCount":2}],"total":5},"success":true}
2022-04-22 21:50:52.444 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932212583436288[0;39m ------------- 结束 耗时：39 ms -------------
2022-04-22 21:50:54.366 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932220808466432[0;39m ------------- 开始 -------------
2022-04-22 21:50:54.366 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932220808466432[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:50:54.366 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932220808466432[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:50:54.367 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932220808466432[0;39m 远程地址: 127.0.0.1
2022-04-22 21:50:54.367 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932220808466432[0;39m 请求参数: []
2022-04-22 21:50:54.380 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932220808466432[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:50:54.381 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932220808466432[0;39m ==> Parameters: 
2022-04-22 21:50:54.402 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:50:54.402 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:50:54.403 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:50:54.403 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:50:54.403 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:50:54.403 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:50:54.404 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:50:54.404 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:50:54.404 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:50:54.404 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:50:54.405 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:50:54.405 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:50:54.405 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:50:54.405 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:50:54.406 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:50:54.406 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932220808466432[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:50:54.406 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932220808466432[0;39m <==      Total: 15
2022-04-22 21:50:54.407 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932220808466432[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:50:54.407 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932220808466432[0;39m ------------- 结束 耗时：41 ms -------------
2022-04-22 21:50:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932223484432384[0;39m 生成今日电子书快照开始
2022-04-22 21:50:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932223484432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:50:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932223484432384[0;39m ==> Parameters: 
2022-04-22 21:50:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932223484432384[0;39m <==    Updates: 0
2022-04-22 21:50:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932223484432384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:51:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932244455952384[0;39m 生成今日电子书快照开始
2022-04-22 21:51:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932244455952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932244455952384[0;39m ==> Parameters: 
2022-04-22 21:51:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932244455952384[0;39m <==    Updates: 0
2022-04-22 21:51:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932244455952384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:51:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932265427472384[0;39m 生成今日电子书快照开始
2022-04-22 21:51:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932265427472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932265427472384[0;39m ==> Parameters: 
2022-04-22 21:51:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932265427472384[0;39m <==    Updates: 0
2022-04-22 21:51:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932265427472384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:51:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932265674936320[0;39m start updating Ebook doc
2022-04-22 21:51:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932265674936320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:51:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932265674936320[0;39m ==> Parameters: 
2022-04-22 21:51:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932265674936320[0;39m <==    Updates: 1
2022-04-22 21:51:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932265674936320[0;39m update ends, take 36 millisecs
2022-04-22 21:51:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932286403186688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932286403186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932286403186688[0;39m ==> Parameters: 
2022-04-22 21:51:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932286403186688[0;39m <==    Updates: 0
2022-04-22 21:51:10.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932286403186688[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 21:51:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932307370512384[0;39m 生成今日电子书快照开始
2022-04-22 21:51:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932307370512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932307370512384[0;39m ==> Parameters: 
2022-04-22 21:51:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932307370512384[0;39m <==    Updates: 0
2022-04-22 21:51:15.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932307370512384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 21:51:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932328342032384[0;39m 生成今日电子书快照开始
2022-04-22 21:51:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932328342032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932328342032384[0;39m ==> Parameters: 
2022-04-22 21:51:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932328342032384[0;39m <==    Updates: 0
2022-04-22 21:51:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932328342032384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 21:51:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932349317746688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932349317746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932349317746688[0;39m ==> Parameters: 
2022-04-22 21:51:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932349317746688[0;39m <==    Updates: 0
2022-04-22 21:51:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932349317746688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:51:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932370289266688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932370289266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932370289266688[0;39m ==> Parameters: 
2022-04-22 21:51:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932370289266688[0;39m <==    Updates: 0
2022-04-22 21:51:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932370289266688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:51:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932391260786688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932391260786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932391260786688[0;39m ==> Parameters: 
2022-04-22 21:51:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932391260786688[0;39m <==    Updates: 0
2022-04-22 21:51:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932391260786688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:51:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932391499862016[0;39m start updating Ebook doc
2022-04-22 21:51:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932391499862016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:51:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932391499862016[0;39m ==> Parameters: 
2022-04-22 21:51:35.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932391499862016[0;39m <==    Updates: 1
2022-04-22 21:51:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932391499862016[0;39m update ends, take 41 millisecs
2022-04-22 21:51:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932412232306688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932412232306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932412232306688[0;39m ==> Parameters: 
2022-04-22 21:51:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932412232306688[0;39m <==    Updates: 0
2022-04-22 21:51:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932412232306688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:51:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932433203826688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932433203826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932433203826688[0;39m ==> Parameters: 
2022-04-22 21:51:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932433203826688[0;39m <==    Updates: 0
2022-04-22 21:51:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932433203826688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:51:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932454175346688[0;39m 生成今日电子书快照开始
2022-04-22 21:51:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932454175346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932454175346688[0;39m ==> Parameters: 
2022-04-22 21:51:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932454175346688[0;39m <==    Updates: 0
2022-04-22 21:51:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932454175346688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:51:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932475130089472[0;39m 生成今日电子书快照开始
2022-04-22 21:51:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932475130089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:51:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932475130089472[0;39m ==> Parameters: 
2022-04-22 21:51:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932475130089472[0;39m <==    Updates: 0
2022-04-22 21:51:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932475130089472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:52:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932496114192384[0;39m 生成今日电子书快照开始
2022-04-22 21:52:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932496114192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932496114192384[0;39m ==> Parameters: 
2022-04-22 21:52:00.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932496114192384[0;39m <==    Updates: 0
2022-04-22 21:52:00.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932496114192384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 21:52:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932517085712384[0;39m start updating Ebook doc
2022-04-22 21:52:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932517085712384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:52:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932517085712384[0;39m ==> Parameters: 
2022-04-22 21:52:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932517085712384[0;39m <==    Updates: 1
2022-04-22 21:52:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932517085712384[0;39m update ends, take 60 millisecs
2022-04-22 21:52:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932517337370624[0;39m 生成今日电子书快照开始
2022-04-22 21:52:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932517337370624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932517337370624[0;39m ==> Parameters: 
2022-04-22 21:52:05.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932517337370624[0;39m <==    Updates: 0
2022-04-22 21:52:05.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932517337370624[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-22 21:52:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932538053038080[0;39m 生成今日电子书快照开始
2022-04-22 21:52:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932538053038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932538053038080[0;39m ==> Parameters: 
2022-04-22 21:52:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932538053038080[0;39m <==    Updates: 0
2022-04-22 21:52:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932538053038080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:52:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932559032946688[0;39m 生成今日电子书快照开始
2022-04-22 21:52:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932559032946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932559032946688[0;39m ==> Parameters: 
2022-04-22 21:52:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932559032946688[0;39m <==    Updates: 0
2022-04-22 21:52:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932559032946688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:52:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932579996078080[0;39m 生成今日电子书快照开始
2022-04-22 21:52:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932579996078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932579996078080[0;39m ==> Parameters: 
2022-04-22 21:52:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932579996078080[0;39m <==    Updates: 0
2022-04-22 21:52:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932579996078080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 21:52:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932600955015168[0;39m 生成今日电子书快照开始
2022-04-22 21:52:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932600955015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932600955015168[0;39m ==> Parameters: 
2022-04-22 21:52:25.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932600955015168[0;39m <==    Updates: 0
2022-04-22 21:52:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932600955015168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:52:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932621939118080[0;39m 生成今日电子书快照开始
2022-04-22 21:52:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932621939118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932621939118080[0;39m ==> Parameters: 
2022-04-22 21:52:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932621939118080[0;39m <==    Updates: 0
2022-04-22 21:52:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932621939118080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:52:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932642898055168[0;39m 生成今日电子书快照开始
2022-04-22 21:52:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932642898055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932642898055168[0;39m ==> Parameters: 
2022-04-22 21:52:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932642898055168[0;39m <==    Updates: 0
2022-04-22 21:52:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932642898055168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:52:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932643141324800[0;39m start updating Ebook doc
2022-04-22 21:52:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932643141324800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:52:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932643141324800[0;39m ==> Parameters: 
2022-04-22 21:52:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932643141324800[0;39m <==    Updates: 1
2022-04-22 21:52:35.095 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932643141324800[0;39m update ends, take 36 millisecs
2022-04-22 21:52:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932663882158080[0;39m 生成今日电子书快照开始
2022-04-22 21:52:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932663882158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932663882158080[0;39m ==> Parameters: 
2022-04-22 21:52:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932663882158080[0;39m <==    Updates: 0
2022-04-22 21:52:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932663882158080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:52:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932684862066688[0;39m 生成今日电子书快照开始
2022-04-22 21:52:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932684862066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932684862066688[0;39m ==> Parameters: 
2022-04-22 21:52:45.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932684862066688[0;39m <==    Updates: 0
2022-04-22 21:52:45.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932684862066688[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-22 21:52:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932705816809472[0;39m 生成今日电子书快照开始
2022-04-22 21:52:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932705816809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932705816809472[0;39m ==> Parameters: 
2022-04-22 21:52:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932705816809472[0;39m <==    Updates: 0
2022-04-22 21:52:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932705816809472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:52:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932726792523776[0;39m 生成今日电子书快照开始
2022-04-22 21:52:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932726792523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:52:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932726792523776[0;39m ==> Parameters: 
2022-04-22 21:52:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932726792523776[0;39m <==    Updates: 0
2022-04-22 21:52:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932726792523776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:53:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932747768238080[0;39m 生成今日电子书快照开始
2022-04-22 21:53:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932747768238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932747768238080[0;39m ==> Parameters: 
2022-04-22 21:53:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932747768238080[0;39m <==    Updates: 0
2022-04-22 21:53:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932747768238080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 21:53:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932768748146688[0;39m 生成今日电子书快照开始
2022-04-22 21:53:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932768748146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932768748146688[0;39m ==> Parameters: 
2022-04-22 21:53:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932768748146688[0;39m <==    Updates: 0
2022-04-22 21:53:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932768748146688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:53:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932768983027712[0;39m start updating Ebook doc
2022-04-22 21:53:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932768983027712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:53:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932768983027712[0;39m ==> Parameters: 
2022-04-22 21:53:05.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932768983027712[0;39m <==    Updates: 1
2022-04-22 21:53:05.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932768983027712[0;39m update ends, take 35 millisecs
2022-04-22 21:53:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932789711278080[0;39m 生成今日电子书快照开始
2022-04-22 21:53:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932789711278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932789711278080[0;39m ==> Parameters: 
2022-04-22 21:53:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932789711278080[0;39m <==    Updates: 0
2022-04-22 21:53:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932789711278080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:53:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932810691186688[0;39m 生成今日电子书快照开始
2022-04-22 21:53:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932810691186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932810691186688[0;39m ==> Parameters: 
2022-04-22 21:53:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932810691186688[0;39m <==    Updates: 0
2022-04-22 21:53:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932810691186688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:53:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932831654318080[0;39m 生成今日电子书快照开始
2022-04-22 21:53:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932831654318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932831654318080[0;39m ==> Parameters: 
2022-04-22 21:53:20.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932831654318080[0;39m <==    Updates: 0
2022-04-22 21:53:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932831654318080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 21:53:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932852625838080[0;39m 生成今日电子书快照开始
2022-04-22 21:53:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932852625838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932852625838080[0;39m ==> Parameters: 
2022-04-22 21:53:25.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932852625838080[0;39m <==    Updates: 0
2022-04-22 21:53:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932852625838080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:53:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932873605746688[0;39m 生成今日电子书快照开始
2022-04-22 21:53:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932873605746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932873605746688[0;39m ==> Parameters: 
2022-04-22 21:53:30.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932873605746688[0;39m <==    Updates: 0
2022-04-22 21:53:30.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932873605746688[0;39m 生成今日电子书快照结束，耗时：101毫秒
2022-04-22 21:53:33.012 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m                  [0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:53:33.012 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :64   [32m                  [0;39m ------------- LoginInterceptor 结束 耗时：0 ms -------------
2022-04-22 21:53:33.015 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :29   [32m172931625926135809[0;39m ------------- LoginInterceptor start -------------
2022-04-22 21:53:33.016 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :40   [32m172931625926135809[0;39m 接口登录拦截：，path：http://127.0.0.1:8080/user/logout/171021810110959616
2022-04-22 21:53:33.016 INFO  com.ameliawiki.wiki.interceptor.LoginInterceptor  :44   [32m172931625926135809[0;39m 登录校验开始，token：171021810110959616
2022-04-22 21:53:33.196 WARN  com.ameliawiki.wiki.interceptor.LoginInterceptor  :52   [32m172931625926135809[0;39m token无效，请求被拦截
2022-04-22 21:53:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932894560489472[0;39m 生成今日电子书快照开始
2022-04-22 21:53:35.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932894560489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:35.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932894560489472[0;39m ==> Parameters: 
2022-04-22 21:53:35.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932894560489472[0;39m <==    Updates: 0
2022-04-22 21:53:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932894560489472[0;39m 生成今日电子书快照结束，耗时：97毫秒
2022-04-22 21:53:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172932894975725568[0;39m start updating Ebook doc
2022-04-22 21:53:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932894975725568[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:53:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932894975725568[0;39m ==> Parameters: 
2022-04-22 21:53:35.146 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172932894975725568[0;39m <==    Updates: 1
2022-04-22 21:53:35.146 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172932894975725568[0;39m update ends, take 46 millisecs
2022-04-22 21:53:38.941 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932911086047232[0;39m ------------- 开始 -------------
2022-04-22 21:53:38.942 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932911086047232[0;39m 请求地址: http://127.0.0.1:8080/ebook-snapshot/get-statistic GET
2022-04-22 21:53:38.942 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932911086047232[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookSnapshotController.getStatistic
2022-04-22 21:53:38.942 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932911086047232[0;39m 远程地址: 127.0.0.1
2022-04-22 21:53:38.942 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932911086047232[0;39m 请求参数: []
2022-04-22 21:53:38.943 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932911094435840[0;39m ------------- 开始 -------------
2022-04-22 21:53:38.943 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172932911094435841[0;39m ------------- 开始 -------------
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932911094435840[0;39m 请求地址: http://127.0.0.1:8080/ebook-snapshot/get-30-statistic GET
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172932911094435841[0;39m 请求地址: http://127.0.0.1:8080/category/all GET
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932911094435840[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookSnapshotController.get30Statistic
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172932911094435841[0;39m 类名方法: com.ameliawiki.wiki.controller.CategoryController.all
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932911094435840[0;39m 远程地址: 127.0.0.1
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172932911094435841[0;39m 远程地址: 127.0.0.1
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932911094435841[0;39m 请求参数: []
2022-04-22 21:53:38.944 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172932911094435840[0;39m 请求参数: []
2022-04-22 21:53:38.966 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m172932911086047232[0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2022-04-22 21:53:38.967 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m172932911086047232[0;39m ==> Parameters: 
2022-04-22 21:53:38.967 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932911094435841[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-04-22 21:53:38.968 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932911094435841[0;39m ==> Parameters: 
2022-04-22 21:53:38.969 DEBUG c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m172932911094435840[0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` between date_sub(curdate(), interval 30 day) and date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2022-04-22 21:53:38.969 DEBUG c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m172932911094435840[0;39m ==> Parameters: 
2022-04-22 21:53:38.988 TRACE c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m172932911086047232[0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2022-04-22 21:53:38.988 TRACE c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m172932911086047232[0;39m <==        Row: 2022-04-21, 1724, 58, 0, 0
2022-04-22 21:53:38.989 TRACE c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m172932911086047232[0;39m <==        Row: 2022-04-22, 1724, 58, 0, 0
2022-04-22 21:53:38.989 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m172932911086047232[0;39m <==      Total: 2
2022-04-22 21:53:38.990 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932911086047232[0;39m 返回结果: {"content":[{"date":1650524400000,"viewCount":1724,"viewIncrease":0,"voteCount":58,"voteIncrease":0},{"date":1650610800000,"viewCount":1724,"viewIncrease":0,"voteCount":58,"voteIncrease":0}],"success":true}
2022-04-22 21:53:38.990 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932911086047232[0;39m ------------- 结束 耗时：49 ms -------------
2022-04-22 21:53:38.992 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==    Columns: id, parent, name, sort
2022-04-22 21:53:38.992 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==    Columns: date, viewIncrease, voteIncrease
2022-04-22 21:53:38.993 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 100, 0, Front end development, 100
2022-04-22 21:53:38.993 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-15, 1430, 12
2022-04-22 21:53:38.993 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 101, 100, Vue, 101
2022-04-22 21:53:38.993 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-16, 10, 23
2022-04-22 21:53:38.993 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-04-22 21:53:38.994 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 200, 0, Java, 200
2022-04-22 21:53:38.994 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-17, 284, 28
2022-04-22 21:53:38.994 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 201, 200, Basics, 201
2022-04-22 21:53:38.994 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-18, 0, 0
2022-04-22 21:53:38.994 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 202, 200, Frameworks, 202
2022-04-22 21:53:38.995 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-19, 0, 0
2022-04-22 21:53:38.995 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 300, 0, Python, 300
2022-04-22 21:53:38.995 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 301, 300, Basic application, 301
2022-04-22 21:53:38.995 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 302, 300, Advanced application, 302
2022-04-22 21:53:38.996 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 400, 0, Database, 400
2022-04-22 21:53:38.996 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-20, 0, 0
2022-04-22 21:53:38.996 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 401, 400, MySQL, 401
2022-04-22 21:53:38.996 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 500, 0, Others, 500
2022-04-22 21:53:38.997 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 501, 500, Servers, 501
2022-04-22 21:53:38.997 TRACE c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m172932911094435840[0;39m <==        Row: 2022-04-21, 0, 0
2022-04-22 21:53:38.997 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 502, 500, Tools, 502
2022-04-22 21:53:38.997 DEBUG c.a.w.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m172932911094435840[0;39m <==      Total: 7
2022-04-22 21:53:38.997 TRACE c.a.wiki.mapper.CategoryMapper.selectByExample    :143  [32m172932911094435841[0;39m <==        Row: 503, 500, Languages, 503
2022-04-22 21:53:38.998 DEBUG c.a.wiki.mapper.CategoryMapper.selectByExample    :137  [32m172932911094435841[0;39m <==      Total: 15
2022-04-22 21:53:38.998 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932911094435840[0;39m 返回结果: {"content":[{"date":1650006000000,"viewCount":0,"viewIncrease":1430,"voteCount":0,"voteIncrease":12},{"date":1650092400000,"viewCount":0,"viewIncrease":10,"voteCount":0,"voteIncrease":23},{"date":1650178800000,"viewCount":0,"viewIncrease":284,"voteCount":0,"voteIncrease":28},{"date":1650265200000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0},{"date":1650351600000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0},{"date":1650438000000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0},{"date":1650524400000,"viewCount":0,"viewIncrease":0,"voteCount":0,"voteIncrease":0}],"success":true}
2022-04-22 21:53:38.998 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932911094435840[0;39m ------------- 结束 耗时：55 ms -------------
2022-04-22 21:53:38.999 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172932911094435841[0;39m 返回结果: {"content":[{"id":100,"name":"Front end development","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"Basics","parent":200,"sort":201},{"id":202,"name":"Frameworks","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"Basic application","parent":300,"sort":301},{"id":302,"name":"Advanced application","parent":300,"sort":302},{"id":400,"name":"Database","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":500,"name":"Others","parent":0,"sort":500},{"id":501,"name":"Servers","parent":500,"sort":501},{"id":502,"name":"Tools","parent":500,"sort":502},{"id":503,"name":"Languages","parent":500,"sort":503}],"success":true}
2022-04-22 21:53:39.000 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172932911094435841[0;39m ------------- 结束 耗时：57 ms -------------
2022-04-22 21:53:39.050 INFO  com.ameliawiki.wiki.websocket.WebSocketServer     :32   [32m172932194099138560[0;39m 有新连接：token：7j8OKFowik，session id：1，当前连接数：2
2022-04-22 21:53:39.337 ERROR com.ameliawiki.wiki.websocket.WebSocketServer     :57   [32m172932212315000832[0;39m 发生错误
java.io.EOFException: null
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.fillReadBuffer(NioEndpoint.java:1231)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.read(NioEndpoint.java:1141)
	at org.apache.tomcat.websocket.server.WsFrameServer.onDataAvailable(WsFrameServer.java:72)
	at org.apache.tomcat.websocket.server.WsFrameServer.doOnDataAvailable(WsFrameServer.java:171)
	at org.apache.tomcat.websocket.server.WsFrameServer.notifyDataAvailable(WsFrameServer.java:151)
	at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.upgradeDispatch(WsHttpUpgradeHandler.java:148)
	at org.apache.coyote.http11.upgrade.UpgradeProcessorInternal.dispatch(UpgradeProcessorInternal.java:54)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:59)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:750)
2022-04-22 21:53:39.349 INFO  com.ameliawiki.wiki.websocket.WebSocketServer     :41   [32m172932212315000832[0;39m 连接关闭，token：fEKlgDagzV，session id：0！当前连接数：1
2022-04-22 21:53:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932915536203776[0;39m 生成今日电子书快照开始
2022-04-22 21:53:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932915536203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932915536203776[0;39m ==> Parameters: 
2022-04-22 21:53:40.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932915536203776[0;39m <==    Updates: 0
2022-04-22 21:53:40.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932915536203776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:53:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932936516112384[0;39m 生成今日电子书快照开始
2022-04-22 21:53:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932936516112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932936516112384[0;39m ==> Parameters: 
2022-04-22 21:53:45.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932936516112384[0;39m <==    Updates: 0
2022-04-22 21:53:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932936516112384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 21:53:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932957487632384[0;39m 生成今日电子书快照开始
2022-04-22 21:53:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932957487632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932957487632384[0;39m ==> Parameters: 
2022-04-22 21:53:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932957487632384[0;39m <==    Updates: 0
2022-04-22 21:53:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932957487632384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:53:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932978459152384[0;39m 生成今日电子书快照开始
2022-04-22 21:53:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932978459152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:53:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932978459152384[0;39m ==> Parameters: 
2022-04-22 21:53:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932978459152384[0;39m <==    Updates: 0
2022-04-22 21:53:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932978459152384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:54:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172932999434866688[0;39m 生成今日电子书快照开始
2022-04-22 21:54:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932999434866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932999434866688[0;39m ==> Parameters: 
2022-04-22 21:54:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172932999434866688[0;39m <==    Updates: 0
2022-04-22 21:54:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172932999434866688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:54:05.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933020389609472[0;39m start updating Ebook doc
2022-04-22 21:54:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933020389609472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:54:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933020389609472[0;39m ==> Parameters: 
2022-04-22 21:54:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933020389609472[0;39m <==    Updates: 1
2022-04-22 21:54:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933020389609472[0;39m update ends, take 58 millisecs
2022-04-22 21:54:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933020637073408[0;39m 生成今日电子书快照开始
2022-04-22 21:54:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933020637073408[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933020637073408[0;39m ==> Parameters: 
2022-04-22 21:54:05.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933020637073408[0;39m <==    Updates: 0
2022-04-22 21:54:05.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933020637073408[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 21:54:06.211 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933025460523008[0;39m ------------- 开始 -------------
2022-04-22 21:54:06.211 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933025460523008[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:54:06.211 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933025460523008[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:54:06.211 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933025460523008[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:06.211 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933025460523008[0;39m 请求参数: [{"categoryId2":101,"page":1,"size":1000}]
2022-04-22 21:54:06.233 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933025460523008[0;39m ==>  Preparing: SELECT count(0) FROM ebook WHERE (category2_id = ?)
2022-04-22 21:54:06.234 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933025460523008[0;39m ==> Parameters: 101(Long)
2022-04-22 21:54:06.251 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933025460523008[0;39m <==    Columns: count(0)
2022-04-22 21:54:06.251 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933025460523008[0;39m <==        Row: 0
2022-04-22 21:54:06.252 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933025460523008[0;39m <==      Total: 1
2022-04-22 21:54:06.252 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172933025460523008[0;39m total rows：0
2022-04-22 21:54:06.252 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172933025460523008[0;39m total pages：0
2022-04-22 21:54:06.252 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933025460523008[0;39m 返回结果: {"content":{"list":[],"total":0},"success":true}
2022-04-22 21:54:06.253 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933025460523008[0;39m ------------- 结束 耗时：43 ms -------------
2022-04-22 21:54:07.508 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933030904729600[0;39m ------------- 开始 -------------
2022-04-22 21:54:07.508 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933030904729600[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:54:07.508 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933030904729600[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:54:07.508 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933030904729600[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:07.509 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933030904729600[0;39m 请求参数: [{"categoryId2":102,"page":1,"size":1000}]
2022-04-22 21:54:07.533 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933030904729600[0;39m ==>  Preparing: SELECT count(0) FROM ebook WHERE (category2_id = ?)
2022-04-22 21:54:07.534 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933030904729600[0;39m ==> Parameters: 102(Long)
2022-04-22 21:54:07.550 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933030904729600[0;39m <==    Columns: count(0)
2022-04-22 21:54:07.551 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933030904729600[0;39m <==        Row: 0
2022-04-22 21:54:07.551 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933030904729600[0;39m <==      Total: 1
2022-04-22 21:54:07.552 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172933030904729600[0;39m total rows：0
2022-04-22 21:54:07.552 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172933030904729600[0;39m total pages：0
2022-04-22 21:54:07.552 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933030904729600[0;39m 返回结果: {"content":{"list":[],"total":0},"success":true}
2022-04-22 21:54:07.552 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933030904729600[0;39m ------------- 结束 耗时：44 ms -------------
2022-04-22 21:54:09.667 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933039960231936[0;39m ------------- 开始 -------------
2022-04-22 21:54:09.668 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933039960231936[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:54:09.668 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933039960231936[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:54:09.668 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933039960231936[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:09.668 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933039960231936[0;39m 请求参数: [{"categoryId2":201,"page":1,"size":1000}]
2022-04-22 21:54:09.683 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933039960231936[0;39m ==>  Preparing: SELECT count(0) FROM ebook WHERE (category2_id = ?)
2022-04-22 21:54:09.684 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933039960231936[0;39m ==> Parameters: 201(Long)
2022-04-22 21:54:09.700 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933039960231936[0;39m <==    Columns: count(0)
2022-04-22 21:54:09.701 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933039960231936[0;39m <==        Row: 1
2022-04-22 21:54:09.701 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933039960231936[0;39m <==      Total: 1
2022-04-22 21:54:09.701 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172933039960231936[0;39m ==>  Preparing: select id, `name`, category1_id, category2_id, description, cover, doc_count, view_count, vote_count from ebook WHERE ( category2_id = ? ) LIMIT ?
2022-04-22 21:54:09.702 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172933039960231936[0;39m ==> Parameters: 201(Long), 1000(Integer)
2022-04-22 21:54:09.718 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172933039960231936[0;39m <==    Columns: id, name, category1_id, category2_id, description, cover, doc_count, view_count, vote_count
2022-04-22 21:54:09.718 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172933039960231936[0;39m <==        Row: 2, Vue Tutorial, 200, 201, Introduce how to build front end with Vue, null, 8, 136, 20
2022-04-22 21:54:09.720 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172933039960231936[0;39m <==      Total: 1
2022-04-22 21:54:09.721 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172933039960231936[0;39m total rows：1
2022-04-22 21:54:09.721 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172933039960231936[0;39m total pages：1
2022-04-22 21:54:09.724 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933039960231936[0;39m 返回结果: {"content":{"list":[{"category1Id":200,"category2Id":201,"description":"Introduce how to build front end with Vue","docCount":8,"id":2,"name":"Vue Tutorial","viewCount":136,"voteCount":20}],"total":1},"success":true}
2022-04-22 21:54:09.724 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933039960231936[0;39m ------------- 结束 耗时：57 ms -------------
2022-04-22 21:54:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933041365323776[0;39m 生成今日电子书快照开始
2022-04-22 21:54:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933041365323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933041365323776[0;39m ==> Parameters: 
2022-04-22 21:54:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933041365323776[0;39m <==    Updates: 0
2022-04-22 21:54:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933041365323776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:54:10.669 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933044162924544[0;39m ------------- 开始 -------------
2022-04-22 21:54:10.669 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933044162924544[0;39m 请求地址: http://127.0.0.1:8080/ebook/list GET
2022-04-22 21:54:10.669 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933044162924544[0;39m 类名方法: com.ameliawiki.wiki.controller.EbookController.list
2022-04-22 21:54:10.670 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933044162924544[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:10.670 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933044162924544[0;39m 请求参数: [{"categoryId2":202,"page":1,"size":1000}]
2022-04-22 21:54:10.691 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933044162924544[0;39m ==>  Preparing: SELECT count(0) FROM ebook WHERE (category2_id = ?)
2022-04-22 21:54:10.692 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933044162924544[0;39m ==> Parameters: 202(Long)
2022-04-22 21:54:10.710 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933044162924544[0;39m <==    Columns: count(0)
2022-04-22 21:54:10.710 TRACE c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :143  [32m172933044162924544[0;39m <==        Row: 1
2022-04-22 21:54:10.711 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample_COUNT :137  [32m172933044162924544[0;39m <==      Total: 1
2022-04-22 21:54:10.711 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172933044162924544[0;39m ==>  Preparing: select id, `name`, category1_id, category2_id, description, cover, doc_count, view_count, vote_count from ebook WHERE ( category2_id = ? ) LIMIT ?
2022-04-22 21:54:10.712 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172933044162924544[0;39m ==> Parameters: 202(Long), 1000(Integer)
2022-04-22 21:54:10.728 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172933044162924544[0;39m <==    Columns: id, name, category1_id, category2_id, description, cover, doc_count, view_count, vote_count
2022-04-22 21:54:10.729 TRACE c.a.wiki.mapper.EbookMapper.selectByExample       :143  [32m172933044162924544[0;39m <==        Row: 1, SpringBoot Tutorial, 200, 202, Introduce how to create a SpringBoot project, null, 6, 69, 5
2022-04-22 21:54:10.729 DEBUG c.a.wiki.mapper.EbookMapper.selectByExample       :137  [32m172933044162924544[0;39m <==      Total: 1
2022-04-22 21:54:10.730 INFO  com.ameliawiki.wiki.service.EbookService          :46   [32m172933044162924544[0;39m total rows：1
2022-04-22 21:54:10.730 INFO  com.ameliawiki.wiki.service.EbookService          :47   [32m172933044162924544[0;39m total pages：1
2022-04-22 21:54:10.730 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933044162924544[0;39m 返回结果: {"content":{"list":[{"category1Id":200,"category2Id":202,"description":"Introduce how to create a SpringBoot project","docCount":6,"id":1,"name":"SpringBoot Tutorial","viewCount":69,"voteCount":5}],"total":1},"success":true}
2022-04-22 21:54:10.731 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933044162924544[0;39m ------------- 结束 耗时：62 ms -------------
2022-04-22 21:54:12.273 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933050890588160[0;39m ------------- 开始 -------------
2022-04-22 21:54:12.273 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933050890588160[0;39m 请求地址: http://127.0.0.1:8080/doc/all/1 GET
2022-04-22 21:54:12.274 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933050890588160[0;39m 类名方法: com.ameliawiki.wiki.controller.DocController.all
2022-04-22 21:54:12.274 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933050890588160[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:12.274 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933050890588160[0;39m 请求参数: [1]
2022-04-22 21:54:12.298 DEBUG c.ameliawiki.wiki.mapper.DocMapper.selectByExample:137  [32m172933050890588160[0;39m ==>  Preparing: select id, ebook_id, parent, `name`, sort, view_count, vote_count from doc WHERE ( ebook_id = ? ) order by sort asc
2022-04-22 21:54:12.299 DEBUG c.ameliawiki.wiki.mapper.DocMapper.selectByExample:137  [32m172933050890588160[0;39m ==> Parameters: 1(Long)
2022-04-22 21:54:12.320 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==    Columns: id, ebook_id, parent, name, sort, view_count, vote_count
2022-04-22 21:54:12.321 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==        Row: 1, 1, 0, Spring Boot, 1, 20, 1
2022-04-22 21:54:12.321 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==        Row: 2, 1, 1, Introduction, 1, 17, 1
2022-04-22 21:54:12.322 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==        Row: 4, 1, 3, Spring Cloud, 1, 14, 1
2022-04-22 21:54:12.322 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==        Row: 6, 1, 5, video, 1, 11, 1
2022-04-22 21:54:12.322 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==        Row: 3, 1, 0, Learn, 2, 3, 0
2022-04-22 21:54:12.323 TRACE c.ameliawiki.wiki.mapper.DocMapper.selectByExample:143  [32m172933050890588160[0;39m <==        Row: 5, 1, 3, Video, 2, 4, 1
2022-04-22 21:54:12.323 DEBUG c.ameliawiki.wiki.mapper.DocMapper.selectByExample:137  [32m172933050890588160[0;39m <==      Total: 6
2022-04-22 21:54:12.324 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933050890588160[0;39m 返回结果: {"content":[{"ebookId":1,"id":1,"name":"Spring Boot","parent":0,"sort":1,"viewCount":20,"voteCount":1},{"ebookId":1,"id":2,"name":"Introduction","parent":1,"sort":1,"viewCount":17,"voteCount":1},{"ebookId":1,"id":4,"name":"Spring Cloud","parent":3,"sort":1,"viewCount":14,"voteCount":1},{"ebookId":1,"id":6,"name":"video","parent":5,"sort":1,"viewCount":11,"voteCount":1},{"ebookId":1,"id":3,"name":"Learn","parent":0,"sort":2,"viewCount":3,"voteCount":0},{"ebookId":1,"id":5,"name":"Video","parent":3,"sort":2,"viewCount":4,"voteCount":1}],"success":true}
2022-04-22 21:54:12.324 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933050890588160[0;39m ------------- 结束 耗时：51 ms -------------
2022-04-22 21:54:12.357 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933051242909696[0;39m ------------- 开始 -------------
2022-04-22 21:54:12.357 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933051242909696[0;39m 请求地址: http://127.0.0.1:8080/doc/find-content/1 GET
2022-04-22 21:54:12.357 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933051242909696[0;39m 类名方法: com.ameliawiki.wiki.controller.DocController.findContent
2022-04-22 21:54:12.358 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933051242909696[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:12.358 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933051242909696[0;39m 请求参数: [1]
2022-04-22 21:54:12.372 DEBUG c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :137  [32m172933051242909696[0;39m ==>  Preparing: select id , content from content where id = ?
2022-04-22 21:54:12.372 DEBUG c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :137  [32m172933051242909696[0;39m ==> Parameters: 1(Long)
2022-04-22 21:54:12.396 TRACE c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :143  [32m172933051242909696[0;39m <==    Columns: id, content
2022-04-22 21:54:12.396 TRACE c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :143  [32m172933051242909696[0;39m <==        Row: 1, <<BLOB>>
2022-04-22 21:54:12.397 DEBUG c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :137  [32m172933051242909696[0;39m <==      Total: 1
2022-04-22 21:54:12.399 DEBUG c.a.wiki.mapper.DocMapperCust.increaseViewCount   :137  [32m172933051242909696[0;39m ==>  Preparing: update doc set view_count = view_count + 1 where id = ?
2022-04-22 21:54:12.400 DEBUG c.a.wiki.mapper.DocMapperCust.increaseViewCount   :137  [32m172933051242909696[0;39m ==> Parameters: 1(Long)
2022-04-22 21:54:12.432 DEBUG c.a.wiki.mapper.DocMapperCust.increaseViewCount   :137  [32m172933051242909696[0;39m <==    Updates: 1
2022-04-22 21:54:12.432 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933051242909696[0;39m 返回结果: {"content":"","success":true}
2022-04-22 21:54:12.433 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933051242909696[0;39m ------------- 结束 耗时：76 ms -------------
2022-04-22 21:54:14.388 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933059761541120[0;39m ------------- 开始 -------------
2022-04-22 21:54:14.388 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933059761541120[0;39m 请求地址: http://127.0.0.1:8080/doc/vote/1 GET
2022-04-22 21:54:14.389 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933059761541120[0;39m 类名方法: com.ameliawiki.wiki.controller.DocController.vote
2022-04-22 21:54:14.389 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933059761541120[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:14.389 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933059761541120[0;39m 请求参数: [1]
2022-04-22 21:54:14.572 INFO  com.ameliawiki.wiki.util.RedisUtil                :30   [32m172933059761541120[0;39m key not exist，put：DOC_VOTE1_127.0.0.1，outdated 86400 secs
2022-04-22 21:54:14.768 DEBUG c.a.wiki.mapper.DocMapperCust.increaseVoteCount   :137  [32m172933059761541120[0;39m ==>  Preparing: update doc set vote_count = vote_count + 1 where id = ?
2022-04-22 21:54:14.768 DEBUG c.a.wiki.mapper.DocMapperCust.increaseVoteCount   :137  [32m172933059761541120[0;39m ==> Parameters: 1(Long)
2022-04-22 21:54:14.805 DEBUG c.a.wiki.mapper.DocMapperCust.increaseVoteCount   :137  [32m172933059761541120[0;39m <==    Updates: 1
2022-04-22 21:54:14.806 DEBUG c.a.wiki.mapper.DocMapper.selectByPrimaryKey      :137  [32m172933059761541120[0;39m ==>  Preparing: select id, ebook_id, parent, `name`, sort, view_count, vote_count from doc where id = ?
2022-04-22 21:54:14.806 DEBUG c.a.wiki.mapper.DocMapper.selectByPrimaryKey      :137  [32m172933059761541120[0;39m ==> Parameters: 1(Long)
2022-04-22 21:54:14.827 TRACE c.a.wiki.mapper.DocMapper.selectByPrimaryKey      :143  [32m172933059761541120[0;39m <==    Columns: id, ebook_id, parent, name, sort, view_count, vote_count
2022-04-22 21:54:14.828 TRACE c.a.wiki.mapper.DocMapper.selectByPrimaryKey      :143  [32m172933059761541120[0;39m <==        Row: 1, 1, 0, Spring Boot, 1, 21, 2
2022-04-22 21:54:14.829 DEBUG c.a.wiki.mapper.DocMapper.selectByPrimaryKey      :137  [32m172933059761541120[0;39m <==      Total: 1
2022-04-22 21:54:14.832 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933059761541120[0;39m 返回结果: {"success":true}
2022-04-22 21:54:14.832 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933059761541120[0;39m ------------- 结束 耗时：444 ms -------------
2022-04-22 21:54:14.835 INFO  com.ameliawiki.wiki.websocket.WebSocketServer     :71   [32m172933059761541120[0;39m 推送消息：7j8OKFowik，内容：Spring Boot is liked!
2022-04-22 21:54:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933062336843776[0;39m 生成今日电子书快照开始
2022-04-22 21:54:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933062336843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933062336843776[0;39m ==> Parameters: 
2022-04-22 21:54:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933062336843776[0;39m <==    Updates: 0
2022-04-22 21:54:15.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933062336843776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:54:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933083308363776[0;39m 生成今日电子书快照开始
2022-04-22 21:54:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933083308363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933083308363776[0;39m ==> Parameters: 
2022-04-22 21:54:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933083308363776[0;39m <==    Updates: 0
2022-04-22 21:54:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933083308363776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:54:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933104288272384[0;39m 生成今日电子书快照开始
2022-04-22 21:54:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933104288272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933104288272384[0;39m ==> Parameters: 
2022-04-22 21:54:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933104288272384[0;39m <==    Updates: 0
2022-04-22 21:54:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933104288272384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:54:29.193 INFO  com.ameliawiki.wiki.aspect.LogAspect              :51   [32m172933121858211840[0;39m ------------- 开始 -------------
2022-04-22 21:54:29.193 INFO  com.ameliawiki.wiki.aspect.LogAspect              :52   [32m172933121858211840[0;39m 请求地址: http://127.0.0.1:8080/doc/find-content/2 GET
2022-04-22 21:54:29.193 INFO  com.ameliawiki.wiki.aspect.LogAspect              :53   [32m172933121858211840[0;39m 类名方法: com.ameliawiki.wiki.controller.DocController.findContent
2022-04-22 21:54:29.193 INFO  com.ameliawiki.wiki.aspect.LogAspect              :54   [32m172933121858211840[0;39m 远程地址: 127.0.0.1
2022-04-22 21:54:29.193 INFO  com.ameliawiki.wiki.aspect.LogAspect              :76   [32m172933121858211840[0;39m 请求参数: [2]
2022-04-22 21:54:29.216 DEBUG c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :137  [32m172933121858211840[0;39m ==>  Preparing: select id , content from content where id = ?
2022-04-22 21:54:29.217 DEBUG c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :137  [32m172933121858211840[0;39m ==> Parameters: 2(Long)
2022-04-22 21:54:29.234 TRACE c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :143  [32m172933121858211840[0;39m <==    Columns: id, content
2022-04-22 21:54:29.235 TRACE c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :143  [32m172933121858211840[0;39m <==        Row: 2, <<BLOB>>
2022-04-22 21:54:29.235 DEBUG c.a.wiki.mapper.ContentMapper.selectByPrimaryKey  :137  [32m172933121858211840[0;39m <==      Total: 1
2022-04-22 21:54:29.236 DEBUG c.a.wiki.mapper.DocMapperCust.increaseViewCount   :137  [32m172933121858211840[0;39m ==>  Preparing: update doc set view_count = view_count + 1 where id = ?
2022-04-22 21:54:29.236 DEBUG c.a.wiki.mapper.DocMapperCust.increaseViewCount   :137  [32m172933121858211840[0;39m ==> Parameters: 2(Long)
2022-04-22 21:54:29.270 DEBUG c.a.wiki.mapper.DocMapperCust.increaseViewCount   :137  [32m172933121858211840[0;39m <==    Updates: 1
2022-04-22 21:54:29.271 INFO  com.ameliawiki.wiki.aspect.LogAspect              :89   [32m172933121858211840[0;39m 返回结果: {"content":"<p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can \"just run\".</p><p>We take an opinionated view of the Spring platform and third-party libraries so you can get started with minimum fuss. Most Spring Boot applications need minimal Spring configuration.</p><p>If you’re looking for information about a specific version, or instructions about how to upgrade from an earlier release, check out&nbsp;<a href=\"https://github.com/spring-projects/spring-boot/wiki#release-notes\">the project release notes section</a>&nbsp;on our wiki.</p><h2>Features</h2><ul><li><p>Create stand-alone Spring applications</p></li><li><p>Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files)</p></li><li><p>Provide opinionated 'starter' dependencies to simplify your build configuration</p></li><li><p>Automatically configure Spring and 3rd party libraries whenever possible</p></li><li><p>Provide production-ready features such as metrics, health checks, and externalized configuration</p></li><li><p>Absolutely no code generation and no requirement for XML configuration</p></li></ul><h2>Getting Started</h2><ul><li><p>Super quick — try the&nbsp;<a href=\"https://spring.io/quickstart\">Quickstart Guide</a>.</p></li><li><p>More general — try&nbsp;<a href=\"https://spring.io/guides/gs/spring-boot/\">Building an Application with Spring Boot</a></p></li><li><p>More specific — try&nbsp;<a href=\"https://spring.io/guides/gs/rest-service/\">Building a RESTful Web Service</a>.</p></li><li><p>Or search through all our guides on the&nbsp;<a href=\"https://spring.io/guides\">Guides</a>&nbsp;homepage.</p></li></ul><h2>Talks and videos</h2><ul><li><p><a href=\"https://content.pivotal.io/springone-platform-2017/its-a-kind-of-magic-under-the-covers-of-spring-boot-brian-clozel-st%C3%A9phane-nicoll\">It’s a Kind of Magic: Under the Covers of Spring Boot</a></p></li><li><p><a href=\"https://content.pivotal.io/springone-platform-2017/whats-new-in-spring-boot-2-0-phillip-webb-madhura-bhave\">What’s New in Spring Boot 2.0</a></p></li><li><p><a href=\"https://content.pivotal.io/webinars/mar-13-introducing-spring-boot-2-0-webinar\">Introducing Spring Boot 2.0 webinar</a></p></li><li><p><a href=\"https://content.pivotal.io/springone-platform-2017/test-driven-development-with-spring-boot-sannidhi-jalukar-madhura-bhave\">Test Driven Development with Spring Boot</a></p></li><li><p><a href=\"https://content.pivotal.io/springone-platform-2017/from-zero-to-hero-with-spring-boot-brian-clozel\">From Zero to Hero with Spring Boot 2.0</a></p></li></ul><p></p><p>You can also join the&nbsp;<a href=\"https://gitter.im/spring-projects/spring-boot\">Spring Boot community on Gitter</a>!</p>","success":true}
2022-04-22 21:54:29.271 INFO  com.ameliawiki.wiki.aspect.LogAspect              :90   [32m172933121858211840[0;39m ------------- 结束 耗时：78 ms -------------
2022-04-22 21:54:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933125251403776[0;39m 生成今日电子书快照开始
2022-04-22 21:54:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933125251403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933125251403776[0;39m ==> Parameters: 
2022-04-22 21:54:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933125251403776[0;39m <==    Updates: 0
2022-04-22 21:54:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933125251403776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:54:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933146231312384[0;39m start updating Ebook doc
2022-04-22 21:54:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933146231312384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:54:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933146231312384[0;39m ==> Parameters: 
2022-04-22 21:54:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933146231312384[0;39m <==    Updates: 1
2022-04-22 21:54:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933146231312384[0;39m update ends, take 58 millisecs
2022-04-22 21:54:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933146478776320[0;39m 生成今日电子书快照开始
2022-04-22 21:54:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933146478776320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933146478776320[0;39m ==> Parameters: 
2022-04-22 21:54:35.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933146478776320[0;39m <==    Updates: 0
2022-04-22 21:54:35.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933146478776320[0;39m 生成今日电子书快照结束，耗时：34毫秒
2022-04-22 21:54:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933167202832384[0;39m 生成今日电子书快照开始
2022-04-22 21:54:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933167202832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933167202832384[0;39m ==> Parameters: 
2022-04-22 21:54:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933167202832384[0;39m <==    Updates: 0
2022-04-22 21:54:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933167202832384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:54:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933188165963776[0;39m 生成今日电子书快照开始
2022-04-22 21:54:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933188165963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933188165963776[0;39m ==> Parameters: 
2022-04-22 21:54:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933188165963776[0;39m <==    Updates: 0
2022-04-22 21:54:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933188165963776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:54:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933209141678080[0;39m 生成今日电子书快照开始
2022-04-22 21:54:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933209141678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933209141678080[0;39m ==> Parameters: 
2022-04-22 21:54:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933209141678080[0;39m <==    Updates: 0
2022-04-22 21:54:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933209141678080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:54:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933230109003776[0;39m 生成今日电子书快照开始
2022-04-22 21:54:55.174 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933230109003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:54:55.175 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933230109003776[0;39m ==> Parameters: 
2022-04-22 21:54:55.211 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933230109003776[0;39m <==    Updates: 0
2022-04-22 21:54:55.211 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933230109003776[0;39m 生成今日电子书快照结束，耗时：208毫秒
2022-04-22 21:55:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933251093106688[0;39m 生成今日电子书快照开始
2022-04-22 21:55:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933251093106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933251093106688[0;39m ==> Parameters: 
2022-04-22 21:55:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933251093106688[0;39m <==    Updates: 0
2022-04-22 21:55:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933251093106688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:55:05.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933272043655168[0;39m 生成今日电子书快照开始
2022-04-22 21:55:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933272043655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933272043655168[0;39m ==> Parameters: 
2022-04-22 21:55:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933272043655168[0;39m <==    Updates: 0
2022-04-22 21:55:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933272043655168[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 21:55:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933272324673536[0;39m start updating Ebook doc
2022-04-22 21:55:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933272324673536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:55:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933272324673536[0;39m ==> Parameters: 
2022-04-22 21:55:05.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933272324673536[0;39m <==    Updates: 1
2022-04-22 21:55:05.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933272324673536[0;39m update ends, take 42 millisecs
2022-04-22 21:55:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933293027758080[0;39m 生成今日电子书快照开始
2022-04-22 21:55:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933293027758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933293027758080[0;39m ==> Parameters: 
2022-04-22 21:55:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933293027758080[0;39m <==    Updates: 0
2022-04-22 21:55:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933293027758080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:55:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933313995083776[0;39m 生成今日电子书快照开始
2022-04-22 21:55:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933313995083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933313995083776[0;39m ==> Parameters: 
2022-04-22 21:55:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933313995083776[0;39m <==    Updates: 0
2022-04-22 21:55:15.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933313995083776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:55:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933334974992384[0;39m 生成今日电子书快照开始
2022-04-22 21:55:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933334974992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933334974992384[0;39m ==> Parameters: 
2022-04-22 21:55:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933334974992384[0;39m <==    Updates: 0
2022-04-22 21:55:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933334974992384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:55:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933355938123776[0;39m 生成今日电子书快照开始
2022-04-22 21:55:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933355938123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933355938123776[0;39m ==> Parameters: 
2022-04-22 21:55:25.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933355938123776[0;39m <==    Updates: 0
2022-04-22 21:55:25.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933355938123776[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 21:55:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933376905449472[0;39m 生成今日电子书快照开始
2022-04-22 21:55:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933376905449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933376905449472[0;39m ==> Parameters: 
2022-04-22 21:55:30.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933376905449472[0;39m <==    Updates: 0
2022-04-22 21:55:30.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933376905449472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 21:55:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933397881163776[0;39m 生成今日电子书快照开始
2022-04-22 21:55:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933397881163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933397881163776[0;39m ==> Parameters: 
2022-04-22 21:55:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933397881163776[0;39m <==    Updates: 0
2022-04-22 21:55:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933397881163776[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 21:55:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933398099267584[0;39m start updating Ebook doc
2022-04-22 21:55:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933398099267584[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:55:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933398099267584[0;39m ==> Parameters: 
2022-04-22 21:55:35.089 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933398099267584[0;39m <==    Updates: 1
2022-04-22 21:55:35.090 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933398099267584[0;39m update ends, take 36 millisecs
2022-04-22 21:55:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933418852683776[0;39m 生成今日电子书快照开始
2022-04-22 21:55:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933418852683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933418852683776[0;39m ==> Parameters: 
2022-04-22 21:55:40.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933418852683776[0;39m <==    Updates: 0
2022-04-22 21:55:40.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933418852683776[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 21:55:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933439836786688[0;39m 生成今日电子书快照开始
2022-04-22 21:55:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933439836786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933439836786688[0;39m ==> Parameters: 
2022-04-22 21:55:45.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933439836786688[0;39m <==    Updates: 0
2022-04-22 21:55:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933439836786688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:55:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933460795723776[0;39m 生成今日电子书快照开始
2022-04-22 21:55:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933460795723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933460795723776[0;39m ==> Parameters: 
2022-04-22 21:55:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933460795723776[0;39m <==    Updates: 0
2022-04-22 21:55:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933460795723776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:55:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933481767243776[0;39m 生成今日电子书快照开始
2022-04-22 21:55:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933481767243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:55:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933481767243776[0;39m ==> Parameters: 
2022-04-22 21:55:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933481767243776[0;39m <==    Updates: 0
2022-04-22 21:55:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933481767243776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:56:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933502738763776[0;39m 生成今日电子书快照开始
2022-04-22 21:56:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933502738763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933502738763776[0;39m ==> Parameters: 
2022-04-22 21:56:00.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933502738763776[0;39m <==    Updates: 0
2022-04-22 21:56:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933502738763776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:56:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933523714478080[0;39m start updating Ebook doc
2022-04-22 21:56:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933523714478080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:56:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933523714478080[0;39m ==> Parameters: 
2022-04-22 21:56:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933523714478080[0;39m <==    Updates: 1
2022-04-22 21:56:05.056 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933523714478080[0;39m update ends, take 53 millisecs
2022-04-22 21:56:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933523940970496[0;39m 生成今日电子书快照开始
2022-04-22 21:56:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933523940970496[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933523940970496[0;39m ==> Parameters: 
2022-04-22 21:56:05.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933523940970496[0;39m <==    Updates: 0
2022-04-22 21:56:05.093 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933523940970496[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-22 21:56:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933544685998080[0;39m 生成今日电子书快照开始
2022-04-22 21:56:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933544685998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933544685998080[0;39m ==> Parameters: 
2022-04-22 21:56:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933544685998080[0;39m <==    Updates: 0
2022-04-22 21:56:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933544685998080[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 21:56:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933565657518080[0;39m 生成今日电子书快照开始
2022-04-22 21:56:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933565657518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933565657518080[0;39m ==> Parameters: 
2022-04-22 21:56:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933565657518080[0;39m <==    Updates: 0
2022-04-22 21:56:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933565657518080[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 21:56:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933586629038080[0;39m 生成今日电子书快照开始
2022-04-22 21:56:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933586629038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933586629038080[0;39m ==> Parameters: 
2022-04-22 21:56:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933586629038080[0;39m <==    Updates: 0
2022-04-22 21:56:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933586629038080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:56:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933607600558080[0;39m 生成今日电子书快照开始
2022-04-22 21:56:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933607600558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933607600558080[0;39m ==> Parameters: 
2022-04-22 21:56:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933607600558080[0;39m <==    Updates: 0
2022-04-22 21:56:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933607600558080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:56:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933628580466688[0;39m 生成今日电子书快照开始
2022-04-22 21:56:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933628580466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933628580466688[0;39m ==> Parameters: 
2022-04-22 21:56:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933628580466688[0;39m <==    Updates: 0
2022-04-22 21:56:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933628580466688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:56:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933649543598080[0;39m 生成今日电子书快照开始
2022-04-22 21:56:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933649543598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933649543598080[0;39m ==> Parameters: 
2022-04-22 21:56:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933649543598080[0;39m <==    Updates: 0
2022-04-22 21:56:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933649543598080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 21:56:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933649757507584[0;39m start updating Ebook doc
2022-04-22 21:56:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933649757507584[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:56:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933649757507584[0;39m ==> Parameters: 
2022-04-22 21:56:35.087 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933649757507584[0;39m <==    Updates: 1
2022-04-22 21:56:35.087 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933649757507584[0;39m update ends, take 32 millisecs
2022-04-22 21:56:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933670519312384[0;39m 生成今日电子书快照开始
2022-04-22 21:56:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933670519312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933670519312384[0;39m ==> Parameters: 
2022-04-22 21:56:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933670519312384[0;39m <==    Updates: 0
2022-04-22 21:56:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933670519312384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:56:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933691482443776[0;39m 生成今日电子书快照开始
2022-04-22 21:56:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933691482443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933691482443776[0;39m ==> Parameters: 
2022-04-22 21:56:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933691482443776[0;39m <==    Updates: 0
2022-04-22 21:56:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933691482443776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:56:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933712453963776[0;39m 生成今日电子书快照开始
2022-04-22 21:56:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933712453963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933712453963776[0;39m ==> Parameters: 
2022-04-22 21:56:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933712453963776[0;39m <==    Updates: 0
2022-04-22 21:56:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933712453963776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:56:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933733429678080[0;39m 生成今日电子书快照开始
2022-04-22 21:56:55.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933733429678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:56:55.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933733429678080[0;39m ==> Parameters: 
2022-04-22 21:56:55.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933733429678080[0;39m <==    Updates: 0
2022-04-22 21:56:55.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933733429678080[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 21:57:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933754409586688[0;39m 生成今日电子书快照开始
2022-04-22 21:57:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933754409586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933754409586688[0;39m ==> Parameters: 
2022-04-22 21:57:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933754409586688[0;39m <==    Updates: 0
2022-04-22 21:57:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933754409586688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:57:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933775372718080[0;39m 生成今日电子书快照开始
2022-04-22 21:57:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933775372718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933775372718080[0;39m ==> Parameters: 
2022-04-22 21:57:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933775372718080[0;39m <==    Updates: 0
2022-04-22 21:57:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933775372718080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:57:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933775636959232[0;39m start updating Ebook doc
2022-04-22 21:57:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933775636959232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:57:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933775636959232[0;39m ==> Parameters: 
2022-04-22 21:57:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933775636959232[0;39m <==    Updates: 1
2022-04-22 21:57:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933775636959232[0;39m update ends, take 36 millisecs
2022-04-22 21:57:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933796348432384[0;39m 生成今日电子书快照开始
2022-04-22 21:57:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933796348432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933796348432384[0;39m ==> Parameters: 
2022-04-22 21:57:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933796348432384[0;39m <==    Updates: 0
2022-04-22 21:57:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933796348432384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:57:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933817315758080[0;39m 生成今日电子书快照开始
2022-04-22 21:57:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933817315758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933817315758080[0;39m ==> Parameters: 
2022-04-22 21:57:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933817315758080[0;39m <==    Updates: 0
2022-04-22 21:57:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933817315758080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:57:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933838295666688[0;39m 生成今日电子书快照开始
2022-04-22 21:57:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933838295666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933838295666688[0;39m ==> Parameters: 
2022-04-22 21:57:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933838295666688[0;39m <==    Updates: 0
2022-04-22 21:57:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933838295666688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 21:57:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933859250409472[0;39m 生成今日电子书快照开始
2022-04-22 21:57:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933859250409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933859250409472[0;39m ==> Parameters: 
2022-04-22 21:57:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933859250409472[0;39m <==    Updates: 0
2022-04-22 21:57:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933859250409472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 21:57:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933880234512384[0;39m 生成今日电子书快照开始
2022-04-22 21:57:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933880234512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933880234512384[0;39m ==> Parameters: 
2022-04-22 21:57:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933880234512384[0;39m <==    Updates: 0
2022-04-22 21:57:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933880234512384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:57:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172933901197643776[0;39m start updating Ebook doc
2022-04-22 21:57:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933901197643776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:57:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933901197643776[0;39m ==> Parameters: 
2022-04-22 21:57:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172933901197643776[0;39m <==    Updates: 1
2022-04-22 21:57:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172933901197643776[0;39m update ends, take 59 millisecs
2022-04-22 21:57:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933901445107712[0;39m 生成今日电子书快照开始
2022-04-22 21:57:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933901445107712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933901445107712[0;39m ==> Parameters: 
2022-04-22 21:57:35.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933901445107712[0;39m <==    Updates: 0
2022-04-22 21:57:35.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933901445107712[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 21:57:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933922181746688[0;39m 生成今日电子书快照开始
2022-04-22 21:57:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933922181746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933922181746688[0;39m ==> Parameters: 
2022-04-22 21:57:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933922181746688[0;39m <==    Updates: 0
2022-04-22 21:57:40.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933922181746688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 21:57:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933943136489472[0;39m 生成今日电子书快照开始
2022-04-22 21:57:45.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933943136489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:45.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933943136489472[0;39m ==> Parameters: 
2022-04-22 21:57:45.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933943136489472[0;39m <==    Updates: 0
2022-04-22 21:57:45.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933943136489472[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 21:57:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933964124786688[0;39m 生成今日电子书快照开始
2022-04-22 21:57:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933964124786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933964124786688[0;39m ==> Parameters: 
2022-04-22 21:57:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933964124786688[0;39m <==    Updates: 0
2022-04-22 21:57:50.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933964124786688[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 21:57:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172933985087918080[0;39m 生成今日电子书快照开始
2022-04-22 21:57:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933985087918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:57:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933985087918080[0;39m ==> Parameters: 
2022-04-22 21:57:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172933985087918080[0;39m <==    Updates: 0
2022-04-22 21:57:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172933985087918080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 21:58:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934006055243776[0;39m 生成今日电子书快照开始
2022-04-22 21:58:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934006055243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934006055243776[0;39m ==> Parameters: 
2022-04-22 21:58:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934006055243776[0;39m <==    Updates: 0
2022-04-22 21:58:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934006055243776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 21:58:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934027035152384[0;39m start updating Ebook doc
2022-04-22 21:58:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934027035152384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:58:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934027035152384[0;39m ==> Parameters: 
2022-04-22 21:58:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934027035152384[0;39m <==    Updates: 1
2022-04-22 21:58:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934027035152384[0;39m update ends, take 61 millisecs
2022-04-22 21:58:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934027299393536[0;39m 生成今日电子书快照开始
2022-04-22 21:58:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934027299393536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934027299393536[0;39m ==> Parameters: 
2022-04-22 21:58:05.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934027299393536[0;39m <==    Updates: 0
2022-04-22 21:58:05.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934027299393536[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-22 21:58:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934047994089472[0;39m 生成今日电子书快照开始
2022-04-22 21:58:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934047994089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934047994089472[0;39m ==> Parameters: 
2022-04-22 21:58:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934047994089472[0;39m <==    Updates: 0
2022-04-22 21:58:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934047994089472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:58:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934068982386688[0;39m 生成今日电子书快照开始
2022-04-22 21:58:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934068982386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934068982386688[0;39m ==> Parameters: 
2022-04-22 21:58:15.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934068982386688[0;39m <==    Updates: 0
2022-04-22 21:58:15.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934068982386688[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 21:58:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934089937129472[0;39m 生成今日电子书快照开始
2022-04-22 21:58:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934089937129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934089937129472[0;39m ==> Parameters: 
2022-04-22 21:58:20.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934089937129472[0;39m <==    Updates: 0
2022-04-22 21:58:20.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934089937129472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:58:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934110917038080[0;39m 生成今日电子书快照开始
2022-04-22 21:58:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934110917038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934110917038080[0;39m ==> Parameters: 
2022-04-22 21:58:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934110917038080[0;39m <==    Updates: 0
2022-04-22 21:58:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934110917038080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:58:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934131888558080[0;39m 生成今日电子书快照开始
2022-04-22 21:58:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934131888558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934131888558080[0;39m ==> Parameters: 
2022-04-22 21:58:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934131888558080[0;39m <==    Updates: 0
2022-04-22 21:58:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934131888558080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 21:58:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934152868466688[0;39m 生成今日电子书快照开始
2022-04-22 21:58:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934152868466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934152868466688[0;39m ==> Parameters: 
2022-04-22 21:58:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934152868466688[0;39m <==    Updates: 0
2022-04-22 21:58:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934152868466688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 21:58:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934153141096448[0;39m start updating Ebook doc
2022-04-22 21:58:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934153141096448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:58:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934153141096448[0;39m ==> Parameters: 
2022-04-22 21:58:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934153141096448[0;39m <==    Updates: 1
2022-04-22 21:58:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934153141096448[0;39m update ends, take 38 millisecs
2022-04-22 21:58:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934173827403776[0;39m 生成今日电子书快照开始
2022-04-22 21:58:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934173827403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934173827403776[0;39m ==> Parameters: 
2022-04-22 21:58:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934173827403776[0;39m <==    Updates: 0
2022-04-22 21:58:40.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934173827403776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 21:58:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934194803118080[0;39m 生成今日电子书快照开始
2022-04-22 21:58:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934194803118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934194803118080[0;39m ==> Parameters: 
2022-04-22 21:58:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934194803118080[0;39m <==    Updates: 0
2022-04-22 21:58:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934194803118080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:58:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934215766249472[0;39m 生成今日电子书快照开始
2022-04-22 21:58:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934215766249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934215766249472[0;39m ==> Parameters: 
2022-04-22 21:58:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934215766249472[0;39m <==    Updates: 0
2022-04-22 21:58:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934215766249472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:58:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934236737769472[0;39m 生成今日电子书快照开始
2022-04-22 21:58:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934236737769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:58:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934236737769472[0;39m ==> Parameters: 
2022-04-22 21:58:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934236737769472[0;39m <==    Updates: 0
2022-04-22 21:58:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934236737769472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 21:59:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934257721872384[0;39m 生成今日电子书快照开始
2022-04-22 21:59:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934257721872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934257721872384[0;39m ==> Parameters: 
2022-04-22 21:59:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934257721872384[0;39m <==    Updates: 0
2022-04-22 21:59:00.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934257721872384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 21:59:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934278685003776[0;39m 生成今日电子书快照开始
2022-04-22 21:59:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934278685003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934278685003776[0;39m ==> Parameters: 
2022-04-22 21:59:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934278685003776[0;39m <==    Updates: 0
2022-04-22 21:59:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934278685003776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 21:59:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934278928273408[0;39m start updating Ebook doc
2022-04-22 21:59:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934278928273408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:59:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934278928273408[0;39m ==> Parameters: 
2022-04-22 21:59:05.094 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934278928273408[0;39m <==    Updates: 1
2022-04-22 21:59:05.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934278928273408[0;39m update ends, take 34 millisecs
2022-04-22 21:59:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934299652329472[0;39m 生成今日电子书快照开始
2022-04-22 21:59:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934299652329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934299652329472[0;39m ==> Parameters: 
2022-04-22 21:59:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934299652329472[0;39m <==    Updates: 0
2022-04-22 21:59:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934299652329472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 21:59:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934320636432384[0;39m 生成今日电子书快照开始
2022-04-22 21:59:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934320636432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934320636432384[0;39m ==> Parameters: 
2022-04-22 21:59:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934320636432384[0;39m <==    Updates: 0
2022-04-22 21:59:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934320636432384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:59:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934341595369472[0;39m 生成今日电子书快照开始
2022-04-22 21:59:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934341595369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934341595369472[0;39m ==> Parameters: 
2022-04-22 21:59:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934341595369472[0;39m <==    Updates: 0
2022-04-22 21:59:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934341595369472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 21:59:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934362571083776[0;39m 生成今日电子书快照开始
2022-04-22 21:59:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934362571083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934362571083776[0;39m ==> Parameters: 
2022-04-22 21:59:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934362571083776[0;39m <==    Updates: 0
2022-04-22 21:59:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934362571083776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:59:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934383550992384[0;39m 生成今日电子书快照开始
2022-04-22 21:59:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934383550992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934383550992384[0;39m ==> Parameters: 
2022-04-22 21:59:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934383550992384[0;39m <==    Updates: 0
2022-04-22 21:59:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934383550992384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 21:59:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934404522512384[0;39m 生成今日电子书快照开始
2022-04-22 21:59:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934404522512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934404522512384[0;39m ==> Parameters: 
2022-04-22 21:59:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934404522512384[0;39m <==    Updates: 0
2022-04-22 21:59:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934404522512384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 21:59:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934404765782016[0;39m start updating Ebook doc
2022-04-22 21:59:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934404765782016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 21:59:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934404765782016[0;39m ==> Parameters: 
2022-04-22 21:59:35.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934404765782016[0;39m <==    Updates: 1
2022-04-22 21:59:35.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934404765782016[0;39m update ends, take 49 millisecs
2022-04-22 21:59:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934425481449472[0;39m 生成今日电子书快照开始
2022-04-22 21:59:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934425481449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934425481449472[0;39m ==> Parameters: 
2022-04-22 21:59:40.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934425481449472[0;39m <==    Updates: 0
2022-04-22 21:59:40.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934425481449472[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 21:59:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934446461358080[0;39m 生成今日电子书快照开始
2022-04-22 21:59:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934446461358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934446461358080[0;39m ==> Parameters: 
2022-04-22 21:59:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934446461358080[0;39m <==    Updates: 0
2022-04-22 21:59:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934446461358080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 21:59:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934467441266688[0;39m 生成今日电子书快照开始
2022-04-22 21:59:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934467441266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934467441266688[0;39m ==> Parameters: 
2022-04-22 21:59:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934467441266688[0;39m <==    Updates: 0
2022-04-22 21:59:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934467441266688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 21:59:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934488400203776[0;39m 生成今日电子书快照开始
2022-04-22 21:59:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934488400203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 21:59:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934488400203776[0;39m ==> Parameters: 
2022-04-22 21:59:55.288 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934488400203776[0;39m <==    Updates: 0
2022-04-22 21:59:55.288 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934488400203776[0;39m 生成今日电子书快照结束，耗时：285毫秒
2022-04-22 22:00:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934509380112384[0;39m 生成今日电子书快照开始
2022-04-22 22:00:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934509380112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934509380112384[0;39m ==> Parameters: 
2022-04-22 22:00:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934509380112384[0;39m <==    Updates: 0
2022-04-22 22:00:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934509380112384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:00:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934530343243776[0;39m 生成今日电子书快照开始
2022-04-22 22:00:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934530343243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934530343243776[0;39m ==> Parameters: 
2022-04-22 22:00:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934530343243776[0;39m <==    Updates: 0
2022-04-22 22:00:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934530343243776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:00:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934530632650752[0;39m start updating Ebook doc
2022-04-22 22:00:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934530632650752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:00:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934530632650752[0;39m ==> Parameters: 
2022-04-22 22:00:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934530632650752[0;39m <==    Updates: 1
2022-04-22 22:00:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934530632650752[0;39m update ends, take 32 millisecs
2022-04-22 22:00:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934551323152384[0;39m 生成今日电子书快照开始
2022-04-22 22:00:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934551323152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934551323152384[0;39m ==> Parameters: 
2022-04-22 22:00:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934551323152384[0;39m <==    Updates: 0
2022-04-22 22:00:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934551323152384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:00:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934572286283776[0;39m 生成今日电子书快照开始
2022-04-22 22:00:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934572286283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934572286283776[0;39m ==> Parameters: 
2022-04-22 22:00:15.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934572286283776[0;39m <==    Updates: 0
2022-04-22 22:00:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934572286283776[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:00:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934593261998080[0;39m 生成今日电子书快照开始
2022-04-22 22:00:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934593261998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934593261998080[0;39m ==> Parameters: 
2022-04-22 22:00:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934593261998080[0;39m <==    Updates: 0
2022-04-22 22:00:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934593261998080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:00:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934614233518080[0;39m 生成今日电子书快照开始
2022-04-22 22:00:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934614233518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934614233518080[0;39m ==> Parameters: 
2022-04-22 22:00:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934614233518080[0;39m <==    Updates: 0
2022-04-22 22:00:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934614233518080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:00:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934635205038080[0;39m 生成今日电子书快照开始
2022-04-22 22:00:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934635205038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934635205038080[0;39m ==> Parameters: 
2022-04-22 22:00:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934635205038080[0;39m <==    Updates: 0
2022-04-22 22:00:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934635205038080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:00:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934656180752384[0;39m 生成今日电子书快照开始
2022-04-22 22:00:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934656180752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934656180752384[0;39m ==> Parameters: 
2022-04-22 22:00:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934656180752384[0;39m <==    Updates: 0
2022-04-22 22:00:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934656180752384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:00:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934656449187840[0;39m start updating Ebook doc
2022-04-22 22:00:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934656449187840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:00:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934656449187840[0;39m ==> Parameters: 
2022-04-22 22:00:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934656449187840[0;39m <==    Updates: 1
2022-04-22 22:00:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934656449187840[0;39m update ends, take 40 millisecs
2022-04-22 22:00:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934677148078080[0;39m 生成今日电子书快照开始
2022-04-22 22:00:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934677148078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934677148078080[0;39m ==> Parameters: 
2022-04-22 22:00:40.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934677148078080[0;39m <==    Updates: 0
2022-04-22 22:00:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934677148078080[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 22:00:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934698119598080[0;39m 生成今日电子书快照开始
2022-04-22 22:00:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934698119598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934698119598080[0;39m ==> Parameters: 
2022-04-22 22:00:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934698119598080[0;39m <==    Updates: 0
2022-04-22 22:00:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934698119598080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:00:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934719091118080[0;39m 生成今日电子书快照开始
2022-04-22 22:00:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934719091118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934719091118080[0;39m ==> Parameters: 
2022-04-22 22:00:50.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934719091118080[0;39m <==    Updates: 0
2022-04-22 22:00:50.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934719091118080[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 22:00:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934740054249472[0;39m 生成今日电子书快照开始
2022-04-22 22:00:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934740054249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:00:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934740054249472[0;39m ==> Parameters: 
2022-04-22 22:00:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934740054249472[0;39m <==    Updates: 0
2022-04-22 22:00:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934740054249472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:01:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934761029963776[0;39m 生成今日电子书快照开始
2022-04-22 22:01:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934761029963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934761029963776[0;39m ==> Parameters: 
2022-04-22 22:01:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934761029963776[0;39m <==    Updates: 0
2022-04-22 22:01:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934761029963776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:01:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934782014066688[0;39m 生成今日电子书快照开始
2022-04-22 22:01:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934782014066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934782014066688[0;39m ==> Parameters: 
2022-04-22 22:01:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934782014066688[0;39m <==    Updates: 0
2022-04-22 22:01:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934782014066688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:01:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934782232170496[0;39m start updating Ebook doc
2022-04-22 22:01:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934782232170496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:01:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934782232170496[0;39m ==> Parameters: 
2022-04-22 22:01:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934782232170496[0;39m <==    Updates: 1
2022-04-22 22:01:05.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934782232170496[0;39m update ends, take 36 millisecs
2022-04-22 22:01:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934802977198080[0;39m 生成今日电子书快照开始
2022-04-22 22:01:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934802977198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934802977198080[0;39m ==> Parameters: 
2022-04-22 22:01:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934802977198080[0;39m <==    Updates: 0
2022-04-22 22:01:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934802977198080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:01:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934823940329472[0;39m 生成今日电子书快照开始
2022-04-22 22:01:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934823940329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934823940329472[0;39m ==> Parameters: 
2022-04-22 22:01:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934823940329472[0;39m <==    Updates: 0
2022-04-22 22:01:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934823940329472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:01:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934844916043776[0;39m 生成今日电子书快照开始
2022-04-22 22:01:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934844916043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934844916043776[0;39m ==> Parameters: 
2022-04-22 22:01:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934844916043776[0;39m <==    Updates: 0
2022-04-22 22:01:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934844916043776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:01:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934865891758080[0;39m 生成今日电子书快照开始
2022-04-22 22:01:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934865891758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934865891758080[0;39m ==> Parameters: 
2022-04-22 22:01:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934865891758080[0;39m <==    Updates: 0
2022-04-22 22:01:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934865891758080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:01:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934886867472384[0;39m 生成今日电子书快照开始
2022-04-22 22:01:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934886867472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934886867472384[0;39m ==> Parameters: 
2022-04-22 22:01:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934886867472384[0;39m <==    Updates: 0
2022-04-22 22:01:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934886867472384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:01:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934907822215168[0;39m 生成今日电子书快照开始
2022-04-22 22:01:35.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934907822215168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:35.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934907822215168[0;39m ==> Parameters: 
2022-04-22 22:01:35.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934907822215168[0;39m <==    Updates: 0
2022-04-22 22:01:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934907822215168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:01:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172934908065484800[0;39m start updating Ebook doc
2022-04-22 22:01:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934908065484800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:01:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934908065484800[0;39m ==> Parameters: 
2022-04-22 22:01:35.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172934908065484800[0;39m <==    Updates: 1
2022-04-22 22:01:35.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172934908065484800[0;39m update ends, take 39 millisecs
2022-04-22 22:01:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934928810512384[0;39m 生成今日电子书快照开始
2022-04-22 22:01:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934928810512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934928810512384[0;39m ==> Parameters: 
2022-04-22 22:01:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934928810512384[0;39m <==    Updates: 0
2022-04-22 22:01:40.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934928810512384[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 22:01:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934949782032384[0;39m 生成今日电子书快照开始
2022-04-22 22:01:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934949782032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934949782032384[0;39m ==> Parameters: 
2022-04-22 22:01:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934949782032384[0;39m <==    Updates: 0
2022-04-22 22:01:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934949782032384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:01:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934970753552384[0;39m 生成今日电子书快照开始
2022-04-22 22:01:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934970753552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934970753552384[0;39m ==> Parameters: 
2022-04-22 22:01:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934970753552384[0;39m <==    Updates: 0
2022-04-22 22:01:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934970753552384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:01:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172934991725072384[0;39m 生成今日电子书快照开始
2022-04-22 22:01:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934991725072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:01:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934991725072384[0;39m ==> Parameters: 
2022-04-22 22:01:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172934991725072384[0;39m <==    Updates: 0
2022-04-22 22:01:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172934991725072384[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:02:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935012684009472[0;39m 生成今日电子书快照开始
2022-04-22 22:02:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935012684009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935012684009472[0;39m ==> Parameters: 
2022-04-22 22:02:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935012684009472[0;39m <==    Updates: 0
2022-04-22 22:02:00.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935012684009472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:02:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935033668112384[0;39m 生成今日电子书快照开始
2022-04-22 22:02:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935033668112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935033668112384[0;39m ==> Parameters: 
2022-04-22 22:02:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935033668112384[0;39m <==    Updates: 0
2022-04-22 22:02:05.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935033668112384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:02:05.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935033974296576[0;39m start updating Ebook doc
2022-04-22 22:02:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935033974296576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:02:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935033974296576[0;39m ==> Parameters: 
2022-04-22 22:02:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935033974296576[0;39m <==    Updates: 1
2022-04-22 22:02:05.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935033974296576[0;39m update ends, take 35 millisecs
2022-04-22 22:02:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935054639632384[0;39m 生成今日电子书快照开始
2022-04-22 22:02:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935054639632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935054639632384[0;39m ==> Parameters: 
2022-04-22 22:02:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935054639632384[0;39m <==    Updates: 0
2022-04-22 22:02:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935054639632384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:02:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935075611152384[0;39m 生成今日电子书快照开始
2022-04-22 22:02:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935075611152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935075611152384[0;39m ==> Parameters: 
2022-04-22 22:02:15.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935075611152384[0;39m <==    Updates: 0
2022-04-22 22:02:15.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935075611152384[0;39m 生成今日电子书快照结束，耗时：86毫秒
2022-04-22 22:02:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935096582672384[0;39m 生成今日电子书快照开始
2022-04-22 22:02:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935096582672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935096582672384[0;39m ==> Parameters: 
2022-04-22 22:02:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935096582672384[0;39m <==    Updates: 0
2022-04-22 22:02:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935096582672384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:02:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935117554192384[0;39m 生成今日电子书快照开始
2022-04-22 22:02:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935117554192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935117554192384[0;39m ==> Parameters: 
2022-04-22 22:02:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935117554192384[0;39m <==    Updates: 0
2022-04-22 22:02:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935117554192384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:02:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935138529906688[0;39m 生成今日电子书快照开始
2022-04-22 22:02:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935138529906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935138529906688[0;39m ==> Parameters: 
2022-04-22 22:02:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935138529906688[0;39m <==    Updates: 0
2022-04-22 22:02:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935138529906688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:02:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935159484649472[0;39m 生成今日电子书快照开始
2022-04-22 22:02:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935159484649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935159484649472[0;39m ==> Parameters: 
2022-04-22 22:02:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935159484649472[0;39m <==    Updates: 0
2022-04-22 22:02:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935159484649472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:02:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935159761473536[0;39m start updating Ebook doc
2022-04-22 22:02:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935159761473536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:02:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935159761473536[0;39m ==> Parameters: 
2022-04-22 22:02:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935159761473536[0;39m <==    Updates: 1
2022-04-22 22:02:35.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935159761473536[0;39m update ends, take 38 millisecs
2022-04-22 22:02:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935180472946688[0;39m 生成今日电子书快照开始
2022-04-22 22:02:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935180472946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935180472946688[0;39m ==> Parameters: 
2022-04-22 22:02:40.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935180472946688[0;39m <==    Updates: 0
2022-04-22 22:02:40.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935180472946688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 22:02:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935201427689472[0;39m 生成今日电子书快照开始
2022-04-22 22:02:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935201427689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935201427689472[0;39m ==> Parameters: 
2022-04-22 22:02:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935201427689472[0;39m <==    Updates: 0
2022-04-22 22:02:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935201427689472[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:02:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935222415986688[0;39m 生成今日电子书快照开始
2022-04-22 22:02:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935222415986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935222415986688[0;39m ==> Parameters: 
2022-04-22 22:02:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935222415986688[0;39m <==    Updates: 0
2022-04-22 22:02:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935222415986688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:02:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935243370729472[0;39m 生成今日电子书快照开始
2022-04-22 22:02:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935243370729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:02:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935243370729472[0;39m ==> Parameters: 
2022-04-22 22:02:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935243370729472[0;39m <==    Updates: 0
2022-04-22 22:02:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935243370729472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:03:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935264359026688[0;39m 生成今日电子书快照开始
2022-04-22 22:03:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935264359026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935264359026688[0;39m ==> Parameters: 
2022-04-22 22:03:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935264359026688[0;39m <==    Updates: 0
2022-04-22 22:03:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935264359026688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:03:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935285330546688[0;39m 生成今日电子书快照开始
2022-04-22 22:03:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935285330546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935285330546688[0;39m ==> Parameters: 
2022-04-22 22:03:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935285330546688[0;39m <==    Updates: 0
2022-04-22 22:03:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935285330546688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:03:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935285611565056[0;39m start updating Ebook doc
2022-04-22 22:03:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935285611565056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:03:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935285611565056[0;39m ==> Parameters: 
2022-04-22 22:03:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935285611565056[0;39m <==    Updates: 1
2022-04-22 22:03:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935285611565056[0;39m update ends, take 31 millisecs
2022-04-22 22:03:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935306281095168[0;39m 生成今日电子书快照开始
2022-04-22 22:03:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935306281095168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935306281095168[0;39m ==> Parameters: 
2022-04-22 22:03:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935306281095168[0;39m <==    Updates: 0
2022-04-22 22:03:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935306281095168[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:03:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935327265198080[0;39m 生成今日电子书快照开始
2022-04-22 22:03:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935327265198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935327265198080[0;39m ==> Parameters: 
2022-04-22 22:03:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935327265198080[0;39m <==    Updates: 0
2022-04-22 22:03:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935327265198080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:03:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935348240912384[0;39m 生成今日电子书快照开始
2022-04-22 22:03:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935348240912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935348240912384[0;39m ==> Parameters: 
2022-04-22 22:03:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935348240912384[0;39m <==    Updates: 0
2022-04-22 22:03:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935348240912384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:03:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935369216626688[0;39m 生成今日电子书快照开始
2022-04-22 22:03:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935369216626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935369216626688[0;39m ==> Parameters: 
2022-04-22 22:03:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935369216626688[0;39m <==    Updates: 0
2022-04-22 22:03:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935369216626688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:03:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935390167175168[0;39m 生成今日电子书快照开始
2022-04-22 22:03:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935390167175168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935390167175168[0;39m ==> Parameters: 
2022-04-22 22:03:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935390167175168[0;39m <==    Updates: 0
2022-04-22 22:03:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935390167175168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:03:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935411163860992[0;39m 生成今日电子书快照开始
2022-04-22 22:03:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935411163860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935411163860992[0;39m ==> Parameters: 
2022-04-22 22:03:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935411163860992[0;39m <==    Updates: 0
2022-04-22 22:03:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935411163860992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:03:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935411436490752[0;39m start updating Ebook doc
2022-04-22 22:03:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935411436490752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:03:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935411436490752[0;39m ==> Parameters: 
2022-04-22 22:03:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935411436490752[0;39m <==    Updates: 1
2022-04-22 22:03:35.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935411436490752[0;39m update ends, take 37 millisecs
2022-04-22 22:03:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935432135380992[0;39m 生成今日电子书快照开始
2022-04-22 22:03:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935432135380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935432135380992[0;39m ==> Parameters: 
2022-04-22 22:03:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935432135380992[0;39m <==    Updates: 0
2022-04-22 22:03:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935432135380992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:03:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935453081735168[0;39m 生成今日电子书快照开始
2022-04-22 22:03:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935453081735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935453081735168[0;39m ==> Parameters: 
2022-04-22 22:03:45.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935453081735168[0;39m <==    Updates: 0
2022-04-22 22:03:45.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935453081735168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:03:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935474065838080[0;39m 生成今日电子书快照开始
2022-04-22 22:03:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935474065838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935474065838080[0;39m ==> Parameters: 
2022-04-22 22:03:50.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935474065838080[0;39m <==    Updates: 0
2022-04-22 22:03:50.118 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935474065838080[0;39m 生成今日电子书快照结束，耗时：114毫秒
2022-04-22 22:03:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935495033163776[0;39m 生成今日电子书快照开始
2022-04-22 22:03:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935495033163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:03:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935495033163776[0;39m ==> Parameters: 
2022-04-22 22:03:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935495033163776[0;39m <==    Updates: 0
2022-04-22 22:03:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935495033163776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:04:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935516004683776[0;39m 生成今日电子书快照开始
2022-04-22 22:04:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935516004683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935516004683776[0;39m ==> Parameters: 
2022-04-22 22:04:00.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935516004683776[0;39m <==    Updates: 0
2022-04-22 22:04:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935516004683776[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:04:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935536972009472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:05.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935536972009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935536972009472[0;39m ==> Parameters: 
2022-04-22 22:04:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935536972009472[0;39m <==    Updates: 0
2022-04-22 22:04:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935536972009472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:04:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935537215279104[0;39m start updating Ebook doc
2022-04-22 22:04:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935537215279104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:04:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935537215279104[0;39m ==> Parameters: 
2022-04-22 22:04:05.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935537215279104[0;39m <==    Updates: 1
2022-04-22 22:04:05.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935537215279104[0;39m update ends, take 39 millisecs
2022-04-22 22:04:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935557943529472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935557943529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935557943529472[0;39m ==> Parameters: 
2022-04-22 22:04:10.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935557943529472[0;39m <==    Updates: 0
2022-04-22 22:04:10.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935557943529472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:04:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935578915049472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935578915049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935578915049472[0;39m ==> Parameters: 
2022-04-22 22:04:15.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935578915049472[0;39m <==    Updates: 0
2022-04-22 22:04:15.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935578915049472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:04:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935599886569472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935599886569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935599886569472[0;39m ==> Parameters: 
2022-04-22 22:04:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935599886569472[0;39m <==    Updates: 0
2022-04-22 22:04:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935599886569472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:04:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935620862283776[0;39m 生成今日电子书快照开始
2022-04-22 22:04:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935620862283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935620862283776[0;39m ==> Parameters: 
2022-04-22 22:04:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935620862283776[0;39m <==    Updates: 0
2022-04-22 22:04:25.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935620862283776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:04:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935641829609472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935641829609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935641829609472[0;39m ==> Parameters: 
2022-04-22 22:04:30.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935641829609472[0;39m <==    Updates: 0
2022-04-22 22:04:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935641829609472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:04:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935662805323776[0;39m 生成今日电子书快照开始
2022-04-22 22:04:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935662805323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935662805323776[0;39m ==> Parameters: 
2022-04-22 22:04:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935662805323776[0;39m <==    Updates: 0
2022-04-22 22:04:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935662805323776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:04:35.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935663048593408[0;39m start updating Ebook doc
2022-04-22 22:04:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935663048593408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:04:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935663048593408[0;39m ==> Parameters: 
2022-04-22 22:04:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935663048593408[0;39m <==    Updates: 1
2022-04-22 22:04:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935663048593408[0;39m update ends, take 38 millisecs
2022-04-22 22:04:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935683772649472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935683772649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935683772649472[0;39m ==> Parameters: 
2022-04-22 22:04:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935683772649472[0;39m <==    Updates: 0
2022-04-22 22:04:40.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935683772649472[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:04:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935704752558080[0;39m 生成今日电子书快照开始
2022-04-22 22:04:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935704752558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935704752558080[0;39m ==> Parameters: 
2022-04-22 22:04:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935704752558080[0;39m <==    Updates: 0
2022-04-22 22:04:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935704752558080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:04:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935725715689472[0;39m 生成今日电子书快照开始
2022-04-22 22:04:50.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935725715689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935725715689472[0;39m ==> Parameters: 
2022-04-22 22:04:50.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935725715689472[0;39m <==    Updates: 0
2022-04-22 22:04:50.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935725715689472[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:04:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935746691403776[0;39m 生成今日电子书快照开始
2022-04-22 22:04:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935746691403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:04:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935746691403776[0;39m ==> Parameters: 
2022-04-22 22:04:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935746691403776[0;39m <==    Updates: 0
2022-04-22 22:04:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935746691403776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:05:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935767667118080[0;39m 生成今日电子书快照开始
2022-04-22 22:05:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935767667118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935767667118080[0;39m ==> Parameters: 
2022-04-22 22:05:00.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935767667118080[0;39m <==    Updates: 0
2022-04-22 22:05:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935767667118080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:05:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935788638638080[0;39m 生成今日电子书快照开始
2022-04-22 22:05:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935788638638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935788638638080[0;39m ==> Parameters: 
2022-04-22 22:05:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935788638638080[0;39m <==    Updates: 0
2022-04-22 22:05:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935788638638080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:05:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935788873519104[0;39m start updating Ebook doc
2022-04-22 22:05:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935788873519104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:05:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935788873519104[0;39m ==> Parameters: 
2022-04-22 22:05:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935788873519104[0;39m <==    Updates: 1
2022-04-22 22:05:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935788873519104[0;39m update ends, take 41 millisecs
2022-04-22 22:05:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935809605963776[0;39m 生成今日电子书快照开始
2022-04-22 22:05:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935809605963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935809605963776[0;39m ==> Parameters: 
2022-04-22 22:05:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935809605963776[0;39m <==    Updates: 0
2022-04-22 22:05:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935809605963776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:05:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935830585872384[0;39m 生成今日电子书快照开始
2022-04-22 22:05:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935830585872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935830585872384[0;39m ==> Parameters: 
2022-04-22 22:05:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935830585872384[0;39m <==    Updates: 0
2022-04-22 22:05:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935830585872384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:05:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935851557392384[0;39m 生成今日电子书快照开始
2022-04-22 22:05:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935851557392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935851557392384[0;39m ==> Parameters: 
2022-04-22 22:05:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935851557392384[0;39m <==    Updates: 0
2022-04-22 22:05:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935851557392384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:05:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935872520523776[0;39m 生成今日电子书快照开始
2022-04-22 22:05:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935872520523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935872520523776[0;39m ==> Parameters: 
2022-04-22 22:05:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935872520523776[0;39m <==    Updates: 0
2022-04-22 22:05:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935872520523776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:05:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935893492043776[0;39m 生成今日电子书快照开始
2022-04-22 22:05:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935893492043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935893492043776[0;39m ==> Parameters: 
2022-04-22 22:05:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935893492043776[0;39m <==    Updates: 0
2022-04-22 22:05:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935893492043776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:05:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935914463563776[0;39m 生成今日电子书快照开始
2022-04-22 22:05:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935914463563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935914463563776[0;39m ==> Parameters: 
2022-04-22 22:05:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935914463563776[0;39m <==    Updates: 0
2022-04-22 22:05:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935914463563776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:05:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172935914702639104[0;39m start updating Ebook doc
2022-04-22 22:05:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935914702639104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:05:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935914702639104[0;39m ==> Parameters: 
2022-04-22 22:05:35.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172935914702639104[0;39m <==    Updates: 1
2022-04-22 22:05:35.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172935914702639104[0;39m update ends, take 38 millisecs
2022-04-22 22:05:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935935439278080[0;39m 生成今日电子书快照开始
2022-04-22 22:05:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935935439278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935935439278080[0;39m ==> Parameters: 
2022-04-22 22:05:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935935439278080[0;39m <==    Updates: 0
2022-04-22 22:05:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935935439278080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:05:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935956414992384[0;39m 生成今日电子书快照开始
2022-04-22 22:05:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935956414992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935956414992384[0;39m ==> Parameters: 
2022-04-22 22:05:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935956414992384[0;39m <==    Updates: 0
2022-04-22 22:05:45.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935956414992384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:05:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935977386512384[0;39m 生成今日电子书快照开始
2022-04-22 22:05:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935977386512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935977386512384[0;39m ==> Parameters: 
2022-04-22 22:05:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935977386512384[0;39m <==    Updates: 0
2022-04-22 22:05:50.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935977386512384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:05:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172935998362226688[0;39m 生成今日电子书快照开始
2022-04-22 22:05:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935998362226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:05:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935998362226688[0;39m ==> Parameters: 
2022-04-22 22:05:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172935998362226688[0;39m <==    Updates: 0
2022-04-22 22:05:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172935998362226688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:06:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936019321163776[0;39m 生成今日电子书快照开始
2022-04-22 22:06:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936019321163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936019321163776[0;39m ==> Parameters: 
2022-04-22 22:06:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936019321163776[0;39m <==    Updates: 0
2022-04-22 22:06:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936019321163776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:06:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936040301072384[0;39m 生成今日电子书快照开始
2022-04-22 22:06:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936040301072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936040301072384[0;39m ==> Parameters: 
2022-04-22 22:06:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936040301072384[0;39m <==    Updates: 0
2022-04-22 22:06:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936040301072384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:06:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936040527564800[0;39m start updating Ebook doc
2022-04-22 22:06:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936040527564800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:06:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936040527564800[0;39m ==> Parameters: 
2022-04-22 22:06:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936040527564800[0;39m <==    Updates: 1
2022-04-22 22:06:05.094 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936040527564800[0;39m update ends, take 36 millisecs
2022-04-22 22:06:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936061264203776[0;39m 生成今日电子书快照开始
2022-04-22 22:06:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936061264203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936061264203776[0;39m ==> Parameters: 
2022-04-22 22:06:10.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936061264203776[0;39m <==    Updates: 0
2022-04-22 22:06:10.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936061264203776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:06:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936082239918080[0;39m 生成今日电子书快照开始
2022-04-22 22:06:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936082239918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936082239918080[0;39m ==> Parameters: 
2022-04-22 22:06:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936082239918080[0;39m <==    Updates: 0
2022-04-22 22:06:15.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936082239918080[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:06:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936103198855168[0;39m 生成今日电子书快照开始
2022-04-22 22:06:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936103198855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936103198855168[0;39m ==> Parameters: 
2022-04-22 22:06:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936103198855168[0;39m <==    Updates: 0
2022-04-22 22:06:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936103198855168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:06:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936124182958080[0;39m 生成今日电子书快照开始
2022-04-22 22:06:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936124182958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936124182958080[0;39m ==> Parameters: 
2022-04-22 22:06:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936124182958080[0;39m <==    Updates: 0
2022-04-22 22:06:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936124182958080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:06:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936145154478080[0;39m 生成今日电子书快照开始
2022-04-22 22:06:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936145154478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936145154478080[0;39m ==> Parameters: 
2022-04-22 22:06:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936145154478080[0;39m <==    Updates: 0
2022-04-22 22:06:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936145154478080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:06:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936166125998080[0;39m 生成今日电子书快照开始
2022-04-22 22:06:35.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936166125998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936166125998080[0;39m ==> Parameters: 
2022-04-22 22:06:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936166125998080[0;39m <==    Updates: 0
2022-04-22 22:06:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936166125998080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:06:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936166339907584[0;39m start updating Ebook doc
2022-04-22 22:06:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936166339907584[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:06:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936166339907584[0;39m ==> Parameters: 
2022-04-22 22:06:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936166339907584[0;39m <==    Updates: 1
2022-04-22 22:06:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936166339907584[0;39m update ends, take 45 millisecs
2022-04-22 22:06:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936187105906688[0;39m 生成今日电子书快照开始
2022-04-22 22:06:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936187105906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936187105906688[0;39m ==> Parameters: 
2022-04-22 22:06:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936187105906688[0;39m <==    Updates: 0
2022-04-22 22:06:40.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936187105906688[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:06:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936208069038080[0;39m 生成今日电子书快照开始
2022-04-22 22:06:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936208069038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936208069038080[0;39m ==> Parameters: 
2022-04-22 22:06:45.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936208069038080[0;39m <==    Updates: 0
2022-04-22 22:06:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936208069038080[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:06:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936229044752384[0;39m 生成今日电子书快照开始
2022-04-22 22:06:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936229044752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936229044752384[0;39m ==> Parameters: 
2022-04-22 22:06:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936229044752384[0;39m <==    Updates: 0
2022-04-22 22:06:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936229044752384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:06:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936250003689472[0;39m 生成今日电子书快照开始
2022-04-22 22:06:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936250003689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:06:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936250003689472[0;39m ==> Parameters: 
2022-04-22 22:06:55.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936250003689472[0;39m <==    Updates: 0
2022-04-22 22:06:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936250003689472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:07:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936270983598080[0;39m 生成今日电子书快照开始
2022-04-22 22:07:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936270983598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936270983598080[0;39m ==> Parameters: 
2022-04-22 22:07:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936270983598080[0;39m <==    Updates: 0
2022-04-22 22:07:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936270983598080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:07:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936291959312384[0;39m 生成今日电子书快照开始
2022-04-22 22:07:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936291959312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936291959312384[0;39m ==> Parameters: 
2022-04-22 22:07:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936291959312384[0;39m <==    Updates: 0
2022-04-22 22:07:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936291959312384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:07:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936292215164928[0;39m start updating Ebook doc
2022-04-22 22:07:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936292215164928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:07:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936292215164928[0;39m ==> Parameters: 
2022-04-22 22:07:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936292215164928[0;39m <==    Updates: 1
2022-04-22 22:07:05.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936292215164928[0;39m update ends, take 35 millisecs
2022-04-22 22:07:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936312922443776[0;39m 生成今日电子书快照开始
2022-04-22 22:07:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936312922443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936312922443776[0;39m ==> Parameters: 
2022-04-22 22:07:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936312922443776[0;39m <==    Updates: 0
2022-04-22 22:07:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936312922443776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:07:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936333902352384[0;39m 生成今日电子书快照开始
2022-04-22 22:07:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936333902352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936333902352384[0;39m ==> Parameters: 
2022-04-22 22:07:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936333902352384[0;39m <==    Updates: 0
2022-04-22 22:07:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936333902352384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:07:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936354878066688[0;39m 生成今日电子书快照开始
2022-04-22 22:07:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936354878066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936354878066688[0;39m ==> Parameters: 
2022-04-22 22:07:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936354878066688[0;39m <==    Updates: 0
2022-04-22 22:07:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936354878066688[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:07:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936375832809472[0;39m 生成今日电子书快照开始
2022-04-22 22:07:25.014 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936375832809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:25.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936375832809472[0;39m ==> Parameters: 
2022-04-22 22:07:25.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936375832809472[0;39m <==    Updates: 0
2022-04-22 22:07:25.049 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936375832809472[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-22 22:07:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936396812718080[0;39m 生成今日电子书快照开始
2022-04-22 22:07:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936396812718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936396812718080[0;39m ==> Parameters: 
2022-04-22 22:07:30.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936396812718080[0;39m <==    Updates: 0
2022-04-22 22:07:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936396812718080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:07:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936417788432384[0;39m 生成今日电子书快照开始
2022-04-22 22:07:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936417788432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936417788432384[0;39m ==> Parameters: 
2022-04-22 22:07:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936417788432384[0;39m <==    Updates: 0
2022-04-22 22:07:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936417788432384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:07:35.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936418006536192[0;39m start updating Ebook doc
2022-04-22 22:07:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936418006536192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:07:35.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936418006536192[0;39m ==> Parameters: 
2022-04-22 22:07:35.090 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936418006536192[0;39m <==    Updates: 1
2022-04-22 22:07:35.090 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936418006536192[0;39m update ends, take 34 millisecs
2022-04-22 22:07:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936438759952384[0;39m 生成今日电子书快照开始
2022-04-22 22:07:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936438759952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936438759952384[0;39m ==> Parameters: 
2022-04-22 22:07:40.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936438759952384[0;39m <==    Updates: 0
2022-04-22 22:07:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936438759952384[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 22:07:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936459731472384[0;39m 生成今日电子书快照开始
2022-04-22 22:07:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936459731472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936459731472384[0;39m ==> Parameters: 
2022-04-22 22:07:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936459731472384[0;39m <==    Updates: 0
2022-04-22 22:07:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936459731472384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:07:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936480698798080[0;39m 生成今日电子书快照开始
2022-04-22 22:07:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936480698798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936480698798080[0;39m ==> Parameters: 
2022-04-22 22:07:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936480698798080[0;39m <==    Updates: 0
2022-04-22 22:07:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936480698798080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:07:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936501674512384[0;39m 生成今日电子书快照开始
2022-04-22 22:07:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936501674512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:07:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936501674512384[0;39m ==> Parameters: 
2022-04-22 22:07:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936501674512384[0;39m <==    Updates: 0
2022-04-22 22:07:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936501674512384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:08:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936522650226688[0;39m 生成今日电子书快照开始
2022-04-22 22:08:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936522650226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936522650226688[0;39m ==> Parameters: 
2022-04-22 22:08:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936522650226688[0;39m <==    Updates: 0
2022-04-22 22:08:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936522650226688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:08:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936543617552384[0;39m 生成今日电子书快照开始
2022-04-22 22:08:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936543617552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936543617552384[0;39m ==> Parameters: 
2022-04-22 22:08:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936543617552384[0;39m <==    Updates: 0
2022-04-22 22:08:05.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936543617552384[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:08:05.057 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936543839850496[0;39m start updating Ebook doc
2022-04-22 22:08:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936543839850496[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:08:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936543839850496[0;39m ==> Parameters: 
2022-04-22 22:08:05.093 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936543839850496[0;39m <==    Updates: 1
2022-04-22 22:08:05.093 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936543839850496[0;39m update ends, take 36 millisecs
2022-04-22 22:08:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936564593266688[0;39m 生成今日电子书快照开始
2022-04-22 22:08:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936564593266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936564593266688[0;39m ==> Parameters: 
2022-04-22 22:08:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936564593266688[0;39m <==    Updates: 0
2022-04-22 22:08:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936564593266688[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:08:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936585560592384[0;39m 生成今日电子书快照开始
2022-04-22 22:08:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936585560592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936585560592384[0;39m ==> Parameters: 
2022-04-22 22:08:15.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936585560592384[0;39m <==    Updates: 0
2022-04-22 22:08:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936585560592384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:08:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936606532112384[0;39m 生成今日电子书快照开始
2022-04-22 22:08:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936606532112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936606532112384[0;39m ==> Parameters: 
2022-04-22 22:08:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936606532112384[0;39m <==    Updates: 0
2022-04-22 22:08:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936606532112384[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:08:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936627507826688[0;39m 生成今日电子书快照开始
2022-04-22 22:08:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936627507826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936627507826688[0;39m ==> Parameters: 
2022-04-22 22:08:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936627507826688[0;39m <==    Updates: 0
2022-04-22 22:08:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936627507826688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:08:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936648475152384[0;39m 生成今日电子书快照开始
2022-04-22 22:08:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936648475152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936648475152384[0;39m ==> Parameters: 
2022-04-22 22:08:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936648475152384[0;39m <==    Updates: 0
2022-04-22 22:08:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936648475152384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:08:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936669434089472[0;39m start updating Ebook doc
2022-04-22 22:08:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936669434089472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:08:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936669434089472[0;39m ==> Parameters: 
2022-04-22 22:08:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936669434089472[0;39m <==    Updates: 1
2022-04-22 22:08:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936669434089472[0;39m update ends, take 64 millisecs
2022-04-22 22:08:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936669702524928[0;39m 生成今日电子书快照开始
2022-04-22 22:08:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936669702524928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936669702524928[0;39m ==> Parameters: 
2022-04-22 22:08:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936669702524928[0;39m <==    Updates: 0
2022-04-22 22:08:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936669702524928[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-22 22:08:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936690418192384[0;39m 生成今日电子书快照开始
2022-04-22 22:08:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936690418192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:40.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936690418192384[0;39m ==> Parameters: 
2022-04-22 22:08:40.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936690418192384[0;39m <==    Updates: 0
2022-04-22 22:08:40.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936690418192384[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:08:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936711393906688[0;39m 生成今日电子书快照开始
2022-04-22 22:08:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936711393906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936711393906688[0;39m ==> Parameters: 
2022-04-22 22:08:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936711393906688[0;39m <==    Updates: 0
2022-04-22 22:08:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936711393906688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:08:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936732348649472[0;39m 生成今日电子书快照开始
2022-04-22 22:08:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936732348649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936732348649472[0;39m ==> Parameters: 
2022-04-22 22:08:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936732348649472[0;39m <==    Updates: 0
2022-04-22 22:08:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936732348649472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:08:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936753328558080[0;39m 生成今日电子书快照开始
2022-04-22 22:08:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936753328558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:08:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936753328558080[0;39m ==> Parameters: 
2022-04-22 22:08:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936753328558080[0;39m <==    Updates: 0
2022-04-22 22:08:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936753328558080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:09:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936774295883776[0;39m 生成今日电子书快照开始
2022-04-22 22:09:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936774295883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936774295883776[0;39m ==> Parameters: 
2022-04-22 22:09:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936774295883776[0;39m <==    Updates: 0
2022-04-22 22:09:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936774295883776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:09:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936795275792384[0;39m 生成今日电子书快照开始
2022-04-22 22:09:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936795275792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936795275792384[0;39m ==> Parameters: 
2022-04-22 22:09:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936795275792384[0;39m <==    Updates: 0
2022-04-22 22:09:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936795275792384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:09:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936795519062016[0;39m start updating Ebook doc
2022-04-22 22:09:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936795519062016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:09:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936795519062016[0;39m ==> Parameters: 
2022-04-22 22:09:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936795519062016[0;39m <==    Updates: 1
2022-04-22 22:09:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936795519062016[0;39m update ends, take 41 millisecs
2022-04-22 22:09:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936816243118080[0;39m 生成今日电子书快照开始
2022-04-22 22:09:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936816243118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936816243118080[0;39m ==> Parameters: 
2022-04-22 22:09:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936816243118080[0;39m <==    Updates: 0
2022-04-22 22:09:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936816243118080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:09:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936837223026688[0;39m 生成今日电子书快照开始
2022-04-22 22:09:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936837223026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936837223026688[0;39m ==> Parameters: 
2022-04-22 22:09:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936837223026688[0;39m <==    Updates: 0
2022-04-22 22:09:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936837223026688[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:09:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936858194546688[0;39m 生成今日电子书快照开始
2022-04-22 22:09:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936858194546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936858194546688[0;39m ==> Parameters: 
2022-04-22 22:09:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936858194546688[0;39m <==    Updates: 0
2022-04-22 22:09:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936858194546688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:09:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936879157678080[0;39m 生成今日电子书快照开始
2022-04-22 22:09:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936879157678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936879157678080[0;39m ==> Parameters: 
2022-04-22 22:09:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936879157678080[0;39m <==    Updates: 0
2022-04-22 22:09:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936879157678080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:09:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936900133392384[0;39m 生成今日电子书快照开始
2022-04-22 22:09:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936900133392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936900133392384[0;39m ==> Parameters: 
2022-04-22 22:09:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936900133392384[0;39m <==    Updates: 0
2022-04-22 22:09:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936900133392384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:09:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936921109106688[0;39m 生成今日电子书快照开始
2022-04-22 22:09:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936921109106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936921109106688[0;39m ==> Parameters: 
2022-04-22 22:09:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936921109106688[0;39m <==    Updates: 0
2022-04-22 22:09:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936921109106688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:09:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172936921369153536[0;39m start updating Ebook doc
2022-04-22 22:09:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936921369153536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:09:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936921369153536[0;39m ==> Parameters: 
2022-04-22 22:09:35.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172936921369153536[0;39m <==    Updates: 1
2022-04-22 22:09:35.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172936921369153536[0;39m update ends, take 35 millisecs
2022-04-22 22:09:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936942080626688[0;39m 生成今日电子书快照开始
2022-04-22 22:09:40.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936942080626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936942080626688[0;39m ==> Parameters: 
2022-04-22 22:09:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936942080626688[0;39m <==    Updates: 0
2022-04-22 22:09:40.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936942080626688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:09:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936963035369472[0;39m 生成今日电子书快照开始
2022-04-22 22:09:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936963035369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936963035369472[0;39m ==> Parameters: 
2022-04-22 22:09:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936963035369472[0;39m <==    Updates: 0
2022-04-22 22:09:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936963035369472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:09:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172936984006889472[0;39m 生成今日电子书快照开始
2022-04-22 22:09:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936984006889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936984006889472[0;39m ==> Parameters: 
2022-04-22 22:09:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172936984006889472[0;39m <==    Updates: 0
2022-04-22 22:09:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172936984006889472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:09:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937004986798080[0;39m 生成今日电子书快照开始
2022-04-22 22:09:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937004986798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:09:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937004986798080[0;39m ==> Parameters: 
2022-04-22 22:09:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937004986798080[0;39m <==    Updates: 0
2022-04-22 22:09:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937004986798080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:10:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937025954123776[0;39m 生成今日电子书快照开始
2022-04-22 22:10:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937025954123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937025954123776[0;39m ==> Parameters: 
2022-04-22 22:10:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937025954123776[0;39m <==    Updates: 0
2022-04-22 22:10:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937025954123776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:10:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937046938226688[0;39m 生成今日电子书快照开始
2022-04-22 22:10:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937046938226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937046938226688[0;39m ==> Parameters: 
2022-04-22 22:10:05.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937046938226688[0;39m <==    Updates: 0
2022-04-22 22:10:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937046938226688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:10:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937047173107712[0;39m start updating Ebook doc
2022-04-22 22:10:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937047173107712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:10:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937047173107712[0;39m ==> Parameters: 
2022-04-22 22:10:05.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937047173107712[0;39m <==    Updates: 1
2022-04-22 22:10:05.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937047173107712[0;39m update ends, take 35 millisecs
2022-04-22 22:10:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937067905552384[0;39m 生成今日电子书快照开始
2022-04-22 22:10:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937067905552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937067905552384[0;39m ==> Parameters: 
2022-04-22 22:10:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937067905552384[0;39m <==    Updates: 0
2022-04-22 22:10:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937067905552384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:10:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937088872878080[0;39m 生成今日电子书快照开始
2022-04-22 22:10:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937088872878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937088872878080[0;39m ==> Parameters: 
2022-04-22 22:10:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937088872878080[0;39m <==    Updates: 0
2022-04-22 22:10:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937088872878080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:10:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937109852786688[0;39m 生成今日电子书快照开始
2022-04-22 22:10:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937109852786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937109852786688[0;39m ==> Parameters: 
2022-04-22 22:10:20.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937109852786688[0;39m <==    Updates: 0
2022-04-22 22:10:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937109852786688[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:10:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937130811723776[0;39m 生成今日电子书快照开始
2022-04-22 22:10:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937130811723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937130811723776[0;39m ==> Parameters: 
2022-04-22 22:10:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937130811723776[0;39m <==    Updates: 0
2022-04-22 22:10:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937130811723776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:10:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937151779049472[0;39m 生成今日电子书快照开始
2022-04-22 22:10:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937151779049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937151779049472[0;39m ==> Parameters: 
2022-04-22 22:10:30.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937151779049472[0;39m <==    Updates: 0
2022-04-22 22:10:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937151779049472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:10:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937172750569472[0;39m 生成今日电子书快照开始
2022-04-22 22:10:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937172750569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937172750569472[0;39m ==> Parameters: 
2022-04-22 22:10:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937172750569472[0;39m <==    Updates: 0
2022-04-22 22:10:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937172750569472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:10:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937173006422016[0;39m start updating Ebook doc
2022-04-22 22:10:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937173006422016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:10:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937173006422016[0;39m ==> Parameters: 
2022-04-22 22:10:35.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937173006422016[0;39m <==    Updates: 1
2022-04-22 22:10:35.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937173006422016[0;39m update ends, take 34 millisecs
2022-04-22 22:10:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937193722089472[0;39m 生成今日电子书快照开始
2022-04-22 22:10:40.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937193722089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937193722089472[0;39m ==> Parameters: 
2022-04-22 22:10:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937193722089472[0;39m <==    Updates: 0
2022-04-22 22:10:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937193722089472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:10:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937214689415168[0;39m 生成今日电子书快照开始
2022-04-22 22:10:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937214689415168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937214689415168[0;39m ==> Parameters: 
2022-04-22 22:10:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937214689415168[0;39m <==    Updates: 0
2022-04-22 22:10:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937214689415168[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:10:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937235665129472[0;39m 生成今日电子书快照开始
2022-04-22 22:10:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937235665129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937235665129472[0;39m ==> Parameters: 
2022-04-22 22:10:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937235665129472[0;39m <==    Updates: 0
2022-04-22 22:10:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937235665129472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:10:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937256640843776[0;39m 生成今日电子书快照开始
2022-04-22 22:10:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937256640843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:10:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937256640843776[0;39m ==> Parameters: 
2022-04-22 22:10:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937256640843776[0;39m <==    Updates: 0
2022-04-22 22:10:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937256640843776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:11:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937277612363776[0;39m 生成今日电子书快照开始
2022-04-22 22:11:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937277612363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937277612363776[0;39m ==> Parameters: 
2022-04-22 22:11:00.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937277612363776[0;39m <==    Updates: 0
2022-04-22 22:11:00.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937277612363776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:11:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937298592272384[0;39m 生成今日电子书快照开始
2022-04-22 22:11:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937298592272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937298592272384[0;39m ==> Parameters: 
2022-04-22 22:11:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937298592272384[0;39m <==    Updates: 0
2022-04-22 22:11:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937298592272384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:11:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937298843930624[0;39m start updating Ebook doc
2022-04-22 22:11:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937298843930624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:11:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937298843930624[0;39m ==> Parameters: 
2022-04-22 22:11:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937298843930624[0;39m <==    Updates: 1
2022-04-22 22:11:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937298843930624[0;39m update ends, take 39 millisecs
2022-04-22 22:11:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937319547015168[0;39m 生成今日电子书快照开始
2022-04-22 22:11:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937319547015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937319547015168[0;39m ==> Parameters: 
2022-04-22 22:11:10.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937319547015168[0;39m <==    Updates: 0
2022-04-22 22:11:10.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937319547015168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:11:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937340535312384[0;39m 生成今日电子书快照开始
2022-04-22 22:11:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937340535312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937340535312384[0;39m ==> Parameters: 
2022-04-22 22:11:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937340535312384[0;39m <==    Updates: 0
2022-04-22 22:11:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937340535312384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:11:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937361502638080[0;39m 生成今日电子书快照开始
2022-04-22 22:11:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937361502638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937361502638080[0;39m ==> Parameters: 
2022-04-22 22:11:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937361502638080[0;39m <==    Updates: 0
2022-04-22 22:11:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937361502638080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:11:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937382461575168[0;39m 生成今日电子书快照开始
2022-04-22 22:11:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937382461575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937382461575168[0;39m ==> Parameters: 
2022-04-22 22:11:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937382461575168[0;39m <==    Updates: 0
2022-04-22 22:11:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937382461575168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:11:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937403441483776[0;39m 生成今日电子书快照开始
2022-04-22 22:11:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937403441483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937403441483776[0;39m ==> Parameters: 
2022-04-22 22:11:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937403441483776[0;39m <==    Updates: 0
2022-04-22 22:11:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937403441483776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:11:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937424408809472[0;39m 生成今日电子书快照开始
2022-04-22 22:11:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937424408809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937424408809472[0;39m ==> Parameters: 
2022-04-22 22:11:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937424408809472[0;39m <==    Updates: 0
2022-04-22 22:11:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937424408809472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:11:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937424668856320[0;39m start updating Ebook doc
2022-04-22 22:11:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937424668856320[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:11:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937424668856320[0;39m ==> Parameters: 
2022-04-22 22:11:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937424668856320[0;39m <==    Updates: 1
2022-04-22 22:11:35.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937424668856320[0;39m update ends, take 36 millisecs
2022-04-22 22:11:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937445384523776[0;39m 生成今日电子书快照开始
2022-04-22 22:11:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937445384523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937445384523776[0;39m ==> Parameters: 
2022-04-22 22:11:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937445384523776[0;39m <==    Updates: 0
2022-04-22 22:11:40.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937445384523776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:11:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937466347655168[0;39m 生成今日电子书快照开始
2022-04-22 22:11:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937466347655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937466347655168[0;39m ==> Parameters: 
2022-04-22 22:11:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937466347655168[0;39m <==    Updates: 0
2022-04-22 22:11:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937466347655168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:11:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937487335952384[0;39m 生成今日电子书快照开始
2022-04-22 22:11:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937487335952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937487335952384[0;39m ==> Parameters: 
2022-04-22 22:11:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937487335952384[0;39m <==    Updates: 0
2022-04-22 22:11:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937487335952384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:11:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937508311666688[0;39m 生成今日电子书快照开始
2022-04-22 22:11:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937508311666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:11:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937508311666688[0;39m ==> Parameters: 
2022-04-22 22:11:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937508311666688[0;39m <==    Updates: 0
2022-04-22 22:11:55.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937508311666688[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:12:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937529270603776[0;39m 生成今日电子书快照开始
2022-04-22 22:12:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937529270603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937529270603776[0;39m ==> Parameters: 
2022-04-22 22:12:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937529270603776[0;39m <==    Updates: 0
2022-04-22 22:12:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937529270603776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:12:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937550246318080[0;39m 生成今日电子书快照开始
2022-04-22 22:12:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937550246318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937550246318080[0;39m ==> Parameters: 
2022-04-22 22:12:05.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937550246318080[0;39m <==    Updates: 0
2022-04-22 22:12:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937550246318080[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:12:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937550477004800[0;39m start updating Ebook doc
2022-04-22 22:12:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937550477004800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:12:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937550477004800[0;39m ==> Parameters: 
2022-04-22 22:12:05.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937550477004800[0;39m <==    Updates: 1
2022-04-22 22:12:05.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937550477004800[0;39m update ends, take 43 millisecs
2022-04-22 22:12:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937571226226688[0;39m 生成今日电子书快照开始
2022-04-22 22:12:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937571226226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937571226226688[0;39m ==> Parameters: 
2022-04-22 22:12:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937571226226688[0;39m <==    Updates: 0
2022-04-22 22:12:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937571226226688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:12:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937592176775168[0;39m 生成今日电子书快照开始
2022-04-22 22:12:15.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937592176775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:15.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937592176775168[0;39m ==> Parameters: 
2022-04-22 22:12:15.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937592176775168[0;39m <==    Updates: 0
2022-04-22 22:12:15.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937592176775168[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 22:12:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937613156683776[0;39m 生成今日电子书快照开始
2022-04-22 22:12:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937613156683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937613156683776[0;39m ==> Parameters: 
2022-04-22 22:12:20.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937613156683776[0;39m <==    Updates: 0
2022-04-22 22:12:20.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937613156683776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:12:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937634136592384[0;39m 生成今日电子书快照开始
2022-04-22 22:12:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937634136592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937634136592384[0;39m ==> Parameters: 
2022-04-22 22:12:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937634136592384[0;39m <==    Updates: 0
2022-04-22 22:12:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937634136592384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:12:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937655099723776[0;39m 生成今日电子书快照开始
2022-04-22 22:12:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937655099723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937655099723776[0;39m ==> Parameters: 
2022-04-22 22:12:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937655099723776[0;39m <==    Updates: 0
2022-04-22 22:12:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937655099723776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:12:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937676071243776[0;39m start updating Ebook doc
2022-04-22 22:12:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937676071243776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:12:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937676071243776[0;39m ==> Parameters: 
2022-04-22 22:12:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937676071243776[0;39m <==    Updates: 1
2022-04-22 22:12:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937676071243776[0;39m update ends, take 59 millisecs
2022-04-22 22:12:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937676318707712[0;39m 生成今日电子书快照开始
2022-04-22 22:12:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937676318707712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937676318707712[0;39m ==> Parameters: 
2022-04-22 22:12:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937676318707712[0;39m <==    Updates: 0
2022-04-22 22:12:35.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937676318707712[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 22:12:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937697042763776[0;39m 生成今日电子书快照开始
2022-04-22 22:12:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937697042763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937697042763776[0;39m ==> Parameters: 
2022-04-22 22:12:40.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937697042763776[0;39m <==    Updates: 0
2022-04-22 22:12:40.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937697042763776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:12:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937718010089472[0;39m 生成今日电子书快照开始
2022-04-22 22:12:45.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937718010089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:45.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937718010089472[0;39m ==> Parameters: 
2022-04-22 22:12:45.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937718010089472[0;39m <==    Updates: 0
2022-04-22 22:12:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937718010089472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:12:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937738981609472[0;39m 生成今日电子书快照开始
2022-04-22 22:12:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937738981609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937738981609472[0;39m ==> Parameters: 
2022-04-22 22:12:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937738981609472[0;39m <==    Updates: 0
2022-04-22 22:12:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937738981609472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:12:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937759969906688[0;39m 生成今日电子书快照开始
2022-04-22 22:12:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937759969906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:12:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937759969906688[0;39m ==> Parameters: 
2022-04-22 22:12:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937759969906688[0;39m <==    Updates: 0
2022-04-22 22:12:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937759969906688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:13:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937780928843776[0;39m 生成今日电子书快照开始
2022-04-22 22:13:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937780928843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937780928843776[0;39m ==> Parameters: 
2022-04-22 22:13:00.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937780928843776[0;39m <==    Updates: 0
2022-04-22 22:13:00.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937780928843776[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-22 22:13:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937801896169472[0;39m 生成今日电子书快照开始
2022-04-22 22:13:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937801896169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937801896169472[0;39m ==> Parameters: 
2022-04-22 22:13:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937801896169472[0;39m <==    Updates: 0
2022-04-22 22:13:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937801896169472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:13:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937802168799232[0;39m start updating Ebook doc
2022-04-22 22:13:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937802168799232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:13:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937802168799232[0;39m ==> Parameters: 
2022-04-22 22:13:05.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937802168799232[0;39m <==    Updates: 1
2022-04-22 22:13:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937802168799232[0;39m update ends, take 37 millisecs
2022-04-22 22:13:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937822876078080[0;39m 生成今日电子书快照开始
2022-04-22 22:13:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937822876078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937822876078080[0;39m ==> Parameters: 
2022-04-22 22:13:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937822876078080[0;39m <==    Updates: 0
2022-04-22 22:13:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937822876078080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:13:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937843835015168[0;39m 生成今日电子书快照开始
2022-04-22 22:13:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937843835015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937843835015168[0;39m ==> Parameters: 
2022-04-22 22:13:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937843835015168[0;39m <==    Updates: 0
2022-04-22 22:13:15.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937843835015168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:13:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937864827506688[0;39m 生成今日电子书快照开始
2022-04-22 22:13:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937864827506688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937864827506688[0;39m ==> Parameters: 
2022-04-22 22:13:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937864827506688[0;39m <==    Updates: 0
2022-04-22 22:13:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937864827506688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:13:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937885778055168[0;39m 生成今日电子书快照开始
2022-04-22 22:13:25.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937885778055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937885778055168[0;39m ==> Parameters: 
2022-04-22 22:13:25.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937885778055168[0;39m <==    Updates: 0
2022-04-22 22:13:25.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937885778055168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:13:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937906753769472[0;39m 生成今日电子书快照开始
2022-04-22 22:13:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937906753769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937906753769472[0;39m ==> Parameters: 
2022-04-22 22:13:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937906753769472[0;39m <==    Updates: 0
2022-04-22 22:13:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937906753769472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:13:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937927721095168[0;39m 生成今日电子书快照开始
2022-04-22 22:13:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937927721095168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937927721095168[0;39m ==> Parameters: 
2022-04-22 22:13:35.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937927721095168[0;39m <==    Updates: 0
2022-04-22 22:13:35.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937927721095168[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:13:35.054 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172937927947587584[0;39m start updating Ebook doc
2022-04-22 22:13:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937927947587584[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:13:35.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937927947587584[0;39m ==> Parameters: 
2022-04-22 22:13:35.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172937927947587584[0;39m <==    Updates: 1
2022-04-22 22:13:35.088 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172937927947587584[0;39m update ends, take 34 millisecs
2022-04-22 22:13:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937948709392384[0;39m 生成今日电子书快照开始
2022-04-22 22:13:40.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937948709392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937948709392384[0;39m ==> Parameters: 
2022-04-22 22:13:40.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937948709392384[0;39m <==    Updates: 0
2022-04-22 22:13:40.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937948709392384[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 22:13:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937969680912384[0;39m 生成今日电子书快照开始
2022-04-22 22:13:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937969680912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937969680912384[0;39m ==> Parameters: 
2022-04-22 22:13:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937969680912384[0;39m <==    Updates: 0
2022-04-22 22:13:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937969680912384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:13:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172937990635655168[0;39m 生成今日电子书快照开始
2022-04-22 22:13:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937990635655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937990635655168[0;39m ==> Parameters: 
2022-04-22 22:13:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172937990635655168[0;39m <==    Updates: 0
2022-04-22 22:13:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172937990635655168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:13:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938011611369472[0;39m 生成今日电子书快照开始
2022-04-22 22:13:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938011611369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:13:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938011611369472[0;39m ==> Parameters: 
2022-04-22 22:13:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938011611369472[0;39m <==    Updates: 0
2022-04-22 22:13:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938011611369472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:14:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938032582889472[0;39m 生成今日电子书快照开始
2022-04-22 22:14:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938032582889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938032582889472[0;39m ==> Parameters: 
2022-04-22 22:14:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938032582889472[0;39m <==    Updates: 0
2022-04-22 22:14:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938032582889472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:14:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938053566992384[0;39m 生成今日电子书快照开始
2022-04-22 22:14:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938053566992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938053566992384[0;39m ==> Parameters: 
2022-04-22 22:14:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938053566992384[0;39m <==    Updates: 0
2022-04-22 22:14:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938053566992384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:14:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938053843816448[0;39m start updating Ebook doc
2022-04-22 22:14:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938053843816448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:14:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938053843816448[0;39m ==> Parameters: 
2022-04-22 22:14:05.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938053843816448[0;39m <==    Updates: 1
2022-04-22 22:14:05.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938053843816448[0;39m update ends, take 39 millisecs
2022-04-22 22:14:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938074534318080[0;39m 生成今日电子书快照开始
2022-04-22 22:14:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938074534318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938074534318080[0;39m ==> Parameters: 
2022-04-22 22:14:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938074534318080[0;39m <==    Updates: 0
2022-04-22 22:14:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938074534318080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:14:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938095493255168[0;39m 生成今日电子书快照开始
2022-04-22 22:14:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938095493255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938095493255168[0;39m ==> Parameters: 
2022-04-22 22:14:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938095493255168[0;39m <==    Updates: 0
2022-04-22 22:14:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938095493255168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:14:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938116477358080[0;39m 生成今日电子书快照开始
2022-04-22 22:14:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938116477358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938116477358080[0;39m ==> Parameters: 
2022-04-22 22:14:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938116477358080[0;39m <==    Updates: 0
2022-04-22 22:14:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938116477358080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:14:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938137440489472[0;39m 生成今日电子书快照开始
2022-04-22 22:14:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938137440489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938137440489472[0;39m ==> Parameters: 
2022-04-22 22:14:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938137440489472[0;39m <==    Updates: 0
2022-04-22 22:14:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938137440489472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:14:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938158412009472[0;39m 生成今日电子书快照开始
2022-04-22 22:14:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938158412009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938158412009472[0;39m ==> Parameters: 
2022-04-22 22:14:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938158412009472[0;39m <==    Updates: 0
2022-04-22 22:14:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938158412009472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:14:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938179379335168[0;39m 生成今日电子书快照开始
2022-04-22 22:14:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938179379335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938179379335168[0;39m ==> Parameters: 
2022-04-22 22:14:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938179379335168[0;39m <==    Updates: 0
2022-04-22 22:14:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938179379335168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:14:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938179626799104[0;39m start updating Ebook doc
2022-04-22 22:14:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938179626799104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:14:35.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938179626799104[0;39m ==> Parameters: 
2022-04-22 22:14:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938179626799104[0;39m <==    Updates: 1
2022-04-22 22:14:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938179626799104[0;39m update ends, take 40 millisecs
2022-04-22 22:14:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938200359243776[0;39m 生成今日电子书快照开始
2022-04-22 22:14:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938200359243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938200359243776[0;39m ==> Parameters: 
2022-04-22 22:14:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938200359243776[0;39m <==    Updates: 0
2022-04-22 22:14:40.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938200359243776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:14:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938221330763776[0;39m 生成今日电子书快照开始
2022-04-22 22:14:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938221330763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938221330763776[0;39m ==> Parameters: 
2022-04-22 22:14:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938221330763776[0;39m <==    Updates: 0
2022-04-22 22:14:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938221330763776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:14:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938242319060992[0;39m 生成今日电子书快照开始
2022-04-22 22:14:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938242319060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938242319060992[0;39m ==> Parameters: 
2022-04-22 22:14:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938242319060992[0;39m <==    Updates: 0
2022-04-22 22:14:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938242319060992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:14:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938263286386688[0;39m 生成今日电子书快照开始
2022-04-22 22:14:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938263286386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:14:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938263286386688[0;39m ==> Parameters: 
2022-04-22 22:14:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938263286386688[0;39m <==    Updates: 0
2022-04-22 22:14:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938263286386688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:15:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938284253712384[0;39m 生成今日电子书快照开始
2022-04-22 22:15:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938284253712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938284253712384[0;39m ==> Parameters: 
2022-04-22 22:15:00.235 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938284253712384[0;39m <==    Updates: 0
2022-04-22 22:15:00.235 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938284253712384[0;39m 生成今日电子书快照结束，耗时：230毫秒
2022-04-22 22:15:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938305212649472[0;39m 生成今日电子书快照开始
2022-04-22 22:15:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938305212649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938305212649472[0;39m ==> Parameters: 
2022-04-22 22:15:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938305212649472[0;39m <==    Updates: 0
2022-04-22 22:15:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938305212649472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:15:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938305506250752[0;39m start updating Ebook doc
2022-04-22 22:15:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938305506250752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:15:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938305506250752[0;39m ==> Parameters: 
2022-04-22 22:15:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938305506250752[0;39m <==    Updates: 1
2022-04-22 22:15:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938305506250752[0;39m update ends, take 34 millisecs
2022-04-22 22:15:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938326192558080[0;39m 生成今日电子书快照开始
2022-04-22 22:15:10.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938326192558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938326192558080[0;39m ==> Parameters: 
2022-04-22 22:15:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938326192558080[0;39m <==    Updates: 0
2022-04-22 22:15:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938326192558080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:15:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938347172466688[0;39m 生成今日电子书快照开始
2022-04-22 22:15:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938347172466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938347172466688[0;39m ==> Parameters: 
2022-04-22 22:15:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938347172466688[0;39m <==    Updates: 0
2022-04-22 22:15:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938347172466688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:15:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938368135598080[0;39m 生成今日电子书快照开始
2022-04-22 22:15:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938368135598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938368135598080[0;39m ==> Parameters: 
2022-04-22 22:15:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938368135598080[0;39m <==    Updates: 0
2022-04-22 22:15:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938368135598080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:15:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938389107118080[0;39m 生成今日电子书快照开始
2022-04-22 22:15:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938389107118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938389107118080[0;39m ==> Parameters: 
2022-04-22 22:15:25.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938389107118080[0;39m <==    Updates: 0
2022-04-22 22:15:25.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938389107118080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:15:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938410078638080[0;39m 生成今日电子书快照开始
2022-04-22 22:15:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938410078638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938410078638080[0;39m ==> Parameters: 
2022-04-22 22:15:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938410078638080[0;39m <==    Updates: 0
2022-04-22 22:15:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938410078638080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:15:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938431045963776[0;39m 生成今日电子书快照开始
2022-04-22 22:15:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938431045963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938431045963776[0;39m ==> Parameters: 
2022-04-22 22:15:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938431045963776[0;39m <==    Updates: 0
2022-04-22 22:15:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938431045963776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:15:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938431310204928[0;39m start updating Ebook doc
2022-04-22 22:15:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938431310204928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:15:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938431310204928[0;39m ==> Parameters: 
2022-04-22 22:15:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938431310204928[0;39m <==    Updates: 1
2022-04-22 22:15:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938431310204928[0;39m update ends, take 43 millisecs
2022-04-22 22:15:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938452013289472[0;39m 生成今日电子书快照开始
2022-04-22 22:15:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938452013289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:40.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938452013289472[0;39m ==> Parameters: 
2022-04-22 22:15:40.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938452013289472[0;39m <==    Updates: 0
2022-04-22 22:15:40.100 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938452013289472[0;39m 生成今日电子书快照结束，耗时：99毫秒
2022-04-22 22:15:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938472993198080[0;39m 生成今日电子书快照开始
2022-04-22 22:15:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938472993198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938472993198080[0;39m ==> Parameters: 
2022-04-22 22:15:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938472993198080[0;39m <==    Updates: 0
2022-04-22 22:15:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938472993198080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:15:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938493952135168[0;39m 生成今日电子书快照开始
2022-04-22 22:15:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938493952135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938493952135168[0;39m ==> Parameters: 
2022-04-22 22:15:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938493952135168[0;39m <==    Updates: 0
2022-04-22 22:15:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938493952135168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:15:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938514923655168[0;39m 生成今日电子书快照开始
2022-04-22 22:15:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938514923655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:15:55.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938514923655168[0;39m ==> Parameters: 
2022-04-22 22:15:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938514923655168[0;39m <==    Updates: 0
2022-04-22 22:15:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938514923655168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:16:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938535907758080[0;39m 生成今日电子书快照开始
2022-04-22 22:16:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938535907758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938535907758080[0;39m ==> Parameters: 
2022-04-22 22:16:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938535907758080[0;39m <==    Updates: 0
2022-04-22 22:16:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938535907758080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:16:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938556870889472[0;39m 生成今日电子书快照开始
2022-04-22 22:16:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938556870889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938556870889472[0;39m ==> Parameters: 
2022-04-22 22:16:05.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938556870889472[0;39m <==    Updates: 0
2022-04-22 22:16:05.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938556870889472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:16:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938557109964800[0;39m start updating Ebook doc
2022-04-22 22:16:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938557109964800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:16:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938557109964800[0;39m ==> Parameters: 
2022-04-22 22:16:05.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938557109964800[0;39m <==    Updates: 1
2022-04-22 22:16:05.095 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938557109964800[0;39m update ends, take 37 millisecs
2022-04-22 22:16:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938577850798080[0;39m 生成今日电子书快照开始
2022-04-22 22:16:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938577850798080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938577850798080[0;39m ==> Parameters: 
2022-04-22 22:16:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938577850798080[0;39m <==    Updates: 0
2022-04-22 22:16:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938577850798080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:16:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938598822318080[0;39m 生成今日电子书快照开始
2022-04-22 22:16:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938598822318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938598822318080[0;39m ==> Parameters: 
2022-04-22 22:16:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938598822318080[0;39m <==    Updates: 0
2022-04-22 22:16:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938598822318080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:16:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938619789643776[0;39m 生成今日电子书快照开始
2022-04-22 22:16:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938619789643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938619789643776[0;39m ==> Parameters: 
2022-04-22 22:16:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938619789643776[0;39m <==    Updates: 0
2022-04-22 22:16:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938619789643776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:16:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938640769552384[0;39m 生成今日电子书快照开始
2022-04-22 22:16:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938640769552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938640769552384[0;39m ==> Parameters: 
2022-04-22 22:16:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938640769552384[0;39m <==    Updates: 0
2022-04-22 22:16:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938640769552384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:16:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938661724295168[0;39m 生成今日电子书快照开始
2022-04-22 22:16:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938661724295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938661724295168[0;39m ==> Parameters: 
2022-04-22 22:16:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938661724295168[0;39m <==    Updates: 0
2022-04-22 22:16:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938661724295168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:16:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938682700009472[0;39m 生成今日电子书快照开始
2022-04-22 22:16:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938682700009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:35.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938682700009472[0;39m ==> Parameters: 
2022-04-22 22:16:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938682700009472[0;39m <==    Updates: 0
2022-04-22 22:16:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938682700009472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:16:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938682939084800[0;39m start updating Ebook doc
2022-04-22 22:16:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938682939084800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:16:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938682939084800[0;39m ==> Parameters: 
2022-04-22 22:16:35.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938682939084800[0;39m <==    Updates: 1
2022-04-22 22:16:35.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938682939084800[0;39m update ends, take 38 millisecs
2022-04-22 22:16:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938703671529472[0;39m 生成今日电子书快照开始
2022-04-22 22:16:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938703671529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938703671529472[0;39m ==> Parameters: 
2022-04-22 22:16:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938703671529472[0;39m <==    Updates: 0
2022-04-22 22:16:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938703671529472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 22:16:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938724643049472[0;39m 生成今日电子书快照开始
2022-04-22 22:16:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938724643049472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938724643049472[0;39m ==> Parameters: 
2022-04-22 22:16:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938724643049472[0;39m <==    Updates: 0
2022-04-22 22:16:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938724643049472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:16:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938745610375168[0;39m 生成今日电子书快照开始
2022-04-22 22:16:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938745610375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938745610375168[0;39m ==> Parameters: 
2022-04-22 22:16:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938745610375168[0;39m <==    Updates: 0
2022-04-22 22:16:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938745610375168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:16:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938766586089472[0;39m 生成今日电子书快照开始
2022-04-22 22:16:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938766586089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:16:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938766586089472[0;39m ==> Parameters: 
2022-04-22 22:16:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938766586089472[0;39m <==    Updates: 0
2022-04-22 22:16:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938766586089472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:17:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938787565998080[0;39m 生成今日电子书快照开始
2022-04-22 22:17:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938787565998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938787565998080[0;39m ==> Parameters: 
2022-04-22 22:17:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938787565998080[0;39m <==    Updates: 0
2022-04-22 22:17:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938787565998080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:17:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938808529129472[0;39m 生成今日电子书快照开始
2022-04-22 22:17:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938808529129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938808529129472[0;39m ==> Parameters: 
2022-04-22 22:17:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938808529129472[0;39m <==    Updates: 0
2022-04-22 22:17:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938808529129472[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:17:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938808826925056[0;39m start updating Ebook doc
2022-04-22 22:17:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938808826925056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:17:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938808826925056[0;39m ==> Parameters: 
2022-04-22 22:17:05.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938808826925056[0;39m <==    Updates: 1
2022-04-22 22:17:05.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938808826925056[0;39m update ends, take 45 millisecs
2022-04-22 22:17:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938829504843776[0;39m 生成今日电子书快照开始
2022-04-22 22:17:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938829504843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938829504843776[0;39m ==> Parameters: 
2022-04-22 22:17:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938829504843776[0;39m <==    Updates: 0
2022-04-22 22:17:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938829504843776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:17:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938850472169472[0;39m 生成今日电子书快照开始
2022-04-22 22:17:15.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938850472169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:15.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938850472169472[0;39m ==> Parameters: 
2022-04-22 22:17:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938850472169472[0;39m <==    Updates: 0
2022-04-22 22:17:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938850472169472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:17:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938871460466688[0;39m 生成今日电子书快照开始
2022-04-22 22:17:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938871460466688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938871460466688[0;39m ==> Parameters: 
2022-04-22 22:17:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938871460466688[0;39m <==    Updates: 0
2022-04-22 22:17:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938871460466688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:17:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938892415209472[0;39m 生成今日电子书快照开始
2022-04-22 22:17:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938892415209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938892415209472[0;39m ==> Parameters: 
2022-04-22 22:17:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938892415209472[0;39m <==    Updates: 0
2022-04-22 22:17:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938892415209472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:17:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938913395118080[0;39m 生成今日电子书快照开始
2022-04-22 22:17:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938913395118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938913395118080[0;39m ==> Parameters: 
2022-04-22 22:17:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938913395118080[0;39m <==    Updates: 0
2022-04-22 22:17:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938913395118080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:17:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938934366638080[0;39m 生成今日电子书快照开始
2022-04-22 22:17:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938934366638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938934366638080[0;39m ==> Parameters: 
2022-04-22 22:17:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938934366638080[0;39m <==    Updates: 0
2022-04-22 22:17:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938934366638080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:17:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172938934630879232[0;39m start updating Ebook doc
2022-04-22 22:17:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938934630879232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:17:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938934630879232[0;39m ==> Parameters: 
2022-04-22 22:17:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172938934630879232[0;39m <==    Updates: 1
2022-04-22 22:17:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172938934630879232[0;39m update ends, take 42 millisecs
2022-04-22 22:17:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938955346546688[0;39m 生成今日电子书快照开始
2022-04-22 22:17:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938955346546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938955346546688[0;39m ==> Parameters: 
2022-04-22 22:17:40.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938955346546688[0;39m <==    Updates: 0
2022-04-22 22:17:40.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938955346546688[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 22:17:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938976309678080[0;39m 生成今日电子书快照开始
2022-04-22 22:17:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938976309678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938976309678080[0;39m ==> Parameters: 
2022-04-22 22:17:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938976309678080[0;39m <==    Updates: 0
2022-04-22 22:17:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938976309678080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:17:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172938997277003776[0;39m 生成今日电子书快照开始
2022-04-22 22:17:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938997277003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938997277003776[0;39m ==> Parameters: 
2022-04-22 22:17:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172938997277003776[0;39m <==    Updates: 0
2022-04-22 22:17:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172938997277003776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:17:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939018248523776[0;39m 生成今日电子书快照开始
2022-04-22 22:17:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939018248523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:17:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939018248523776[0;39m ==> Parameters: 
2022-04-22 22:17:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939018248523776[0;39m <==    Updates: 0
2022-04-22 22:17:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939018248523776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:18:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939039220043776[0;39m 生成今日电子书快照开始
2022-04-22 22:18:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939039220043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939039220043776[0;39m ==> Parameters: 
2022-04-22 22:18:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939039220043776[0;39m <==    Updates: 0
2022-04-22 22:18:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939039220043776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:18:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939060195758080[0;39m 生成今日电子书快照开始
2022-04-22 22:18:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939060195758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939060195758080[0;39m ==> Parameters: 
2022-04-22 22:18:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939060195758080[0;39m <==    Updates: 0
2022-04-22 22:18:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939060195758080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:18:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939060439027712[0;39m start updating Ebook doc
2022-04-22 22:18:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939060439027712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:18:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939060439027712[0;39m ==> Parameters: 
2022-04-22 22:18:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939060439027712[0;39m <==    Updates: 1
2022-04-22 22:18:05.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939060439027712[0;39m update ends, take 39 millisecs
2022-04-22 22:18:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939081158889472[0;39m 生成今日电子书快照开始
2022-04-22 22:18:10.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939081158889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:10.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939081158889472[0;39m ==> Parameters: 
2022-04-22 22:18:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939081158889472[0;39m <==    Updates: 0
2022-04-22 22:18:10.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939081158889472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:18:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939102134603776[0;39m 生成今日电子书快照开始
2022-04-22 22:18:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939102134603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939102134603776[0;39m ==> Parameters: 
2022-04-22 22:18:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939102134603776[0;39m <==    Updates: 0
2022-04-22 22:18:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939102134603776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:18:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939123106123776[0;39m 生成今日电子书快照开始
2022-04-22 22:18:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939123106123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939123106123776[0;39m ==> Parameters: 
2022-04-22 22:18:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939123106123776[0;39m <==    Updates: 0
2022-04-22 22:18:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939123106123776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:18:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939144069255168[0;39m 生成今日电子书快照开始
2022-04-22 22:18:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939144069255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939144069255168[0;39m ==> Parameters: 
2022-04-22 22:18:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939144069255168[0;39m <==    Updates: 0
2022-04-22 22:18:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939144069255168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:18:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939165053358080[0;39m 生成今日电子书快照开始
2022-04-22 22:18:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939165053358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939165053358080[0;39m ==> Parameters: 
2022-04-22 22:18:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939165053358080[0;39m <==    Updates: 0
2022-04-22 22:18:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939165053358080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:18:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939186033266688[0;39m 生成今日电子书快照开始
2022-04-22 22:18:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939186033266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:35.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939186033266688[0;39m ==> Parameters: 
2022-04-22 22:18:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939186033266688[0;39m <==    Updates: 0
2022-04-22 22:18:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939186033266688[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:18:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939186255564800[0;39m start updating Ebook doc
2022-04-22 22:18:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939186255564800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:18:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939186255564800[0;39m ==> Parameters: 
2022-04-22 22:18:35.092 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939186255564800[0;39m <==    Updates: 1
2022-04-22 22:18:35.092 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939186255564800[0;39m update ends, take 34 millisecs
2022-04-22 22:18:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939207004786688[0;39m 生成今日电子书快照开始
2022-04-22 22:18:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939207004786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:40.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939207004786688[0;39m ==> Parameters: 
2022-04-22 22:18:40.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939207004786688[0;39m <==    Updates: 0
2022-04-22 22:18:40.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939207004786688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:18:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939227976306688[0;39m 生成今日电子书快照开始
2022-04-22 22:18:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939227976306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939227976306688[0;39m ==> Parameters: 
2022-04-22 22:18:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939227976306688[0;39m <==    Updates: 0
2022-04-22 22:18:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939227976306688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:18:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939248926855168[0;39m 生成今日电子书快照开始
2022-04-22 22:18:50.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939248926855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939248926855168[0;39m ==> Parameters: 
2022-04-22 22:18:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939248926855168[0;39m <==    Updates: 0
2022-04-22 22:18:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939248926855168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:18:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939269915152384[0;39m 生成今日电子书快照开始
2022-04-22 22:18:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939269915152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:18:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939269915152384[0;39m ==> Parameters: 
2022-04-22 22:18:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939269915152384[0;39m <==    Updates: 0
2022-04-22 22:18:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939269915152384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:19:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939290874089472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:00.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939290874089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939290874089472[0;39m ==> Parameters: 
2022-04-22 22:19:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939290874089472[0;39m <==    Updates: 0
2022-04-22 22:19:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939290874089472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:19:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939311845609472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939311845609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939311845609472[0;39m ==> Parameters: 
2022-04-22 22:19:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939311845609472[0;39m <==    Updates: 0
2022-04-22 22:19:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939311845609472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:19:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939312118239232[0;39m start updating Ebook doc
2022-04-22 22:19:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939312118239232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:19:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939312118239232[0;39m ==> Parameters: 
2022-04-22 22:19:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939312118239232[0;39m <==    Updates: 1
2022-04-22 22:19:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939312118239232[0;39m update ends, take 38 millisecs
2022-04-22 22:19:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939332817129472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939332817129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939332817129472[0;39m ==> Parameters: 
2022-04-22 22:19:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939332817129472[0;39m <==    Updates: 0
2022-04-22 22:19:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939332817129472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:19:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939353788649472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939353788649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939353788649472[0;39m ==> Parameters: 
2022-04-22 22:19:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939353788649472[0;39m <==    Updates: 0
2022-04-22 22:19:15.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939353788649472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:19:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939374760169472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:20.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939374760169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939374760169472[0;39m ==> Parameters: 
2022-04-22 22:19:20.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939374760169472[0;39m <==    Updates: 0
2022-04-22 22:19:20.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939374760169472[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:19:24.998 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939395719106560[0;39m 生成今日电子书快照开始
2022-04-22 22:19:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939395719106560[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939395719106560[0;39m ==> Parameters: 
2022-04-22 22:19:25.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939395719106560[0;39m <==    Updates: 0
2022-04-22 22:19:25.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939395719106560[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 22:19:29.999 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939416694820864[0;39m 生成今日电子书快照开始
2022-04-22 22:19:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939416694820864[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939416694820864[0;39m ==> Parameters: 
2022-04-22 22:19:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939416694820864[0;39m <==    Updates: 0
2022-04-22 22:19:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939416694820864[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:19:34.988 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939437620203520[0;39m start updating Ebook doc
2022-04-22 22:19:35.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939437620203520[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:19:35.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939437620203520[0;39m ==> Parameters: 
2022-04-22 22:19:35.054 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939437620203520[0;39m <==    Updates: 1
2022-04-22 22:19:35.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939437620203520[0;39m update ends, take 66 millisecs
2022-04-22 22:19:35.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939437901221888[0;39m 生成今日电子书快照开始
2022-04-22 22:19:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939437901221888[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:35.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939437901221888[0;39m ==> Parameters: 
2022-04-22 22:19:35.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939437901221888[0;39m <==    Updates: 0
2022-04-22 22:19:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939437901221888[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 22:19:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939458650443776[0;39m 生成今日电子书快照开始
2022-04-22 22:19:40.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939458650443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939458650443776[0;39m ==> Parameters: 
2022-04-22 22:19:40.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939458650443776[0;39m <==    Updates: 0
2022-04-22 22:19:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939458650443776[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-22 22:19:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939479613575168[0;39m 生成今日电子书快照开始
2022-04-22 22:19:45.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939479613575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939479613575168[0;39m ==> Parameters: 
2022-04-22 22:19:45.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939479613575168[0;39m <==    Updates: 0
2022-04-22 22:19:45.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939479613575168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:19:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939500589289472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939500589289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939500589289472[0;39m ==> Parameters: 
2022-04-22 22:19:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939500589289472[0;39m <==    Updates: 0
2022-04-22 22:19:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939500589289472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:19:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939521560809472[0;39m 生成今日电子书快照开始
2022-04-22 22:19:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939521560809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:19:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939521560809472[0;39m ==> Parameters: 
2022-04-22 22:19:55.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939521560809472[0;39m <==    Updates: 0
2022-04-22 22:19:55.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939521560809472[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 22:20:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939542528135168[0;39m 生成今日电子书快照开始
2022-04-22 22:20:00.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939542528135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939542528135168[0;39m ==> Parameters: 
2022-04-22 22:20:00.180 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939542528135168[0;39m <==    Updates: 0
2022-04-22 22:20:00.180 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939542528135168[0;39m 生成今日电子书快照结束，耗时：179毫秒
2022-04-22 22:20:04.994 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939563474489344[0;39m start updating Ebook doc
2022-04-22 22:20:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939563474489344[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:20:05.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939563474489344[0;39m ==> Parameters: 
2022-04-22 22:20:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939563474489344[0;39m <==    Updates: 1
2022-04-22 22:20:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939563474489344[0;39m update ends, take 64 millisecs
2022-04-22 22:20:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939563747119104[0;39m 生成今日电子书快照开始
2022-04-22 22:20:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939563747119104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939563747119104[0;39m ==> Parameters: 
2022-04-22 22:20:05.094 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939563747119104[0;39m <==    Updates: 0
2022-04-22 22:20:05.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939563747119104[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-22 22:20:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939584492146688[0;39m 生成今日电子书快照开始
2022-04-22 22:20:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939584492146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939584492146688[0;39m ==> Parameters: 
2022-04-22 22:20:10.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939584492146688[0;39m <==    Updates: 0
2022-04-22 22:20:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939584492146688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:20:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939605442695168[0;39m 生成今日电子书快照开始
2022-04-22 22:20:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939605442695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939605442695168[0;39m ==> Parameters: 
2022-04-22 22:20:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939605442695168[0;39m <==    Updates: 0
2022-04-22 22:20:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939605442695168[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:20:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939626418409472[0;39m 生成今日电子书快照开始
2022-04-22 22:20:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939626418409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939626418409472[0;39m ==> Parameters: 
2022-04-22 22:20:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939626418409472[0;39m <==    Updates: 0
2022-04-22 22:20:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939626418409472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:20:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939647394123776[0;39m 生成今日电子书快照开始
2022-04-22 22:20:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939647394123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939647394123776[0;39m ==> Parameters: 
2022-04-22 22:20:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939647394123776[0;39m <==    Updates: 0
2022-04-22 22:20:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939647394123776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:20:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939668365643776[0;39m 生成今日电子书快照开始
2022-04-22 22:20:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939668365643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939668365643776[0;39m ==> Parameters: 
2022-04-22 22:20:30.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939668365643776[0;39m <==    Updates: 0
2022-04-22 22:20:30.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939668365643776[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 22:20:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939689332969472[0;39m start updating Ebook doc
2022-04-22 22:20:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939689332969472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:20:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939689332969472[0;39m ==> Parameters: 
2022-04-22 22:20:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939689332969472[0;39m <==    Updates: 1
2022-04-22 22:20:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939689332969472[0;39m update ends, take 67 millisecs
2022-04-22 22:20:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939689613987840[0;39m 生成今日电子书快照开始
2022-04-22 22:20:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939689613987840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939689613987840[0;39m ==> Parameters: 
2022-04-22 22:20:35.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939689613987840[0;39m <==    Updates: 0
2022-04-22 22:20:35.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939689613987840[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 22:20:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939710321266688[0;39m 生成今日电子书快照开始
2022-04-22 22:20:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939710321266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:40.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939710321266688[0;39m ==> Parameters: 
2022-04-22 22:20:40.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939710321266688[0;39m <==    Updates: 0
2022-04-22 22:20:40.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939710321266688[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 22:20:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939731276009472[0;39m 生成今日电子书快照开始
2022-04-22 22:20:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939731276009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939731276009472[0;39m ==> Parameters: 
2022-04-22 22:20:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939731276009472[0;39m <==    Updates: 0
2022-04-22 22:20:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939731276009472[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 22:20:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939752264306688[0;39m 生成今日电子书快照开始
2022-04-22 22:20:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939752264306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939752264306688[0;39m ==> Parameters: 
2022-04-22 22:20:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939752264306688[0;39m <==    Updates: 0
2022-04-22 22:20:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939752264306688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:20:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939773214855168[0;39m 生成今日电子书快照开始
2022-04-22 22:20:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939773214855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:20:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939773214855168[0;39m ==> Parameters: 
2022-04-22 22:20:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939773214855168[0;39m <==    Updates: 0
2022-04-22 22:20:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939773214855168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:21:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939794190569472[0;39m 生成今日电子书快照开始
2022-04-22 22:21:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939794190569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939794190569472[0;39m ==> Parameters: 
2022-04-22 22:21:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939794190569472[0;39m <==    Updates: 0
2022-04-22 22:21:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939794190569472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:21:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939815178866688[0;39m 生成今日电子书快照开始
2022-04-22 22:21:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939815178866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939815178866688[0;39m ==> Parameters: 
2022-04-22 22:21:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939815178866688[0;39m <==    Updates: 0
2022-04-22 22:21:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939815178866688[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:21:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939815405359104[0;39m start updating Ebook doc
2022-04-22 22:21:05.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939815405359104[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:21:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939815405359104[0;39m ==> Parameters: 
2022-04-22 22:21:05.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939815405359104[0;39m <==    Updates: 1
2022-04-22 22:21:05.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939815405359104[0;39m update ends, take 37 millisecs
2022-04-22 22:21:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939836141998080[0;39m 生成今日电子书快照开始
2022-04-22 22:21:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939836141998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939836141998080[0;39m ==> Parameters: 
2022-04-22 22:21:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939836141998080[0;39m <==    Updates: 0
2022-04-22 22:21:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939836141998080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:21:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939857105129472[0;39m 生成今日电子书快照开始
2022-04-22 22:21:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939857105129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939857105129472[0;39m ==> Parameters: 
2022-04-22 22:21:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939857105129472[0;39m <==    Updates: 0
2022-04-22 22:21:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939857105129472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:21:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939878093426688[0;39m 生成今日电子书快照开始
2022-04-22 22:21:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939878093426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939878093426688[0;39m ==> Parameters: 
2022-04-22 22:21:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939878093426688[0;39m <==    Updates: 0
2022-04-22 22:21:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939878093426688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:21:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939899064946688[0;39m 生成今日电子书快照开始
2022-04-22 22:21:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939899064946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939899064946688[0;39m ==> Parameters: 
2022-04-22 22:21:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939899064946688[0;39m <==    Updates: 0
2022-04-22 22:21:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939899064946688[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:21:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939920028078080[0;39m 生成今日电子书快照开始
2022-04-22 22:21:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939920028078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939920028078080[0;39m ==> Parameters: 
2022-04-22 22:21:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939920028078080[0;39m <==    Updates: 0
2022-04-22 22:21:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939920028078080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:21:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939940995403776[0;39m 生成今日电子书快照开始
2022-04-22 22:21:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939940995403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939940995403776[0;39m ==> Parameters: 
2022-04-22 22:21:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939940995403776[0;39m <==    Updates: 0
2022-04-22 22:21:35.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939940995403776[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:21:35.079 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172939941318365184[0;39m start updating Ebook doc
2022-04-22 22:21:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939941318365184[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:21:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939941318365184[0;39m ==> Parameters: 
2022-04-22 22:21:35.111 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172939941318365184[0;39m <==    Updates: 1
2022-04-22 22:21:35.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172939941318365184[0;39m update ends, take 32 millisecs
2022-04-22 22:21:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939961962729472[0;39m 生成今日电子书快照开始
2022-04-22 22:21:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939961962729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939961962729472[0;39m ==> Parameters: 
2022-04-22 22:21:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939961962729472[0;39m <==    Updates: 0
2022-04-22 22:21:40.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939961962729472[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-22 22:21:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172939982930055168[0;39m 生成今日电子书快照开始
2022-04-22 22:21:45.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939982930055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:45.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939982930055168[0;39m ==> Parameters: 
2022-04-22 22:21:45.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172939982930055168[0;39m <==    Updates: 0
2022-04-22 22:21:45.052 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172939982930055168[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:21:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940003909963776[0;39m 生成今日电子书快照开始
2022-04-22 22:21:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940003909963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940003909963776[0;39m ==> Parameters: 
2022-04-22 22:21:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940003909963776[0;39m <==    Updates: 0
2022-04-22 22:21:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940003909963776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:21:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940024877289472[0;39m 生成今日电子书快照开始
2022-04-22 22:21:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940024877289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:21:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940024877289472[0;39m ==> Parameters: 
2022-04-22 22:21:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940024877289472[0;39m <==    Updates: 0
2022-04-22 22:21:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940024877289472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:22:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940045857198080[0;39m 生成今日电子书快照开始
2022-04-22 22:22:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940045857198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940045857198080[0;39m ==> Parameters: 
2022-04-22 22:22:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940045857198080[0;39m <==    Updates: 0
2022-04-22 22:22:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940045857198080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:22:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940066820329472[0;39m 生成今日电子书快照开始
2022-04-22 22:22:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940066820329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940066820329472[0;39m ==> Parameters: 
2022-04-22 22:22:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940066820329472[0;39m <==    Updates: 0
2022-04-22 22:22:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940066820329472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:22:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940067071987712[0;39m start updating Ebook doc
2022-04-22 22:22:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940067071987712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:22:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940067071987712[0;39m ==> Parameters: 
2022-04-22 22:22:05.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940067071987712[0;39m <==    Updates: 1
2022-04-22 22:22:05.095 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940067071987712[0;39m update ends, take 34 millisecs
2022-04-22 22:22:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940087808626688[0;39m 生成今日电子书快照开始
2022-04-22 22:22:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940087808626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940087808626688[0;39m ==> Parameters: 
2022-04-22 22:22:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940087808626688[0;39m <==    Updates: 0
2022-04-22 22:22:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940087808626688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:22:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940108763369472[0;39m 生成今日电子书快照开始
2022-04-22 22:22:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940108763369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940108763369472[0;39m ==> Parameters: 
2022-04-22 22:22:15.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940108763369472[0;39m <==    Updates: 0
2022-04-22 22:22:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940108763369472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:22:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940129751666688[0;39m 生成今日电子书快照开始
2022-04-22 22:22:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940129751666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940129751666688[0;39m ==> Parameters: 
2022-04-22 22:22:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940129751666688[0;39m <==    Updates: 0
2022-04-22 22:22:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940129751666688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:22:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940150706409472[0;39m 生成今日电子书快照开始
2022-04-22 22:22:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940150706409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940150706409472[0;39m ==> Parameters: 
2022-04-22 22:22:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940150706409472[0;39m <==    Updates: 0
2022-04-22 22:22:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940150706409472[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:22:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940171686318080[0;39m 生成今日电子书快照开始
2022-04-22 22:22:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940171686318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940171686318080[0;39m ==> Parameters: 
2022-04-22 22:22:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940171686318080[0;39m <==    Updates: 0
2022-04-22 22:22:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940171686318080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:22:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940192645255168[0;39m 生成今日电子书快照开始
2022-04-22 22:22:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940192645255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:35.237 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940192645255168[0;39m ==> Parameters: 
2022-04-22 22:22:35.299 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940192645255168[0;39m <==    Updates: 0
2022-04-22 22:22:35.300 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940192645255168[0;39m 生成今日电子书快照结束，耗时：300毫秒
2022-04-22 22:22:35.300 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940193903546368[0;39m start updating Ebook doc
2022-04-22 22:22:35.300 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940193903546368[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:22:35.300 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940193903546368[0;39m ==> Parameters: 
2022-04-22 22:22:35.345 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940193903546368[0;39m <==    Updates: 1
2022-04-22 22:22:35.346 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940193903546368[0;39m update ends, take 46 millisecs
2022-04-22 22:22:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940213616775168[0;39m 生成今日电子书快照开始
2022-04-22 22:22:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940213616775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:40.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940213616775168[0;39m ==> Parameters: 
2022-04-22 22:22:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940213616775168[0;39m <==    Updates: 0
2022-04-22 22:22:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940213616775168[0;39m 生成今日电子书快照结束，耗时：86毫秒
2022-04-22 22:22:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940234592489472[0;39m 生成今日电子书快照开始
2022-04-22 22:22:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940234592489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:45.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940234592489472[0;39m ==> Parameters: 
2022-04-22 22:22:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940234592489472[0;39m <==    Updates: 0
2022-04-22 22:22:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940234592489472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:22:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940255576592384[0;39m 生成今日电子书快照开始
2022-04-22 22:22:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940255576592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940255576592384[0;39m ==> Parameters: 
2022-04-22 22:22:50.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940255576592384[0;39m <==    Updates: 0
2022-04-22 22:22:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940255576592384[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:22:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940276535529472[0;39m 生成今日电子书快照开始
2022-04-22 22:22:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940276535529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:22:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940276535529472[0;39m ==> Parameters: 
2022-04-22 22:22:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940276535529472[0;39m <==    Updates: 0
2022-04-22 22:22:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940276535529472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:23:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940297523826688[0;39m 生成今日电子书快照开始
2022-04-22 22:23:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940297523826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940297523826688[0;39m ==> Parameters: 
2022-04-22 22:23:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940297523826688[0;39m <==    Updates: 0
2022-04-22 22:23:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940297523826688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:23:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940318491152384[0;39m 生成今日电子书快照开始
2022-04-22 22:23:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940318491152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940318491152384[0;39m ==> Parameters: 
2022-04-22 22:23:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940318491152384[0;39m <==    Updates: 0
2022-04-22 22:23:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940318491152384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:23:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940318763782144[0;39m start updating Ebook doc
2022-04-22 22:23:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940318763782144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:23:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940318763782144[0;39m ==> Parameters: 
2022-04-22 22:23:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940318763782144[0;39m <==    Updates: 1
2022-04-22 22:23:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940318763782144[0;39m update ends, take 35 millisecs
2022-04-22 22:23:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940339450089472[0;39m 生成今日电子书快照开始
2022-04-22 22:23:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940339450089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940339450089472[0;39m ==> Parameters: 
2022-04-22 22:23:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940339450089472[0;39m <==    Updates: 0
2022-04-22 22:23:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940339450089472[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 22:23:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940360434192384[0;39m 生成今日电子书快照开始
2022-04-22 22:23:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940360434192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940360434192384[0;39m ==> Parameters: 
2022-04-22 22:23:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940360434192384[0;39m <==    Updates: 0
2022-04-22 22:23:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940360434192384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:23:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940381409906688[0;39m 生成今日电子书快照开始
2022-04-22 22:23:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940381409906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940381409906688[0;39m ==> Parameters: 
2022-04-22 22:23:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940381409906688[0;39m <==    Updates: 0
2022-04-22 22:23:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940381409906688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:23:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940402368843776[0;39m 生成今日电子书快照开始
2022-04-22 22:23:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940402368843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940402368843776[0;39m ==> Parameters: 
2022-04-22 22:23:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940402368843776[0;39m <==    Updates: 0
2022-04-22 22:23:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940402368843776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:23:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940423357140992[0;39m 生成今日电子书快照开始
2022-04-22 22:23:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940423357140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940423357140992[0;39m ==> Parameters: 
2022-04-22 22:23:30.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940423357140992[0;39m <==    Updates: 0
2022-04-22 22:23:30.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940423357140992[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:23:35.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940444303495168[0;39m start updating Ebook doc
2022-04-22 22:23:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940444303495168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:23:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940444303495168[0;39m ==> Parameters: 
2022-04-22 22:23:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940444303495168[0;39m <==    Updates: 1
2022-04-22 22:23:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940444303495168[0;39m update ends, take 63 millisecs
2022-04-22 22:23:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940444571930624[0;39m 生成今日电子书快照开始
2022-04-22 22:23:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940444571930624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940444571930624[0;39m ==> Parameters: 
2022-04-22 22:23:35.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940444571930624[0;39m <==    Updates: 0
2022-04-22 22:23:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940444571930624[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 22:23:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940465283403776[0;39m 生成今日电子书快照开始
2022-04-22 22:23:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940465283403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940465283403776[0;39m ==> Parameters: 
2022-04-22 22:23:40.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940465283403776[0;39m <==    Updates: 0
2022-04-22 22:23:40.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940465283403776[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 22:23:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940486246535168[0;39m 生成今日电子书快照开始
2022-04-22 22:23:45.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940486246535168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:45.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940486246535168[0;39m ==> Parameters: 
2022-04-22 22:23:45.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940486246535168[0;39m <==    Updates: 0
2022-04-22 22:23:45.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940486246535168[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:23:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940507226443776[0;39m 生成今日电子书快照开始
2022-04-22 22:23:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940507226443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940507226443776[0;39m ==> Parameters: 
2022-04-22 22:23:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940507226443776[0;39m <==    Updates: 0
2022-04-22 22:23:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940507226443776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:23:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940528193769472[0;39m 生成今日电子书快照开始
2022-04-22 22:23:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940528193769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:23:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940528193769472[0;39m ==> Parameters: 
2022-04-22 22:23:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940528193769472[0;39m <==    Updates: 0
2022-04-22 22:23:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940528193769472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:24:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940549161095168[0;39m 生成今日电子书快照开始
2022-04-22 22:24:00.015 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940549161095168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:00.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940549161095168[0;39m ==> Parameters: 
2022-04-22 22:24:00.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940549161095168[0;39m <==    Updates: 0
2022-04-22 22:24:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940549161095168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:24:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940570136809472[0;39m 生成今日电子书快照开始
2022-04-22 22:24:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940570136809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940570136809472[0;39m ==> Parameters: 
2022-04-22 22:24:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940570136809472[0;39m <==    Updates: 0
2022-04-22 22:24:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940570136809472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:24:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940570384273408[0;39m start updating Ebook doc
2022-04-22 22:24:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940570384273408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:24:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940570384273408[0;39m ==> Parameters: 
2022-04-22 22:24:05.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940570384273408[0;39m <==    Updates: 1
2022-04-22 22:24:05.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940570384273408[0;39m update ends, take 36 millisecs
2022-04-22 22:24:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940591108329472[0;39m 生成今日电子书快照开始
2022-04-22 22:24:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940591108329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940591108329472[0;39m ==> Parameters: 
2022-04-22 22:24:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940591108329472[0;39m <==    Updates: 0
2022-04-22 22:24:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940591108329472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:24:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940612075655168[0;39m 生成今日电子书快照开始
2022-04-22 22:24:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940612075655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940612075655168[0;39m ==> Parameters: 
2022-04-22 22:24:15.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940612075655168[0;39m <==    Updates: 0
2022-04-22 22:24:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940612075655168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:24:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940633063952384[0;39m 生成今日电子书快照开始
2022-04-22 22:24:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940633063952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940633063952384[0;39m ==> Parameters: 
2022-04-22 22:24:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940633063952384[0;39m <==    Updates: 0
2022-04-22 22:24:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940633063952384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:24:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940654022889472[0;39m 生成今日电子书快照开始
2022-04-22 22:24:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940654022889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940654022889472[0;39m ==> Parameters: 
2022-04-22 22:24:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940654022889472[0;39m <==    Updates: 0
2022-04-22 22:24:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940654022889472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:24:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940675011186688[0;39m 生成今日电子书快照开始
2022-04-22 22:24:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940675011186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940675011186688[0;39m ==> Parameters: 
2022-04-22 22:24:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940675011186688[0;39m <==    Updates: 0
2022-04-22 22:24:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940675011186688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:24:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940695974318080[0;39m 生成今日电子书快照开始
2022-04-22 22:24:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940695974318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940695974318080[0;39m ==> Parameters: 
2022-04-22 22:24:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940695974318080[0;39m <==    Updates: 0
2022-04-22 22:24:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940695974318080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:24:35.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940696230170624[0;39m start updating Ebook doc
2022-04-22 22:24:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940696230170624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:24:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940696230170624[0;39m ==> Parameters: 
2022-04-22 22:24:35.098 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940696230170624[0;39m <==    Updates: 1
2022-04-22 22:24:35.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940696230170624[0;39m update ends, take 34 millisecs
2022-04-22 22:24:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940716937449472[0;39m 生成今日电子书快照开始
2022-04-22 22:24:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940716937449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940716937449472[0;39m ==> Parameters: 
2022-04-22 22:24:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940716937449472[0;39m <==    Updates: 0
2022-04-22 22:24:40.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940716937449472[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:24:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940737913163776[0;39m 生成今日电子书快照开始
2022-04-22 22:24:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940737913163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940737913163776[0;39m ==> Parameters: 
2022-04-22 22:24:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940737913163776[0;39m <==    Updates: 0
2022-04-22 22:24:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940737913163776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:24:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940758897266688[0;39m 生成今日电子书快照开始
2022-04-22 22:24:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940758897266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940758897266688[0;39m ==> Parameters: 
2022-04-22 22:24:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940758897266688[0;39m <==    Updates: 0
2022-04-22 22:24:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940758897266688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:24:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940779852009472[0;39m 生成今日电子书快照开始
2022-04-22 22:24:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940779852009472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:24:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940779852009472[0;39m ==> Parameters: 
2022-04-22 22:24:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940779852009472[0;39m <==    Updates: 0
2022-04-22 22:24:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940779852009472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:25:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940800823529472[0;39m 生成今日电子书快照开始
2022-04-22 22:25:00.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940800823529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:00.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940800823529472[0;39m ==> Parameters: 
2022-04-22 22:25:00.171 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940800823529472[0;39m <==    Updates: 0
2022-04-22 22:25:00.172 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940800823529472[0;39m 生成今日电子书快照结束，耗时：170毫秒
2022-04-22 22:25:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940821820215296[0;39m 生成今日电子书快照开始
2022-04-22 22:25:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940821820215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940821820215296[0;39m ==> Parameters: 
2022-04-22 22:25:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940821820215296[0;39m <==    Updates: 0
2022-04-22 22:25:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940821820215296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:25:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940822080262144[0;39m start updating Ebook doc
2022-04-22 22:25:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940822080262144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:25:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940822080262144[0;39m ==> Parameters: 
2022-04-22 22:25:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940822080262144[0;39m <==    Updates: 1
2022-04-22 22:25:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940822080262144[0;39m update ends, take 34 millisecs
2022-04-22 22:25:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940842779152384[0;39m 生成今日电子书快照开始
2022-04-22 22:25:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940842779152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940842779152384[0;39m ==> Parameters: 
2022-04-22 22:25:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940842779152384[0;39m <==    Updates: 0
2022-04-22 22:25:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940842779152384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:25:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940863759060992[0;39m 生成今日电子书快照开始
2022-04-22 22:25:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940863759060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940863759060992[0;39m ==> Parameters: 
2022-04-22 22:25:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940863759060992[0;39m <==    Updates: 0
2022-04-22 22:25:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940863759060992[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:25:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940884743163904[0;39m 生成今日电子书快照开始
2022-04-22 22:25:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940884743163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940884743163904[0;39m ==> Parameters: 
2022-04-22 22:25:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940884743163904[0;39m <==    Updates: 0
2022-04-22 22:25:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940884743163904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:25:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940905681129472[0;39m 生成今日电子书快照开始
2022-04-22 22:25:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940905681129472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940905681129472[0;39m ==> Parameters: 
2022-04-22 22:25:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940905681129472[0;39m <==    Updates: 0
2022-04-22 22:25:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940905681129472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:25:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940926690398208[0;39m 生成今日电子书快照开始
2022-04-22 22:25:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940926690398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940926690398208[0;39m ==> Parameters: 
2022-04-22 22:25:30.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940926690398208[0;39m <==    Updates: 0
2022-04-22 22:25:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940926690398208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:25:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940947624169472[0;39m 生成今日电子书快照开始
2022-04-22 22:25:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940947624169472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940947624169472[0;39m ==> Parameters: 
2022-04-22 22:25:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940947624169472[0;39m <==    Updates: 0
2022-04-22 22:25:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940947624169472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:25:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172940947880022016[0;39m start updating Ebook doc
2022-04-22 22:25:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940947880022016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:25:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940947880022016[0;39m ==> Parameters: 
2022-04-22 22:25:35.135 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172940947880022016[0;39m <==    Updates: 1
2022-04-22 22:25:35.135 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172940947880022016[0;39m update ends, take 72 millisecs
2022-04-22 22:25:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940968625049600[0;39m 生成今日电子书快照开始
2022-04-22 22:25:40.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940968625049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940968625049600[0;39m ==> Parameters: 
2022-04-22 22:25:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940968625049600[0;39m <==    Updates: 0
2022-04-22 22:25:40.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940968625049600[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 22:25:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172940989588180992[0;39m 生成今日电子书快照开始
2022-04-22 22:25:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940989588180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940989588180992[0;39m ==> Parameters: 
2022-04-22 22:25:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172940989588180992[0;39m <==    Updates: 0
2022-04-22 22:25:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172940989588180992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:25:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941010559700992[0;39m 生成今日电子书快照开始
2022-04-22 22:25:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941010559700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941010559700992[0;39m ==> Parameters: 
2022-04-22 22:25:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941010559700992[0;39m <==    Updates: 0
2022-04-22 22:25:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941010559700992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:25:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941031514443776[0;39m 生成今日电子书快照开始
2022-04-22 22:25:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941031514443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:25:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941031514443776[0;39m ==> Parameters: 
2022-04-22 22:25:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941031514443776[0;39m <==    Updates: 0
2022-04-22 22:25:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941031514443776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:26:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941052519518208[0;39m 生成今日电子书快照开始
2022-04-22 22:26:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941052519518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941052519518208[0;39m ==> Parameters: 
2022-04-22 22:26:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941052519518208[0;39m <==    Updates: 0
2022-04-22 22:26:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941052519518208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:26:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941073478455296[0;39m 生成今日电子书快照开始
2022-04-22 22:26:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941073478455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941073478455296[0;39m ==> Parameters: 
2022-04-22 22:26:05.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941073478455296[0;39m <==    Updates: 0
2022-04-22 22:26:05.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941073478455296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:26:05.078 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941073776250880[0;39m start updating Ebook doc
2022-04-22 22:26:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941073776250880[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:26:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941073776250880[0;39m ==> Parameters: 
2022-04-22 22:26:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941073776250880[0;39m <==    Updates: 1
2022-04-22 22:26:05.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941073776250880[0;39m update ends, take 33 millisecs
2022-04-22 22:26:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941094462558208[0;39m 生成今日电子书快照开始
2022-04-22 22:26:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941094462558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941094462558208[0;39m ==> Parameters: 
2022-04-22 22:26:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941094462558208[0;39m <==    Updates: 0
2022-04-22 22:26:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941094462558208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:26:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941115425689600[0;39m 生成今日电子书快照开始
2022-04-22 22:26:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941115425689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941115425689600[0;39m ==> Parameters: 
2022-04-22 22:26:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941115425689600[0;39m <==    Updates: 0
2022-04-22 22:26:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941115425689600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:26:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941136372043776[0;39m 生成今日电子书快照开始
2022-04-22 22:26:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941136372043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941136372043776[0;39m ==> Parameters: 
2022-04-22 22:26:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941136372043776[0;39m <==    Updates: 0
2022-04-22 22:26:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941136372043776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:26:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941157377118208[0;39m 生成今日电子书快照开始
2022-04-22 22:26:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941157377118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941157377118208[0;39m ==> Parameters: 
2022-04-22 22:26:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941157377118208[0;39m <==    Updates: 0
2022-04-22 22:26:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941157377118208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:26:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941178340249600[0;39m 生成今日电子书快照开始
2022-04-22 22:26:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941178340249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941178340249600[0;39m ==> Parameters: 
2022-04-22 22:26:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941178340249600[0;39m <==    Updates: 0
2022-04-22 22:26:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941178340249600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:26:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941199315963904[0;39m 生成今日电子书快照开始
2022-04-22 22:26:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941199315963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941199315963904[0;39m ==> Parameters: 
2022-04-22 22:26:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941199315963904[0;39m <==    Updates: 0
2022-04-22 22:26:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941199315963904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:26:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941199584399360[0;39m start updating Ebook doc
2022-04-22 22:26:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941199584399360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:26:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941199584399360[0;39m ==> Parameters: 
2022-04-22 22:26:35.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941199584399360[0;39m <==    Updates: 1
2022-04-22 22:26:35.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941199584399360[0;39m update ends, take 40 millisecs
2022-04-22 22:26:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941220287483904[0;39m 生成今日电子书快照开始
2022-04-22 22:26:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941220287483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941220287483904[0;39m ==> Parameters: 
2022-04-22 22:26:40.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941220287483904[0;39m <==    Updates: 0
2022-04-22 22:26:40.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941220287483904[0;39m 生成今日电子书快照结束，耗时：95毫秒
2022-04-22 22:26:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941241263198208[0;39m 生成今日电子书快照开始
2022-04-22 22:26:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941241263198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941241263198208[0;39m ==> Parameters: 
2022-04-22 22:26:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941241263198208[0;39m <==    Updates: 0
2022-04-22 22:26:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941241263198208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:26:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941262230523904[0;39m 生成今日电子书快照开始
2022-04-22 22:26:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941262230523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941262230523904[0;39m ==> Parameters: 
2022-04-22 22:26:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941262230523904[0;39m <==    Updates: 0
2022-04-22 22:26:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941262230523904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:26:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941283189460992[0;39m 生成今日电子书快照开始
2022-04-22 22:26:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941283189460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:26:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941283189460992[0;39m ==> Parameters: 
2022-04-22 22:26:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941283189460992[0;39m <==    Updates: 0
2022-04-22 22:26:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941283189460992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:27:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941304144203776[0;39m 生成今日电子书快照开始
2022-04-22 22:27:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941304144203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941304144203776[0;39m ==> Parameters: 
2022-04-22 22:27:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941304144203776[0;39m <==    Updates: 0
2022-04-22 22:27:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941304144203776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:27:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941325111529472[0;39m 生成今日电子书快照开始
2022-04-22 22:27:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941325111529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941325111529472[0;39m ==> Parameters: 
2022-04-22 22:27:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941325111529472[0;39m <==    Updates: 0
2022-04-22 22:27:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941325111529472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:27:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941325392547840[0;39m start updating Ebook doc
2022-04-22 22:27:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941325392547840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:27:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941325392547840[0;39m ==> Parameters: 
2022-04-22 22:27:05.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941325392547840[0;39m <==    Updates: 1
2022-04-22 22:27:05.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941325392547840[0;39m update ends, take 35 millisecs
2022-04-22 22:27:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941346091438080[0;39m 生成今日电子书快照开始
2022-04-22 22:27:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941346091438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941346091438080[0;39m ==> Parameters: 
2022-04-22 22:27:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941346091438080[0;39m <==    Updates: 0
2022-04-22 22:27:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941346091438080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:27:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941367062958080[0;39m 生成今日电子书快照开始
2022-04-22 22:27:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941367062958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941367062958080[0;39m ==> Parameters: 
2022-04-22 22:27:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941367062958080[0;39m <==    Updates: 0
2022-04-22 22:27:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941367062958080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:27:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941388026089472[0;39m 生成今日电子书快照开始
2022-04-22 22:27:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941388026089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941388026089472[0;39m ==> Parameters: 
2022-04-22 22:27:20.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941388026089472[0;39m <==    Updates: 0
2022-04-22 22:27:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941388026089472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:27:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941409035358208[0;39m 生成今日电子书快照开始
2022-04-22 22:27:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941409035358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941409035358208[0;39m ==> Parameters: 
2022-04-22 22:27:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941409035358208[0;39m <==    Updates: 0
2022-04-22 22:27:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941409035358208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:27:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941429977518080[0;39m 生成今日电子书快照开始
2022-04-22 22:27:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941429977518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941429977518080[0;39m ==> Parameters: 
2022-04-22 22:27:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941429977518080[0;39m <==    Updates: 0
2022-04-22 22:27:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941429977518080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:27:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941450949038080[0;39m 生成今日电子书快照开始
2022-04-22 22:27:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941450949038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941450949038080[0;39m ==> Parameters: 
2022-04-22 22:27:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941450949038080[0;39m <==    Updates: 0
2022-04-22 22:27:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941450949038080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:27:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941451213279232[0;39m start updating Ebook doc
2022-04-22 22:27:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941451213279232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:27:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941451213279232[0;39m ==> Parameters: 
2022-04-22 22:27:35.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941451213279232[0;39m <==    Updates: 1
2022-04-22 22:27:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941451213279232[0;39m update ends, take 38 millisecs
2022-04-22 22:27:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941471945723904[0;39m 生成今日电子书快照开始
2022-04-22 22:27:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941471945723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:40.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941471945723904[0;39m ==> Parameters: 
2022-04-22 22:27:40.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941471945723904[0;39m <==    Updates: 0
2022-04-22 22:27:40.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941471945723904[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:27:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941492883689472[0;39m 生成今日电子书快照开始
2022-04-22 22:27:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941492883689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941492883689472[0;39m ==> Parameters: 
2022-04-22 22:27:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941492883689472[0;39m <==    Updates: 0
2022-04-22 22:27:45.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941492883689472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:27:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941513863598080[0;39m 生成今日电子书快照开始
2022-04-22 22:27:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941513863598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941513863598080[0;39m ==> Parameters: 
2022-04-22 22:27:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941513863598080[0;39m <==    Updates: 0
2022-04-22 22:27:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941513863598080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:27:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941534835118080[0;39m 生成今日电子书快照开始
2022-04-22 22:27:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941534835118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:27:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941534835118080[0;39m ==> Parameters: 
2022-04-22 22:27:55.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941534835118080[0;39m <==    Updates: 0
2022-04-22 22:27:55.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941534835118080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:28:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941555835998208[0;39m 生成今日电子书快照开始
2022-04-22 22:28:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941555835998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941555835998208[0;39m ==> Parameters: 
2022-04-22 22:28:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941555835998208[0;39m <==    Updates: 0
2022-04-22 22:28:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941555835998208[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:28:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941576778158080[0;39m 生成今日电子书快照开始
2022-04-22 22:28:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941576778158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941576778158080[0;39m ==> Parameters: 
2022-04-22 22:28:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941576778158080[0;39m <==    Updates: 0
2022-04-22 22:28:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941576778158080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:28:05.060 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941577017233408[0;39m start updating Ebook doc
2022-04-22 22:28:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941577017233408[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:28:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941577017233408[0;39m ==> Parameters: 
2022-04-22 22:28:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941577017233408[0;39m <==    Updates: 1
2022-04-22 22:28:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941577017233408[0;39m update ends, take 38 millisecs
2022-04-22 22:28:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941597770649600[0;39m 生成今日电子书快照开始
2022-04-22 22:28:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941597770649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941597770649600[0;39m ==> Parameters: 
2022-04-22 22:28:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941597770649600[0;39m <==    Updates: 0
2022-04-22 22:28:10.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941597770649600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:28:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941618721198080[0;39m 生成今日电子书快照开始
2022-04-22 22:28:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941618721198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941618721198080[0;39m ==> Parameters: 
2022-04-22 22:28:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941618721198080[0;39m <==    Updates: 0
2022-04-22 22:28:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941618721198080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:28:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941639692718080[0;39m 生成今日电子书快照开始
2022-04-22 22:28:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941639692718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941639692718080[0;39m ==> Parameters: 
2022-04-22 22:28:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941639692718080[0;39m <==    Updates: 0
2022-04-22 22:28:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941639692718080[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:28:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941660664238080[0;39m 生成今日电子书快照开始
2022-04-22 22:28:25.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941660664238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941660664238080[0;39m ==> Parameters: 
2022-04-22 22:28:25.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941660664238080[0;39m <==    Updates: 0
2022-04-22 22:28:25.054 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941660664238080[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 22:28:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941681635758080[0;39m 生成今日电子书快照开始
2022-04-22 22:28:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941681635758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941681635758080[0;39m ==> Parameters: 
2022-04-22 22:28:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941681635758080[0;39m <==    Updates: 0
2022-04-22 22:28:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941681635758080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:28:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941702607278080[0;39m 生成今日电子书快照开始
2022-04-22 22:28:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941702607278080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941702607278080[0;39m ==> Parameters: 
2022-04-22 22:28:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941702607278080[0;39m <==    Updates: 0
2022-04-22 22:28:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941702607278080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:28:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941702850547712[0;39m start updating Ebook doc
2022-04-22 22:28:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941702850547712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:28:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941702850547712[0;39m ==> Parameters: 
2022-04-22 22:28:35.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941702850547712[0;39m <==    Updates: 1
2022-04-22 22:28:35.103 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941702850547712[0;39m update ends, take 42 millisecs
2022-04-22 22:28:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941723599769600[0;39m 生成今日电子书快照开始
2022-04-22 22:28:40.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941723599769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941723599769600[0;39m ==> Parameters: 
2022-04-22 22:28:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941723599769600[0;39m <==    Updates: 0
2022-04-22 22:28:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941723599769600[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:28:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941744579678208[0;39m 生成今日电子书快照开始
2022-04-22 22:28:45.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941744579678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:45.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941744579678208[0;39m ==> Parameters: 
2022-04-22 22:28:45.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941744579678208[0;39m <==    Updates: 0
2022-04-22 22:28:45.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941744579678208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:28:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941765509255168[0;39m 生成今日电子书快照开始
2022-04-22 22:28:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941765509255168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941765509255168[0;39m ==> Parameters: 
2022-04-22 22:28:50.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941765509255168[0;39m <==    Updates: 0
2022-04-22 22:28:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941765509255168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:28:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941786501746688[0;39m 生成今日电子书快照开始
2022-04-22 22:28:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941786501746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:28:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941786501746688[0;39m ==> Parameters: 
2022-04-22 22:28:55.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941786501746688[0;39m <==    Updates: 0
2022-04-22 22:28:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941786501746688[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 22:29:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941807490043904[0;39m 生成今日电子书快照开始
2022-04-22 22:29:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941807490043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941807490043904[0;39m ==> Parameters: 
2022-04-22 22:29:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941807490043904[0;39m <==    Updates: 0
2022-04-22 22:29:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941807490043904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:29:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941828432203776[0;39m 生成今日电子书快照开始
2022-04-22 22:29:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941828432203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941828432203776[0;39m ==> Parameters: 
2022-04-22 22:29:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941828432203776[0;39m <==    Updates: 0
2022-04-22 22:29:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941828432203776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:29:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941828704833536[0;39m start updating Ebook doc
2022-04-22 22:29:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941828704833536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:29:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941828704833536[0;39m ==> Parameters: 
2022-04-22 22:29:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941828704833536[0;39m <==    Updates: 1
2022-04-22 22:29:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941828704833536[0;39m update ends, take 38 millisecs
2022-04-22 22:29:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941849412112384[0;39m 生成今日电子书快照开始
2022-04-22 22:29:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941849412112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941849412112384[0;39m ==> Parameters: 
2022-04-22 22:29:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941849412112384[0;39m <==    Updates: 0
2022-04-22 22:29:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941849412112384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:29:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941870379438080[0;39m 生成今日电子书快照开始
2022-04-22 22:29:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941870379438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941870379438080[0;39m ==> Parameters: 
2022-04-22 22:29:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941870379438080[0;39m <==    Updates: 0
2022-04-22 22:29:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941870379438080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:29:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941891363540992[0;39m 生成今日电子书快照开始
2022-04-22 22:29:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941891363540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941891363540992[0;39m ==> Parameters: 
2022-04-22 22:29:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941891363540992[0;39m <==    Updates: 0
2022-04-22 22:29:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941891363540992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:29:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941912326672384[0;39m 生成今日电子书快照开始
2022-04-22 22:29:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941912326672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941912326672384[0;39m ==> Parameters: 
2022-04-22 22:29:25.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941912326672384[0;39m <==    Updates: 0
2022-04-22 22:29:25.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941912326672384[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:29:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941933298192384[0;39m 生成今日电子书快照开始
2022-04-22 22:29:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941933298192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941933298192384[0;39m ==> Parameters: 
2022-04-22 22:29:30.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941933298192384[0;39m <==    Updates: 0
2022-04-22 22:29:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941933298192384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:29:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172941954269712384[0;39m start updating Ebook doc
2022-04-22 22:29:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941954269712384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:29:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941954269712384[0;39m ==> Parameters: 
2022-04-22 22:29:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172941954269712384[0;39m <==    Updates: 1
2022-04-22 22:29:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172941954269712384[0;39m update ends, take 67 millisecs
2022-04-22 22:29:35.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941954559119360[0;39m 生成今日电子书快照开始
2022-04-22 22:29:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941954559119360[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941954559119360[0;39m ==> Parameters: 
2022-04-22 22:29:35.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941954559119360[0;39m <==    Updates: 0
2022-04-22 22:29:35.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941954559119360[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 22:29:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941975237038080[0;39m 生成今日电子书快照开始
2022-04-22 22:29:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941975237038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941975237038080[0;39m ==> Parameters: 
2022-04-22 22:29:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941975237038080[0;39m <==    Updates: 0
2022-04-22 22:29:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941975237038080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:29:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172941996208558080[0;39m 生成今日电子书快照开始
2022-04-22 22:29:45.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941996208558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:45.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941996208558080[0;39m ==> Parameters: 
2022-04-22 22:29:45.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172941996208558080[0;39m <==    Updates: 0
2022-04-22 22:29:45.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172941996208558080[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 22:29:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942017192660992[0;39m 生成今日电子书快照开始
2022-04-22 22:29:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942017192660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942017192660992[0;39m ==> Parameters: 
2022-04-22 22:29:50.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942017192660992[0;39m <==    Updates: 0
2022-04-22 22:29:50.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942017192660992[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 22:29:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942038176763904[0;39m 生成今日电子书快照开始
2022-04-22 22:29:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942038176763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:29:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942038176763904[0;39m ==> Parameters: 
2022-04-22 22:29:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942038176763904[0;39m <==    Updates: 0
2022-04-22 22:29:55.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942038176763904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:30:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942059144089600[0;39m 生成今日电子书快照开始
2022-04-22 22:30:00.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942059144089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:00.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942059144089600[0;39m ==> Parameters: 
2022-04-22 22:30:00.202 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942059144089600[0;39m <==    Updates: 0
2022-04-22 22:30:00.202 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942059144089600[0;39m 生成今日电子书快照结束，耗时：194毫秒
2022-04-22 22:30:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942080098832384[0;39m start updating Ebook doc
2022-04-22 22:30:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942080098832384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:30:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942080098832384[0;39m ==> Parameters: 
2022-04-22 22:30:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942080098832384[0;39m <==    Updates: 1
2022-04-22 22:30:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942080098832384[0;39m update ends, take 63 millisecs
2022-04-22 22:30:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942080363073536[0;39m 生成今日电子书快照开始
2022-04-22 22:30:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942080363073536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942080363073536[0;39m ==> Parameters: 
2022-04-22 22:30:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942080363073536[0;39m <==    Updates: 0
2022-04-22 22:30:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942080363073536[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 22:30:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942101091323904[0;39m 生成今日电子书快照开始
2022-04-22 22:30:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942101091323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942101091323904[0;39m ==> Parameters: 
2022-04-22 22:30:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942101091323904[0;39m <==    Updates: 0
2022-04-22 22:30:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942101091323904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:30:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942122062843904[0;39m 生成今日电子书快照开始
2022-04-22 22:30:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942122062843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942122062843904[0;39m ==> Parameters: 
2022-04-22 22:30:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942122062843904[0;39m <==    Updates: 0
2022-04-22 22:30:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942122062843904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:30:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942143034363904[0;39m 生成今日电子书快照开始
2022-04-22 22:30:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942143034363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942143034363904[0;39m ==> Parameters: 
2022-04-22 22:30:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942143034363904[0;39m <==    Updates: 0
2022-04-22 22:30:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942143034363904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:30:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942163984912384[0;39m 生成今日电子书快照开始
2022-04-22 22:30:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942163984912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942163984912384[0;39m ==> Parameters: 
2022-04-22 22:30:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942163984912384[0;39m <==    Updates: 0
2022-04-22 22:30:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942163984912384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:30:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942184981598208[0;39m 生成今日电子书快照开始
2022-04-22 22:30:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942184981598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942184981598208[0;39m ==> Parameters: 
2022-04-22 22:30:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942184981598208[0;39m <==    Updates: 0
2022-04-22 22:30:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942184981598208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:30:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942205927952384[0;39m 生成今日电子书快照开始
2022-04-22 22:30:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942205927952384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942205927952384[0;39m ==> Parameters: 
2022-04-22 22:30:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942205927952384[0;39m <==    Updates: 0
2022-04-22 22:30:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942205927952384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:30:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942206183804928[0;39m start updating Ebook doc
2022-04-22 22:30:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942206183804928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:30:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942206183804928[0;39m ==> Parameters: 
2022-04-22 22:30:35.100 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942206183804928[0;39m <==    Updates: 1
2022-04-22 22:30:35.100 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942206183804928[0;39m update ends, take 35 millisecs
2022-04-22 22:30:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942226899472384[0;39m 生成今日电子书快照开始
2022-04-22 22:30:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942226899472384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:40.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942226899472384[0;39m ==> Parameters: 
2022-04-22 22:30:40.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942226899472384[0;39m <==    Updates: 0
2022-04-22 22:30:40.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942226899472384[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-22 22:30:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942247870992384[0;39m 生成今日电子书快照开始
2022-04-22 22:30:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942247870992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942247870992384[0;39m ==> Parameters: 
2022-04-22 22:30:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942247870992384[0;39m <==    Updates: 0
2022-04-22 22:30:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942247870992384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:30:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942268825735168[0;39m 生成今日电子书快照开始
2022-04-22 22:30:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942268825735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942268825735168[0;39m ==> Parameters: 
2022-04-22 22:30:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942268825735168[0;39m <==    Updates: 0
2022-04-22 22:30:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942268825735168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:30:55.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942289843392512[0;39m 生成今日电子书快照开始
2022-04-22 22:30:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942289843392512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:30:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942289843392512[0;39m ==> Parameters: 
2022-04-22 22:30:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942289843392512[0;39m <==    Updates: 0
2022-04-22 22:30:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942289843392512[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:31:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942310793940992[0;39m 生成今日电子书快照开始
2022-04-22 22:31:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942310793940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942310793940992[0;39m ==> Parameters: 
2022-04-22 22:31:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942310793940992[0;39m <==    Updates: 0
2022-04-22 22:31:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942310793940992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:31:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942331778043904[0;39m 生成今日电子书快照开始
2022-04-22 22:31:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942331778043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942331778043904[0;39m ==> Parameters: 
2022-04-22 22:31:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942331778043904[0;39m <==    Updates: 0
2022-04-22 22:31:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942331778043904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:31:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942332042285056[0;39m start updating Ebook doc
2022-04-22 22:31:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942332042285056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:31:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942332042285056[0;39m ==> Parameters: 
2022-04-22 22:31:05.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942332042285056[0;39m <==    Updates: 1
2022-04-22 22:31:05.120 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942332042285056[0;39m update ends, take 48 millisecs
2022-04-22 22:31:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942352753758208[0;39m 生成今日电子书快照开始
2022-04-22 22:31:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942352753758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942352753758208[0;39m ==> Parameters: 
2022-04-22 22:31:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942352753758208[0;39m <==    Updates: 0
2022-04-22 22:31:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942352753758208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:31:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942373683335168[0;39m 生成今日电子书快照开始
2022-04-22 22:31:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942373683335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:15.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942373683335168[0;39m ==> Parameters: 
2022-04-22 22:31:15.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942373683335168[0;39m <==    Updates: 0
2022-04-22 22:31:15.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942373683335168[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:31:20.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942394700992512[0;39m 生成今日电子书快照开始
2022-04-22 22:31:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942394700992512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942394700992512[0;39m ==> Parameters: 
2022-04-22 22:31:20.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942394700992512[0;39m <==    Updates: 0
2022-04-22 22:31:20.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942394700992512[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:31:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942415659929600[0;39m 生成今日电子书快照开始
2022-04-22 22:31:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942415659929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942415659929600[0;39m ==> Parameters: 
2022-04-22 22:31:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942415659929600[0;39m <==    Updates: 0
2022-04-22 22:31:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942415659929600[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:31:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942436614672384[0;39m 生成今日电子书快照开始
2022-04-22 22:31:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942436614672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942436614672384[0;39m ==> Parameters: 
2022-04-22 22:31:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942436614672384[0;39m <==    Updates: 0
2022-04-22 22:31:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942436614672384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:31:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942457607163904[0;39m 生成今日电子书快照开始
2022-04-22 22:31:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942457607163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942457607163904[0;39m ==> Parameters: 
2022-04-22 22:31:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942457607163904[0;39m <==    Updates: 0
2022-04-22 22:31:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942457607163904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:31:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942457854627840[0;39m start updating Ebook doc
2022-04-22 22:31:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942457854627840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:31:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942457854627840[0;39m ==> Parameters: 
2022-04-22 22:31:35.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942457854627840[0;39m <==    Updates: 1
2022-04-22 22:31:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942457854627840[0;39m update ends, take 40 millisecs
2022-04-22 22:31:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942478561906688[0;39m 生成今日电子书快照开始
2022-04-22 22:31:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942478561906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942478561906688[0;39m ==> Parameters: 
2022-04-22 22:31:40.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942478561906688[0;39m <==    Updates: 0
2022-04-22 22:31:40.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942478561906688[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:31:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942499537620992[0;39m 生成今日电子书快照开始
2022-04-22 22:31:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942499537620992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942499537620992[0;39m ==> Parameters: 
2022-04-22 22:31:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942499537620992[0;39m <==    Updates: 0
2022-04-22 22:31:45.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942499537620992[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:31:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942520521723904[0;39m 生成今日电子书快照开始
2022-04-22 22:31:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942520521723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:50.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942520521723904[0;39m ==> Parameters: 
2022-04-22 22:31:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942520521723904[0;39m <==    Updates: 0
2022-04-22 22:31:50.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942520521723904[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:31:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942541459689472[0;39m 生成今日电子书快照开始
2022-04-22 22:31:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942541459689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:31:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942541459689472[0;39m ==> Parameters: 
2022-04-22 22:31:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942541459689472[0;39m <==    Updates: 0
2022-04-22 22:31:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942541459689472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:32:00.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942562431209472[0;39m 生成今日电子书快照开始
2022-04-22 22:32:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942562431209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942562431209472[0;39m ==> Parameters: 
2022-04-22 22:32:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942562431209472[0;39m <==    Updates: 0
2022-04-22 22:32:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942562431209472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:32:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942583402729472[0;39m 生成今日电子书快照开始
2022-04-22 22:32:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942583402729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942583402729472[0;39m ==> Parameters: 
2022-04-22 22:32:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942583402729472[0;39m <==    Updates: 0
2022-04-22 22:32:05.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942583402729472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:32:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942583654387712[0;39m start updating Ebook doc
2022-04-22 22:32:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942583654387712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:32:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942583654387712[0;39m ==> Parameters: 
2022-04-22 22:32:05.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942583654387712[0;39m <==    Updates: 1
2022-04-22 22:32:05.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942583654387712[0;39m update ends, take 36 millisecs
2022-04-22 22:32:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942604403609600[0;39m 生成今日电子书快照开始
2022-04-22 22:32:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942604403609600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942604403609600[0;39m ==> Parameters: 
2022-04-22 22:32:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942604403609600[0;39m <==    Updates: 0
2022-04-22 22:32:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942604403609600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:32:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942625341575168[0;39m 生成今日电子书快照开始
2022-04-22 22:32:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942625341575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942625341575168[0;39m ==> Parameters: 
2022-04-22 22:32:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942625341575168[0;39m <==    Updates: 0
2022-04-22 22:32:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942625341575168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:32:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942646355038208[0;39m 生成今日电子书快照开始
2022-04-22 22:32:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942646355038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942646355038208[0;39m ==> Parameters: 
2022-04-22 22:32:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942646355038208[0;39m <==    Updates: 0
2022-04-22 22:32:20.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942646355038208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:32:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942667293003776[0;39m 生成今日电子书快照开始
2022-04-22 22:32:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942667293003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942667293003776[0;39m ==> Parameters: 
2022-04-22 22:32:25.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942667293003776[0;39m <==    Updates: 0
2022-04-22 22:32:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942667293003776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:32:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942688256135168[0;39m 生成今日电子书快照开始
2022-04-22 22:32:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942688256135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942688256135168[0;39m ==> Parameters: 
2022-04-22 22:32:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942688256135168[0;39m <==    Updates: 0
2022-04-22 22:32:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942688256135168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:32:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942709252820992[0;39m 生成今日电子书快照开始
2022-04-22 22:32:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942709252820992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942709252820992[0;39m ==> Parameters: 
2022-04-22 22:32:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942709252820992[0;39m <==    Updates: 0
2022-04-22 22:32:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942709252820992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:32:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942709504479232[0;39m start updating Ebook doc
2022-04-22 22:32:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942709504479232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:32:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942709504479232[0;39m ==> Parameters: 
2022-04-22 22:32:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942709504479232[0;39m <==    Updates: 1
2022-04-22 22:32:35.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942709504479232[0;39m update ends, take 43 millisecs
2022-04-22 22:32:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942730211758080[0;39m 生成今日电子书快照开始
2022-04-22 22:32:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942730211758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942730211758080[0;39m ==> Parameters: 
2022-04-22 22:32:40.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942730211758080[0;39m <==    Updates: 0
2022-04-22 22:32:40.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942730211758080[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 22:32:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942751208443904[0;39m 生成今日电子书快照开始
2022-04-22 22:32:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942751208443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942751208443904[0;39m ==> Parameters: 
2022-04-22 22:32:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942751208443904[0;39m <==    Updates: 0
2022-04-22 22:32:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942751208443904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:32:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942772167380992[0;39m 生成今日电子书快照开始
2022-04-22 22:32:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942772167380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942772167380992[0;39m ==> Parameters: 
2022-04-22 22:32:50.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942772167380992[0;39m <==    Updates: 0
2022-04-22 22:32:50.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942772167380992[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:32:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942793126318080[0;39m 生成今日电子书快照开始
2022-04-22 22:32:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942793126318080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:32:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942793126318080[0;39m ==> Parameters: 
2022-04-22 22:32:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942793126318080[0;39m <==    Updates: 0
2022-04-22 22:32:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942793126318080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:33:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942814110420992[0;39m 生成今日电子书快照开始
2022-04-22 22:33:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942814110420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942814110420992[0;39m ==> Parameters: 
2022-04-22 22:33:00.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942814110420992[0;39m <==    Updates: 0
2022-04-22 22:33:00.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942814110420992[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:33:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942835098718208[0;39m 生成今日电子书快照开始
2022-04-22 22:33:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942835098718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942835098718208[0;39m ==> Parameters: 
2022-04-22 22:33:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942835098718208[0;39m <==    Updates: 0
2022-04-22 22:33:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942835098718208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:33:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942835350376448[0;39m start updating Ebook doc
2022-04-22 22:33:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942835350376448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:33:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942835350376448[0;39m ==> Parameters: 
2022-04-22 22:33:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942835350376448[0;39m <==    Updates: 1
2022-04-22 22:33:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942835350376448[0;39m update ends, take 36 millisecs
2022-04-22 22:33:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942856053460992[0;39m 生成今日电子书快照开始
2022-04-22 22:33:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942856053460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942856053460992[0;39m ==> Parameters: 
2022-04-22 22:33:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942856053460992[0;39m <==    Updates: 0
2022-04-22 22:33:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942856053460992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:33:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942877024980992[0;39m 生成今日电子书快照开始
2022-04-22 22:33:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942877024980992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942877024980992[0;39m ==> Parameters: 
2022-04-22 22:33:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942877024980992[0;39m <==    Updates: 0
2022-04-22 22:33:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942877024980992[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:33:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942897992306688[0;39m 生成今日电子书快照开始
2022-04-22 22:33:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942897992306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942897992306688[0;39m ==> Parameters: 
2022-04-22 22:33:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942897992306688[0;39m <==    Updates: 0
2022-04-22 22:33:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942897992306688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:33:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942918968020992[0;39m 生成今日电子书快照开始
2022-04-22 22:33:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942918968020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942918968020992[0;39m ==> Parameters: 
2022-04-22 22:33:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942918968020992[0;39m <==    Updates: 0
2022-04-22 22:33:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942918968020992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:33:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942939947929600[0;39m 生成今日电子书快照开始
2022-04-22 22:33:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942939947929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942939947929600[0;39m ==> Parameters: 
2022-04-22 22:33:30.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942939947929600[0;39m <==    Updates: 0
2022-04-22 22:33:30.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942939947929600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:33:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942960911060992[0;39m 生成今日电子书快照开始
2022-04-22 22:33:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942960911060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942960911060992[0;39m ==> Parameters: 
2022-04-22 22:33:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942960911060992[0;39m <==    Updates: 0
2022-04-22 22:33:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942960911060992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:33:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172942961187885056[0;39m start updating Ebook doc
2022-04-22 22:33:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942961187885056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:33:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942961187885056[0;39m ==> Parameters: 
2022-04-22 22:33:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172942961187885056[0;39m <==    Updates: 1
2022-04-22 22:33:35.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172942961187885056[0;39m update ends, take 35 millisecs
2022-04-22 22:33:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172942981882580992[0;39m 生成今日电子书快照开始
2022-04-22 22:33:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942981882580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:40.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942981882580992[0;39m ==> Parameters: 
2022-04-22 22:33:40.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172942981882580992[0;39m <==    Updates: 0
2022-04-22 22:33:40.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172942981882580992[0;39m 生成今日电子书快照结束，耗时：85毫秒
2022-04-22 22:33:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943002837323776[0;39m 生成今日电子书快照开始
2022-04-22 22:33:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943002837323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943002837323776[0;39m ==> Parameters: 
2022-04-22 22:33:45.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943002837323776[0;39m <==    Updates: 0
2022-04-22 22:33:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943002837323776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:33:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943023829815296[0;39m 生成今日电子书快照开始
2022-04-22 22:33:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943023829815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943023829815296[0;39m ==> Parameters: 
2022-04-22 22:33:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943023829815296[0;39m <==    Updates: 0
2022-04-22 22:33:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943023829815296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:33:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943044771975168[0;39m 生成今日电子书快照开始
2022-04-22 22:33:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943044771975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:33:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943044771975168[0;39m ==> Parameters: 
2022-04-22 22:33:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943044771975168[0;39m <==    Updates: 0
2022-04-22 22:33:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943044771975168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:34:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943065781243904[0;39m 生成今日电子书快照开始
2022-04-22 22:34:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943065781243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943065781243904[0;39m ==> Parameters: 
2022-04-22 22:34:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943065781243904[0;39m <==    Updates: 0
2022-04-22 22:34:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943065781243904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:34:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943086740180992[0;39m start updating Ebook doc
2022-04-22 22:34:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943086740180992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:34:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943086740180992[0;39m ==> Parameters: 
2022-04-22 22:34:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943086740180992[0;39m <==    Updates: 1
2022-04-22 22:34:05.058 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943086740180992[0;39m update ends, take 51 millisecs
2022-04-22 22:34:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943086962479104[0;39m 生成今日电子书快照开始
2022-04-22 22:34:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943086962479104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943086962479104[0;39m ==> Parameters: 
2022-04-22 22:34:05.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943086962479104[0;39m <==    Updates: 0
2022-04-22 22:34:05.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943086962479104[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 22:34:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943107711700992[0;39m 生成今日电子书快照开始
2022-04-22 22:34:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943107711700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943107711700992[0;39m ==> Parameters: 
2022-04-22 22:34:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943107711700992[0;39m <==    Updates: 0
2022-04-22 22:34:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943107711700992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:34:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943128666443776[0;39m 生成今日电子书快照开始
2022-04-22 22:34:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943128666443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943128666443776[0;39m ==> Parameters: 
2022-04-22 22:34:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943128666443776[0;39m <==    Updates: 0
2022-04-22 22:34:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943128666443776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:34:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943149654740992[0;39m 生成今日电子书快照开始
2022-04-22 22:34:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943149654740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943149654740992[0;39m ==> Parameters: 
2022-04-22 22:34:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943149654740992[0;39m <==    Updates: 0
2022-04-22 22:34:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943149654740992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:34:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943170638843904[0;39m 生成今日电子书快照开始
2022-04-22 22:34:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943170638843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943170638843904[0;39m ==> Parameters: 
2022-04-22 22:34:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943170638843904[0;39m <==    Updates: 0
2022-04-22 22:34:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943170638843904[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:34:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943191593586688[0;39m 生成今日电子书快照开始
2022-04-22 22:34:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943191593586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943191593586688[0;39m ==> Parameters: 
2022-04-22 22:34:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943191593586688[0;39m <==    Updates: 0
2022-04-22 22:34:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943191593586688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:34:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943212573495296[0;39m 生成今日电子书快照开始
2022-04-22 22:34:35.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943212573495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943212573495296[0;39m ==> Parameters: 
2022-04-22 22:34:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943212573495296[0;39m <==    Updates: 0
2022-04-22 22:34:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943212573495296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:34:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943212799987712[0;39m start updating Ebook doc
2022-04-22 22:34:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943212799987712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:34:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943212799987712[0;39m ==> Parameters: 
2022-04-22 22:34:35.095 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943212799987712[0;39m <==    Updates: 1
2022-04-22 22:34:35.096 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943212799987712[0;39m update ends, take 35 millisecs
2022-04-22 22:34:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943233545015296[0;39m 生成今日电子书快照开始
2022-04-22 22:34:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943233545015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943233545015296[0;39m ==> Parameters: 
2022-04-22 22:34:40.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943233545015296[0;39m <==    Updates: 0
2022-04-22 22:34:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943233545015296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:34:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943254491369472[0;39m 生成今日电子书快照开始
2022-04-22 22:34:45.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943254491369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943254491369472[0;39m ==> Parameters: 
2022-04-22 22:34:45.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943254491369472[0;39m <==    Updates: 0
2022-04-22 22:34:45.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943254491369472[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:34:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943275488055296[0;39m 生成今日电子书快照开始
2022-04-22 22:34:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943275488055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943275488055296[0;39m ==> Parameters: 
2022-04-22 22:34:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943275488055296[0;39m <==    Updates: 0
2022-04-22 22:34:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943275488055296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:34:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943296459575296[0;39m 生成今日电子书快照开始
2022-04-22 22:34:55.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943296459575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:34:55.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943296459575296[0;39m ==> Parameters: 
2022-04-22 22:34:55.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943296459575296[0;39m <==    Updates: 0
2022-04-22 22:34:55.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943296459575296[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:35:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943317435289600[0;39m 生成今日电子书快照开始
2022-04-22 22:35:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943317435289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943317435289600[0;39m ==> Parameters: 
2022-04-22 22:35:00.195 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943317435289600[0;39m <==    Updates: 0
2022-04-22 22:35:00.195 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943317435289600[0;39m 生成今日电子书快照结束，耗时：187毫秒
2022-04-22 22:35:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943338411003904[0;39m 生成今日电子书快照开始
2022-04-22 22:35:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943338411003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943338411003904[0;39m ==> Parameters: 
2022-04-22 22:35:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943338411003904[0;39m <==    Updates: 0
2022-04-22 22:35:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943338411003904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:35:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943338633302016[0;39m start updating Ebook doc
2022-04-22 22:35:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943338633302016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:35:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943338633302016[0;39m ==> Parameters: 
2022-04-22 22:35:05.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943338633302016[0;39m <==    Updates: 1
2022-04-22 22:35:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943338633302016[0;39m update ends, take 39 millisecs
2022-04-22 22:35:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943359374135296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943359374135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943359374135296[0;39m ==> Parameters: 
2022-04-22 22:35:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943359374135296[0;39m <==    Updates: 0
2022-04-22 22:35:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943359374135296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:35:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943380320489472[0;39m 生成今日电子书快照开始
2022-04-22 22:35:15.016 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943380320489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943380320489472[0;39m ==> Parameters: 
2022-04-22 22:35:15.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943380320489472[0;39m <==    Updates: 0
2022-04-22 22:35:15.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943380320489472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:35:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943401317175296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943401317175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943401317175296[0;39m ==> Parameters: 
2022-04-22 22:35:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943401317175296[0;39m <==    Updates: 0
2022-04-22 22:35:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943401317175296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:35:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943422288695296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943422288695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943422288695296[0;39m ==> Parameters: 
2022-04-22 22:35:25.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943422288695296[0;39m <==    Updates: 0
2022-04-22 22:35:25.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943422288695296[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:35:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943443260215296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943443260215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943443260215296[0;39m ==> Parameters: 
2022-04-22 22:35:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943443260215296[0;39m <==    Updates: 0
2022-04-22 22:35:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943443260215296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:35:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943464240123904[0;39m start updating Ebook doc
2022-04-22 22:35:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943464240123904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:35:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943464240123904[0;39m ==> Parameters: 
2022-04-22 22:35:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943464240123904[0;39m <==    Updates: 1
2022-04-22 22:35:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943464240123904[0;39m update ends, take 63 millisecs
2022-04-22 22:35:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943464504365056[0;39m 生成今日电子书快照开始
2022-04-22 22:35:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943464504365056[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943464504365056[0;39m ==> Parameters: 
2022-04-22 22:35:35.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943464504365056[0;39m <==    Updates: 0
2022-04-22 22:35:35.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943464504365056[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-22 22:35:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943485203255296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943485203255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943485203255296[0;39m ==> Parameters: 
2022-04-22 22:35:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943485203255296[0;39m <==    Updates: 0
2022-04-22 22:35:40.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943485203255296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:35:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943506174775296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943506174775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943506174775296[0;39m ==> Parameters: 
2022-04-22 22:35:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943506174775296[0;39m <==    Updates: 0
2022-04-22 22:35:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943506174775296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:35:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943527133712384[0;39m 生成今日电子书快照开始
2022-04-22 22:35:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943527133712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943527133712384[0;39m ==> Parameters: 
2022-04-22 22:35:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943527133712384[0;39m <==    Updates: 0
2022-04-22 22:35:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943527133712384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:35:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943548117815296[0;39m 生成今日电子书快照开始
2022-04-22 22:35:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943548117815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:35:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943548117815296[0;39m ==> Parameters: 
2022-04-22 22:35:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943548117815296[0;39m <==    Updates: 0
2022-04-22 22:35:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943548117815296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:36:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943569089335296[0;39m 生成今日电子书快照开始
2022-04-22 22:36:00.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943569089335296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:00.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943569089335296[0;39m ==> Parameters: 
2022-04-22 22:36:00.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943569089335296[0;39m <==    Updates: 0
2022-04-22 22:36:00.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943569089335296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:36:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943590073438208[0;39m 生成今日电子书快照开始
2022-04-22 22:36:05.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943590073438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:05.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943590073438208[0;39m ==> Parameters: 
2022-04-22 22:36:05.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943590073438208[0;39m <==    Updates: 0
2022-04-22 22:36:05.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943590073438208[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:36:05.081 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943590371233792[0;39m start updating Ebook doc
2022-04-22 22:36:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943590371233792[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:36:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943590371233792[0;39m ==> Parameters: 
2022-04-22 22:36:05.125 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943590371233792[0;39m <==    Updates: 1
2022-04-22 22:36:05.125 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943590371233792[0;39m update ends, take 44 millisecs
2022-04-22 22:36:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943611044958208[0;39m 生成今日电子书快照开始
2022-04-22 22:36:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943611044958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943611044958208[0;39m ==> Parameters: 
2022-04-22 22:36:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943611044958208[0;39m <==    Updates: 0
2022-04-22 22:36:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943611044958208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:36:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943632008089600[0;39m 生成今日电子书快照开始
2022-04-22 22:36:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943632008089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943632008089600[0;39m ==> Parameters: 
2022-04-22 22:36:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943632008089600[0;39m <==    Updates: 0
2022-04-22 22:36:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943632008089600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:36:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943652971220992[0;39m 生成今日电子书快照开始
2022-04-22 22:36:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943652971220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943652971220992[0;39m ==> Parameters: 
2022-04-22 22:36:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943652971220992[0;39m <==    Updates: 0
2022-04-22 22:36:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943652971220992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:36:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943673930158080[0;39m 生成今日电子书快照开始
2022-04-22 22:36:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943673930158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943673930158080[0;39m ==> Parameters: 
2022-04-22 22:36:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943673930158080[0;39m <==    Updates: 0
2022-04-22 22:36:25.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943673930158080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:36:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943694931038208[0;39m 生成今日电子书快照开始
2022-04-22 22:36:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943694931038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943694931038208[0;39m ==> Parameters: 
2022-04-22 22:36:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943694931038208[0;39m <==    Updates: 0
2022-04-22 22:36:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943694931038208[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:36:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943715902558208[0;39m 生成今日电子书快照开始
2022-04-22 22:36:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943715902558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943715902558208[0;39m ==> Parameters: 
2022-04-22 22:36:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943715902558208[0;39m <==    Updates: 0
2022-04-22 22:36:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943715902558208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:36:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943716162605056[0;39m start updating Ebook doc
2022-04-22 22:36:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943716162605056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:36:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943716162605056[0;39m ==> Parameters: 
2022-04-22 22:36:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943716162605056[0;39m <==    Updates: 1
2022-04-22 22:36:35.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943716162605056[0;39m update ends, take 34 millisecs
2022-04-22 22:36:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943736865689600[0;39m 生成今日电子书快照开始
2022-04-22 22:36:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943736865689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943736865689600[0;39m ==> Parameters: 
2022-04-22 22:36:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943736865689600[0;39m <==    Updates: 0
2022-04-22 22:36:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943736865689600[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:36:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943757820432384[0;39m 生成今日电子书快照开始
2022-04-22 22:36:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943757820432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943757820432384[0;39m ==> Parameters: 
2022-04-22 22:36:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943757820432384[0;39m <==    Updates: 0
2022-04-22 22:36:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943757820432384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:36:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943778804535296[0;39m 生成今日电子书快照开始
2022-04-22 22:36:50.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943778804535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:50.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943778804535296[0;39m ==> Parameters: 
2022-04-22 22:36:50.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943778804535296[0;39m <==    Updates: 0
2022-04-22 22:36:50.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943778804535296[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 22:36:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943799780249600[0;39m 生成今日电子书快照开始
2022-04-22 22:36:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943799780249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:36:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943799780249600[0;39m ==> Parameters: 
2022-04-22 22:36:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943799780249600[0;39m <==    Updates: 0
2022-04-22 22:36:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943799780249600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:37:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943820734992384[0;39m 生成今日电子书快照开始
2022-04-22 22:37:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943820734992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943820734992384[0;39m ==> Parameters: 
2022-04-22 22:37:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943820734992384[0;39m <==    Updates: 0
2022-04-22 22:37:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943820734992384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:37:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943841723289600[0;39m 生成今日电子书快照开始
2022-04-22 22:37:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943841723289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943841723289600[0;39m ==> Parameters: 
2022-04-22 22:37:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943841723289600[0;39m <==    Updates: 0
2022-04-22 22:37:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943841723289600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:37:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943841987530752[0;39m start updating Ebook doc
2022-04-22 22:37:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943841987530752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:37:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943841987530752[0;39m ==> Parameters: 
2022-04-22 22:37:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943841987530752[0;39m <==    Updates: 1
2022-04-22 22:37:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943841987530752[0;39m update ends, take 43 millisecs
2022-04-22 22:37:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943862682226688[0;39m 生成今日电子书快照开始
2022-04-22 22:37:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943862682226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943862682226688[0;39m ==> Parameters: 
2022-04-22 22:37:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943862682226688[0;39m <==    Updates: 0
2022-04-22 22:37:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943862682226688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:37:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943883653746688[0;39m 生成今日电子书快照开始
2022-04-22 22:37:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943883653746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943883653746688[0;39m ==> Parameters: 
2022-04-22 22:37:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943883653746688[0;39m <==    Updates: 0
2022-04-22 22:37:15.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943883653746688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:37:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943904604295168[0;39m 生成今日电子书快照开始
2022-04-22 22:37:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943904604295168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943904604295168[0;39m ==> Parameters: 
2022-04-22 22:37:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943904604295168[0;39m <==    Updates: 0
2022-04-22 22:37:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943904604295168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:37:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943925609369600[0;39m 生成今日电子书快照开始
2022-04-22 22:37:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943925609369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943925609369600[0;39m ==> Parameters: 
2022-04-22 22:37:25.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943925609369600[0;39m <==    Updates: 0
2022-04-22 22:37:25.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943925609369600[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:37:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943946580889600[0;39m 生成今日电子书快照开始
2022-04-22 22:37:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943946580889600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943946580889600[0;39m ==> Parameters: 
2022-04-22 22:37:30.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943946580889600[0;39m <==    Updates: 0
2022-04-22 22:37:30.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943946580889600[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:37:35.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172943967552409600[0;39m start updating Ebook doc
2022-04-22 22:37:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943967552409600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:37:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943967552409600[0;39m ==> Parameters: 
2022-04-22 22:37:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172943967552409600[0;39m <==    Updates: 1
2022-04-22 22:37:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172943967552409600[0;39m update ends, take 67 millisecs
2022-04-22 22:37:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943967837622272[0;39m 生成今日电子书快照开始
2022-04-22 22:37:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943967837622272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943967837622272[0;39m ==> Parameters: 
2022-04-22 22:37:35.111 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943967837622272[0;39m <==    Updates: 0
2022-04-22 22:37:35.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943967837622272[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-22 22:37:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172943988523929600[0;39m 生成今日电子书快照开始
2022-04-22 22:37:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943988523929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943988523929600[0;39m ==> Parameters: 
2022-04-22 22:37:40.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172943988523929600[0;39m <==    Updates: 0
2022-04-22 22:37:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172943988523929600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:37:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944009487060992[0;39m 生成今日电子书快照开始
2022-04-22 22:37:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944009487060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944009487060992[0;39m ==> Parameters: 
2022-04-22 22:37:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944009487060992[0;39m <==    Updates: 0
2022-04-22 22:37:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944009487060992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:37:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944030466969600[0;39m 生成今日电子书快照开始
2022-04-22 22:37:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944030466969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944030466969600[0;39m ==> Parameters: 
2022-04-22 22:37:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944030466969600[0;39m <==    Updates: 0
2022-04-22 22:37:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944030466969600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:37:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944051442683904[0;39m 生成今日电子书快照开始
2022-04-22 22:37:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944051442683904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:37:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944051442683904[0;39m ==> Parameters: 
2022-04-22 22:37:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944051442683904[0;39m <==    Updates: 0
2022-04-22 22:37:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944051442683904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:38:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944072401620992[0;39m 生成今日电子书快照开始
2022-04-22 22:38:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944072401620992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944072401620992[0;39m ==> Parameters: 
2022-04-22 22:38:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944072401620992[0;39m <==    Updates: 0
2022-04-22 22:38:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944072401620992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:38:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944093385723904[0;39m 生成今日电子书快照开始
2022-04-22 22:38:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944093385723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944093385723904[0;39m ==> Parameters: 
2022-04-22 22:38:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944093385723904[0;39m <==    Updates: 0
2022-04-22 22:38:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944093385723904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:38:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944093649965056[0;39m start updating Ebook doc
2022-04-22 22:38:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944093649965056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:38:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944093649965056[0;39m ==> Parameters: 
2022-04-22 22:38:05.108 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944093649965056[0;39m <==    Updates: 1
2022-04-22 22:38:05.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944093649965056[0;39m update ends, take 36 millisecs
2022-04-22 22:38:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944114357243904[0;39m 生成今日电子书快照开始
2022-04-22 22:38:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944114357243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944114357243904[0;39m ==> Parameters: 
2022-04-22 22:38:10.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944114357243904[0;39m <==    Updates: 0
2022-04-22 22:38:10.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944114357243904[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:38:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944135328763904[0;39m 生成今日电子书快照开始
2022-04-22 22:38:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944135328763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944135328763904[0;39m ==> Parameters: 
2022-04-22 22:38:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944135328763904[0;39m <==    Updates: 0
2022-04-22 22:38:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944135328763904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:38:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944156262535168[0;39m 生成今日电子书快照开始
2022-04-22 22:38:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944156262535168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944156262535168[0;39m ==> Parameters: 
2022-04-22 22:38:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944156262535168[0;39m <==    Updates: 0
2022-04-22 22:38:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944156262535168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:38:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944177242443776[0;39m 生成今日电子书快照开始
2022-04-22 22:38:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944177242443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944177242443776[0;39m ==> Parameters: 
2022-04-22 22:38:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944177242443776[0;39m <==    Updates: 0
2022-04-22 22:38:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944177242443776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 22:38:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944198243323904[0;39m 生成今日电子书快照开始
2022-04-22 22:38:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944198243323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944198243323904[0;39m ==> Parameters: 
2022-04-22 22:38:30.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944198243323904[0;39m <==    Updates: 0
2022-04-22 22:38:30.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944198243323904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:38:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944219214843904[0;39m start updating Ebook doc
2022-04-22 22:38:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944219214843904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:38:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944219214843904[0;39m ==> Parameters: 
2022-04-22 22:38:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944219214843904[0;39m <==    Updates: 1
2022-04-22 22:38:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944219214843904[0;39m update ends, take 60 millisecs
2022-04-22 22:38:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944219466502144[0;39m 生成今日电子书快照开始
2022-04-22 22:38:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944219466502144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944219466502144[0;39m ==> Parameters: 
2022-04-22 22:38:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944219466502144[0;39m <==    Updates: 0
2022-04-22 22:38:35.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944219466502144[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 22:38:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944240186363904[0;39m 生成今日电子书快照开始
2022-04-22 22:38:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944240186363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944240186363904[0;39m ==> Parameters: 
2022-04-22 22:38:40.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944240186363904[0;39m <==    Updates: 0
2022-04-22 22:38:40.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944240186363904[0;39m 生成今日电子书快照结束，耗时：99毫秒
2022-04-22 22:38:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944261149495296[0;39m 生成今日电子书快照开始
2022-04-22 22:38:45.242 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944261149495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:45.242 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944261149495296[0;39m ==> Parameters: 
2022-04-22 22:38:45.279 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944261149495296[0;39m <==    Updates: 0
2022-04-22 22:38:45.280 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944261149495296[0;39m 生成今日电子书快照结束，耗时：273毫秒
2022-04-22 22:38:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944282112626688[0;39m 生成今日电子书快照开始
2022-04-22 22:38:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944282112626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944282112626688[0;39m ==> Parameters: 
2022-04-22 22:38:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944282112626688[0;39m <==    Updates: 0
2022-04-22 22:38:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944282112626688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:38:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944303092535296[0;39m 生成今日电子书快照开始
2022-04-22 22:38:55.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944303092535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:38:55.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944303092535296[0;39m ==> Parameters: 
2022-04-22 22:38:55.160 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944303092535296[0;39m <==    Updates: 0
2022-04-22 22:38:55.160 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944303092535296[0;39m 生成今日电子书快照结束，耗时：152毫秒
2022-04-22 22:39:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944324072443904[0;39m 生成今日电子书快照开始
2022-04-22 22:39:00.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944324072443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:00.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944324072443904[0;39m ==> Parameters: 
2022-04-22 22:39:00.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944324072443904[0;39m <==    Updates: 0
2022-04-22 22:39:00.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944324072443904[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 22:39:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944345043963904[0;39m 生成今日电子书快照开始
2022-04-22 22:39:05.169 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944345043963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:05.170 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944345043963904[0;39m ==> Parameters: 
2022-04-22 22:39:05.204 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944345043963904[0;39m <==    Updates: 0
2022-04-22 22:39:05.204 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944345043963904[0;39m 生成今日电子书快照结束，耗时：194毫秒
2022-04-22 22:39:05.205 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944345866047488[0;39m start updating Ebook doc
2022-04-22 22:39:05.205 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944345866047488[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:39:05.205 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944345866047488[0;39m ==> Parameters: 
2022-04-22 22:39:05.245 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944345866047488[0;39m <==    Updates: 1
2022-04-22 22:39:05.245 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944345866047488[0;39m update ends, take 40 millisecs
2022-04-22 22:39:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944366015483904[0;39m 生成今日电子书快照开始
2022-04-22 22:39:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944366015483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944366015483904[0;39m ==> Parameters: 
2022-04-22 22:39:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944366015483904[0;39m <==    Updates: 0
2022-04-22 22:39:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944366015483904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:39:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944386970226688[0;39m 生成今日电子书快照开始
2022-04-22 22:39:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944386970226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944386970226688[0;39m ==> Parameters: 
2022-04-22 22:39:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944386970226688[0;39m <==    Updates: 0
2022-04-22 22:39:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944386970226688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:39:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944407954329600[0;39m 生成今日电子书快照开始
2022-04-22 22:39:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944407954329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944407954329600[0;39m ==> Parameters: 
2022-04-22 22:39:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944407954329600[0;39m <==    Updates: 0
2022-04-22 22:39:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944407954329600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:39:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944428934238208[0;39m 生成今日电子书快照开始
2022-04-22 22:39:25.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944428934238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:25.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944428934238208[0;39m ==> Parameters: 
2022-04-22 22:39:25.166 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944428934238208[0;39m <==    Updates: 0
2022-04-22 22:39:25.166 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944428934238208[0;39m 生成今日电子书快照结束，耗时：155毫秒
2022-04-22 22:39:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944449901563904[0;39m 生成今日电子书快照开始
2022-04-22 22:39:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944449901563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944449901563904[0;39m ==> Parameters: 
2022-04-22 22:39:30.309 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944449901563904[0;39m <==    Updates: 0
2022-04-22 22:39:30.309 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944449901563904[0;39m 生成今日电子书快照结束，耗时：299毫秒
2022-04-22 22:39:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944470856306688[0;39m start updating Ebook doc
2022-04-22 22:39:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944470856306688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:39:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944470856306688[0;39m ==> Parameters: 
2022-04-22 22:39:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944470856306688[0;39m <==    Updates: 1
2022-04-22 22:39:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944470856306688[0;39m update ends, take 59 millisecs
2022-04-22 22:39:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944471107964928[0;39m 生成今日电子书快照开始
2022-04-22 22:39:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944471107964928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944471107964928[0;39m ==> Parameters: 
2022-04-22 22:39:35.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944471107964928[0;39m <==    Updates: 0
2022-04-22 22:39:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944471107964928[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 22:39:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944491848798208[0;39m 生成今日电子书快照开始
2022-04-22 22:39:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944491848798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944491848798208[0;39m ==> Parameters: 
2022-04-22 22:39:40.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944491848798208[0;39m <==    Updates: 0
2022-04-22 22:39:40.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944491848798208[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 22:39:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944512811929600[0;39m 生成今日电子书快照开始
2022-04-22 22:39:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944512811929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944512811929600[0;39m ==> Parameters: 
2022-04-22 22:39:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944512811929600[0;39m <==    Updates: 0
2022-04-22 22:39:45.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944512811929600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:39:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944533770866688[0;39m 生成今日电子书快照开始
2022-04-22 22:39:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944533770866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944533770866688[0;39m ==> Parameters: 
2022-04-22 22:39:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944533770866688[0;39m <==    Updates: 0
2022-04-22 22:39:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944533770866688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:39:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944554763358208[0;39m 生成今日电子书快照开始
2022-04-22 22:39:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944554763358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:39:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944554763358208[0;39m ==> Parameters: 
2022-04-22 22:39:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944554763358208[0;39m <==    Updates: 0
2022-04-22 22:39:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944554763358208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:40:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944575734878208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:00.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944575734878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:00.135 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944575734878208[0;39m ==> Parameters: 
2022-04-22 22:40:00.303 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944575734878208[0;39m <==    Updates: 0
2022-04-22 22:40:00.304 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944575734878208[0;39m 生成今日电子书快照结束，耗时：294毫秒
2022-04-22 22:40:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944596698009600[0;39m 生成今日电子书快照开始
2022-04-22 22:40:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944596698009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944596698009600[0;39m ==> Parameters: 
2022-04-22 22:40:05.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944596698009600[0;39m <==    Updates: 0
2022-04-22 22:40:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944596698009600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:40:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944596979027968[0;39m start updating Ebook doc
2022-04-22 22:40:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944596979027968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:40:05.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944596979027968[0;39m ==> Parameters: 
2022-04-22 22:40:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944596979027968[0;39m <==    Updates: 1
2022-04-22 22:40:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944596979027968[0;39m update ends, take 39 millisecs
2022-04-22 22:40:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944617661140992[0;39m 生成今日电子书快照开始
2022-04-22 22:40:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944617661140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944617661140992[0;39m ==> Parameters: 
2022-04-22 22:40:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944617661140992[0;39m <==    Updates: 0
2022-04-22 22:40:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944617661140992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:40:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944638615883776[0;39m 生成今日电子书快照开始
2022-04-22 22:40:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944638615883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944638615883776[0;39m ==> Parameters: 
2022-04-22 22:40:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944638615883776[0;39m <==    Updates: 0
2022-04-22 22:40:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944638615883776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:40:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944659620958208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944659620958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944659620958208[0;39m ==> Parameters: 
2022-04-22 22:40:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944659620958208[0;39m <==    Updates: 0
2022-04-22 22:40:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944659620958208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:40:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944680592478208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944680592478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944680592478208[0;39m ==> Parameters: 
2022-04-22 22:40:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944680592478208[0;39m <==    Updates: 0
2022-04-22 22:40:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944680592478208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:40:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944701563998208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944701563998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944701563998208[0;39m ==> Parameters: 
2022-04-22 22:40:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944701563998208[0;39m <==    Updates: 0
2022-04-22 22:40:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944701563998208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:40:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944722535518208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944722535518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944722535518208[0;39m ==> Parameters: 
2022-04-22 22:40:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944722535518208[0;39m <==    Updates: 0
2022-04-22 22:40:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944722535518208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:40:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944722812342272[0;39m start updating Ebook doc
2022-04-22 22:40:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944722812342272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:40:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944722812342272[0;39m ==> Parameters: 
2022-04-22 22:40:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944722812342272[0;39m <==    Updates: 1
2022-04-22 22:40:35.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944722812342272[0;39m update ends, take 41 millisecs
2022-04-22 22:40:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944743507038208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944743507038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944743507038208[0;39m ==> Parameters: 
2022-04-22 22:40:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944743507038208[0;39m <==    Updates: 0
2022-04-22 22:40:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944743507038208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:40:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944764478558208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:45.287 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944764478558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:45.288 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944764478558208[0;39m ==> Parameters: 
2022-04-22 22:40:45.325 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944764478558208[0;39m <==    Updates: 0
2022-04-22 22:40:45.326 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944764478558208[0;39m 生成今日电子书快照结束，耗时：315毫秒
2022-04-22 22:40:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944785433300992[0;39m 生成今日电子书快照开始
2022-04-22 22:40:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944785433300992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944785433300992[0;39m ==> Parameters: 
2022-04-22 22:40:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944785433300992[0;39m <==    Updates: 0
2022-04-22 22:40:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944785433300992[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:40:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944806421598208[0;39m 生成今日电子书快照开始
2022-04-22 22:40:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944806421598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:40:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944806421598208[0;39m ==> Parameters: 
2022-04-22 22:40:55.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944806421598208[0;39m <==    Updates: 0
2022-04-22 22:40:55.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944806421598208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 22:41:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944827376340992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944827376340992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944827376340992[0;39m ==> Parameters: 
2022-04-22 22:41:00.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944827376340992[0;39m <==    Updates: 0
2022-04-22 22:41:00.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944827376340992[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:41:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944848347860992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944848347860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944848347860992[0;39m ==> Parameters: 
2022-04-22 22:41:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944848347860992[0;39m <==    Updates: 0
2022-04-22 22:41:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944848347860992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:41:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944848595324928[0;39m start updating Ebook doc
2022-04-22 22:41:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944848595324928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:41:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944848595324928[0;39m ==> Parameters: 
2022-04-22 22:41:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944848595324928[0;39m <==    Updates: 1
2022-04-22 22:41:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944848595324928[0;39m update ends, take 40 millisecs
2022-04-22 22:41:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944869319380992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944869319380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944869319380992[0;39m ==> Parameters: 
2022-04-22 22:41:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944869319380992[0;39m <==    Updates: 0
2022-04-22 22:41:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944869319380992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:41:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944890307678208[0;39m 生成今日电子书快照开始
2022-04-22 22:41:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944890307678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944890307678208[0;39m ==> Parameters: 
2022-04-22 22:41:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944890307678208[0;39m <==    Updates: 0
2022-04-22 22:41:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944890307678208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:41:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944911262420992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944911262420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944911262420992[0;39m ==> Parameters: 
2022-04-22 22:41:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944911262420992[0;39m <==    Updates: 0
2022-04-22 22:41:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944911262420992[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:41:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944932229746688[0;39m 生成今日电子书快照开始
2022-04-22 22:41:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944932229746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944932229746688[0;39m ==> Parameters: 
2022-04-22 22:41:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944932229746688[0;39m <==    Updates: 0
2022-04-22 22:41:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944932229746688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:41:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944953205460992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944953205460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944953205460992[0;39m ==> Parameters: 
2022-04-22 22:41:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944953205460992[0;39m <==    Updates: 0
2022-04-22 22:41:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944953205460992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:41:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172944974176980992[0;39m start updating Ebook doc
2022-04-22 22:41:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944974176980992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:41:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944974176980992[0;39m ==> Parameters: 
2022-04-22 22:41:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172944974176980992[0;39m <==    Updates: 1
2022-04-22 22:41:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172944974176980992[0;39m update ends, take 61 millisecs
2022-04-22 22:41:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944974437027840[0;39m 生成今日电子书快照开始
2022-04-22 22:41:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944974437027840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944974437027840[0;39m ==> Parameters: 
2022-04-22 22:41:35.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944974437027840[0;39m <==    Updates: 0
2022-04-22 22:41:35.102 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944974437027840[0;39m 生成今日电子书快照结束，耗时：34毫秒
2022-04-22 22:41:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172944995148500992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944995148500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944995148500992[0;39m ==> Parameters: 
2022-04-22 22:41:40.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172944995148500992[0;39m <==    Updates: 0
2022-04-22 22:41:40.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172944995148500992[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:41:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945016120020992[0;39m 生成今日电子书快照开始
2022-04-22 22:41:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945016120020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945016120020992[0;39m ==> Parameters: 
2022-04-22 22:41:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945016120020992[0;39m <==    Updates: 0
2022-04-22 22:41:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945016120020992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:41:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945037095735296[0;39m 生成今日电子书快照开始
2022-04-22 22:41:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945037095735296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945037095735296[0;39m ==> Parameters: 
2022-04-22 22:41:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945037095735296[0;39m <==    Updates: 0
2022-04-22 22:41:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945037095735296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:41:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945058067255296[0;39m 生成今日电子书快照开始
2022-04-22 22:41:55.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945058067255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:41:55.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945058067255296[0;39m ==> Parameters: 
2022-04-22 22:41:55.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945058067255296[0;39m <==    Updates: 0
2022-04-22 22:41:55.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945058067255296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:42:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945079038775296[0;39m 生成今日电子书快照开始
2022-04-22 22:42:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945079038775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945079038775296[0;39m ==> Parameters: 
2022-04-22 22:42:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945079038775296[0;39m <==    Updates: 0
2022-04-22 22:42:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945079038775296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:42:05.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945100010295296[0;39m start updating Ebook doc
2022-04-22 22:42:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945100010295296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:42:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945100010295296[0;39m ==> Parameters: 
2022-04-22 22:42:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945100010295296[0;39m <==    Updates: 1
2022-04-22 22:42:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945100010295296[0;39m update ends, take 62 millisecs
2022-04-22 22:42:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945100270342144[0;39m 生成今日电子书快照开始
2022-04-22 22:42:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945100270342144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945100270342144[0;39m ==> Parameters: 
2022-04-22 22:42:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945100270342144[0;39m <==    Updates: 0
2022-04-22 22:42:05.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945100270342144[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 22:42:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945120981815296[0;39m 生成今日电子书快照开始
2022-04-22 22:42:10.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945120981815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:10.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945120981815296[0;39m ==> Parameters: 
2022-04-22 22:42:10.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945120981815296[0;39m <==    Updates: 0
2022-04-22 22:42:10.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945120981815296[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:42:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945141965918208[0;39m 生成今日电子书快照开始
2022-04-22 22:42:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945141965918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945141965918208[0;39m ==> Parameters: 
2022-04-22 22:42:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945141965918208[0;39m <==    Updates: 0
2022-04-22 22:42:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945141965918208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:42:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945162924855296[0;39m 生成今日电子书快照开始
2022-04-22 22:42:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945162924855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945162924855296[0;39m ==> Parameters: 
2022-04-22 22:42:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945162924855296[0;39m <==    Updates: 0
2022-04-22 22:42:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945162924855296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:42:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945183904763904[0;39m 生成今日电子书快照开始
2022-04-22 22:42:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945183904763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945183904763904[0;39m ==> Parameters: 
2022-04-22 22:42:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945183904763904[0;39m <==    Updates: 0
2022-04-22 22:42:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945183904763904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:42:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945204880478208[0;39m 生成今日电子书快照开始
2022-04-22 22:42:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945204880478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945204880478208[0;39m ==> Parameters: 
2022-04-22 22:42:30.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945204880478208[0;39m <==    Updates: 0
2022-04-22 22:42:30.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945204880478208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:42:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945225831026688[0;39m 生成今日电子书快照开始
2022-04-22 22:42:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945225831026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945225831026688[0;39m ==> Parameters: 
2022-04-22 22:42:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945225831026688[0;39m <==    Updates: 0
2022-04-22 22:42:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945225831026688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:42:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945226095267840[0;39m start updating Ebook doc
2022-04-22 22:42:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945226095267840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:42:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945226095267840[0;39m ==> Parameters: 
2022-04-22 22:42:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945226095267840[0;39m <==    Updates: 1
2022-04-22 22:42:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945226095267840[0;39m update ends, take 38 millisecs
2022-04-22 22:42:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945246810935296[0;39m 生成今日电子书快照开始
2022-04-22 22:42:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945246810935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945246810935296[0;39m ==> Parameters: 
2022-04-22 22:42:40.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945246810935296[0;39m <==    Updates: 0
2022-04-22 22:42:40.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945246810935296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:42:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945267782455296[0;39m 生成今日电子书快照开始
2022-04-22 22:42:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945267782455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945267782455296[0;39m ==> Parameters: 
2022-04-22 22:42:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945267782455296[0;39m <==    Updates: 0
2022-04-22 22:42:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945267782455296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:42:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945288745586688[0;39m 生成今日电子书快照开始
2022-04-22 22:42:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945288745586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945288745586688[0;39m ==> Parameters: 
2022-04-22 22:42:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945288745586688[0;39m <==    Updates: 0
2022-04-22 22:42:50.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945288745586688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:42:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945309725495296[0;39m 生成今日电子书快照开始
2022-04-22 22:42:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945309725495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:42:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945309725495296[0;39m ==> Parameters: 
2022-04-22 22:42:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945309725495296[0;39m <==    Updates: 0
2022-04-22 22:42:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945309725495296[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:43:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945330688626688[0;39m 生成今日电子书快照开始
2022-04-22 22:43:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945330688626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945330688626688[0;39m ==> Parameters: 
2022-04-22 22:43:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945330688626688[0;39m <==    Updates: 0
2022-04-22 22:43:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945330688626688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:43:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945351660146688[0;39m start updating Ebook doc
2022-04-22 22:43:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945351660146688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:43:05.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945351660146688[0;39m ==> Parameters: 
2022-04-22 22:43:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945351660146688[0;39m <==    Updates: 1
2022-04-22 22:43:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945351660146688[0;39m update ends, take 59 millisecs
2022-04-22 22:43:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945351915999232[0;39m 生成今日电子书快照开始
2022-04-22 22:43:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945351915999232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945351915999232[0;39m ==> Parameters: 
2022-04-22 22:43:05.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945351915999232[0;39m <==    Updates: 0
2022-04-22 22:43:05.100 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945351915999232[0;39m 生成今日电子书快照结束，耗时：34毫秒
2022-04-22 22:43:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945372640055296[0;39m 生成今日电子书快照开始
2022-04-22 22:43:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945372640055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945372640055296[0;39m ==> Parameters: 
2022-04-22 22:43:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945372640055296[0;39m <==    Updates: 0
2022-04-22 22:43:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945372640055296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:43:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945393624158208[0;39m 生成今日电子书快照开始
2022-04-22 22:43:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945393624158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945393624158208[0;39m ==> Parameters: 
2022-04-22 22:43:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945393624158208[0;39m <==    Updates: 0
2022-04-22 22:43:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945393624158208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:43:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945414583095296[0;39m 生成今日电子书快照开始
2022-04-22 22:43:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945414583095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945414583095296[0;39m ==> Parameters: 
2022-04-22 22:43:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945414583095296[0;39m <==    Updates: 0
2022-04-22 22:43:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945414583095296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:43:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945435550420992[0;39m 生成今日电子书快照开始
2022-04-22 22:43:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945435550420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:25.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945435550420992[0;39m ==> Parameters: 
2022-04-22 22:43:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945435550420992[0;39m <==    Updates: 0
2022-04-22 22:43:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945435550420992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:43:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945456530329600[0;39m 生成今日电子书快照开始
2022-04-22 22:43:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945456530329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945456530329600[0;39m ==> Parameters: 
2022-04-22 22:43:30.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945456530329600[0;39m <==    Updates: 0
2022-04-22 22:43:30.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945456530329600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:43:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945477497655296[0;39m 生成今日电子书快照开始
2022-04-22 22:43:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945477497655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:35.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945477497655296[0;39m ==> Parameters: 
2022-04-22 22:43:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945477497655296[0;39m <==    Updates: 0
2022-04-22 22:43:35.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945477497655296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:43:35.080 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945477803839488[0;39m start updating Ebook doc
2022-04-22 22:43:35.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945477803839488[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:43:35.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945477803839488[0;39m ==> Parameters: 
2022-04-22 22:43:35.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945477803839488[0;39m <==    Updates: 1
2022-04-22 22:43:35.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945477803839488[0;39m update ends, take 36 millisecs
2022-04-22 22:43:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945498460786688[0;39m 生成今日电子书快照开始
2022-04-22 22:43:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945498460786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945498460786688[0;39m ==> Parameters: 
2022-04-22 22:43:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945498460786688[0;39m <==    Updates: 0
2022-04-22 22:43:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945498460786688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:43:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945519444889600[0;39m 生成今日电子书快照开始
2022-04-22 22:43:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945519444889600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945519444889600[0;39m ==> Parameters: 
2022-04-22 22:43:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945519444889600[0;39m <==    Updates: 0
2022-04-22 22:43:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945519444889600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:43:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945540416409600[0;39m 生成今日电子书快照开始
2022-04-22 22:43:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945540416409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945540416409600[0;39m ==> Parameters: 
2022-04-22 22:43:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945540416409600[0;39m <==    Updates: 0
2022-04-22 22:43:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945540416409600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:43:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945561387929600[0;39m 生成今日电子书快照开始
2022-04-22 22:43:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945561387929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:43:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945561387929600[0;39m ==> Parameters: 
2022-04-22 22:43:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945561387929600[0;39m <==    Updates: 0
2022-04-22 22:43:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945561387929600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:44:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945582351060992[0;39m 生成今日电子书快照开始
2022-04-22 22:44:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945582351060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945582351060992[0;39m ==> Parameters: 
2022-04-22 22:44:00.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945582351060992[0;39m <==    Updates: 0
2022-04-22 22:44:00.107 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945582351060992[0;39m 生成今日电子书快照结束，耗时：101毫秒
2022-04-22 22:44:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945603330969600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945603330969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945603330969600[0;39m ==> Parameters: 
2022-04-22 22:44:05.297 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945603330969600[0;39m <==    Updates: 0
2022-04-22 22:44:05.297 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945603330969600[0;39m 生成今日电子书快照结束，耗时：289毫秒
2022-04-22 22:44:05.297 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945604543123456[0;39m start updating Ebook doc
2022-04-22 22:44:05.297 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945604543123456[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:44:05.297 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945604543123456[0;39m ==> Parameters: 
2022-04-22 22:44:05.333 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945604543123456[0;39m <==    Updates: 1
2022-04-22 22:44:05.333 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945604543123456[0;39m update ends, take 36 millisecs
2022-04-22 22:44:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945624289906688[0;39m 生成今日电子书快照开始
2022-04-22 22:44:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945624289906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945624289906688[0;39m ==> Parameters: 
2022-04-22 22:44:10.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945624289906688[0;39m <==    Updates: 0
2022-04-22 22:44:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945624289906688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:44:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945645274009600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945645274009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945645274009600[0;39m ==> Parameters: 
2022-04-22 22:44:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945645274009600[0;39m <==    Updates: 0
2022-04-22 22:44:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945645274009600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:44:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945666224558080[0;39m 生成今日电子书快照开始
2022-04-22 22:44:20.188 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945666224558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:20.189 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945666224558080[0;39m ==> Parameters: 
2022-04-22 22:44:20.228 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945666224558080[0;39m <==    Updates: 0
2022-04-22 22:44:20.229 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945666224558080[0;39m 生成今日电子书快照结束，耗时：226毫秒
2022-04-22 22:44:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945687217049600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945687217049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945687217049600[0;39m ==> Parameters: 
2022-04-22 22:44:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945687217049600[0;39m <==    Updates: 0
2022-04-22 22:44:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945687217049600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:44:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945708167598080[0;39m 生成今日电子书快照开始
2022-04-22 22:44:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945708167598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945708167598080[0;39m ==> Parameters: 
2022-04-22 22:44:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945708167598080[0;39m <==    Updates: 0
2022-04-22 22:44:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945708167598080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:44:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945729160089600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:35.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945729160089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:35.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945729160089600[0;39m ==> Parameters: 
2022-04-22 22:44:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945729160089600[0;39m <==    Updates: 0
2022-04-22 22:44:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945729160089600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:44:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945729441107968[0;39m start updating Ebook doc
2022-04-22 22:44:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945729441107968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:44:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945729441107968[0;39m ==> Parameters: 
2022-04-22 22:44:35.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945729441107968[0;39m <==    Updates: 1
2022-04-22 22:44:35.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945729441107968[0;39m update ends, take 35 millisecs
2022-04-22 22:44:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945750131609600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945750131609600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945750131609600[0;39m ==> Parameters: 
2022-04-22 22:44:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945750131609600[0;39m <==    Updates: 0
2022-04-22 22:44:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945750131609600[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:44:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945771103129600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945771103129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945771103129600[0;39m ==> Parameters: 
2022-04-22 22:44:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945771103129600[0;39m <==    Updates: 0
2022-04-22 22:44:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945771103129600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:44:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945792074649600[0;39m 生成今日电子书快照开始
2022-04-22 22:44:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945792074649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945792074649600[0;39m ==> Parameters: 
2022-04-22 22:44:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945792074649600[0;39m <==    Updates: 0
2022-04-22 22:44:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945792074649600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:44:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945813041975296[0;39m 生成今日电子书快照开始
2022-04-22 22:44:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945813041975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:44:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945813041975296[0;39m ==> Parameters: 
2022-04-22 22:44:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945813041975296[0;39m <==    Updates: 0
2022-04-22 22:44:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945813041975296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:45:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945834005106688[0;39m 生成今日电子书快照开始
2022-04-22 22:45:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945834005106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945834005106688[0;39m ==> Parameters: 
2022-04-22 22:45:00.191 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945834005106688[0;39m <==    Updates: 0
2022-04-22 22:45:00.192 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945834005106688[0;39m 生成今日电子书快照结束，耗时：187毫秒
2022-04-22 22:45:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945854989209600[0;39m 生成今日电子书快照开始
2022-04-22 22:45:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945854989209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945854989209600[0;39m ==> Parameters: 
2022-04-22 22:45:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945854989209600[0;39m <==    Updates: 0
2022-04-22 22:45:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945854989209600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:45:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945855253450752[0;39m start updating Ebook doc
2022-04-22 22:45:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945855253450752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:45:05.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945855253450752[0;39m ==> Parameters: 
2022-04-22 22:45:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945855253450752[0;39m <==    Updates: 1
2022-04-22 22:45:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945855253450752[0;39m update ends, take 40 millisecs
2022-04-22 22:45:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945875960729600[0;39m 生成今日电子书快照开始
2022-04-22 22:45:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945875960729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945875960729600[0;39m ==> Parameters: 
2022-04-22 22:45:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945875960729600[0;39m <==    Updates: 0
2022-04-22 22:45:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945875960729600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:45:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945896923860992[0;39m 生成今日电子书快照开始
2022-04-22 22:45:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945896923860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945896923860992[0;39m ==> Parameters: 
2022-04-22 22:45:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945896923860992[0;39m <==    Updates: 0
2022-04-22 22:45:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945896923860992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:45:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945917907963904[0;39m 生成今日电子书快照开始
2022-04-22 22:45:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945917907963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945917907963904[0;39m ==> Parameters: 
2022-04-22 22:45:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945917907963904[0;39m <==    Updates: 0
2022-04-22 22:45:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945917907963904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:45:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945938879483904[0;39m 生成今日电子书快照开始
2022-04-22 22:45:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945938879483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945938879483904[0;39m ==> Parameters: 
2022-04-22 22:45:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945938879483904[0;39m <==    Updates: 0
2022-04-22 22:45:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945938879483904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:45:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945959842615296[0;39m 生成今日电子书快照开始
2022-04-22 22:45:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945959842615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945959842615296[0;39m ==> Parameters: 
2022-04-22 22:45:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945959842615296[0;39m <==    Updates: 0
2022-04-22 22:45:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945959842615296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:45:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172945980822523904[0;39m 生成今日电子书快照开始
2022-04-22 22:45:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945980822523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945980822523904[0;39m ==> Parameters: 
2022-04-22 22:45:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172945980822523904[0;39m <==    Updates: 0
2022-04-22 22:45:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172945980822523904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:45:35.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172945981095153664[0;39m start updating Ebook doc
2022-04-22 22:45:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945981095153664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:45:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945981095153664[0;39m ==> Parameters: 
2022-04-22 22:45:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172945981095153664[0;39m <==    Updates: 1
2022-04-22 22:45:35.108 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172945981095153664[0;39m update ends, take 34 millisecs
2022-04-22 22:45:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946001794043904[0;39m 生成今日电子书快照开始
2022-04-22 22:45:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946001794043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946001794043904[0;39m ==> Parameters: 
2022-04-22 22:45:40.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946001794043904[0;39m <==    Updates: 0
2022-04-22 22:45:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946001794043904[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:45:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946022757175296[0;39m 生成今日电子书快照开始
2022-04-22 22:45:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946022757175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946022757175296[0;39m ==> Parameters: 
2022-04-22 22:45:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946022757175296[0;39m <==    Updates: 0
2022-04-22 22:45:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946022757175296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:45:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946043737083904[0;39m 生成今日电子书快照开始
2022-04-22 22:45:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946043737083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946043737083904[0;39m ==> Parameters: 
2022-04-22 22:45:50.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946043737083904[0;39m <==    Updates: 0
2022-04-22 22:45:50.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946043737083904[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:45:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946064704409600[0;39m 生成今日电子书快照开始
2022-04-22 22:45:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946064704409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:45:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946064704409600[0;39m ==> Parameters: 
2022-04-22 22:45:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946064704409600[0;39m <==    Updates: 0
2022-04-22 22:45:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946064704409600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:46:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946085675929600[0;39m 生成今日电子书快照开始
2022-04-22 22:46:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946085675929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946085675929600[0;39m ==> Parameters: 
2022-04-22 22:46:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946085675929600[0;39m <==    Updates: 0
2022-04-22 22:46:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946085675929600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:46:05.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946106647449600[0;39m start updating Ebook doc
2022-04-22 22:46:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946106647449600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:46:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946106647449600[0;39m ==> Parameters: 
2022-04-22 22:46:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946106647449600[0;39m <==    Updates: 1
2022-04-22 22:46:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946106647449600[0;39m update ends, take 60 millisecs
2022-04-22 22:46:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946106903302144[0;39m 生成今日电子书快照开始
2022-04-22 22:46:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946106903302144[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946106903302144[0;39m ==> Parameters: 
2022-04-22 22:46:05.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946106903302144[0;39m <==    Updates: 0
2022-04-22 22:46:05.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946106903302144[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 22:46:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946127597998080[0;39m 生成今日电子书快照开始
2022-04-22 22:46:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946127597998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946127597998080[0;39m ==> Parameters: 
2022-04-22 22:46:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946127597998080[0;39m <==    Updates: 0
2022-04-22 22:46:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946127597998080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:46:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946148594683904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946148594683904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946148594683904[0;39m ==> Parameters: 
2022-04-22 22:46:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946148594683904[0;39m <==    Updates: 0
2022-04-22 22:46:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946148594683904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:46:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946169566203904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946169566203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946169566203904[0;39m ==> Parameters: 
2022-04-22 22:46:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946169566203904[0;39m <==    Updates: 0
2022-04-22 22:46:20.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946169566203904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 22:46:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946190537723904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946190537723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946190537723904[0;39m ==> Parameters: 
2022-04-22 22:46:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946190537723904[0;39m <==    Updates: 0
2022-04-22 22:46:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946190537723904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:46:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946211484078080[0;39m 生成今日电子书快照开始
2022-04-22 22:46:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946211484078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946211484078080[0;39m ==> Parameters: 
2022-04-22 22:46:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946211484078080[0;39m <==    Updates: 0
2022-04-22 22:46:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946211484078080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:46:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946232480763904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:35.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946232480763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:35.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946232480763904[0;39m ==> Parameters: 
2022-04-22 22:46:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946232480763904[0;39m <==    Updates: 0
2022-04-22 22:46:35.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946232480763904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:46:35.080 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946232778559488[0;39m start updating Ebook doc
2022-04-22 22:46:35.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946232778559488[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:46:35.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946232778559488[0;39m ==> Parameters: 
2022-04-22 22:46:35.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946232778559488[0;39m <==    Updates: 1
2022-04-22 22:46:35.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946232778559488[0;39m update ends, take 33 millisecs
2022-04-22 22:46:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946253452283904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946253452283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946253452283904[0;39m ==> Parameters: 
2022-04-22 22:46:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946253452283904[0;39m <==    Updates: 0
2022-04-22 22:46:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946253452283904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:46:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946274423803904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946274423803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946274423803904[0;39m ==> Parameters: 
2022-04-22 22:46:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946274423803904[0;39m <==    Updates: 0
2022-04-22 22:46:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946274423803904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:46:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946295395323904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:50.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946295395323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:50.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946295395323904[0;39m ==> Parameters: 
2022-04-22 22:46:50.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946295395323904[0;39m <==    Updates: 0
2022-04-22 22:46:50.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946295395323904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:46:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946316366843904[0;39m 生成今日电子书快照开始
2022-04-22 22:46:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946316366843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:46:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946316366843904[0;39m ==> Parameters: 
2022-04-22 22:46:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946316366843904[0;39m <==    Updates: 0
2022-04-22 22:46:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946316366843904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:47:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946337325780992[0;39m 生成今日电子书快照开始
2022-04-22 22:47:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946337325780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946337325780992[0;39m ==> Parameters: 
2022-04-22 22:47:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946337325780992[0;39m <==    Updates: 0
2022-04-22 22:47:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946337325780992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:47:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946358305689600[0;39m 生成今日电子书快照开始
2022-04-22 22:47:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946358305689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946358305689600[0;39m ==> Parameters: 
2022-04-22 22:47:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946358305689600[0;39m <==    Updates: 0
2022-04-22 22:47:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946358305689600[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:47:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946358557347840[0;39m start updating Ebook doc
2022-04-22 22:47:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946358557347840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:47:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946358557347840[0;39m ==> Parameters: 
2022-04-22 22:47:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946358557347840[0;39m <==    Updates: 1
2022-04-22 22:47:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946358557347840[0;39m update ends, take 38 millisecs
2022-04-22 22:47:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946379285598208[0;39m 生成今日电子书快照开始
2022-04-22 22:47:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946379285598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946379285598208[0;39m ==> Parameters: 
2022-04-22 22:47:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946379285598208[0;39m <==    Updates: 0
2022-04-22 22:47:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946379285598208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:47:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946400257118208[0;39m 生成今日电子书快照开始
2022-04-22 22:47:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946400257118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946400257118208[0;39m ==> Parameters: 
2022-04-22 22:47:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946400257118208[0;39m <==    Updates: 0
2022-04-22 22:47:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946400257118208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:47:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946421228638208[0;39m 生成今日电子书快照开始
2022-04-22 22:47:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946421228638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946421228638208[0;39m ==> Parameters: 
2022-04-22 22:47:20.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946421228638208[0;39m <==    Updates: 0
2022-04-22 22:47:20.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946421228638208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:47:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946442187575296[0;39m 生成今日电子书快照开始
2022-04-22 22:47:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946442187575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946442187575296[0;39m ==> Parameters: 
2022-04-22 22:47:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946442187575296[0;39m <==    Updates: 0
2022-04-22 22:47:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946442187575296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:47:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946463167483904[0;39m 生成今日电子书快照开始
2022-04-22 22:47:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946463167483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:30.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946463167483904[0;39m ==> Parameters: 
2022-04-22 22:47:30.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946463167483904[0;39m <==    Updates: 0
2022-04-22 22:47:30.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946463167483904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:47:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946484143198208[0;39m start updating Ebook doc
2022-04-22 22:47:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946484143198208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:47:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946484143198208[0;39m ==> Parameters: 
2022-04-22 22:47:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946484143198208[0;39m <==    Updates: 1
2022-04-22 22:47:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946484143198208[0;39m update ends, take 60 millisecs
2022-04-22 22:47:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946484394856448[0;39m 生成今日电子书快照开始
2022-04-22 22:47:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946484394856448[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946484394856448[0;39m ==> Parameters: 
2022-04-22 22:47:35.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946484394856448[0;39m <==    Updates: 0
2022-04-22 22:47:35.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946484394856448[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 22:47:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946505102135296[0;39m 生成今日电子书快照开始
2022-04-22 22:47:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946505102135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946505102135296[0;39m ==> Parameters: 
2022-04-22 22:47:40.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946505102135296[0;39m <==    Updates: 0
2022-04-22 22:47:40.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946505102135296[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 22:47:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946526086238208[0;39m 生成今日电子书快照开始
2022-04-22 22:47:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946526086238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946526086238208[0;39m ==> Parameters: 
2022-04-22 22:47:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946526086238208[0;39m <==    Updates: 0
2022-04-22 22:47:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946526086238208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:47:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946547057758208[0;39m 生成今日电子书快照开始
2022-04-22 22:47:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946547057758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946547057758208[0;39m ==> Parameters: 
2022-04-22 22:47:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946547057758208[0;39m <==    Updates: 0
2022-04-22 22:47:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946547057758208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:47:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946568029278208[0;39m 生成今日电子书快照开始
2022-04-22 22:47:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946568029278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:47:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946568029278208[0;39m ==> Parameters: 
2022-04-22 22:47:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946568029278208[0;39m <==    Updates: 0
2022-04-22 22:47:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946568029278208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:48:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946588992409600[0;39m 生成今日电子书快照开始
2022-04-22 22:48:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946588992409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946588992409600[0;39m ==> Parameters: 
2022-04-22 22:48:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946588992409600[0;39m <==    Updates: 0
2022-04-22 22:48:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946588992409600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 22:48:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946609951346688[0;39m 生成今日电子书快照开始
2022-04-22 22:48:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946609951346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946609951346688[0;39m ==> Parameters: 
2022-04-22 22:48:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946609951346688[0;39m <==    Updates: 0
2022-04-22 22:48:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946609951346688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:48:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946610223976448[0;39m start updating Ebook doc
2022-04-22 22:48:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946610223976448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:48:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946610223976448[0;39m ==> Parameters: 
2022-04-22 22:48:05.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946610223976448[0;39m <==    Updates: 1
2022-04-22 22:48:05.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946610223976448[0;39m update ends, take 46 millisecs
2022-04-22 22:48:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946630931255296[0;39m 生成今日电子书快照开始
2022-04-22 22:48:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946630931255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946630931255296[0;39m ==> Parameters: 
2022-04-22 22:48:10.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946630931255296[0;39m <==    Updates: 0
2022-04-22 22:48:10.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946630931255296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:48:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946651902775296[0;39m 生成今日电子书快照开始
2022-04-22 22:48:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946651902775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946651902775296[0;39m ==> Parameters: 
2022-04-22 22:48:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946651902775296[0;39m <==    Updates: 0
2022-04-22 22:48:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946651902775296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:48:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946672882683904[0;39m 生成今日电子书快照开始
2022-04-22 22:48:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946672882683904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946672882683904[0;39m ==> Parameters: 
2022-04-22 22:48:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946672882683904[0;39m <==    Updates: 0
2022-04-22 22:48:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946672882683904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:48:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946693858398208[0;39m 生成今日电子书快照开始
2022-04-22 22:48:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946693858398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946693858398208[0;39m ==> Parameters: 
2022-04-22 22:48:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946693858398208[0;39m <==    Updates: 0
2022-04-22 22:48:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946693858398208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:48:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946714813140992[0;39m 生成今日电子书快照开始
2022-04-22 22:48:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946714813140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946714813140992[0;39m ==> Parameters: 
2022-04-22 22:48:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946714813140992[0;39m <==    Updates: 0
2022-04-22 22:48:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946714813140992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:48:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946735763689472[0;39m 生成今日电子书快照开始
2022-04-22 22:48:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946735763689472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:35.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946735763689472[0;39m ==> Parameters: 
2022-04-22 22:48:35.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946735763689472[0;39m <==    Updates: 0
2022-04-22 22:48:35.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946735763689472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:48:35.058 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946736002764800[0;39m start updating Ebook doc
2022-04-22 22:48:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946736002764800[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:48:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946736002764800[0;39m ==> Parameters: 
2022-04-22 22:48:35.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946736002764800[0;39m <==    Updates: 1
2022-04-22 22:48:35.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946736002764800[0;39m update ends, take 41 millisecs
2022-04-22 22:48:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946756747792384[0;39m 生成今日电子书快照开始
2022-04-22 22:48:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946756747792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946756747792384[0;39m ==> Parameters: 
2022-04-22 22:48:40.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946756747792384[0;39m <==    Updates: 0
2022-04-22 22:48:40.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946756747792384[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:48:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946777710923776[0;39m 生成今日电子书快照开始
2022-04-22 22:48:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946777710923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946777710923776[0;39m ==> Parameters: 
2022-04-22 22:48:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946777710923776[0;39m <==    Updates: 0
2022-04-22 22:48:45.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946777710923776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:48:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946798690832384[0;39m 生成今日电子书快照开始
2022-04-22 22:48:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946798690832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946798690832384[0;39m ==> Parameters: 
2022-04-22 22:48:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946798690832384[0;39m <==    Updates: 0
2022-04-22 22:48:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946798690832384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:48:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946819662352384[0;39m 生成今日电子书快照开始
2022-04-22 22:48:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946819662352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:48:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946819662352384[0;39m ==> Parameters: 
2022-04-22 22:48:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946819662352384[0;39m <==    Updates: 0
2022-04-22 22:48:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946819662352384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:49:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946840633872384[0;39m 生成今日电子书快照开始
2022-04-22 22:49:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946840633872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946840633872384[0;39m ==> Parameters: 
2022-04-22 22:49:00.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946840633872384[0;39m <==    Updates: 0
2022-04-22 22:49:00.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946840633872384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:49:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946861597003776[0;39m 生成今日电子书快照开始
2022-04-22 22:49:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946861597003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946861597003776[0;39m ==> Parameters: 
2022-04-22 22:49:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946861597003776[0;39m <==    Updates: 0
2022-04-22 22:49:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946861597003776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:49:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946861844467712[0;39m start updating Ebook doc
2022-04-22 22:49:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946861844467712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:49:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946861844467712[0;39m ==> Parameters: 
2022-04-22 22:49:05.099 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946861844467712[0;39m <==    Updates: 1
2022-04-22 22:49:05.099 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946861844467712[0;39m update ends, take 38 millisecs
2022-04-22 22:49:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946882572718080[0;39m 生成今日电子书快照开始
2022-04-22 22:49:10.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946882572718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:10.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946882572718080[0;39m ==> Parameters: 
2022-04-22 22:49:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946882572718080[0;39m <==    Updates: 0
2022-04-22 22:49:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946882572718080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:49:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946903544238080[0;39m 生成今日电子书快照开始
2022-04-22 22:49:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946903544238080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946903544238080[0;39m ==> Parameters: 
2022-04-22 22:49:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946903544238080[0;39m <==    Updates: 0
2022-04-22 22:49:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946903544238080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:49:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946924536729600[0;39m 生成今日电子书快照开始
2022-04-22 22:49:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946924536729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946924536729600[0;39m ==> Parameters: 
2022-04-22 22:49:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946924536729600[0;39m <==    Updates: 0
2022-04-22 22:49:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946924536729600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:49:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946945495666688[0;39m 生成今日电子书快照开始
2022-04-22 22:49:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946945495666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946945495666688[0;39m ==> Parameters: 
2022-04-22 22:49:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946945495666688[0;39m <==    Updates: 0
2022-04-22 22:49:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946945495666688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:49:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946966479769600[0;39m 生成今日电子书快照开始
2022-04-22 22:49:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946966479769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946966479769600[0;39m ==> Parameters: 
2022-04-22 22:49:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946966479769600[0;39m <==    Updates: 0
2022-04-22 22:49:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946966479769600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:49:35.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172946987421929472[0;39m 生成今日电子书快照开始
2022-04-22 22:49:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946987421929472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946987421929472[0;39m ==> Parameters: 
2022-04-22 22:49:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172946987421929472[0;39m <==    Updates: 0
2022-04-22 22:49:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172946987421929472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:49:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172946987690364928[0;39m start updating Ebook doc
2022-04-22 22:49:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946987690364928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:49:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946987690364928[0;39m ==> Parameters: 
2022-04-22 22:49:35.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172946987690364928[0;39m <==    Updates: 1
2022-04-22 22:49:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172946987690364928[0;39m update ends, take 39 millisecs
2022-04-22 22:49:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947008431198208[0;39m 生成今日电子书快照开始
2022-04-22 22:49:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947008431198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947008431198208[0;39m ==> Parameters: 
2022-04-22 22:49:40.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947008431198208[0;39m <==    Updates: 0
2022-04-22 22:49:40.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947008431198208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 22:49:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947029373358080[0;39m 生成今日电子书快照开始
2022-04-22 22:49:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947029373358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947029373358080[0;39m ==> Parameters: 
2022-04-22 22:49:45.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947029373358080[0;39m <==    Updates: 0
2022-04-22 22:49:45.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947029373358080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:49:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947050361655296[0;39m 生成今日电子书快照开始
2022-04-22 22:49:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947050361655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947050361655296[0;39m ==> Parameters: 
2022-04-22 22:49:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947050361655296[0;39m <==    Updates: 0
2022-04-22 22:49:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947050361655296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:49:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947071333175296[0;39m 生成今日电子书快照开始
2022-04-22 22:49:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947071333175296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:49:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947071333175296[0;39m ==> Parameters: 
2022-04-22 22:49:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947071333175296[0;39m <==    Updates: 0
2022-04-22 22:49:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947071333175296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:50:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947092287918080[0;39m 生成今日电子书快照开始
2022-04-22 22:50:00.149 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947092287918080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:00.150 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947092287918080[0;39m ==> Parameters: 
2022-04-22 22:50:00.187 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947092287918080[0;39m <==    Updates: 0
2022-04-22 22:50:00.187 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947092287918080[0;39m 生成今日电子书快照结束，耗时：183毫秒
2022-04-22 22:50:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947113255243776[0;39m 生成今日电子书快照开始
2022-04-22 22:50:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947113255243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947113255243776[0;39m ==> Parameters: 
2022-04-22 22:50:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947113255243776[0;39m <==    Updates: 0
2022-04-22 22:50:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947113255243776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:50:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947113532067840[0;39m start updating Ebook doc
2022-04-22 22:50:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947113532067840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:50:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947113532067840[0;39m ==> Parameters: 
2022-04-22 22:50:05.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947113532067840[0;39m <==    Updates: 1
2022-04-22 22:50:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947113532067840[0;39m update ends, take 38 millisecs
2022-04-22 22:50:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947134239346688[0;39m 生成今日电子书快照开始
2022-04-22 22:50:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947134239346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947134239346688[0;39m ==> Parameters: 
2022-04-22 22:50:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947134239346688[0;39m <==    Updates: 0
2022-04-22 22:50:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947134239346688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:50:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947155194089472[0;39m 生成今日电子书快照开始
2022-04-22 22:50:15.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947155194089472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:15.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947155194089472[0;39m ==> Parameters: 
2022-04-22 22:50:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947155194089472[0;39m <==    Updates: 0
2022-04-22 22:50:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947155194089472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:50:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947176182386688[0;39m 生成今日电子书快照开始
2022-04-22 22:50:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947176182386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947176182386688[0;39m ==> Parameters: 
2022-04-22 22:50:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947176182386688[0;39m <==    Updates: 0
2022-04-22 22:50:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947176182386688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:50:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947197158100992[0;39m 生成今日电子书快照开始
2022-04-22 22:50:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947197158100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947197158100992[0;39m ==> Parameters: 
2022-04-22 22:50:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947197158100992[0;39m <==    Updates: 0
2022-04-22 22:50:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947197158100992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:50:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947218117038080[0;39m 生成今日电子书快照开始
2022-04-22 22:50:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947218117038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947218117038080[0;39m ==> Parameters: 
2022-04-22 22:50:30.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947218117038080[0;39m <==    Updates: 0
2022-04-22 22:50:30.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947218117038080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:50:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947239117918208[0;39m 生成今日电子书快照开始
2022-04-22 22:50:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947239117918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947239117918208[0;39m ==> Parameters: 
2022-04-22 22:50:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947239117918208[0;39m <==    Updates: 0
2022-04-22 22:50:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947239117918208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:50:35.078 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947239403130880[0;39m start updating Ebook doc
2022-04-22 22:50:35.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947239403130880[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:50:35.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947239403130880[0;39m ==> Parameters: 
2022-04-22 22:50:35.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947239403130880[0;39m <==    Updates: 1
2022-04-22 22:50:35.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947239403130880[0;39m update ends, take 41 millisecs
2022-04-22 22:50:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947260076855296[0;39m 生成今日电子书快照开始
2022-04-22 22:50:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947260076855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947260076855296[0;39m ==> Parameters: 
2022-04-22 22:50:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947260076855296[0;39m <==    Updates: 0
2022-04-22 22:50:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947260076855296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:50:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947281027403776[0;39m 生成今日电子书快照开始
2022-04-22 22:50:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947281027403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947281027403776[0;39m ==> Parameters: 
2022-04-22 22:50:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947281027403776[0;39m <==    Updates: 0
2022-04-22 22:50:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947281027403776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:50:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947302032478208[0;39m 生成今日电子书快照开始
2022-04-22 22:50:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947302032478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947302032478208[0;39m ==> Parameters: 
2022-04-22 22:50:50.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947302032478208[0;39m <==    Updates: 0
2022-04-22 22:50:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947302032478208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:50:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947322991415296[0;39m 生成今日电子书快照开始
2022-04-22 22:50:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947322991415296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:50:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947322991415296[0;39m ==> Parameters: 
2022-04-22 22:50:55.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947322991415296[0;39m <==    Updates: 0
2022-04-22 22:50:55.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947322991415296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 22:51:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947343941963776[0;39m 生成今日电子书快照开始
2022-04-22 22:51:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947343941963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947343941963776[0;39m ==> Parameters: 
2022-04-22 22:51:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947343941963776[0;39m <==    Updates: 0
2022-04-22 22:51:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947343941963776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:51:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947364926066688[0;39m 生成今日电子书快照开始
2022-04-22 22:51:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947364926066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947364926066688[0;39m ==> Parameters: 
2022-04-22 22:51:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947364926066688[0;39m <==    Updates: 0
2022-04-22 22:51:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947364926066688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:51:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947365190307840[0;39m start updating Ebook doc
2022-04-22 22:51:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947365190307840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:51:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947365190307840[0;39m ==> Parameters: 
2022-04-22 22:51:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947365190307840[0;39m <==    Updates: 1
2022-04-22 22:51:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947365190307840[0;39m update ends, take 37 millisecs
2022-04-22 22:51:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947385905975296[0;39m 生成今日电子书快照开始
2022-04-22 22:51:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947385905975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947385905975296[0;39m ==> Parameters: 
2022-04-22 22:51:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947385905975296[0;39m <==    Updates: 0
2022-04-22 22:51:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947385905975296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:51:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947406881689600[0;39m 生成今日电子书快照开始
2022-04-22 22:51:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947406881689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947406881689600[0;39m ==> Parameters: 
2022-04-22 22:51:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947406881689600[0;39m <==    Updates: 0
2022-04-22 22:51:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947406881689600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:51:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947427828043776[0;39m 生成今日电子书快照开始
2022-04-22 22:51:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947427828043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947427828043776[0;39m ==> Parameters: 
2022-04-22 22:51:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947427828043776[0;39m <==    Updates: 0
2022-04-22 22:51:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947427828043776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:51:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947448803758080[0;39m 生成今日电子书快照开始
2022-04-22 22:51:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947448803758080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947448803758080[0;39m ==> Parameters: 
2022-04-22 22:51:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947448803758080[0;39m <==    Updates: 0
2022-04-22 22:51:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947448803758080[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:51:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947469766889472[0;39m 生成今日电子书快照开始
2022-04-22 22:51:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947469766889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947469766889472[0;39m ==> Parameters: 
2022-04-22 22:51:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947469766889472[0;39m <==    Updates: 0
2022-04-22 22:51:30.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947469766889472[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:51:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947490771963904[0;39m start updating Ebook doc
2022-04-22 22:51:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947490771963904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:51:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947490771963904[0;39m ==> Parameters: 
2022-04-22 22:51:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947490771963904[0;39m <==    Updates: 1
2022-04-22 22:51:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947490771963904[0;39m update ends, take 59 millisecs
2022-04-22 22:51:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947491019427840[0;39m 生成今日电子书快照开始
2022-04-22 22:51:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947491019427840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947491019427840[0;39m ==> Parameters: 
2022-04-22 22:51:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947491019427840[0;39m <==    Updates: 0
2022-04-22 22:51:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947491019427840[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 22:51:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947511722512384[0;39m 生成今日电子书快照开始
2022-04-22 22:51:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947511722512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947511722512384[0;39m ==> Parameters: 
2022-04-22 22:51:40.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947511722512384[0;39m <==    Updates: 0
2022-04-22 22:51:40.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947511722512384[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 22:51:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947532689838080[0;39m 生成今日电子书快照开始
2022-04-22 22:51:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947532689838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947532689838080[0;39m ==> Parameters: 
2022-04-22 22:51:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947532689838080[0;39m <==    Updates: 0
2022-04-22 22:51:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947532689838080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:51:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947553665552384[0;39m 生成今日电子书快照开始
2022-04-22 22:51:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947553665552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947553665552384[0;39m ==> Parameters: 
2022-04-22 22:51:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947553665552384[0;39m <==    Updates: 0
2022-04-22 22:51:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947553665552384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:51:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947574645460992[0;39m 生成今日电子书快照开始
2022-04-22 22:51:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947574645460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:51:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947574645460992[0;39m ==> Parameters: 
2022-04-22 22:51:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947574645460992[0;39m <==    Updates: 0
2022-04-22 22:51:55.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947574645460992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:52:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947595600203776[0;39m 生成今日电子书快照开始
2022-04-22 22:52:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947595600203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947595600203776[0;39m ==> Parameters: 
2022-04-22 22:52:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947595600203776[0;39m <==    Updates: 0
2022-04-22 22:52:00.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947595600203776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:52:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947616601083904[0;39m 生成今日电子书快照开始
2022-04-22 22:52:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947616601083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947616601083904[0;39m ==> Parameters: 
2022-04-22 22:52:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947616601083904[0;39m <==    Updates: 0
2022-04-22 22:52:05.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947616601083904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:52:05.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947616869519360[0;39m start updating Ebook doc
2022-04-22 22:52:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947616869519360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:52:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947616869519360[0;39m ==> Parameters: 
2022-04-22 22:52:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947616869519360[0;39m <==    Updates: 1
2022-04-22 22:52:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947616869519360[0;39m update ends, take 41 millisecs
2022-04-22 22:52:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947637572603904[0;39m 生成今日电子书快照开始
2022-04-22 22:52:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947637572603904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947637572603904[0;39m ==> Parameters: 
2022-04-22 22:52:10.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947637572603904[0;39m <==    Updates: 0
2022-04-22 22:52:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947637572603904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:52:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947658523152384[0;39m 生成今日电子书快照开始
2022-04-22 22:52:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947658523152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947658523152384[0;39m ==> Parameters: 
2022-04-22 22:52:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947658523152384[0;39m <==    Updates: 0
2022-04-22 22:52:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947658523152384[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:52:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947679490478080[0;39m 生成今日电子书快照开始
2022-04-22 22:52:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947679490478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947679490478080[0;39m ==> Parameters: 
2022-04-22 22:52:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947679490478080[0;39m <==    Updates: 0
2022-04-22 22:52:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947679490478080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:52:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947700466192384[0;39m 生成今日电子书快照开始
2022-04-22 22:52:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947700466192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:25.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947700466192384[0;39m ==> Parameters: 
2022-04-22 22:52:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947700466192384[0;39m <==    Updates: 0
2022-04-22 22:52:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947700466192384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:52:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947721429323776[0;39m 生成今日电子书快照开始
2022-04-22 22:52:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947721429323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947721429323776[0;39m ==> Parameters: 
2022-04-22 22:52:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947721429323776[0;39m <==    Updates: 0
2022-04-22 22:52:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947721429323776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:52:34.995 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947742371483648[0;39m start updating Ebook doc
2022-04-22 22:52:35.011 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947742371483648[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:52:35.012 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947742371483648[0;39m ==> Parameters: 
2022-04-22 22:52:35.049 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947742371483648[0;39m <==    Updates: 1
2022-04-22 22:52:35.049 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947742371483648[0;39m update ends, take 53 millisecs
2022-04-22 22:52:35.050 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947742602170368[0;39m 生成今日电子书快照开始
2022-04-22 22:52:35.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947742602170368[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:35.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947742602170368[0;39m ==> Parameters: 
2022-04-22 22:52:35.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947742602170368[0;39m <==    Updates: 0
2022-04-22 22:52:35.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947742602170368[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 22:52:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947763363975168[0;39m 生成今日电子书快照开始
2022-04-22 22:52:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947763363975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:40.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947763363975168[0;39m ==> Parameters: 
2022-04-22 22:52:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947763363975168[0;39m <==    Updates: 0
2022-04-22 22:52:40.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947763363975168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:52:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947784364855296[0;39m 生成今日电子书快照开始
2022-04-22 22:52:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947784364855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947784364855296[0;39m ==> Parameters: 
2022-04-22 22:52:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947784364855296[0;39m <==    Updates: 0
2022-04-22 22:52:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947784364855296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:52:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947805332180992[0;39m 生成今日电子书快照开始
2022-04-22 22:52:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947805332180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947805332180992[0;39m ==> Parameters: 
2022-04-22 22:52:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947805332180992[0;39m <==    Updates: 0
2022-04-22 22:52:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947805332180992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:52:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947826303700992[0;39m 生成今日电子书快照开始
2022-04-22 22:52:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947826303700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:52:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947826303700992[0;39m ==> Parameters: 
2022-04-22 22:52:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947826303700992[0;39m <==    Updates: 0
2022-04-22 22:52:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947826303700992[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:53:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947847262638080[0;39m 生成今日电子书快照开始
2022-04-22 22:53:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947847262638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:00.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947847262638080[0;39m ==> Parameters: 
2022-04-22 22:53:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947847262638080[0;39m <==    Updates: 0
2022-04-22 22:53:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947847262638080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:53:04.991 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947868183826432[0;39m start updating Ebook doc
2022-04-22 22:53:05.009 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947868183826432[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:53:05.010 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947868183826432[0;39m ==> Parameters: 
2022-04-22 22:53:05.046 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947868183826432[0;39m <==    Updates: 1
2022-04-22 22:53:05.047 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947868183826432[0;39m update ends, take 56 millisecs
2022-04-22 22:53:05.047 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947868418707456[0;39m 生成今日电子书快照开始
2022-04-22 22:53:05.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947868418707456[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:05.048 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947868418707456[0;39m ==> Parameters: 
2022-04-22 22:53:05.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947868418707456[0;39m <==    Updates: 0
2022-04-22 22:53:05.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947868418707456[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-22 22:53:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947889230843904[0;39m 生成今日电子书快照开始
2022-04-22 22:53:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947889230843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947889230843904[0;39m ==> Parameters: 
2022-04-22 22:53:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947889230843904[0;39m <==    Updates: 0
2022-04-22 22:53:10.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947889230843904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:53:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947910173003776[0;39m 生成今日电子书快照开始
2022-04-22 22:53:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947910173003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947910173003776[0;39m ==> Parameters: 
2022-04-22 22:53:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947910173003776[0;39m <==    Updates: 0
2022-04-22 22:53:15.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947910173003776[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:53:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947931173883904[0;39m 生成今日电子书快照开始
2022-04-22 22:53:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947931173883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947931173883904[0;39m ==> Parameters: 
2022-04-22 22:53:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947931173883904[0;39m <==    Updates: 0
2022-04-22 22:53:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947931173883904[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 22:53:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947952145403904[0;39m 生成今日电子书快照开始
2022-04-22 22:53:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947952145403904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947952145403904[0;39m ==> Parameters: 
2022-04-22 22:53:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947952145403904[0;39m <==    Updates: 0
2022-04-22 22:53:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947952145403904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:53:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947973083369472[0;39m 生成今日电子书快照开始
2022-04-22 22:53:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947973083369472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947973083369472[0;39m ==> Parameters: 
2022-04-22 22:53:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947973083369472[0;39m <==    Updates: 0
2022-04-22 22:53:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947973083369472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:53:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172947994080055296[0;39m start updating Ebook doc
2022-04-22 22:53:35.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947994080055296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:53:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947994080055296[0;39m ==> Parameters: 
2022-04-22 22:53:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172947994080055296[0;39m <==    Updates: 1
2022-04-22 22:53:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172947994080055296[0;39m update ends, take 54 millisecs
2022-04-22 22:53:35.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172947994306547712[0;39m 生成今日电子书快照开始
2022-04-22 22:53:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947994306547712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947994306547712[0;39m ==> Parameters: 
2022-04-22 22:53:35.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172947994306547712[0;39m <==    Updates: 0
2022-04-22 22:53:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172947994306547712[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-22 22:53:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948015051575296[0;39m 生成今日电子书快照开始
2022-04-22 22:53:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948015051575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948015051575296[0;39m ==> Parameters: 
2022-04-22 22:53:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948015051575296[0;39m <==    Updates: 0
2022-04-22 22:53:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948015051575296[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 22:53:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948036031483904[0;39m 生成今日电子书快照开始
2022-04-22 22:53:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948036031483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948036031483904[0;39m ==> Parameters: 
2022-04-22 22:53:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948036031483904[0;39m <==    Updates: 0
2022-04-22 22:53:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948036031483904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:53:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948056994615296[0;39m 生成今日电子书快照开始
2022-04-22 22:53:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948056994615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948056994615296[0;39m ==> Parameters: 
2022-04-22 22:53:50.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948056994615296[0;39m <==    Updates: 0
2022-04-22 22:53:50.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948056994615296[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:53:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948077961940992[0;39m 生成今日电子书快照开始
2022-04-22 22:53:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948077961940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:53:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948077961940992[0;39m ==> Parameters: 
2022-04-22 22:53:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948077961940992[0;39m <==    Updates: 0
2022-04-22 22:53:55.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948077961940992[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:54:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948098929266688[0;39m 生成今日电子书快照开始
2022-04-22 22:54:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948098929266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948098929266688[0;39m ==> Parameters: 
2022-04-22 22:54:00.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948098929266688[0;39m <==    Updates: 0
2022-04-22 22:54:00.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948098929266688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:54:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948119917563904[0;39m 生成今日电子书快照开始
2022-04-22 22:54:05.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948119917563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:05.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948119917563904[0;39m ==> Parameters: 
2022-04-22 22:54:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948119917563904[0;39m <==    Updates: 0
2022-04-22 22:54:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948119917563904[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:54:05.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948120202776576[0;39m start updating Ebook doc
2022-04-22 22:54:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948120202776576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:54:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948120202776576[0;39m ==> Parameters: 
2022-04-22 22:54:05.124 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948120202776576[0;39m <==    Updates: 1
2022-04-22 22:54:05.124 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948120202776576[0;39m update ends, take 47 millisecs
2022-04-22 22:54:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948140859723776[0;39m 生成今日电子书快照开始
2022-04-22 22:54:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948140859723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948140859723776[0;39m ==> Parameters: 
2022-04-22 22:54:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948140859723776[0;39m <==    Updates: 0
2022-04-22 22:54:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948140859723776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:54:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948161860603904[0;39m 生成今日电子书快照开始
2022-04-22 22:54:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948161860603904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948161860603904[0;39m ==> Parameters: 
2022-04-22 22:54:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948161860603904[0;39m <==    Updates: 0
2022-04-22 22:54:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948161860603904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:54:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948182806958080[0;39m 生成今日电子书快照开始
2022-04-22 22:54:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948182806958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948182806958080[0;39m ==> Parameters: 
2022-04-22 22:54:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948182806958080[0;39m <==    Updates: 0
2022-04-22 22:54:20.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948182806958080[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:54:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948203803643904[0;39m 生成今日电子书快照开始
2022-04-22 22:54:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948203803643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948203803643904[0;39m ==> Parameters: 
2022-04-22 22:54:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948203803643904[0;39m <==    Updates: 0
2022-04-22 22:54:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948203803643904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:54:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948224775163904[0;39m 生成今日电子书快照开始
2022-04-22 22:54:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948224775163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948224775163904[0;39m ==> Parameters: 
2022-04-22 22:54:30.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948224775163904[0;39m <==    Updates: 0
2022-04-22 22:54:30.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948224775163904[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 22:54:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948245734100992[0;39m 生成今日电子书快照开始
2022-04-22 22:54:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948245734100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948245734100992[0;39m ==> Parameters: 
2022-04-22 22:54:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948245734100992[0;39m <==    Updates: 0
2022-04-22 22:54:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948245734100992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:54:35.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948245998342144[0;39m start updating Ebook doc
2022-04-22 22:54:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948245998342144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:54:35.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948245998342144[0;39m ==> Parameters: 
2022-04-22 22:54:35.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948245998342144[0;39m <==    Updates: 1
2022-04-22 22:54:35.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948245998342144[0;39m update ends, take 38 millisecs
2022-04-22 22:54:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948266714009600[0;39m 生成今日电子书快照开始
2022-04-22 22:54:40.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948266714009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:40.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948266714009600[0;39m ==> Parameters: 
2022-04-22 22:54:40.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948266714009600[0;39m <==    Updates: 0
2022-04-22 22:54:40.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948266714009600[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 22:54:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948287689723904[0;39m 生成今日电子书快照开始
2022-04-22 22:54:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948287689723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948287689723904[0;39m ==> Parameters: 
2022-04-22 22:54:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948287689723904[0;39m <==    Updates: 0
2022-04-22 22:54:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948287689723904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:54:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948308640272384[0;39m 生成今日电子书快照开始
2022-04-22 22:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948308640272384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948308640272384[0;39m ==> Parameters: 
2022-04-22 22:54:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948308640272384[0;39m <==    Updates: 0
2022-04-22 22:54:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948308640272384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 22:54:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948329603403776[0;39m 生成今日电子书快照开始
2022-04-22 22:54:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948329603403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:54:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948329603403776[0;39m ==> Parameters: 
2022-04-22 22:54:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948329603403776[0;39m <==    Updates: 0
2022-04-22 22:54:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948329603403776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:55:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948350591700992[0;39m 生成今日电子书快照开始
2022-04-22 22:55:00.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948350591700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:00.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948350591700992[0;39m ==> Parameters: 
2022-04-22 22:55:00.269 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948350591700992[0;39m <==    Updates: 0
2022-04-22 22:55:00.269 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948350591700992[0;39m 生成今日电子书快照结束，耗时：263毫秒
2022-04-22 22:55:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948371550638080[0;39m start updating Ebook doc
2022-04-22 22:55:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948371550638080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:55:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948371550638080[0;39m ==> Parameters: 
2022-04-22 22:55:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948371550638080[0;39m <==    Updates: 1
2022-04-22 22:55:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948371550638080[0;39m update ends, take 62 millisecs
2022-04-22 22:55:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948371819073536[0;39m 生成今日电子书快照开始
2022-04-22 22:55:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948371819073536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948371819073536[0;39m ==> Parameters: 
2022-04-22 22:55:05.108 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948371819073536[0;39m <==    Updates: 0
2022-04-22 22:55:05.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948371819073536[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 22:55:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948392517963776[0;39m 生成今日电子书快照开始
2022-04-22 22:55:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948392517963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948392517963776[0;39m ==> Parameters: 
2022-04-22 22:55:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948392517963776[0;39m <==    Updates: 0
2022-04-22 22:55:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948392517963776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:55:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948413518843904[0;39m 生成今日电子书快照开始
2022-04-22 22:55:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948413518843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948413518843904[0;39m ==> Parameters: 
2022-04-22 22:55:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948413518843904[0;39m <==    Updates: 0
2022-04-22 22:55:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948413518843904[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 22:55:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948434490363904[0;39m 生成今日电子书快照开始
2022-04-22 22:55:20.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948434490363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:20.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948434490363904[0;39m ==> Parameters: 
2022-04-22 22:55:20.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948434490363904[0;39m <==    Updates: 0
2022-04-22 22:55:20.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948434490363904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 22:55:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948455424135168[0;39m 生成今日电子书快照开始
2022-04-22 22:55:25.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948455424135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:25.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948455424135168[0;39m ==> Parameters: 
2022-04-22 22:55:25.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948455424135168[0;39m <==    Updates: 0
2022-04-22 22:55:25.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948455424135168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:55:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948476404043776[0;39m 生成今日电子书快照开始
2022-04-22 22:55:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948476404043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948476404043776[0;39m ==> Parameters: 
2022-04-22 22:55:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948476404043776[0;39m <==    Updates: 0
2022-04-22 22:55:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948476404043776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:55:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948497409118208[0;39m start updating Ebook doc
2022-04-22 22:55:35.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948497409118208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:55:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948497409118208[0;39m ==> Parameters: 
2022-04-22 22:55:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948497409118208[0;39m <==    Updates: 1
2022-04-22 22:55:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948497409118208[0;39m update ends, take 62 millisecs
2022-04-22 22:55:35.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948497673359360[0;39m 生成今日电子书快照开始
2022-04-22 22:55:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948497673359360[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948497673359360[0;39m ==> Parameters: 
2022-04-22 22:55:35.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948497673359360[0;39m <==    Updates: 0
2022-04-22 22:55:35.115 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948497673359360[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 22:55:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948518368055296[0;39m 生成今日电子书快照开始
2022-04-22 22:55:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948518368055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:40.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948518368055296[0;39m ==> Parameters: 
2022-04-22 22:55:40.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948518368055296[0;39m <==    Updates: 0
2022-04-22 22:55:40.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948518368055296[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 22:55:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948539347963904[0;39m 生成今日电子书快照开始
2022-04-22 22:55:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948539347963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948539347963904[0;39m ==> Parameters: 
2022-04-22 22:55:45.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948539347963904[0;39m <==    Updates: 0
2022-04-22 22:55:45.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948539347963904[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 22:55:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948560306900992[0;39m 生成今日电子书快照开始
2022-04-22 22:55:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948560306900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948560306900992[0;39m ==> Parameters: 
2022-04-22 22:55:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948560306900992[0;39m <==    Updates: 0
2022-04-22 22:55:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948560306900992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:55:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948581282615296[0;39m 生成今日电子书快照开始
2022-04-22 22:55:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948581282615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:55:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948581282615296[0;39m ==> Parameters: 
2022-04-22 22:55:55.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948581282615296[0;39m <==    Updates: 0
2022-04-22 22:55:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948581282615296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:56:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948602266718208[0;39m 生成今日电子书快照开始
2022-04-22 22:56:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948602266718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948602266718208[0;39m ==> Parameters: 
2022-04-22 22:56:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948602266718208[0;39m <==    Updates: 0
2022-04-22 22:56:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948602266718208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:56:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948623229849600[0;39m 生成今日电子书快照开始
2022-04-22 22:56:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948623229849600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948623229849600[0;39m ==> Parameters: 
2022-04-22 22:56:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948623229849600[0;39m <==    Updates: 0
2022-04-22 22:56:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948623229849600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 22:56:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948623468924928[0;39m start updating Ebook doc
2022-04-22 22:56:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948623468924928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:56:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948623468924928[0;39m ==> Parameters: 
2022-04-22 22:56:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948623468924928[0;39m <==    Updates: 1
2022-04-22 22:56:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948623468924928[0;39m update ends, take 39 millisecs
2022-04-22 22:56:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948644209758208[0;39m 生成今日电子书快照开始
2022-04-22 22:56:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948644209758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948644209758208[0;39m ==> Parameters: 
2022-04-22 22:56:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948644209758208[0;39m <==    Updates: 0
2022-04-22 22:56:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948644209758208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:56:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948665177083904[0;39m 生成今日电子书快照开始
2022-04-22 22:56:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948665177083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948665177083904[0;39m ==> Parameters: 
2022-04-22 22:56:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948665177083904[0;39m <==    Updates: 0
2022-04-22 22:56:15.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948665177083904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:56:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948686152798208[0;39m 生成今日电子书快照开始
2022-04-22 22:56:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948686152798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:20.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948686152798208[0;39m ==> Parameters: 
2022-04-22 22:56:20.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948686152798208[0;39m <==    Updates: 0
2022-04-22 22:56:20.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948686152798208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:56:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948707090763776[0;39m 生成今日电子书快照开始
2022-04-22 22:56:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948707090763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948707090763776[0;39m ==> Parameters: 
2022-04-22 22:56:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948707090763776[0;39m <==    Updates: 0
2022-04-22 22:56:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948707090763776[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 22:56:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948728070672384[0;39m 生成今日电子书快照开始
2022-04-22 22:56:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948728070672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948728070672384[0;39m ==> Parameters: 
2022-04-22 22:56:30.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948728070672384[0;39m <==    Updates: 0
2022-04-22 22:56:30.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948728070672384[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 22:56:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948749050580992[0;39m start updating Ebook doc
2022-04-22 22:56:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948749050580992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:56:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948749050580992[0;39m ==> Parameters: 
2022-04-22 22:56:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948749050580992[0;39m <==    Updates: 1
2022-04-22 22:56:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948749050580992[0;39m update ends, take 56 millisecs
2022-04-22 22:56:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948749293850624[0;39m 生成今日电子书快照开始
2022-04-22 22:56:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948749293850624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948749293850624[0;39m ==> Parameters: 
2022-04-22 22:56:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948749293850624[0;39m <==    Updates: 0
2022-04-22 22:56:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948749293850624[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 22:56:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948770009518080[0;39m 生成今日电子书快照开始
2022-04-22 22:56:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948770009518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948770009518080[0;39m ==> Parameters: 
2022-04-22 22:56:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948770009518080[0;39m <==    Updates: 0
2022-04-22 22:56:40.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948770009518080[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 22:56:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948791006203904[0;39m 生成今日电子书快照开始
2022-04-22 22:56:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948791006203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948791006203904[0;39m ==> Parameters: 
2022-04-22 22:56:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948791006203904[0;39m <==    Updates: 0
2022-04-22 22:56:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948791006203904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:56:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948811948363776[0;39m 生成今日电子书快照开始
2022-04-22 22:56:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948811948363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948811948363776[0;39m ==> Parameters: 
2022-04-22 22:56:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948811948363776[0;39m <==    Updates: 0
2022-04-22 22:56:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948811948363776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:56:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948832940855296[0;39m 生成今日电子书快照开始
2022-04-22 22:56:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948832940855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:56:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948832940855296[0;39m ==> Parameters: 
2022-04-22 22:56:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948832940855296[0;39m <==    Updates: 0
2022-04-22 22:56:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948832940855296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:57:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948853891403776[0;39m 生成今日电子书快照开始
2022-04-22 22:57:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948853891403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948853891403776[0;39m ==> Parameters: 
2022-04-22 22:57:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948853891403776[0;39m <==    Updates: 0
2022-04-22 22:57:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948853891403776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:57:05.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172948874854535168[0;39m start updating Ebook doc
2022-04-22 22:57:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948874854535168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:57:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948874854535168[0;39m ==> Parameters: 
2022-04-22 22:57:05.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172948874854535168[0;39m <==    Updates: 1
2022-04-22 22:57:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172948874854535168[0;39m update ends, take 60 millisecs
2022-04-22 22:57:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948875114582016[0;39m 生成今日电子书快照开始
2022-04-22 22:57:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948875114582016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948875114582016[0;39m ==> Parameters: 
2022-04-22 22:57:05.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948875114582016[0;39m <==    Updates: 0
2022-04-22 22:57:05.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948875114582016[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-22 22:57:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948895842832384[0;39m 生成今日电子书快照开始
2022-04-22 22:57:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948895842832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948895842832384[0;39m ==> Parameters: 
2022-04-22 22:57:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948895842832384[0;39m <==    Updates: 0
2022-04-22 22:57:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948895842832384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:57:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948916797575168[0;39m 生成今日电子书快照开始
2022-04-22 22:57:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948916797575168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948916797575168[0;39m ==> Parameters: 
2022-04-22 22:57:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948916797575168[0;39m <==    Updates: 0
2022-04-22 22:57:15.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948916797575168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:57:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948937798455296[0;39m 生成今日电子书快照开始
2022-04-22 22:57:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948937798455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948937798455296[0;39m ==> Parameters: 
2022-04-22 22:57:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948937798455296[0;39m <==    Updates: 0
2022-04-22 22:57:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948937798455296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:57:25.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948958757392384[0;39m 生成今日电子书快照开始
2022-04-22 22:57:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948958757392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948958757392384[0;39m ==> Parameters: 
2022-04-22 22:57:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948958757392384[0;39m <==    Updates: 0
2022-04-22 22:57:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948958757392384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 22:57:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172948979720523776[0;39m 生成今日电子书快照开始
2022-04-22 22:57:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948979720523776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948979720523776[0;39m ==> Parameters: 
2022-04-22 22:57:30.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172948979720523776[0;39m <==    Updates: 0
2022-04-22 22:57:30.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172948979720523776[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 22:57:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949000692043776[0;39m start updating Ebook doc
2022-04-22 22:57:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949000692043776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:57:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949000692043776[0;39m ==> Parameters: 
2022-04-22 22:57:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949000692043776[0;39m <==    Updates: 1
2022-04-22 22:57:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949000692043776[0;39m update ends, take 60 millisecs
2022-04-22 22:57:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949000947896320[0;39m 生成今日电子书快照开始
2022-04-22 22:57:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949000947896320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949000947896320[0;39m ==> Parameters: 
2022-04-22 22:57:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949000947896320[0;39m <==    Updates: 0
2022-04-22 22:57:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949000947896320[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 22:57:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949021692923904[0;39m 生成今日电子书快照开始
2022-04-22 22:57:40.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949021692923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:40.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949021692923904[0;39m ==> Parameters: 
2022-04-22 22:57:40.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949021692923904[0;39m <==    Updates: 0
2022-04-22 22:57:40.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949021692923904[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 22:57:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949042656055296[0;39m 生成今日电子书快照开始
2022-04-22 22:57:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949042656055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949042656055296[0;39m ==> Parameters: 
2022-04-22 22:57:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949042656055296[0;39m <==    Updates: 0
2022-04-22 22:57:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949042656055296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:57:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949063640158208[0;39m 生成今日电子书快照开始
2022-04-22 22:57:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949063640158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949063640158208[0;39m ==> Parameters: 
2022-04-22 22:57:50.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949063640158208[0;39m <==    Updates: 0
2022-04-22 22:57:50.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949063640158208[0;39m 生成今日电子书快照结束，耗时：86毫秒
2022-04-22 22:57:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949084578123776[0;39m 生成今日电子书快照开始
2022-04-22 22:57:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949084578123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:57:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949084578123776[0;39m ==> Parameters: 
2022-04-22 22:57:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949084578123776[0;39m <==    Updates: 0
2022-04-22 22:57:55.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949084578123776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:58:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949105562226688[0;39m 生成今日电子书快照开始
2022-04-22 22:58:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949105562226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949105562226688[0;39m ==> Parameters: 
2022-04-22 22:58:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949105562226688[0;39m <==    Updates: 0
2022-04-22 22:58:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949105562226688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 22:58:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949126516969472[0;39m 生成今日电子书快照开始
2022-04-22 22:58:05.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949126516969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949126516969472[0;39m ==> Parameters: 
2022-04-22 22:58:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949126516969472[0;39m <==    Updates: 0
2022-04-22 22:58:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949126516969472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:58:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949126785404928[0;39m start updating Ebook doc
2022-04-22 22:58:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949126785404928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:58:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949126785404928[0;39m ==> Parameters: 
2022-04-22 22:58:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949126785404928[0;39m <==    Updates: 1
2022-04-22 22:58:05.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949126785404928[0;39m update ends, take 40 millisecs
2022-04-22 22:58:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949147513655296[0;39m 生成今日电子书快照开始
2022-04-22 22:58:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949147513655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949147513655296[0;39m ==> Parameters: 
2022-04-22 22:58:10.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949147513655296[0;39m <==    Updates: 0
2022-04-22 22:58:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949147513655296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 22:58:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949168493563904[0;39m 生成今日电子书快照开始
2022-04-22 22:58:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949168493563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949168493563904[0;39m ==> Parameters: 
2022-04-22 22:58:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949168493563904[0;39m <==    Updates: 0
2022-04-22 22:58:15.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949168493563904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 22:58:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949189465083904[0;39m 生成今日电子书快照开始
2022-04-22 22:58:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949189465083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949189465083904[0;39m ==> Parameters: 
2022-04-22 22:58:20.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949189465083904[0;39m <==    Updates: 0
2022-04-22 22:58:20.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949189465083904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 22:58:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949210419826688[0;39m 生成今日电子书快照开始
2022-04-22 22:58:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949210419826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949210419826688[0;39m ==> Parameters: 
2022-04-22 22:58:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949210419826688[0;39m <==    Updates: 0
2022-04-22 22:58:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949210419826688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:58:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949231382958080[0;39m 生成今日电子书快照开始
2022-04-22 22:58:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949231382958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949231382958080[0;39m ==> Parameters: 
2022-04-22 22:58:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949231382958080[0;39m <==    Updates: 0
2022-04-22 22:58:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949231382958080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 22:58:35.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949252375449600[0;39m start updating Ebook doc
2022-04-22 22:58:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949252375449600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:58:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949252375449600[0;39m ==> Parameters: 
2022-04-22 22:58:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949252375449600[0;39m <==    Updates: 1
2022-04-22 22:58:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949252375449600[0;39m update ends, take 53 millisecs
2022-04-22 22:58:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949252606136320[0;39m 生成今日电子书快照开始
2022-04-22 22:58:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949252606136320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949252606136320[0;39m ==> Parameters: 
2022-04-22 22:58:35.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949252606136320[0;39m <==    Updates: 0
2022-04-22 22:58:35.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949252606136320[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 22:58:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949273334386688[0;39m 生成今日电子书快照开始
2022-04-22 22:58:40.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949273334386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:40.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949273334386688[0;39m ==> Parameters: 
2022-04-22 22:58:40.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949273334386688[0;39m <==    Updates: 0
2022-04-22 22:58:40.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949273334386688[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 22:58:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949294310100992[0;39m 生成今日电子书快照开始
2022-04-22 22:58:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949294310100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949294310100992[0;39m ==> Parameters: 
2022-04-22 22:58:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949294310100992[0;39m <==    Updates: 0
2022-04-22 22:58:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949294310100992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:58:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949315277426688[0;39m 生成今日电子书快照开始
2022-04-22 22:58:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949315277426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949315277426688[0;39m ==> Parameters: 
2022-04-22 22:58:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949315277426688[0;39m <==    Updates: 0
2022-04-22 22:58:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949315277426688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:58:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949336253140992[0;39m 生成今日电子书快照开始
2022-04-22 22:58:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949336253140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:58:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949336253140992[0;39m ==> Parameters: 
2022-04-22 22:58:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949336253140992[0;39m <==    Updates: 0
2022-04-22 22:58:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949336253140992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:59:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949357224660992[0;39m 生成今日电子书快照开始
2022-04-22 22:59:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949357224660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949357224660992[0;39m ==> Parameters: 
2022-04-22 22:59:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949357224660992[0;39m <==    Updates: 0
2022-04-22 22:59:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949357224660992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:59:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949378179403776[0;39m start updating Ebook doc
2022-04-22 22:59:05.019 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949378179403776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:59:05.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949378179403776[0;39m ==> Parameters: 
2022-04-22 22:59:05.060 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949378179403776[0;39m <==    Updates: 1
2022-04-22 22:59:05.061 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949378179403776[0;39m update ends, take 58 millisecs
2022-04-22 22:59:05.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949378426867712[0;39m 生成今日电子书快照开始
2022-04-22 22:59:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949378426867712[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949378426867712[0;39m ==> Parameters: 
2022-04-22 22:59:05.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949378426867712[0;39m <==    Updates: 0
2022-04-22 22:59:05.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949378426867712[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 22:59:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949399167700992[0;39m 生成今日电子书快照开始
2022-04-22 22:59:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949399167700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949399167700992[0;39m ==> Parameters: 
2022-04-22 22:59:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949399167700992[0;39m <==    Updates: 0
2022-04-22 22:59:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949399167700992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:59:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949420139220992[0;39m 生成今日电子书快照开始
2022-04-22 22:59:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949420139220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949420139220992[0;39m ==> Parameters: 
2022-04-22 22:59:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949420139220992[0;39m <==    Updates: 0
2022-04-22 22:59:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949420139220992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 22:59:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949441089769472[0;39m 生成今日电子书快照开始
2022-04-22 22:59:20.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949441089769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949441089769472[0;39m ==> Parameters: 
2022-04-22 22:59:20.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949441089769472[0;39m <==    Updates: 0
2022-04-22 22:59:20.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949441089769472[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:59:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949462061289472[0;39m 生成今日电子书快照开始
2022-04-22 22:59:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949462061289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949462061289472[0;39m ==> Parameters: 
2022-04-22 22:59:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949462061289472[0;39m <==    Updates: 0
2022-04-22 22:59:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949462061289472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 22:59:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949483062169600[0;39m 生成今日电子书快照开始
2022-04-22 22:59:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949483062169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949483062169600[0;39m ==> Parameters: 
2022-04-22 22:59:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949483062169600[0;39m <==    Updates: 0
2022-04-22 22:59:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949483062169600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 22:59:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949504042078208[0;39m 生成今日电子书快照开始
2022-04-22 22:59:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949504042078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949504042078208[0;39m ==> Parameters: 
2022-04-22 22:59:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949504042078208[0;39m <==    Updates: 0
2022-04-22 22:59:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949504042078208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 22:59:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949504293736448[0;39m start updating Ebook doc
2022-04-22 22:59:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949504293736448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 22:59:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949504293736448[0;39m ==> Parameters: 
2022-04-22 22:59:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949504293736448[0;39m <==    Updates: 1
2022-04-22 22:59:35.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949504293736448[0;39m update ends, take 39 millisecs
2022-04-22 22:59:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949524996820992[0;39m 生成今日电子书快照开始
2022-04-22 22:59:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949524996820992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:40.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949524996820992[0;39m ==> Parameters: 
2022-04-22 22:59:40.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949524996820992[0;39m <==    Updates: 0
2022-04-22 22:59:40.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949524996820992[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 22:59:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949545980923904[0;39m 生成今日电子书快照开始
2022-04-22 22:59:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949545980923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949545980923904[0;39m ==> Parameters: 
2022-04-22 22:59:45.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949545980923904[0;39m <==    Updates: 0
2022-04-22 22:59:45.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949545980923904[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 22:59:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949566935666688[0;39m 生成今日电子书快照开始
2022-04-22 22:59:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949566935666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949566935666688[0;39m ==> Parameters: 
2022-04-22 22:59:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949566935666688[0;39m <==    Updates: 0
2022-04-22 22:59:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949566935666688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 22:59:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949587902992384[0;39m 生成今日电子书快照开始
2022-04-22 22:59:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949587902992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 22:59:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949587902992384[0;39m ==> Parameters: 
2022-04-22 22:59:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949587902992384[0;39m <==    Updates: 0
2022-04-22 22:59:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949587902992384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:00:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949608887095296[0;39m 生成今日电子书快照开始
2022-04-22 23:00:00.132 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949608887095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:00.132 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949608887095296[0;39m ==> Parameters: 
2022-04-22 23:00:00.211 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949608887095296[0;39m <==    Updates: 0
2022-04-22 23:00:00.211 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949608887095296[0;39m 生成今日电子书快照结束，耗时：204毫秒
2022-04-22 23:00:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949629862809600[0;39m 生成今日电子书快照开始
2022-04-22 23:00:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949629862809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:05.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949629862809600[0;39m ==> Parameters: 
2022-04-22 23:00:05.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949629862809600[0;39m <==    Updates: 0
2022-04-22 23:00:05.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949629862809600[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:00:05.079 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949630160605184[0;39m start updating Ebook doc
2022-04-22 23:00:05.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949630160605184[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:00:05.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949630160605184[0;39m ==> Parameters: 
2022-04-22 23:00:05.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949630160605184[0;39m <==    Updates: 1
2022-04-22 23:00:05.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949630160605184[0;39m update ends, take 37 millisecs
2022-04-22 23:00:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949650830135296[0;39m 生成今日电子书快照开始
2022-04-22 23:00:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949650830135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949650830135296[0;39m ==> Parameters: 
2022-04-22 23:00:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949650830135296[0;39m <==    Updates: 0
2022-04-22 23:00:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949650830135296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:00:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949671810043904[0;39m 生成今日电子书快照开始
2022-04-22 23:00:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949671810043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949671810043904[0;39m ==> Parameters: 
2022-04-22 23:00:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949671810043904[0;39m <==    Updates: 0
2022-04-22 23:00:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949671810043904[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:00:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949692760592384[0;39m 生成今日电子书快照开始
2022-04-22 23:00:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949692760592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949692760592384[0;39m ==> Parameters: 
2022-04-22 23:00:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949692760592384[0;39m <==    Updates: 0
2022-04-22 23:00:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949692760592384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:00:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949713723723776[0;39m 生成今日电子书快照开始
2022-04-22 23:00:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949713723723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949713723723776[0;39m ==> Parameters: 
2022-04-22 23:00:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949713723723776[0;39m <==    Updates: 0
2022-04-22 23:00:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949713723723776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:00:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949734716215296[0;39m 生成今日电子书快照开始
2022-04-22 23:00:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949734716215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949734716215296[0;39m ==> Parameters: 
2022-04-22 23:00:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949734716215296[0;39m <==    Updates: 0
2022-04-22 23:00:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949734716215296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:00:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949755683540992[0;39m start updating Ebook doc
2022-04-22 23:00:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949755683540992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:00:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949755683540992[0;39m ==> Parameters: 
2022-04-22 23:00:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949755683540992[0;39m <==    Updates: 1
2022-04-22 23:00:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949755683540992[0;39m update ends, take 60 millisecs
2022-04-22 23:00:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949755935199232[0;39m 生成今日电子书快照开始
2022-04-22 23:00:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949755935199232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949755935199232[0;39m ==> Parameters: 
2022-04-22 23:00:35.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949755935199232[0;39m <==    Updates: 0
2022-04-22 23:00:35.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949755935199232[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 23:00:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949776659255296[0;39m 生成今日电子书快照开始
2022-04-22 23:00:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949776659255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949776659255296[0;39m ==> Parameters: 
2022-04-22 23:00:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949776659255296[0;39m <==    Updates: 0
2022-04-22 23:00:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949776659255296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:00:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949797639163904[0;39m 生成今日电子书快照开始
2022-04-22 23:00:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949797639163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949797639163904[0;39m ==> Parameters: 
2022-04-22 23:00:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949797639163904[0;39m <==    Updates: 0
2022-04-22 23:00:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949797639163904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:00:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949818572935168[0;39m 生成今日电子书快照开始
2022-04-22 23:00:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949818572935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949818572935168[0;39m ==> Parameters: 
2022-04-22 23:00:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949818572935168[0;39m <==    Updates: 0
2022-04-22 23:00:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949818572935168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:00:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949839573815296[0;39m 生成今日电子书快照开始
2022-04-22 23:00:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949839573815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:00:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949839573815296[0;39m ==> Parameters: 
2022-04-22 23:00:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949839573815296[0;39m <==    Updates: 0
2022-04-22 23:00:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949839573815296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:01:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949860549529600[0;39m 生成今日电子书快照开始
2022-04-22 23:01:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949860549529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949860549529600[0;39m ==> Parameters: 
2022-04-22 23:01:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949860549529600[0;39m <==    Updates: 0
2022-04-22 23:01:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949860549529600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:01:05.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172949881521049600[0;39m start updating Ebook doc
2022-04-22 23:01:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949881521049600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:01:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949881521049600[0;39m ==> Parameters: 
2022-04-22 23:01:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172949881521049600[0;39m <==    Updates: 1
2022-04-22 23:01:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172949881521049600[0;39m update ends, take 63 millisecs
2022-04-22 23:01:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949881789485056[0;39m 生成今日电子书快照开始
2022-04-22 23:01:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949881789485056[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949881789485056[0;39m ==> Parameters: 
2022-04-22 23:01:05.121 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949881789485056[0;39m <==    Updates: 0
2022-04-22 23:01:05.121 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949881789485056[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-22 23:01:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949902484180992[0;39m 生成今日电子书快照开始
2022-04-22 23:01:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949902484180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949902484180992[0;39m ==> Parameters: 
2022-04-22 23:01:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949902484180992[0;39m <==    Updates: 0
2022-04-22 23:01:10.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949902484180992[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:01:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949923468283904[0;39m 生成今日电子书快照开始
2022-04-22 23:01:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949923468283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949923468283904[0;39m ==> Parameters: 
2022-04-22 23:01:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949923468283904[0;39m <==    Updates: 0
2022-04-22 23:01:15.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949923468283904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:01:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949944414638080[0;39m 生成今日电子书快照开始
2022-04-22 23:01:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949944414638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949944414638080[0;39m ==> Parameters: 
2022-04-22 23:01:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949944414638080[0;39m <==    Updates: 0
2022-04-22 23:01:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949944414638080[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:01:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949965381963776[0;39m 生成今日电子书快照开始
2022-04-22 23:01:25.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949965381963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949965381963776[0;39m ==> Parameters: 
2022-04-22 23:01:25.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949965381963776[0;39m <==    Updates: 0
2022-04-22 23:01:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949965381963776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:01:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172949986349289472[0;39m 生成今日电子书快照开始
2022-04-22 23:01:30.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949986349289472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949986349289472[0;39m ==> Parameters: 
2022-04-22 23:01:30.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172949986349289472[0;39m <==    Updates: 0
2022-04-22 23:01:30.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172949986349289472[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:01:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950007358558208[0;39m start updating Ebook doc
2022-04-22 23:01:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950007358558208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:01:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950007358558208[0;39m ==> Parameters: 
2022-04-22 23:01:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950007358558208[0;39m <==    Updates: 1
2022-04-22 23:01:35.074 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950007358558208[0;39m update ends, take 64 millisecs
2022-04-22 23:01:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950007626993664[0;39m 生成今日电子书快照开始
2022-04-22 23:01:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950007626993664[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950007626993664[0;39m ==> Parameters: 
2022-04-22 23:01:35.119 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950007626993664[0;39m <==    Updates: 0
2022-04-22 23:01:35.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950007626993664[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 23:01:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950028321689600[0;39m 生成今日电子书快照开始
2022-04-22 23:01:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950028321689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950028321689600[0;39m ==> Parameters: 
2022-04-22 23:01:40.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950028321689600[0;39m <==    Updates: 0
2022-04-22 23:01:40.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950028321689600[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:01:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950049297403904[0;39m 生成今日电子书快照开始
2022-04-22 23:01:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950049297403904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950049297403904[0;39m ==> Parameters: 
2022-04-22 23:01:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950049297403904[0;39m <==    Updates: 0
2022-04-22 23:01:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950049297403904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:01:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950070264729600[0;39m 生成今日电子书快照开始
2022-04-22 23:01:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950070264729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950070264729600[0;39m ==> Parameters: 
2022-04-22 23:01:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950070264729600[0;39m <==    Updates: 0
2022-04-22 23:01:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950070264729600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:01:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950091236249600[0;39m 生成今日电子书快照开始
2022-04-22 23:01:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950091236249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:01:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950091236249600[0;39m ==> Parameters: 
2022-04-22 23:01:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950091236249600[0;39m <==    Updates: 0
2022-04-22 23:01:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950091236249600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:02:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950112182603776[0;39m 生成今日电子书快照开始
2022-04-22 23:02:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950112182603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950112182603776[0;39m ==> Parameters: 
2022-04-22 23:02:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950112182603776[0;39m <==    Updates: 0
2022-04-22 23:02:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950112182603776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:02:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950133154123776[0;39m 生成今日电子书快照开始
2022-04-22 23:02:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950133154123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950133154123776[0;39m ==> Parameters: 
2022-04-22 23:02:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950133154123776[0;39m <==    Updates: 0
2022-04-22 23:02:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950133154123776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:02:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950133414170624[0;39m start updating Ebook doc
2022-04-22 23:02:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950133414170624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:02:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950133414170624[0;39m ==> Parameters: 
2022-04-22 23:02:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950133414170624[0;39m <==    Updates: 1
2022-04-22 23:02:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950133414170624[0;39m update ends, take 38 millisecs
2022-04-22 23:02:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950154150809600[0;39m 生成今日电子书快照开始
2022-04-22 23:02:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950154150809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950154150809600[0;39m ==> Parameters: 
2022-04-22 23:02:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950154150809600[0;39m <==    Updates: 0
2022-04-22 23:02:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950154150809600[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:02:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950175097163776[0;39m 生成今日电子书快照开始
2022-04-22 23:02:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950175097163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950175097163776[0;39m ==> Parameters: 
2022-04-22 23:02:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950175097163776[0;39m <==    Updates: 0
2022-04-22 23:02:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950175097163776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:02:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950196098043904[0;39m 生成今日电子书快照开始
2022-04-22 23:02:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950196098043904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:20.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950196098043904[0;39m ==> Parameters: 
2022-04-22 23:02:20.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950196098043904[0;39m <==    Updates: 0
2022-04-22 23:02:20.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950196098043904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:02:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950217069563904[0;39m 生成今日电子书快照开始
2022-04-22 23:02:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950217069563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950217069563904[0;39m ==> Parameters: 
2022-04-22 23:02:25.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950217069563904[0;39m <==    Updates: 0
2022-04-22 23:02:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950217069563904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:02:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950238041083904[0;39m 生成今日电子书快照开始
2022-04-22 23:02:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950238041083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950238041083904[0;39m ==> Parameters: 
2022-04-22 23:02:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950238041083904[0;39m <==    Updates: 0
2022-04-22 23:02:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950238041083904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:02:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950259004215296[0;39m start updating Ebook doc
2022-04-22 23:02:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950259004215296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:02:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950259004215296[0;39m ==> Parameters: 
2022-04-22 23:02:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950259004215296[0;39m <==    Updates: 1
2022-04-22 23:02:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950259004215296[0;39m update ends, take 57 millisecs
2022-04-22 23:02:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950259247484928[0;39m 生成今日电子书快照开始
2022-04-22 23:02:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950259247484928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950259247484928[0;39m ==> Parameters: 
2022-04-22 23:02:35.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950259247484928[0;39m <==    Updates: 0
2022-04-22 23:02:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950259247484928[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 23:02:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950279984123904[0;39m 生成今日电子书快照开始
2022-04-22 23:02:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950279984123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950279984123904[0;39m ==> Parameters: 
2022-04-22 23:02:40.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950279984123904[0;39m <==    Updates: 0
2022-04-22 23:02:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950279984123904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:02:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950300926283776[0;39m 生成今日电子书快照开始
2022-04-22 23:02:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950300926283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950300926283776[0;39m ==> Parameters: 
2022-04-22 23:02:45.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950300926283776[0;39m <==    Updates: 0
2022-04-22 23:02:45.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950300926283776[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:02:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950321922969600[0;39m 生成今日电子书快照开始
2022-04-22 23:02:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950321922969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950321922969600[0;39m ==> Parameters: 
2022-04-22 23:02:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950321922969600[0;39m <==    Updates: 0
2022-04-22 23:02:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950321922969600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:02:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950342860935168[0;39m 生成今日电子书快照开始
2022-04-22 23:02:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950342860935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:02:55.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950342860935168[0;39m ==> Parameters: 
2022-04-22 23:02:55.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950342860935168[0;39m <==    Updates: 0
2022-04-22 23:02:55.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950342860935168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:03:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950363874398208[0;39m 生成今日电子书快照开始
2022-04-22 23:03:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950363874398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950363874398208[0;39m ==> Parameters: 
2022-04-22 23:03:00.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950363874398208[0;39m <==    Updates: 0
2022-04-22 23:03:00.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950363874398208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:03:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950384820752384[0;39m 生成今日电子书快照开始
2022-04-22 23:03:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950384820752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950384820752384[0;39m ==> Parameters: 
2022-04-22 23:03:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950384820752384[0;39m <==    Updates: 0
2022-04-22 23:03:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950384820752384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:03:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950385122742272[0;39m start updating Ebook doc
2022-04-22 23:03:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950385122742272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:03:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950385122742272[0;39m ==> Parameters: 
2022-04-22 23:03:05.115 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950385122742272[0;39m <==    Updates: 1
2022-04-22 23:03:05.115 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950385122742272[0;39m update ends, take 39 millisecs
2022-04-22 23:03:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950405800660992[0;39m 生成今日电子书快照开始
2022-04-22 23:03:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950405800660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950405800660992[0;39m ==> Parameters: 
2022-04-22 23:03:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950405800660992[0;39m <==    Updates: 0
2022-04-22 23:03:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950405800660992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:03:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950426780569600[0;39m 生成今日电子书快照开始
2022-04-22 23:03:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950426780569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950426780569600[0;39m ==> Parameters: 
2022-04-22 23:03:15.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950426780569600[0;39m <==    Updates: 0
2022-04-22 23:03:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950426780569600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:03:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950447756283904[0;39m 生成今日电子书快照开始
2022-04-22 23:03:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950447756283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950447756283904[0;39m ==> Parameters: 
2022-04-22 23:03:20.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950447756283904[0;39m <==    Updates: 0
2022-04-22 23:03:20.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950447756283904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:03:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950468715220992[0;39m 生成今日电子书快照开始
2022-04-22 23:03:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950468715220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950468715220992[0;39m ==> Parameters: 
2022-04-22 23:03:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950468715220992[0;39m <==    Updates: 0
2022-04-22 23:03:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950468715220992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:03:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950489678352384[0;39m 生成今日电子书快照开始
2022-04-22 23:03:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950489678352384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950489678352384[0;39m ==> Parameters: 
2022-04-22 23:03:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950489678352384[0;39m <==    Updates: 0
2022-04-22 23:03:30.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950489678352384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:03:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950510662455296[0;39m start updating Ebook doc
2022-04-22 23:03:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950510662455296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:03:35.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950510662455296[0;39m ==> Parameters: 
2022-04-22 23:03:35.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950510662455296[0;39m <==    Updates: 1
2022-04-22 23:03:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950510662455296[0;39m update ends, take 52 millisecs
2022-04-22 23:03:35.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950510880559104[0;39m 生成今日电子书快照开始
2022-04-22 23:03:35.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950510880559104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950510880559104[0;39m ==> Parameters: 
2022-04-22 23:03:35.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950510880559104[0;39m <==    Updates: 0
2022-04-22 23:03:35.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950510880559104[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:03:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950531633975296[0;39m 生成今日电子书快照开始
2022-04-22 23:03:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950531633975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950531633975296[0;39m ==> Parameters: 
2022-04-22 23:03:40.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950531633975296[0;39m <==    Updates: 0
2022-04-22 23:03:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950531633975296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:03:45.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950552618078208[0;39m 生成今日电子书快照开始
2022-04-22 23:03:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950552618078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950552618078208[0;39m ==> Parameters: 
2022-04-22 23:03:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950552618078208[0;39m <==    Updates: 0
2022-04-22 23:03:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950552618078208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:03:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950573581209600[0;39m 生成今日电子书快照开始
2022-04-22 23:03:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950573581209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950573581209600[0;39m ==> Parameters: 
2022-04-22 23:03:50.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950573581209600[0;39m <==    Updates: 0
2022-04-22 23:03:50.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950573581209600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:03:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950594561118208[0;39m 生成今日电子书快照开始
2022-04-22 23:03:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950594561118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:03:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950594561118208[0;39m ==> Parameters: 
2022-04-22 23:03:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950594561118208[0;39m <==    Updates: 0
2022-04-22 23:03:55.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950594561118208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:04:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950615490695168[0;39m 生成今日电子书快照开始
2022-04-22 23:04:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950615490695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950615490695168[0;39m ==> Parameters: 
2022-04-22 23:04:00.192 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950615490695168[0;39m <==    Updates: 0
2022-04-22 23:04:00.193 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950615490695168[0;39m 生成今日电子书快照结束，耗时：193毫秒
2022-04-22 23:04:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950636504158208[0;39m 生成今日电子书快照开始
2022-04-22 23:04:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950636504158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:05.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950636504158208[0;39m ==> Parameters: 
2022-04-22 23:04:05.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950636504158208[0;39m <==    Updates: 0
2022-04-22 23:04:05.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950636504158208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:04:05.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950636764205056[0;39m start updating Ebook doc
2022-04-22 23:04:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950636764205056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:04:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950636764205056[0;39m ==> Parameters: 
2022-04-22 23:04:05.115 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950636764205056[0;39m <==    Updates: 1
2022-04-22 23:04:05.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950636764205056[0;39m update ends, take 43 millisecs
2022-04-22 23:04:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950657475678208[0;39m 生成今日电子书快照开始
2022-04-22 23:04:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950657475678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950657475678208[0;39m ==> Parameters: 
2022-04-22 23:04:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950657475678208[0;39m <==    Updates: 0
2022-04-22 23:04:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950657475678208[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:04:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950678438809600[0;39m 生成今日电子书快照开始
2022-04-22 23:04:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950678438809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950678438809600[0;39m ==> Parameters: 
2022-04-22 23:04:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950678438809600[0;39m <==    Updates: 0
2022-04-22 23:04:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950678438809600[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:04:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950699414523904[0;39m 生成今日电子书快照开始
2022-04-22 23:04:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950699414523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950699414523904[0;39m ==> Parameters: 
2022-04-22 23:04:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950699414523904[0;39m <==    Updates: 0
2022-04-22 23:04:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950699414523904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:04:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950720390238208[0;39m 生成今日电子书快照开始
2022-04-22 23:04:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950720390238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950720390238208[0;39m ==> Parameters: 
2022-04-22 23:04:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950720390238208[0;39m <==    Updates: 0
2022-04-22 23:04:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950720390238208[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:04:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950741344980992[0;39m 生成今日电子书快照开始
2022-04-22 23:04:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950741344980992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950741344980992[0;39m ==> Parameters: 
2022-04-22 23:04:30.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950741344980992[0;39m <==    Updates: 0
2022-04-22 23:04:30.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950741344980992[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:04:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950762329083904[0;39m start updating Ebook doc
2022-04-22 23:04:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950762329083904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:04:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950762329083904[0;39m ==> Parameters: 
2022-04-22 23:04:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950762329083904[0;39m <==    Updates: 1
2022-04-22 23:04:35.063 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950762329083904[0;39m update ends, take 54 millisecs
2022-04-22 23:04:35.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950762559770624[0;39m 生成今日电子书快照开始
2022-04-22 23:04:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950762559770624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950762559770624[0;39m ==> Parameters: 
2022-04-22 23:04:35.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950762559770624[0;39m <==    Updates: 0
2022-04-22 23:04:35.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950762559770624[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:04:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950783296409600[0;39m 生成今日电子书快照开始
2022-04-22 23:04:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950783296409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950783296409600[0;39m ==> Parameters: 
2022-04-22 23:04:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950783296409600[0;39m <==    Updates: 0
2022-04-22 23:04:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950783296409600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:04:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950804276318208[0;39m 生成今日电子书快照开始
2022-04-22 23:04:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950804276318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950804276318208[0;39m ==> Parameters: 
2022-04-22 23:04:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950804276318208[0;39m <==    Updates: 0
2022-04-22 23:04:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950804276318208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:04:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950825214283776[0;39m 生成今日电子书快照开始
2022-04-22 23:04:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950825214283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950825214283776[0;39m ==> Parameters: 
2022-04-22 23:04:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950825214283776[0;39m <==    Updates: 0
2022-04-22 23:04:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950825214283776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:04:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950846202580992[0;39m 生成今日电子书快照开始
2022-04-22 23:04:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950846202580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:04:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950846202580992[0;39m ==> Parameters: 
2022-04-22 23:04:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950846202580992[0;39m <==    Updates: 0
2022-04-22 23:04:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950846202580992[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:05:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950867165712384[0;39m 生成今日电子书快照开始
2022-04-22 23:05:00.177 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950867165712384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:00.177 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950867165712384[0;39m ==> Parameters: 
2022-04-22 23:05:00.255 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950867165712384[0;39m <==    Updates: 0
2022-04-22 23:05:00.256 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950867165712384[0;39m 生成今日电子书快照结束，耗时：251毫秒
2022-04-22 23:05:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172950888145620992[0;39m start updating Ebook doc
2022-04-22 23:05:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950888145620992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:05:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950888145620992[0;39m ==> Parameters: 
2022-04-22 23:05:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172950888145620992[0;39m <==    Updates: 1
2022-04-22 23:05:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172950888145620992[0;39m update ends, take 61 millisecs
2022-04-22 23:05:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950888405667840[0;39m 生成今日电子书快照开始
2022-04-22 23:05:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950888405667840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950888405667840[0;39m ==> Parameters: 
2022-04-22 23:05:05.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950888405667840[0;39m <==    Updates: 0
2022-04-22 23:05:05.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950888405667840[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:05:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950909133918208[0;39m 生成今日电子书快照开始
2022-04-22 23:05:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950909133918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950909133918208[0;39m ==> Parameters: 
2022-04-22 23:05:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950909133918208[0;39m <==    Updates: 0
2022-04-22 23:05:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950909133918208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:05:15.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950930063495168[0;39m 生成今日电子书快照开始
2022-04-22 23:05:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950930063495168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950930063495168[0;39m ==> Parameters: 
2022-04-22 23:05:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950930063495168[0;39m <==    Updates: 0
2022-04-22 23:05:15.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950930063495168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:05:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950951064375296[0;39m 生成今日电子书快照开始
2022-04-22 23:05:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950951064375296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950951064375296[0;39m ==> Parameters: 
2022-04-22 23:05:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950951064375296[0;39m <==    Updates: 0
2022-04-22 23:05:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950951064375296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:05:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950972048478208[0;39m 生成今日电子书快照开始
2022-04-22 23:05:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950972048478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950972048478208[0;39m ==> Parameters: 
2022-04-22 23:05:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950972048478208[0;39m <==    Updates: 0
2022-04-22 23:05:25.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950972048478208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:05:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172950992986443776[0;39m 生成今日电子书快照开始
2022-04-22 23:05:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950992986443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950992986443776[0;39m ==> Parameters: 
2022-04-22 23:05:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172950992986443776[0;39m <==    Updates: 0
2022-04-22 23:05:30.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172950992986443776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:05:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951013953769472[0;39m start updating Ebook doc
2022-04-22 23:05:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951013953769472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:05:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951013953769472[0;39m ==> Parameters: 
2022-04-22 23:05:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951013953769472[0;39m <==    Updates: 1
2022-04-22 23:05:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951013953769472[0;39m update ends, take 65 millisecs
2022-04-22 23:05:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951014226399232[0;39m 生成今日电子书快照开始
2022-04-22 23:05:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951014226399232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951014226399232[0;39m ==> Parameters: 
2022-04-22 23:05:35.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951014226399232[0;39m <==    Updates: 0
2022-04-22 23:05:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951014226399232[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:05:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951034963038208[0;39m 生成今日电子书快照开始
2022-04-22 23:05:40.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951034963038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:40.047 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951034963038208[0;39m ==> Parameters: 
2022-04-22 23:05:40.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951034963038208[0;39m <==    Updates: 0
2022-04-22 23:05:40.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951034963038208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:05:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951055913586688[0;39m 生成今日电子书快照开始
2022-04-22 23:05:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951055913586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951055913586688[0;39m ==> Parameters: 
2022-04-22 23:05:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951055913586688[0;39m <==    Updates: 0
2022-04-22 23:05:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951055913586688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:05:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951076889300992[0;39m 生成今日电子书快照开始
2022-04-22 23:05:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951076889300992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951076889300992[0;39m ==> Parameters: 
2022-04-22 23:05:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951076889300992[0;39m <==    Updates: 0
2022-04-22 23:05:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951076889300992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:05:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951097852432384[0;39m 生成今日电子书快照开始
2022-04-22 23:05:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951097852432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:05:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951097852432384[0;39m ==> Parameters: 
2022-04-22 23:05:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951097852432384[0;39m <==    Updates: 0
2022-04-22 23:05:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951097852432384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:06:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951118815563776[0;39m 生成今日电子书快照开始
2022-04-22 23:06:00.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951118815563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:00.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951118815563776[0;39m ==> Parameters: 
2022-04-22 23:06:00.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951118815563776[0;39m <==    Updates: 0
2022-04-22 23:06:00.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951118815563776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:06:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951139820638208[0;39m start updating Ebook doc
2022-04-22 23:06:05.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951139820638208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:06:05.039 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951139820638208[0;39m ==> Parameters: 
2022-04-22 23:06:05.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951139820638208[0;39m <==    Updates: 1
2022-04-22 23:06:05.080 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951139820638208[0;39m update ends, take 69 millisecs
2022-04-22 23:06:05.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951140114239488[0;39m 生成今日电子书快照开始
2022-04-22 23:06:05.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951140114239488[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:05.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951140114239488[0;39m ==> Parameters: 
2022-04-22 23:06:05.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951140114239488[0;39m <==    Updates: 0
2022-04-22 23:06:05.120 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951140114239488[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:06:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951160787963904[0;39m 生成今日电子书快照开始
2022-04-22 23:06:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951160787963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951160787963904[0;39m ==> Parameters: 
2022-04-22 23:06:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951160787963904[0;39m <==    Updates: 0
2022-04-22 23:06:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951160787963904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:06:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951181730123776[0;39m 生成今日电子书快照开始
2022-04-22 23:06:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951181730123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951181730123776[0;39m ==> Parameters: 
2022-04-22 23:06:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951181730123776[0;39m <==    Updates: 0
2022-04-22 23:06:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951181730123776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:06:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951202726809600[0;39m 生成今日电子书快照开始
2022-04-22 23:06:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951202726809600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951202726809600[0;39m ==> Parameters: 
2022-04-22 23:06:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951202726809600[0;39m <==    Updates: 0
2022-04-22 23:06:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951202726809600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:06:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951223706718208[0;39m 生成今日电子书快照开始
2022-04-22 23:06:25.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951223706718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:25.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951223706718208[0;39m ==> Parameters: 
2022-04-22 23:06:25.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951223706718208[0;39m <==    Updates: 0
2022-04-22 23:06:25.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951223706718208[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:06:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951244644683776[0;39m 生成今日电子书快照开始
2022-04-22 23:06:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951244644683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951244644683776[0;39m ==> Parameters: 
2022-04-22 23:06:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951244644683776[0;39m <==    Updates: 0
2022-04-22 23:06:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951244644683776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:06:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951265649758208[0;39m start updating Ebook doc
2022-04-22 23:06:35.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951265649758208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:06:35.039 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951265649758208[0;39m ==> Parameters: 
2022-04-22 23:06:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951265649758208[0;39m <==    Updates: 1
2022-04-22 23:06:35.074 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951265649758208[0;39m update ends, take 64 millisecs
2022-04-22 23:06:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951265918193664[0;39m 生成今日电子书快照开始
2022-04-22 23:06:35.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951265918193664[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951265918193664[0;39m ==> Parameters: 
2022-04-22 23:06:35.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951265918193664[0;39m <==    Updates: 0
2022-04-22 23:06:35.112 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951265918193664[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:06:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951286604500992[0;39m 生成今日电子书快照开始
2022-04-22 23:06:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951286604500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951286604500992[0;39m ==> Parameters: 
2022-04-22 23:06:40.090 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951286604500992[0;39m <==    Updates: 0
2022-04-22 23:06:40.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951286604500992[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-22 23:06:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951307592798208[0;39m 生成今日电子书快照开始
2022-04-22 23:06:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951307592798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951307592798208[0;39m ==> Parameters: 
2022-04-22 23:06:45.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951307592798208[0;39m <==    Updates: 0
2022-04-22 23:06:45.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951307592798208[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:06:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951328539152384[0;39m 生成今日电子书快照开始
2022-04-22 23:06:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951328539152384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951328539152384[0;39m ==> Parameters: 
2022-04-22 23:06:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951328539152384[0;39m <==    Updates: 0
2022-04-22 23:06:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951328539152384[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:06:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951349535838208[0;39m 生成今日电子书快照开始
2022-04-22 23:06:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951349535838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:06:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951349535838208[0;39m ==> Parameters: 
2022-04-22 23:06:55.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951349535838208[0;39m <==    Updates: 0
2022-04-22 23:06:55.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951349535838208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:07:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951370482192384[0;39m 生成今日电子书快照开始
2022-04-22 23:07:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951370482192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951370482192384[0;39m ==> Parameters: 
2022-04-22 23:07:00.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951370482192384[0;39m <==    Updates: 0
2022-04-22 23:07:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951370482192384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:07:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951391445323776[0;39m start updating Ebook doc
2022-04-22 23:07:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951391445323776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:07:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951391445323776[0;39m ==> Parameters: 
2022-04-22 23:07:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951391445323776[0;39m <==    Updates: 1
2022-04-22 23:07:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951391445323776[0;39m update ends, take 73 millisecs
2022-04-22 23:07:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951391755702272[0;39m 生成今日电子书快照开始
2022-04-22 23:07:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951391755702272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951391755702272[0;39m ==> Parameters: 
2022-04-22 23:07:05.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951391755702272[0;39m <==    Updates: 0
2022-04-22 23:07:05.128 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951391755702272[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 23:07:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951412408455168[0;39m 生成今日电子书快照开始
2022-04-22 23:07:10.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951412408455168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951412408455168[0;39m ==> Parameters: 
2022-04-22 23:07:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951412408455168[0;39m <==    Updates: 0
2022-04-22 23:07:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951412408455168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:07:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951433413529600[0;39m 生成今日电子书快照开始
2022-04-22 23:07:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951433413529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951433413529600[0;39m ==> Parameters: 
2022-04-22 23:07:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951433413529600[0;39m <==    Updates: 0
2022-04-22 23:07:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951433413529600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:07:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951454364078080[0;39m 生成今日电子书快照开始
2022-04-22 23:07:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951454364078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951454364078080[0;39m ==> Parameters: 
2022-04-22 23:07:20.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951454364078080[0;39m <==    Updates: 0
2022-04-22 23:07:20.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951454364078080[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:07:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951475356569600[0;39m 生成今日电子书快照开始
2022-04-22 23:07:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951475356569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951475356569600[0;39m ==> Parameters: 
2022-04-22 23:07:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951475356569600[0;39m <==    Updates: 0
2022-04-22 23:07:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951475356569600[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:07:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951496328089600[0;39m 生成今日电子书快照开始
2022-04-22 23:07:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951496328089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951496328089600[0;39m ==> Parameters: 
2022-04-22 23:07:30.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951496328089600[0;39m <==    Updates: 0
2022-04-22 23:07:30.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951496328089600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:07:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951517307998208[0;39m 生成今日电子书快照开始
2022-04-22 23:07:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951517307998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951517307998208[0;39m ==> Parameters: 
2022-04-22 23:07:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951517307998208[0;39m <==    Updates: 0
2022-04-22 23:07:35.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951517307998208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:07:35.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951517576433664[0;39m start updating Ebook doc
2022-04-22 23:07:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951517576433664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:07:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951517576433664[0;39m ==> Parameters: 
2022-04-22 23:07:35.115 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951517576433664[0;39m <==    Updates: 1
2022-04-22 23:07:35.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951517576433664[0;39m update ends, take 42 millisecs
2022-04-22 23:07:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951538258546688[0;39m 生成今日电子书快照开始
2022-04-22 23:07:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951538258546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951538258546688[0;39m ==> Parameters: 
2022-04-22 23:07:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951538258546688[0;39m <==    Updates: 0
2022-04-22 23:07:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951538258546688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:07:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951559242649600[0;39m 生成今日电子书快照开始
2022-04-22 23:07:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951559242649600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951559242649600[0;39m ==> Parameters: 
2022-04-22 23:07:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951559242649600[0;39m <==    Updates: 0
2022-04-22 23:07:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951559242649600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:07:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951580205780992[0;39m 生成今日电子书快照开始
2022-04-22 23:07:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951580205780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951580205780992[0;39m ==> Parameters: 
2022-04-22 23:07:50.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951580205780992[0;39m <==    Updates: 0
2022-04-22 23:07:50.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951580205780992[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:07:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951601185689600[0;39m 生成今日电子书快照开始
2022-04-22 23:07:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951601185689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:07:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951601185689600[0;39m ==> Parameters: 
2022-04-22 23:07:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951601185689600[0;39m <==    Updates: 0
2022-04-22 23:07:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951601185689600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:08:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951622165598208[0;39m 生成今日电子书快照开始
2022-04-22 23:08:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951622165598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951622165598208[0;39m ==> Parameters: 
2022-04-22 23:08:00.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951622165598208[0;39m <==    Updates: 0
2022-04-22 23:08:00.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951622165598208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:08:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951643103563776[0;39m start updating Ebook doc
2022-04-22 23:08:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951643103563776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:08:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951643103563776[0;39m ==> Parameters: 
2022-04-22 23:08:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951643103563776[0;39m <==    Updates: 1
2022-04-22 23:08:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951643103563776[0;39m update ends, take 62 millisecs
2022-04-22 23:08:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951643363610624[0;39m 生成今日电子书快照开始
2022-04-22 23:08:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951643363610624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951643363610624[0;39m ==> Parameters: 
2022-04-22 23:08:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951643363610624[0;39m <==    Updates: 0
2022-04-22 23:08:05.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951643363610624[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 23:08:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951664091860992[0;39m 生成今日电子书快照开始
2022-04-22 23:08:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951664091860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951664091860992[0;39m ==> Parameters: 
2022-04-22 23:08:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951664091860992[0;39m <==    Updates: 0
2022-04-22 23:08:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951664091860992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:08:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951685071769600[0;39m 生成今日电子书快照开始
2022-04-22 23:08:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951685071769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951685071769600[0;39m ==> Parameters: 
2022-04-22 23:08:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951685071769600[0;39m <==    Updates: 0
2022-04-22 23:08:15.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951685071769600[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:08:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951706043289600[0;39m 生成今日电子书快照开始
2022-04-22 23:08:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951706043289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951706043289600[0;39m ==> Parameters: 
2022-04-22 23:08:20.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951706043289600[0;39m <==    Updates: 0
2022-04-22 23:08:20.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951706043289600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:08:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951726985449472[0;39m 生成今日电子书快照开始
2022-04-22 23:08:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951726985449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951726985449472[0;39m ==> Parameters: 
2022-04-22 23:08:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951726985449472[0;39m <==    Updates: 0
2022-04-22 23:08:25.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951726985449472[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:08:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951747965358080[0;39m 生成今日电子书快照开始
2022-04-22 23:08:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951747965358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951747965358080[0;39m ==> Parameters: 
2022-04-22 23:08:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951747965358080[0;39m <==    Updates: 0
2022-04-22 23:08:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951747965358080[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:08:35.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951768953655296[0;39m 生成今日电子书快照开始
2022-04-22 23:08:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951768953655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:35.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951768953655296[0;39m ==> Parameters: 
2022-04-22 23:08:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951768953655296[0;39m <==    Updates: 0
2022-04-22 23:08:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951768953655296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:08:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951769230479360[0;39m start updating Ebook doc
2022-04-22 23:08:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951769230479360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:08:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951769230479360[0;39m ==> Parameters: 
2022-04-22 23:08:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951769230479360[0;39m <==    Updates: 1
2022-04-22 23:08:35.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951769230479360[0;39m update ends, take 32 millisecs
2022-04-22 23:08:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951789929369600[0;39m 生成今日电子书快照开始
2022-04-22 23:08:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951789929369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951789929369600[0;39m ==> Parameters: 
2022-04-22 23:08:40.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951789929369600[0;39m <==    Updates: 0
2022-04-22 23:08:40.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951789929369600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:08:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951810909278208[0;39m 生成今日电子书快照开始
2022-04-22 23:08:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951810909278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:45.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951810909278208[0;39m ==> Parameters: 
2022-04-22 23:08:45.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951810909278208[0;39m <==    Updates: 0
2022-04-22 23:08:45.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951810909278208[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:08:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951831847243776[0;39m 生成今日电子书快照开始
2022-04-22 23:08:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951831847243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:50.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951831847243776[0;39m ==> Parameters: 
2022-04-22 23:08:50.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951831847243776[0;39m <==    Updates: 0
2022-04-22 23:08:50.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951831847243776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:08:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951852814569472[0;39m 生成今日电子书快照开始
2022-04-22 23:08:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951852814569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:08:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951852814569472[0;39m ==> Parameters: 
2022-04-22 23:08:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951852814569472[0;39m <==    Updates: 0
2022-04-22 23:08:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951852814569472[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:09:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951873815449600[0;39m 生成今日电子书快照开始
2022-04-22 23:09:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951873815449600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951873815449600[0;39m ==> Parameters: 
2022-04-22 23:09:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951873815449600[0;39m <==    Updates: 0
2022-04-22 23:09:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951873815449600[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:09:05.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172951894753415168[0;39m start updating Ebook doc
2022-04-22 23:09:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951894753415168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:09:05.023 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951894753415168[0;39m ==> Parameters: 
2022-04-22 23:09:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172951894753415168[0;39m <==    Updates: 1
2022-04-22 23:09:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172951894753415168[0;39m update ends, take 64 millisecs
2022-04-22 23:09:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951895021850624[0;39m 生成今日电子书快照开始
2022-04-22 23:09:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951895021850624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951895021850624[0;39m ==> Parameters: 
2022-04-22 23:09:05.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951895021850624[0;39m <==    Updates: 0
2022-04-22 23:09:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951895021850624[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-22 23:09:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951915737518080[0;39m 生成今日电子书快照开始
2022-04-22 23:09:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951915737518080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951915737518080[0;39m ==> Parameters: 
2022-04-22 23:09:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951915737518080[0;39m <==    Updates: 0
2022-04-22 23:09:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951915737518080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:09:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951936738398208[0;39m 生成今日电子书快照开始
2022-04-22 23:09:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951936738398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951936738398208[0;39m ==> Parameters: 
2022-04-22 23:09:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951936738398208[0;39m <==    Updates: 0
2022-04-22 23:09:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951936738398208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:09:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951957667975168[0;39m 生成今日电子书快照开始
2022-04-22 23:09:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951957667975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951957667975168[0;39m ==> Parameters: 
2022-04-22 23:09:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951957667975168[0;39m <==    Updates: 0
2022-04-22 23:09:20.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951957667975168[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:09:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951978677243904[0;39m 生成今日电子书快照开始
2022-04-22 23:09:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951978677243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951978677243904[0;39m ==> Parameters: 
2022-04-22 23:09:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951978677243904[0;39m <==    Updates: 0
2022-04-22 23:09:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951978677243904[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:09:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172951999615209472[0;39m 生成今日电子书快照开始
2022-04-22 23:09:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951999615209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951999615209472[0;39m ==> Parameters: 
2022-04-22 23:09:30.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172951999615209472[0;39m <==    Updates: 0
2022-04-22 23:09:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172951999615209472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:09:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952020607700992[0;39m 生成今日电子书快照开始
2022-04-22 23:09:35.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952020607700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:35.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952020607700992[0;39m ==> Parameters: 
2022-04-22 23:09:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952020607700992[0;39m <==    Updates: 0
2022-04-22 23:09:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952020607700992[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:09:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952020859359232[0;39m start updating Ebook doc
2022-04-22 23:09:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952020859359232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:09:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952020859359232[0;39m ==> Parameters: 
2022-04-22 23:09:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952020859359232[0;39m <==    Updates: 1
2022-04-22 23:09:35.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952020859359232[0;39m update ends, take 47 millisecs
2022-04-22 23:09:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952041579220992[0;39m 生成今日电子书快照开始
2022-04-22 23:09:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952041579220992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952041579220992[0;39m ==> Parameters: 
2022-04-22 23:09:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952041579220992[0;39m <==    Updates: 0
2022-04-22 23:09:40.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952041579220992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:09:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952062567518208[0;39m 生成今日电子书快照开始
2022-04-22 23:09:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952062567518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952062567518208[0;39m ==> Parameters: 
2022-04-22 23:09:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952062567518208[0;39m <==    Updates: 0
2022-04-22 23:09:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952062567518208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:09:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952083522260992[0;39m 生成今日电子书快照开始
2022-04-22 23:09:50.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952083522260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:50.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952083522260992[0;39m ==> Parameters: 
2022-04-22 23:09:50.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952083522260992[0;39m <==    Updates: 0
2022-04-22 23:09:50.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952083522260992[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:09:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952104477003776[0;39m 生成今日电子书快照开始
2022-04-22 23:09:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952104477003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:09:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952104477003776[0;39m ==> Parameters: 
2022-04-22 23:09:55.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952104477003776[0;39m <==    Updates: 0
2022-04-22 23:09:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952104477003776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:10:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952125440135168[0;39m 生成今日电子书快照开始
2022-04-22 23:10:00.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952125440135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952125440135168[0;39m ==> Parameters: 
2022-04-22 23:10:00.227 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952125440135168[0;39m <==    Updates: 0
2022-04-22 23:10:00.227 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952125440135168[0;39m 生成今日电子书快照结束，耗时：227毫秒
2022-04-22 23:10:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952146432626688[0;39m 生成今日电子书快照开始
2022-04-22 23:10:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952146432626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952146432626688[0;39m ==> Parameters: 
2022-04-22 23:10:05.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952146432626688[0;39m <==    Updates: 0
2022-04-22 23:10:05.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952146432626688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:10:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952146722033664[0;39m start updating Ebook doc
2022-04-22 23:10:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952146722033664[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:10:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952146722033664[0;39m ==> Parameters: 
2022-04-22 23:10:05.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952146722033664[0;39m <==    Updates: 1
2022-04-22 23:10:05.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952146722033664[0;39m update ends, take 43 millisecs
2022-04-22 23:10:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952167404146688[0;39m 生成今日电子书快照开始
2022-04-22 23:10:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952167404146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952167404146688[0;39m ==> Parameters: 
2022-04-22 23:10:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952167404146688[0;39m <==    Updates: 0
2022-04-22 23:10:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952167404146688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:10:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952188396638208[0;39m 生成今日电子书快照开始
2022-04-22 23:10:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952188396638208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952188396638208[0;39m ==> Parameters: 
2022-04-22 23:10:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952188396638208[0;39m <==    Updates: 0
2022-04-22 23:10:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952188396638208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:10:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952209355575296[0;39m 生成今日电子书快照开始
2022-04-22 23:10:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952209355575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952209355575296[0;39m ==> Parameters: 
2022-04-22 23:10:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952209355575296[0;39m <==    Updates: 0
2022-04-22 23:10:20.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952209355575296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:10:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952230327095296[0;39m 生成今日电子书快照开始
2022-04-22 23:10:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952230327095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952230327095296[0;39m ==> Parameters: 
2022-04-22 23:10:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952230327095296[0;39m <==    Updates: 0
2022-04-22 23:10:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952230327095296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:10:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952251286032384[0;39m 生成今日电子书快照开始
2022-04-22 23:10:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952251286032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952251286032384[0;39m ==> Parameters: 
2022-04-22 23:10:30.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952251286032384[0;39m <==    Updates: 0
2022-04-22 23:10:30.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952251286032384[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 23:10:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952272240775168[0;39m 生成今日电子书快照开始
2022-04-22 23:10:35.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952272240775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:35.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952272240775168[0;39m ==> Parameters: 
2022-04-22 23:10:35.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952272240775168[0;39m <==    Updates: 0
2022-04-22 23:10:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952272240775168[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:10:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952272500822016[0;39m start updating Ebook doc
2022-04-22 23:10:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952272500822016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:10:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952272500822016[0;39m ==> Parameters: 
2022-04-22 23:10:35.096 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952272500822016[0;39m <==    Updates: 1
2022-04-22 23:10:35.097 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952272500822016[0;39m update ends, take 35 millisecs
2022-04-22 23:10:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952293254238208[0;39m 生成今日电子书快照开始
2022-04-22 23:10:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952293254238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952293254238208[0;39m ==> Parameters: 
2022-04-22 23:10:40.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952293254238208[0;39m <==    Updates: 0
2022-04-22 23:10:40.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952293254238208[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:10:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952314217369600[0;39m 生成今日电子书快照开始
2022-04-22 23:10:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952314217369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952314217369600[0;39m ==> Parameters: 
2022-04-22 23:10:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952314217369600[0;39m <==    Updates: 0
2022-04-22 23:10:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952314217369600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:10:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952335172112384[0;39m 生成今日电子书快照开始
2022-04-22 23:10:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952335172112384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952335172112384[0;39m ==> Parameters: 
2022-04-22 23:10:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952335172112384[0;39m <==    Updates: 0
2022-04-22 23:10:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952335172112384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:10:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952356143632384[0;39m 生成今日电子书快照开始
2022-04-22 23:10:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952356143632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:10:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952356143632384[0;39m ==> Parameters: 
2022-04-22 23:10:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952356143632384[0;39m <==    Updates: 0
2022-04-22 23:10:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952356143632384[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:11:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952377119346688[0;39m 生成今日电子书快照开始
2022-04-22 23:11:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952377119346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952377119346688[0;39m ==> Parameters: 
2022-04-22 23:11:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952377119346688[0;39m <==    Updates: 0
2022-04-22 23:11:00.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952377119346688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:11:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952398078283776[0;39m start updating Ebook doc
2022-04-22 23:11:05.016 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952398078283776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:11:05.017 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952398078283776[0;39m ==> Parameters: 
2022-04-22 23:11:05.055 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952398078283776[0;39m <==    Updates: 1
2022-04-22 23:11:05.055 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952398078283776[0;39m update ends, take 53 millisecs
2022-04-22 23:11:05.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952398304776192[0;39m 生成今日电子书快照开始
2022-04-22 23:11:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952398304776192[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:05.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952398304776192[0;39m ==> Parameters: 
2022-04-22 23:11:05.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952398304776192[0;39m <==    Updates: 0
2022-04-22 23:11:05.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952398304776192[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 23:11:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952419083358208[0;39m 生成今日电子书快照开始
2022-04-22 23:11:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952419083358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952419083358208[0;39m ==> Parameters: 
2022-04-22 23:11:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952419083358208[0;39m <==    Updates: 0
2022-04-22 23:11:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952419083358208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:11:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952440046489600[0;39m 生成今日电子书快照开始
2022-04-22 23:11:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952440046489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952440046489600[0;39m ==> Parameters: 
2022-04-22 23:11:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952440046489600[0;39m <==    Updates: 0
2022-04-22 23:11:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952440046489600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:11:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952461013815296[0;39m 生成今日电子书快照开始
2022-04-22 23:11:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952461013815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952461013815296[0;39m ==> Parameters: 
2022-04-22 23:11:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952461013815296[0;39m <==    Updates: 0
2022-04-22 23:11:20.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952461013815296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:11:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952481993723904[0;39m 生成今日电子书快照开始
2022-04-22 23:11:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952481993723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952481993723904[0;39m ==> Parameters: 
2022-04-22 23:11:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952481993723904[0;39m <==    Updates: 0
2022-04-22 23:11:25.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952481993723904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:11:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952502940078080[0;39m 生成今日电子书快照开始
2022-04-22 23:11:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952502940078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952502940078080[0;39m ==> Parameters: 
2022-04-22 23:11:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952502940078080[0;39m <==    Updates: 0
2022-04-22 23:11:30.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952502940078080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:11:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952523907403776[0;39m start updating Ebook doc
2022-04-22 23:11:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952523907403776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:11:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952523907403776[0;39m ==> Parameters: 
2022-04-22 23:11:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952523907403776[0;39m <==    Updates: 1
2022-04-22 23:11:35.077 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952523907403776[0;39m update ends, take 75 millisecs
2022-04-22 23:11:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952524221976576[0;39m 生成今日电子书快照开始
2022-04-22 23:11:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952524221976576[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952524221976576[0;39m ==> Parameters: 
2022-04-22 23:11:35.127 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952524221976576[0;39m <==    Updates: 0
2022-04-22 23:11:35.127 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952524221976576[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 23:11:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952544908283904[0;39m 生成今日电子书快照开始
2022-04-22 23:11:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952544908283904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952544908283904[0;39m ==> Parameters: 
2022-04-22 23:11:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952544908283904[0;39m <==    Updates: 0
2022-04-22 23:11:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952544908283904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:11:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952565858832384[0;39m 生成今日电子书快照开始
2022-04-22 23:11:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952565858832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952565858832384[0;39m ==> Parameters: 
2022-04-22 23:11:45.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952565858832384[0;39m <==    Updates: 0
2022-04-22 23:11:45.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952565858832384[0;39m 生成今日电子书快照结束，耗时：51毫秒
2022-04-22 23:11:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952586855518208[0;39m 生成今日电子书快照开始
2022-04-22 23:11:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952586855518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952586855518208[0;39m ==> Parameters: 
2022-04-22 23:11:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952586855518208[0;39m <==    Updates: 0
2022-04-22 23:11:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952586855518208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:11:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952607827038208[0;39m 生成今日电子书快照开始
2022-04-22 23:11:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952607827038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:11:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952607827038208[0;39m ==> Parameters: 
2022-04-22 23:11:55.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952607827038208[0;39m <==    Updates: 0
2022-04-22 23:11:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952607827038208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:12:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952628773392384[0;39m 生成今日电子书快照开始
2022-04-22 23:12:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952628773392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952628773392384[0;39m ==> Parameters: 
2022-04-22 23:12:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952628773392384[0;39m <==    Updates: 0
2022-04-22 23:12:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952628773392384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:12:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952649744912384[0;39m start updating Ebook doc
2022-04-22 23:12:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952649744912384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:12:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952649744912384[0;39m ==> Parameters: 
2022-04-22 23:12:05.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952649744912384[0;39m <==    Updates: 1
2022-04-22 23:12:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952649744912384[0;39m update ends, take 70 millisecs
2022-04-22 23:12:05.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952650038513664[0;39m 生成今日电子书快照开始
2022-04-22 23:12:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952650038513664[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952650038513664[0;39m ==> Parameters: 
2022-04-22 23:12:05.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952650038513664[0;39m <==    Updates: 0
2022-04-22 23:12:05.114 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952650038513664[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:12:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952670708043776[0;39m 生成今日电子书快照开始
2022-04-22 23:12:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952670708043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952670708043776[0;39m ==> Parameters: 
2022-04-22 23:12:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952670708043776[0;39m <==    Updates: 0
2022-04-22 23:12:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952670708043776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:12:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952691713118208[0;39m 生成今日电子书快照开始
2022-04-22 23:12:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952691713118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952691713118208[0;39m ==> Parameters: 
2022-04-22 23:12:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952691713118208[0;39m <==    Updates: 0
2022-04-22 23:12:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952691713118208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:12:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952712672055296[0;39m 生成今日电子书快照开始
2022-04-22 23:12:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952712672055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952712672055296[0;39m ==> Parameters: 
2022-04-22 23:12:20.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952712672055296[0;39m <==    Updates: 0
2022-04-22 23:12:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952712672055296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:12:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952733651963904[0;39m 生成今日电子书快照开始
2022-04-22 23:12:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952733651963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952733651963904[0;39m ==> Parameters: 
2022-04-22 23:12:25.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952733651963904[0;39m <==    Updates: 0
2022-04-22 23:12:25.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952733651963904[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:12:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952754610900992[0;39m 生成今日电子书快照开始
2022-04-22 23:12:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952754610900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952754610900992[0;39m ==> Parameters: 
2022-04-22 23:12:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952754610900992[0;39m <==    Updates: 0
2022-04-22 23:12:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952754610900992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:12:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952775599198208[0;39m start updating Ebook doc
2022-04-22 23:12:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952775599198208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:12:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952775599198208[0;39m ==> Parameters: 
2022-04-22 23:12:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952775599198208[0;39m <==    Updates: 1
2022-04-22 23:12:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952775599198208[0;39m update ends, take 66 millisecs
2022-04-22 23:12:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952775880216576[0;39m 生成今日电子书快照开始
2022-04-22 23:12:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952775880216576[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952775880216576[0;39m ==> Parameters: 
2022-04-22 23:12:35.123 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952775880216576[0;39m <==    Updates: 0
2022-04-22 23:12:35.124 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952775880216576[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-22 23:12:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952796562329600[0;39m 生成今日电子书快照开始
2022-04-22 23:12:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952796562329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952796562329600[0;39m ==> Parameters: 
2022-04-22 23:12:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952796562329600[0;39m <==    Updates: 0
2022-04-22 23:12:40.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952796562329600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:12:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952817533849600[0;39m 生成今日电子书快照开始
2022-04-22 23:12:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952817533849600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952817533849600[0;39m ==> Parameters: 
2022-04-22 23:12:45.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952817533849600[0;39m <==    Updates: 0
2022-04-22 23:12:45.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952817533849600[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:12:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952838513758208[0;39m 生成今日电子书快照开始
2022-04-22 23:12:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952838513758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952838513758208[0;39m ==> Parameters: 
2022-04-22 23:12:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952838513758208[0;39m <==    Updates: 0
2022-04-22 23:12:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952838513758208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:12:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952859485278208[0;39m 生成今日电子书快照开始
2022-04-22 23:12:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952859485278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:12:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952859485278208[0;39m ==> Parameters: 
2022-04-22 23:12:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952859485278208[0;39m <==    Updates: 0
2022-04-22 23:12:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952859485278208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:13:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952880423243776[0;39m 生成今日电子书快照开始
2022-04-22 23:13:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952880423243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952880423243776[0;39m ==> Parameters: 
2022-04-22 23:13:00.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952880423243776[0;39m <==    Updates: 0
2022-04-22 23:13:00.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952880423243776[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:13:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172952901428318208[0;39m start updating Ebook doc
2022-04-22 23:13:05.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952901428318208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:13:05.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952901428318208[0;39m ==> Parameters: 
2022-04-22 23:13:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172952901428318208[0;39m <==    Updates: 1
2022-04-22 23:13:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172952901428318208[0;39m update ends, take 66 millisecs
2022-04-22 23:13:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952901705142272[0;39m 生成今日电子书快照开始
2022-04-22 23:13:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952901705142272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:05.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952901705142272[0;39m ==> Parameters: 
2022-04-22 23:13:05.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952901705142272[0;39m <==    Updates: 0
2022-04-22 23:13:05.117 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952901705142272[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 23:13:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952922399838208[0;39m 生成今日电子书快照开始
2022-04-22 23:13:10.255 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952922399838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:10.255 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952922399838208[0;39m ==> Parameters: 
2022-04-22 23:13:10.305 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952922399838208[0;39m <==    Updates: 0
2022-04-22 23:13:10.306 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952922399838208[0;39m 生成今日电子书快照结束，耗时：296毫秒
2022-04-22 23:13:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952943362969600[0;39m 生成今日电子书快照开始
2022-04-22 23:13:15.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952943362969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:15.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952943362969600[0;39m ==> Parameters: 
2022-04-22 23:13:15.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952943362969600[0;39m <==    Updates: 0
2022-04-22 23:13:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952943362969600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:13:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952964334489600[0;39m 生成今日电子书快照开始
2022-04-22 23:13:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952964334489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952964334489600[0;39m ==> Parameters: 
2022-04-22 23:13:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952964334489600[0;39m <==    Updates: 0
2022-04-22 23:13:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952964334489600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:13:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172952985306009600[0;39m 生成今日电子书快照开始
2022-04-22 23:13:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952985306009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952985306009600[0;39m ==> Parameters: 
2022-04-22 23:13:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172952985306009600[0;39m <==    Updates: 0
2022-04-22 23:13:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172952985306009600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:13:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953006260752384[0;39m 生成今日电子书快照开始
2022-04-22 23:13:30.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953006260752384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953006260752384[0;39m ==> Parameters: 
2022-04-22 23:13:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953006260752384[0;39m <==    Updates: 0
2022-04-22 23:13:30.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953006260752384[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:13:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953027244855296[0;39m start updating Ebook doc
2022-04-22 23:13:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953027244855296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:13:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953027244855296[0;39m ==> Parameters: 
2022-04-22 23:13:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953027244855296[0;39m <==    Updates: 1
2022-04-22 23:13:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953027244855296[0;39m update ends, take 55 millisecs
2022-04-22 23:13:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953027475542016[0;39m 生成今日电子书快照开始
2022-04-22 23:13:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953027475542016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953027475542016[0;39m ==> Parameters: 
2022-04-22 23:13:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953027475542016[0;39m <==    Updates: 0
2022-04-22 23:13:35.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953027475542016[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-22 23:13:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953048212180992[0;39m 生成今日电子书快照开始
2022-04-22 23:13:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953048212180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953048212180992[0;39m ==> Parameters: 
2022-04-22 23:13:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953048212180992[0;39m <==    Updates: 0
2022-04-22 23:13:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953048212180992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:13:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953069192089600[0;39m 生成今日电子书快照开始
2022-04-22 23:13:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953069192089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:45.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953069192089600[0;39m ==> Parameters: 
2022-04-22 23:13:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953069192089600[0;39m <==    Updates: 0
2022-04-22 23:13:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953069192089600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:13:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953090134249472[0;39m 生成今日电子书快照开始
2022-04-22 23:13:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953090134249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953090134249472[0;39m ==> Parameters: 
2022-04-22 23:13:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953090134249472[0;39m <==    Updates: 0
2022-04-22 23:13:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953090134249472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:13:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953111122546688[0;39m 生成今日电子书快照开始
2022-04-22 23:13:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953111122546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:13:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953111122546688[0;39m ==> Parameters: 
2022-04-22 23:13:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953111122546688[0;39m <==    Updates: 0
2022-04-22 23:13:55.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953111122546688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:14:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953132094066688[0;39m 生成今日电子书快照开始
2022-04-22 23:14:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953132094066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953132094066688[0;39m ==> Parameters: 
2022-04-22 23:14:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953132094066688[0;39m <==    Updates: 0
2022-04-22 23:14:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953132094066688[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:14:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953153053003776[0;39m 生成今日电子书快照开始
2022-04-22 23:14:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953153053003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:05.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953153053003776[0;39m ==> Parameters: 
2022-04-22 23:14:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953153053003776[0;39m <==    Updates: 0
2022-04-22 23:14:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953153053003776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:14:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953153313050624[0;39m start updating Ebook doc
2022-04-22 23:14:05.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953153313050624[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:14:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953153313050624[0;39m ==> Parameters: 
2022-04-22 23:14:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953153313050624[0;39m <==    Updates: 1
2022-04-22 23:14:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953153313050624[0;39m update ends, take 43 millisecs
2022-04-22 23:14:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953174020329472[0;39m 生成今日电子书快照开始
2022-04-22 23:14:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953174020329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953174020329472[0;39m ==> Parameters: 
2022-04-22 23:14:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953174020329472[0;39m <==    Updates: 0
2022-04-22 23:14:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953174020329472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:14:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953195017015296[0;39m 生成今日电子书快照开始
2022-04-22 23:14:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953195017015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953195017015296[0;39m ==> Parameters: 
2022-04-22 23:14:15.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953195017015296[0;39m <==    Updates: 0
2022-04-22 23:14:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953195017015296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:14:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953215988535296[0;39m 生成今日电子书快照开始
2022-04-22 23:14:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953215988535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953215988535296[0;39m ==> Parameters: 
2022-04-22 23:14:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953215988535296[0;39m <==    Updates: 0
2022-04-22 23:14:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953215988535296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:14:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953236939083776[0;39m 生成今日电子书快照开始
2022-04-22 23:14:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953236939083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953236939083776[0;39m ==> Parameters: 
2022-04-22 23:14:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953236939083776[0;39m <==    Updates: 0
2022-04-22 23:14:25.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953236939083776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:14:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953257906409472[0;39m 生成今日电子书快照开始
2022-04-22 23:14:30.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953257906409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:30.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953257906409472[0;39m ==> Parameters: 
2022-04-22 23:14:30.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953257906409472[0;39m <==    Updates: 0
2022-04-22 23:14:30.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953257906409472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:14:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953278911483904[0;39m 生成今日电子书快照开始
2022-04-22 23:14:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953278911483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953278911483904[0;39m ==> Parameters: 
2022-04-22 23:14:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953278911483904[0;39m <==    Updates: 0
2022-04-22 23:14:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953278911483904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:14:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953279158947840[0;39m start updating Ebook doc
2022-04-22 23:14:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953279158947840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:14:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953279158947840[0;39m ==> Parameters: 
2022-04-22 23:14:35.103 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953279158947840[0;39m <==    Updates: 1
2022-04-22 23:14:35.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953279158947840[0;39m update ends, take 36 millisecs
2022-04-22 23:14:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953299883003904[0;39m 生成今日电子书快照开始
2022-04-22 23:14:40.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953299883003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:40.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953299883003904[0;39m ==> Parameters: 
2022-04-22 23:14:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953299883003904[0;39m <==    Updates: 0
2022-04-22 23:14:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953299883003904[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:14:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953320841940992[0;39m 生成今日电子书快照开始
2022-04-22 23:14:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953320841940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953320841940992[0;39m ==> Parameters: 
2022-04-22 23:14:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953320841940992[0;39m <==    Updates: 0
2022-04-22 23:14:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953320841940992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:14:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953341796683776[0;39m 生成今日电子书快照开始
2022-04-22 23:14:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953341796683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953341796683776[0;39m ==> Parameters: 
2022-04-22 23:14:50.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953341796683776[0;39m <==    Updates: 0
2022-04-22 23:14:50.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953341796683776[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:14:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953362768203776[0;39m 生成今日电子书快照开始
2022-04-22 23:14:55.131 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953362768203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:14:55.132 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953362768203776[0;39m ==> Parameters: 
2022-04-22 23:14:55.220 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953362768203776[0;39m <==    Updates: 0
2022-04-22 23:14:55.220 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953362768203776[0;39m 生成今日电子书快照结束，耗时：218毫秒
2022-04-22 23:15:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953383739723776[0;39m 生成今日电子书快照开始
2022-04-22 23:15:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953383739723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953383739723776[0;39m ==> Parameters: 
2022-04-22 23:15:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953383739723776[0;39m <==    Updates: 0
2022-04-22 23:15:00.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953383739723776[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:15:05.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953404728020992[0;39m start updating Ebook doc
2022-04-22 23:15:05.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953404728020992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:15:05.022 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953404728020992[0;39m ==> Parameters: 
2022-04-22 23:15:05.058 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953404728020992[0;39m <==    Updates: 1
2022-04-22 23:15:05.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953404728020992[0;39m update ends, take 52 millisecs
2022-04-22 23:15:05.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953404950319104[0;39m 生成今日电子书快照开始
2022-04-22 23:15:05.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953404950319104[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:05.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953404950319104[0;39m ==> Parameters: 
2022-04-22 23:15:05.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953404950319104[0;39m <==    Updates: 0
2022-04-22 23:15:05.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953404950319104[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 23:15:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953425712123904[0;39m 生成今日电子书快照开始
2022-04-22 23:15:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953425712123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953425712123904[0;39m ==> Parameters: 
2022-04-22 23:15:10.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953425712123904[0;39m <==    Updates: 0
2022-04-22 23:15:10.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953425712123904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:15:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953446675255296[0;39m 生成今日电子书快照开始
2022-04-22 23:15:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953446675255296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953446675255296[0;39m ==> Parameters: 
2022-04-22 23:15:15.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953446675255296[0;39m <==    Updates: 0
2022-04-22 23:15:15.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953446675255296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:15:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953467629998080[0;39m 生成今日电子书快照开始
2022-04-22 23:15:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953467629998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953467629998080[0;39m ==> Parameters: 
2022-04-22 23:15:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953467629998080[0;39m <==    Updates: 0
2022-04-22 23:15:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953467629998080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:15:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953488609906688[0;39m 生成今日电子书快照开始
2022-04-22 23:15:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953488609906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953488609906688[0;39m ==> Parameters: 
2022-04-22 23:15:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953488609906688[0;39m <==    Updates: 0
2022-04-22 23:15:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953488609906688[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:15:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953509581426688[0;39m 生成今日电子书快照开始
2022-04-22 23:15:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953509581426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953509581426688[0;39m ==> Parameters: 
2022-04-22 23:15:30.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953509581426688[0;39m <==    Updates: 0
2022-04-22 23:15:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953509581426688[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:15:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953530544558080[0;39m 生成今日电子书快照开始
2022-04-22 23:15:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953530544558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953530544558080[0;39m ==> Parameters: 
2022-04-22 23:15:35.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953530544558080[0;39m <==    Updates: 0
2022-04-22 23:15:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953530544558080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:15:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953530804604928[0;39m start updating Ebook doc
2022-04-22 23:15:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953530804604928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:15:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953530804604928[0;39m ==> Parameters: 
2022-04-22 23:15:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953530804604928[0;39m <==    Updates: 1
2022-04-22 23:15:35.113 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953530804604928[0;39m update ends, take 48 millisecs
2022-04-22 23:15:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953551528660992[0;39m 生成今日电子书快照开始
2022-04-22 23:15:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953551528660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953551528660992[0;39m ==> Parameters: 
2022-04-22 23:15:40.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953551528660992[0;39m <==    Updates: 0
2022-04-22 23:15:40.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953551528660992[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 23:15:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953572508569600[0;39m 生成今日电子书快照开始
2022-04-22 23:15:45.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953572508569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:45.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953572508569600[0;39m ==> Parameters: 
2022-04-22 23:15:45.134 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953572508569600[0;39m <==    Updates: 0
2022-04-22 23:15:45.134 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953572508569600[0;39m 生成今日电子书快照结束，耗时：125毫秒
2022-04-22 23:15:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953593488478208[0;39m 生成今日电子书快照开始
2022-04-22 23:15:50.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953593488478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953593488478208[0;39m ==> Parameters: 
2022-04-22 23:15:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953593488478208[0;39m <==    Updates: 0
2022-04-22 23:15:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953593488478208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:15:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953614422249472[0;39m 生成今日电子书快照开始
2022-04-22 23:15:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953614422249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:15:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953614422249472[0;39m ==> Parameters: 
2022-04-22 23:15:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953614422249472[0;39m <==    Updates: 0
2022-04-22 23:15:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953614422249472[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:16:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953635427323904[0;39m 生成今日电子书快照开始
2022-04-22 23:16:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953635427323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953635427323904[0;39m ==> Parameters: 
2022-04-22 23:16:00.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953635427323904[0;39m <==    Updates: 0
2022-04-22 23:16:00.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953635427323904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:16:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953656369483776[0;39m start updating Ebook doc
2022-04-22 23:16:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953656369483776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:16:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953656369483776[0;39m ==> Parameters: 
2022-04-22 23:16:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953656369483776[0;39m <==    Updates: 1
2022-04-22 23:16:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953656369483776[0;39m update ends, take 68 millisecs
2022-04-22 23:16:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953656658890752[0;39m 生成今日电子书快照开始
2022-04-22 23:16:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953656658890752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953656658890752[0;39m ==> Parameters: 
2022-04-22 23:16:05.112 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953656658890752[0;39m <==    Updates: 0
2022-04-22 23:16:05.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953656658890752[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-22 23:16:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953677361975296[0;39m 生成今日电子书快照开始
2022-04-22 23:16:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953677361975296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953677361975296[0;39m ==> Parameters: 
2022-04-22 23:16:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953677361975296[0;39m <==    Updates: 0
2022-04-22 23:16:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953677361975296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:16:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953698333495296[0;39m 生成今日电子书快照开始
2022-04-22 23:16:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953698333495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:15.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953698333495296[0;39m ==> Parameters: 
2022-04-22 23:16:15.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953698333495296[0;39m <==    Updates: 0
2022-04-22 23:16:15.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953698333495296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:16:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953719305015296[0;39m 生成今日电子书快照开始
2022-04-22 23:16:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953719305015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953719305015296[0;39m ==> Parameters: 
2022-04-22 23:16:20.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953719305015296[0;39m <==    Updates: 0
2022-04-22 23:16:20.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953719305015296[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:16:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953740289118208[0;39m 生成今日电子书快照开始
2022-04-22 23:16:25.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953740289118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:25.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953740289118208[0;39m ==> Parameters: 
2022-04-22 23:16:25.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953740289118208[0;39m <==    Updates: 0
2022-04-22 23:16:25.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953740289118208[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:16:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953761222889472[0;39m 生成今日电子书快照开始
2022-04-22 23:16:30.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953761222889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953761222889472[0;39m ==> Parameters: 
2022-04-22 23:16:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953761222889472[0;39m <==    Updates: 0
2022-04-22 23:16:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953761222889472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:16:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953782219575296[0;39m start updating Ebook doc
2022-04-22 23:16:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953782219575296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:16:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953782219575296[0;39m ==> Parameters: 
2022-04-22 23:16:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953782219575296[0;39m <==    Updates: 1
2022-04-22 23:16:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953782219575296[0;39m update ends, take 55 millisecs
2022-04-22 23:16:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953782450262016[0;39m 生成今日电子书快照开始
2022-04-22 23:16:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953782450262016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953782450262016[0;39m ==> Parameters: 
2022-04-22 23:16:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953782450262016[0;39m <==    Updates: 0
2022-04-22 23:16:35.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953782450262016[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-22 23:16:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953803161735168[0;39m 生成今日电子书快照开始
2022-04-22 23:16:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953803161735168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953803161735168[0;39m ==> Parameters: 
2022-04-22 23:16:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953803161735168[0;39m <==    Updates: 0
2022-04-22 23:16:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953803161735168[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:16:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953824175198208[0;39m 生成今日电子书快照开始
2022-04-22 23:16:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953824175198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:45.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953824175198208[0;39m ==> Parameters: 
2022-04-22 23:16:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953824175198208[0;39m <==    Updates: 0
2022-04-22 23:16:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953824175198208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:16:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953845146718208[0;39m 生成今日电子书快照开始
2022-04-22 23:16:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953845146718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953845146718208[0;39m ==> Parameters: 
2022-04-22 23:16:50.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953845146718208[0;39m <==    Updates: 0
2022-04-22 23:16:50.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953845146718208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:16:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953866088878080[0;39m 生成今日电子书快照开始
2022-04-22 23:16:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953866088878080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:16:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953866088878080[0;39m ==> Parameters: 
2022-04-22 23:16:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953866088878080[0;39m <==    Updates: 0
2022-04-22 23:16:55.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953866088878080[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:17:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953887085563904[0;39m 生成今日电子书快照开始
2022-04-22 23:17:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953887085563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953887085563904[0;39m ==> Parameters: 
2022-04-22 23:17:00.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953887085563904[0;39m <==    Updates: 0
2022-04-22 23:17:00.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953887085563904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:17:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953908027723776[0;39m 生成今日电子书快照开始
2022-04-22 23:17:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953908027723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:05.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953908027723776[0;39m ==> Parameters: 
2022-04-22 23:17:05.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953908027723776[0;39m <==    Updates: 0
2022-04-22 23:17:05.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953908027723776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:17:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172953908279382016[0;39m start updating Ebook doc
2022-04-22 23:17:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953908279382016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:17:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953908279382016[0;39m ==> Parameters: 
2022-04-22 23:17:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172953908279382016[0;39m <==    Updates: 1
2022-04-22 23:17:05.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172953908279382016[0;39m update ends, take 38 millisecs
2022-04-22 23:17:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953929028603904[0;39m 生成今日电子书快照开始
2022-04-22 23:17:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953929028603904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953929028603904[0;39m ==> Parameters: 
2022-04-22 23:17:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953929028603904[0;39m <==    Updates: 0
2022-04-22 23:17:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953929028603904[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:17:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953949966569472[0;39m 生成今日电子书快照开始
2022-04-22 23:17:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953949966569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953949966569472[0;39m ==> Parameters: 
2022-04-22 23:17:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953949966569472[0;39m <==    Updates: 0
2022-04-22 23:17:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953949966569472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:17:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953970975838208[0;39m 生成今日电子书快照开始
2022-04-22 23:17:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953970975838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953970975838208[0;39m ==> Parameters: 
2022-04-22 23:17:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953970975838208[0;39m <==    Updates: 0
2022-04-22 23:17:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953970975838208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:17:25.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172953991951552512[0;39m 生成今日电子书快照开始
2022-04-22 23:17:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953991951552512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953991951552512[0;39m ==> Parameters: 
2022-04-22 23:17:25.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172953991951552512[0;39m <==    Updates: 0
2022-04-22 23:17:25.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172953991951552512[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:17:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954012897906688[0;39m 生成今日电子书快照开始
2022-04-22 23:17:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954012897906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954012897906688[0;39m ==> Parameters: 
2022-04-22 23:17:30.128 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954012897906688[0;39m <==    Updates: 0
2022-04-22 23:17:30.128 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954012897906688[0;39m 生成今日电子书快照结束，耗时：123毫秒
2022-04-22 23:17:35.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954033886203904[0;39m 生成今日电子书快照开始
2022-04-22 23:17:35.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954033886203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:35.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954033886203904[0;39m ==> Parameters: 
2022-04-22 23:17:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954033886203904[0;39m <==    Updates: 0
2022-04-22 23:17:35.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954033886203904[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:17:35.079 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954034179805184[0;39m start updating Ebook doc
2022-04-22 23:17:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954034179805184[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:17:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954034179805184[0;39m ==> Parameters: 
2022-04-22 23:17:35.118 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954034179805184[0;39m <==    Updates: 1
2022-04-22 23:17:35.118 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954034179805184[0;39m update ends, take 39 millisecs
2022-04-22 23:17:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954054857723904[0;39m 生成今日电子书快照开始
2022-04-22 23:17:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954054857723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954054857723904[0;39m ==> Parameters: 
2022-04-22 23:17:40.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954054857723904[0;39m <==    Updates: 0
2022-04-22 23:17:40.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954054857723904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:17:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954075833438208[0;39m 生成今日电子书快照开始
2022-04-22 23:17:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954075833438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954075833438208[0;39m ==> Parameters: 
2022-04-22 23:17:45.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954075833438208[0;39m <==    Updates: 0
2022-04-22 23:17:45.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954075833438208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:17:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954096775598080[0;39m 生成今日电子书快照开始
2022-04-22 23:17:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954096775598080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954096775598080[0;39m ==> Parameters: 
2022-04-22 23:17:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954096775598080[0;39m <==    Updates: 0
2022-04-22 23:17:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954096775598080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:17:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954117747118080[0;39m 生成今日电子书快照开始
2022-04-22 23:17:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954117747118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:17:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954117747118080[0;39m ==> Parameters: 
2022-04-22 23:17:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954117747118080[0;39m <==    Updates: 0
2022-04-22 23:17:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954117747118080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:18:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954138714443776[0;39m 生成今日电子书快照开始
2022-04-22 23:18:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954138714443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954138714443776[0;39m ==> Parameters: 
2022-04-22 23:18:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954138714443776[0;39m <==    Updates: 0
2022-04-22 23:18:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954138714443776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:18:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954159685963776[0;39m 生成今日电子书快照开始
2022-04-22 23:18:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954159685963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954159685963776[0;39m ==> Parameters: 
2022-04-22 23:18:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954159685963776[0;39m <==    Updates: 0
2022-04-22 23:18:05.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954159685963776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:18:05.069 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954159966982144[0;39m start updating Ebook doc
2022-04-22 23:18:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954159966982144[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:18:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954159966982144[0;39m ==> Parameters: 
2022-04-22 23:18:05.114 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954159966982144[0;39m <==    Updates: 1
2022-04-22 23:18:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954159966982144[0;39m update ends, take 45 millisecs
2022-04-22 23:18:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954180657483776[0;39m 生成今日电子书快照开始
2022-04-22 23:18:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954180657483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954180657483776[0;39m ==> Parameters: 
2022-04-22 23:18:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954180657483776[0;39m <==    Updates: 0
2022-04-22 23:18:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954180657483776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:18:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954201624809472[0;39m 生成今日电子书快照开始
2022-04-22 23:18:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954201624809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:15.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954201624809472[0;39m ==> Parameters: 
2022-04-22 23:18:15.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954201624809472[0;39m <==    Updates: 0
2022-04-22 23:18:15.051 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954201624809472[0;39m 生成今日电子书快照结束，耗时：49毫秒
2022-04-22 23:18:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954222621495296[0;39m 生成今日电子书快照开始
2022-04-22 23:18:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954222621495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954222621495296[0;39m ==> Parameters: 
2022-04-22 23:18:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954222621495296[0;39m <==    Updates: 0
2022-04-22 23:18:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954222621495296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:18:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954243605598208[0;39m 生成今日电子书快照开始
2022-04-22 23:18:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954243605598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954243605598208[0;39m ==> Parameters: 
2022-04-22 23:18:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954243605598208[0;39m <==    Updates: 0
2022-04-22 23:18:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954243605598208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:18:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954264572923904[0;39m 生成今日电子书快照开始
2022-04-22 23:18:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954264572923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954264572923904[0;39m ==> Parameters: 
2022-04-22 23:18:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954264572923904[0;39m <==    Updates: 0
2022-04-22 23:18:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954264572923904[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:18:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954285515083776[0;39m start updating Ebook doc
2022-04-22 23:18:35.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954285515083776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:18:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954285515083776[0;39m ==> Parameters: 
2022-04-22 23:18:35.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954285515083776[0;39m <==    Updates: 1
2022-04-22 23:18:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954285515083776[0;39m update ends, take 63 millisecs
2022-04-22 23:18:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954285779324928[0;39m 生成今日电子书快照开始
2022-04-22 23:18:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954285779324928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954285779324928[0;39m ==> Parameters: 
2022-04-22 23:18:35.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954285779324928[0;39m <==    Updates: 0
2022-04-22 23:18:35.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954285779324928[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-22 23:18:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954306515963904[0;39m 生成今日电子书快照开始
2022-04-22 23:18:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954306515963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954306515963904[0;39m ==> Parameters: 
2022-04-22 23:18:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954306515963904[0;39m <==    Updates: 0
2022-04-22 23:18:40.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954306515963904[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:18:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954327470706688[0;39m 生成今日电子书快照开始
2022-04-22 23:18:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954327470706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954327470706688[0;39m ==> Parameters: 
2022-04-22 23:18:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954327470706688[0;39m <==    Updates: 0
2022-04-22 23:18:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954327470706688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:18:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954348442226688[0;39m 生成今日电子书快照开始
2022-04-22 23:18:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954348442226688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954348442226688[0;39m ==> Parameters: 
2022-04-22 23:18:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954348442226688[0;39m <==    Updates: 0
2022-04-22 23:18:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954348442226688[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:18:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954369417940992[0;39m 生成今日电子书快照开始
2022-04-22 23:18:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954369417940992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:18:55.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954369417940992[0;39m ==> Parameters: 
2022-04-22 23:18:55.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954369417940992[0;39m <==    Updates: 0
2022-04-22 23:18:55.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954369417940992[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:19:00.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954390381072384[0;39m 生成今日电子书快照开始
2022-04-22 23:19:00.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954390381072384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:00.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954390381072384[0;39m ==> Parameters: 
2022-04-22 23:19:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954390381072384[0;39m <==    Updates: 0
2022-04-22 23:19:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954390381072384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:19:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954411352592384[0;39m 生成今日电子书快照开始
2022-04-22 23:19:05.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954411352592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:05.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954411352592384[0;39m ==> Parameters: 
2022-04-22 23:19:05.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954411352592384[0;39m <==    Updates: 0
2022-04-22 23:19:05.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954411352592384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:19:05.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954411658776576[0;39m start updating Ebook doc
2022-04-22 23:19:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954411658776576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:19:05.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954411658776576[0;39m ==> Parameters: 
2022-04-22 23:19:05.123 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954411658776576[0;39m <==    Updates: 1
2022-04-22 23:19:05.123 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954411658776576[0;39m update ends, take 46 millisecs
2022-04-22 23:19:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954432315723776[0;39m 生成今日电子书快照开始
2022-04-22 23:19:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954432315723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954432315723776[0;39m ==> Parameters: 
2022-04-22 23:19:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954432315723776[0;39m <==    Updates: 0
2022-04-22 23:19:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954432315723776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:19:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954453308215296[0;39m 生成今日电子书快照开始
2022-04-22 23:19:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954453308215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954453308215296[0;39m ==> Parameters: 
2022-04-22 23:19:15.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954453308215296[0;39m <==    Updates: 0
2022-04-22 23:19:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954453308215296[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 23:19:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954474262958080[0;39m 生成今日电子书快照开始
2022-04-22 23:19:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954474262958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:20.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954474262958080[0;39m ==> Parameters: 
2022-04-22 23:19:20.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954474262958080[0;39m <==    Updates: 0
2022-04-22 23:19:20.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954474262958080[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:19:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954495247060992[0;39m 生成今日电子书快照开始
2022-04-22 23:19:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954495247060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954495247060992[0;39m ==> Parameters: 
2022-04-22 23:19:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954495247060992[0;39m <==    Updates: 0
2022-04-22 23:19:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954495247060992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:19:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954516235358208[0;39m 生成今日电子书快照开始
2022-04-22 23:19:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954516235358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954516235358208[0;39m ==> Parameters: 
2022-04-22 23:19:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954516235358208[0;39m <==    Updates: 0
2022-04-22 23:19:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954516235358208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:19:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954537173323776[0;39m 生成今日电子书快照开始
2022-04-22 23:19:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954537173323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954537173323776[0;39m ==> Parameters: 
2022-04-22 23:19:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954537173323776[0;39m <==    Updates: 0
2022-04-22 23:19:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954537173323776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:19:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954537466925056[0;39m start updating Ebook doc
2022-04-22 23:19:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954537466925056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:19:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954537466925056[0;39m ==> Parameters: 
2022-04-22 23:19:35.127 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954537466925056[0;39m <==    Updates: 1
2022-04-22 23:19:35.128 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954537466925056[0;39m update ends, take 56 millisecs
2022-04-22 23:19:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954558153232384[0;39m 生成今日电子书快照开始
2022-04-22 23:19:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954558153232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954558153232384[0;39m ==> Parameters: 
2022-04-22 23:19:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954558153232384[0;39m <==    Updates: 0
2022-04-22 23:19:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954558153232384[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:19:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954579107975168[0;39m 生成今日电子书快照开始
2022-04-22 23:19:45.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954579107975168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:45.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954579107975168[0;39m ==> Parameters: 
2022-04-22 23:19:45.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954579107975168[0;39m <==    Updates: 0
2022-04-22 23:19:45.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954579107975168[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:19:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954600121438208[0;39m 生成今日电子书快照开始
2022-04-22 23:19:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954600121438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954600121438208[0;39m ==> Parameters: 
2022-04-22 23:19:50.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954600121438208[0;39m <==    Updates: 0
2022-04-22 23:19:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954600121438208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:19:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954621084569600[0;39m 生成今日电子书快照开始
2022-04-22 23:19:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954621084569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:19:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954621084569600[0;39m ==> Parameters: 
2022-04-22 23:19:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954621084569600[0;39m <==    Updates: 0
2022-04-22 23:19:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954621084569600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:20:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954642056089600[0;39m 生成今日电子书快照开始
2022-04-22 23:20:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954642056089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954642056089600[0;39m ==> Parameters: 
2022-04-22 23:20:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954642056089600[0;39m <==    Updates: 0
2022-04-22 23:20:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954642056089600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:20:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954663010832384[0;39m start updating Ebook doc
2022-04-22 23:20:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954663010832384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:20:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954663010832384[0;39m ==> Parameters: 
2022-04-22 23:20:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954663010832384[0;39m <==    Updates: 1
2022-04-22 23:20:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954663010832384[0;39m update ends, take 61 millisecs
2022-04-22 23:20:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954663266684928[0;39m 生成今日电子书快照开始
2022-04-22 23:20:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954663266684928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954663266684928[0;39m ==> Parameters: 
2022-04-22 23:20:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954663266684928[0;39m <==    Updates: 0
2022-04-22 23:20:05.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954663266684928[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:20:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954683999129600[0;39m 生成今日电子书快照开始
2022-04-22 23:20:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954683999129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954683999129600[0;39m ==> Parameters: 
2022-04-22 23:20:10.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954683999129600[0;39m <==    Updates: 0
2022-04-22 23:20:10.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954683999129600[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 23:20:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954704966455296[0;39m 生成今日电子书快照开始
2022-04-22 23:20:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954704966455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954704966455296[0;39m ==> Parameters: 
2022-04-22 23:20:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954704966455296[0;39m <==    Updates: 0
2022-04-22 23:20:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954704966455296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:20:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954725925392384[0;39m 生成今日电子书快照开始
2022-04-22 23:20:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954725925392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954725925392384[0;39m ==> Parameters: 
2022-04-22 23:20:20.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954725925392384[0;39m <==    Updates: 0
2022-04-22 23:20:20.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954725925392384[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 23:20:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954746909495296[0;39m 生成今日电子书快照开始
2022-04-22 23:20:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954746909495296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954746909495296[0;39m ==> Parameters: 
2022-04-22 23:20:25.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954746909495296[0;39m <==    Updates: 0
2022-04-22 23:20:25.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954746909495296[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:20:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954767851655168[0;39m 生成今日电子书快照开始
2022-04-22 23:20:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954767851655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954767851655168[0;39m ==> Parameters: 
2022-04-22 23:20:30.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954767851655168[0;39m <==    Updates: 0
2022-04-22 23:20:30.058 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954767851655168[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:20:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954788865118208[0;39m 生成今日电子书快照开始
2022-04-22 23:20:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954788865118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954788865118208[0;39m ==> Parameters: 
2022-04-22 23:20:35.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954788865118208[0;39m <==    Updates: 0
2022-04-22 23:20:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954788865118208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:20:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954789099999232[0;39m start updating Ebook doc
2022-04-22 23:20:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954789099999232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:20:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954789099999232[0;39m ==> Parameters: 
2022-04-22 23:20:35.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954789099999232[0;39m <==    Updates: 1
2022-04-22 23:20:35.105 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954789099999232[0;39m update ends, take 39 millisecs
2022-04-22 23:20:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954809815666688[0;39m 生成今日电子书快照开始
2022-04-22 23:20:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954809815666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954809815666688[0;39m ==> Parameters: 
2022-04-22 23:20:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954809815666688[0;39m <==    Updates: 0
2022-04-22 23:20:40.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954809815666688[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:20:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954830795575296[0;39m 生成今日电子书快照开始
2022-04-22 23:20:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954830795575296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954830795575296[0;39m ==> Parameters: 
2022-04-22 23:20:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954830795575296[0;39m <==    Updates: 0
2022-04-22 23:20:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954830795575296[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:20:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954851767095296[0;39m 生成今日电子书快照开始
2022-04-22 23:20:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954851767095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954851767095296[0;39m ==> Parameters: 
2022-04-22 23:20:50.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954851767095296[0;39m <==    Updates: 0
2022-04-22 23:20:50.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954851767095296[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:20:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954872738615296[0;39m 生成今日电子书快照开始
2022-04-22 23:20:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954872738615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:20:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954872738615296[0;39m ==> Parameters: 
2022-04-22 23:20:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954872738615296[0;39m <==    Updates: 0
2022-04-22 23:20:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954872738615296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:21:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954893689163776[0;39m 生成今日电子书快照开始
2022-04-22 23:21:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954893689163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954893689163776[0;39m ==> Parameters: 
2022-04-22 23:21:00.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954893689163776[0;39m <==    Updates: 0
2022-04-22 23:21:00.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954893689163776[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:21:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172954914669072384[0;39m start updating Ebook doc
2022-04-22 23:21:05.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954914669072384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:21:05.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954914669072384[0;39m ==> Parameters: 
2022-04-22 23:21:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172954914669072384[0;39m <==    Updates: 1
2022-04-22 23:21:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172954914669072384[0;39m update ends, take 63 millisecs
2022-04-22 23:21:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954914937507840[0;39m 生成今日电子书快照开始
2022-04-22 23:21:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954914937507840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954914937507840[0;39m ==> Parameters: 
2022-04-22 23:21:05.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954914937507840[0;39m <==    Updates: 0
2022-04-22 23:21:05.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954914937507840[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 23:21:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954935640592384[0;39m 生成今日电子书快照开始
2022-04-22 23:21:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954935640592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954935640592384[0;39m ==> Parameters: 
2022-04-22 23:21:10.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954935640592384[0;39m <==    Updates: 0
2022-04-22 23:21:10.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954935640592384[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:21:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954956620500992[0;39m 生成今日电子书快照开始
2022-04-22 23:21:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954956620500992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954956620500992[0;39m ==> Parameters: 
2022-04-22 23:21:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954956620500992[0;39m <==    Updates: 0
2022-04-22 23:21:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954956620500992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:21:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954977579438080[0;39m 生成今日电子书快照开始
2022-04-22 23:21:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954977579438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954977579438080[0;39m ==> Parameters: 
2022-04-22 23:21:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954977579438080[0;39m <==    Updates: 0
2022-04-22 23:21:20.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954977579438080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:21:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172954998546763776[0;39m 生成今日电子书快照开始
2022-04-22 23:21:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954998546763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954998546763776[0;39m ==> Parameters: 
2022-04-22 23:21:25.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172954998546763776[0;39m <==    Updates: 0
2022-04-22 23:21:25.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172954998546763776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:21:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955019547643904[0;39m 生成今日电子书快照开始
2022-04-22 23:21:30.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955019547643904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955019547643904[0;39m ==> Parameters: 
2022-04-22 23:21:30.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955019547643904[0;39m <==    Updates: 0
2022-04-22 23:21:30.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955019547643904[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:21:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955040506580992[0;39m 生成今日电子书快照开始
2022-04-22 23:21:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955040506580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955040506580992[0;39m ==> Parameters: 
2022-04-22 23:21:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955040506580992[0;39m <==    Updates: 0
2022-04-22 23:21:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955040506580992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:21:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955040783405056[0;39m start updating Ebook doc
2022-04-22 23:21:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955040783405056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:21:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955040783405056[0;39m ==> Parameters: 
2022-04-22 23:21:35.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955040783405056[0;39m <==    Updates: 1
2022-04-22 23:21:35.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955040783405056[0;39m update ends, take 42 millisecs
2022-04-22 23:21:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955061461323776[0;39m 生成今日电子书快照开始
2022-04-22 23:21:40.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955061461323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955061461323776[0;39m ==> Parameters: 
2022-04-22 23:21:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955061461323776[0;39m <==    Updates: 0
2022-04-22 23:21:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955061461323776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:21:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955082453815296[0;39m 生成今日电子书快照开始
2022-04-22 23:21:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955082453815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955082453815296[0;39m ==> Parameters: 
2022-04-22 23:21:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955082453815296[0;39m <==    Updates: 0
2022-04-22 23:21:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955082453815296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:21:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955103437918208[0;39m 生成今日电子书快照开始
2022-04-22 23:21:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955103437918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955103437918208[0;39m ==> Parameters: 
2022-04-22 23:21:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955103437918208[0;39m <==    Updates: 0
2022-04-22 23:21:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955103437918208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:21:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955124405243904[0;39m 生成今日电子书快照开始
2022-04-22 23:21:55.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955124405243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:21:55.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955124405243904[0;39m ==> Parameters: 
2022-04-22 23:21:55.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955124405243904[0;39m <==    Updates: 0
2022-04-22 23:21:55.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955124405243904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:22:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955145368375296[0;39m 生成今日电子书快照开始
2022-04-22 23:22:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955145368375296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955145368375296[0;39m ==> Parameters: 
2022-04-22 23:22:00.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955145368375296[0;39m <==    Updates: 0
2022-04-22 23:22:00.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955145368375296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:22:05.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955166323118080[0;39m start updating Ebook doc
2022-04-22 23:22:05.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955166323118080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:22:05.026 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955166323118080[0;39m ==> Parameters: 
2022-04-22 23:22:05.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955166323118080[0;39m <==    Updates: 1
2022-04-22 23:22:05.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955166323118080[0;39m update ends, take 59 millisecs
2022-04-22 23:22:05.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955166574776320[0;39m 生成今日电子书快照开始
2022-04-22 23:22:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955166574776320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:05.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955166574776320[0;39m ==> Parameters: 
2022-04-22 23:22:05.099 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955166574776320[0;39m <==    Updates: 0
2022-04-22 23:22:05.100 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955166574776320[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 23:22:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955187290443776[0;39m 生成今日电子书快照开始
2022-04-22 23:22:10.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955187290443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:10.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955187290443776[0;39m ==> Parameters: 
2022-04-22 23:22:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955187290443776[0;39m <==    Updates: 0
2022-04-22 23:22:10.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955187290443776[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:22:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955208257769472[0;39m 生成今日电子书快照开始
2022-04-22 23:22:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955208257769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955208257769472[0;39m ==> Parameters: 
2022-04-22 23:22:15.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955208257769472[0;39m <==    Updates: 0
2022-04-22 23:22:15.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955208257769472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:22:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955229267038208[0;39m 生成今日电子书快照开始
2022-04-22 23:22:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955229267038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955229267038208[0;39m ==> Parameters: 
2022-04-22 23:22:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955229267038208[0;39m <==    Updates: 0
2022-04-22 23:22:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955229267038208[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:22:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955250234363904[0;39m 生成今日电子书快照开始
2022-04-22 23:22:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955250234363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955250234363904[0;39m ==> Parameters: 
2022-04-22 23:22:25.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955250234363904[0;39m <==    Updates: 0
2022-04-22 23:22:25.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955250234363904[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:22:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955271172329472[0;39m 生成今日电子书快照开始
2022-04-22 23:22:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955271172329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955271172329472[0;39m ==> Parameters: 
2022-04-22 23:22:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955271172329472[0;39m <==    Updates: 0
2022-04-22 23:22:30.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955271172329472[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:22:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955292173209600[0;39m start updating Ebook doc
2022-04-22 23:22:35.041 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955292173209600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:22:35.042 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955292173209600[0;39m ==> Parameters: 
2022-04-22 23:22:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955292173209600[0;39m <==    Updates: 1
2022-04-22 23:22:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955292173209600[0;39m update ends, take 63 millisecs
2022-04-22 23:22:35.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955292445839360[0;39m 生成今日电子书快照开始
2022-04-22 23:22:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955292445839360[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955292445839360[0;39m ==> Parameters: 
2022-04-22 23:22:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955292445839360[0;39m <==    Updates: 0
2022-04-22 23:22:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955292445839360[0;39m 生成今日电子书快照结束，耗时：33毫秒
2022-04-22 23:22:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955313148923904[0;39m 生成今日电子书快照开始
2022-04-22 23:22:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955313148923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955313148923904[0;39m ==> Parameters: 
2022-04-22 23:22:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955313148923904[0;39m <==    Updates: 0
2022-04-22 23:22:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955313148923904[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:22:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955334112055296[0;39m 生成今日电子书快照开始
2022-04-22 23:22:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955334112055296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955334112055296[0;39m ==> Parameters: 
2022-04-22 23:22:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955334112055296[0;39m <==    Updates: 0
2022-04-22 23:22:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955334112055296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:22:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955355058409472[0;39m 生成今日电子书快照开始
2022-04-22 23:22:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955355058409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955355058409472[0;39m ==> Parameters: 
2022-04-22 23:22:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955355058409472[0;39m <==    Updates: 0
2022-04-22 23:22:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955355058409472[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:22:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955376059289600[0;39m 生成今日电子书快照开始
2022-04-22 23:22:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955376059289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:22:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955376059289600[0;39m ==> Parameters: 
2022-04-22 23:22:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955376059289600[0;39m <==    Updates: 0
2022-04-22 23:22:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955376059289600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:23:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955397035003904[0;39m 生成今日电子书快照开始
2022-04-22 23:23:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955397035003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955397035003904[0;39m ==> Parameters: 
2022-04-22 23:23:00.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955397035003904[0;39m <==    Updates: 0
2022-04-22 23:23:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955397035003904[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:23:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955417977163776[0;39m start updating Ebook doc
2022-04-22 23:23:05.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955417977163776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:23:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955417977163776[0;39m ==> Parameters: 
2022-04-22 23:23:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955417977163776[0;39m <==    Updates: 1
2022-04-22 23:23:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955417977163776[0;39m update ends, take 64 millisecs
2022-04-22 23:23:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955418245599232[0;39m 生成今日电子书快照开始
2022-04-22 23:23:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955418245599232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955418245599232[0;39m ==> Parameters: 
2022-04-22 23:23:05.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955418245599232[0;39m <==    Updates: 0
2022-04-22 23:23:05.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955418245599232[0;39m 生成今日电子书快照结束，耗时：36毫秒
2022-04-22 23:23:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955438982238208[0;39m 生成今日电子书快照开始
2022-04-22 23:23:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955438982238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:10.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955438982238208[0;39m ==> Parameters: 
2022-04-22 23:23:10.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955438982238208[0;39m <==    Updates: 0
2022-04-22 23:23:10.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955438982238208[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:23:15.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955459949563904[0;39m 生成今日电子书快照开始
2022-04-22 23:23:15.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955459949563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:15.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955459949563904[0;39m ==> Parameters: 
2022-04-22 23:23:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955459949563904[0;39m <==    Updates: 0
2022-04-22 23:23:15.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955459949563904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:23:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955480925278208[0;39m 生成今日电子书快照开始
2022-04-22 23:23:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955480925278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955480925278208[0;39m ==> Parameters: 
2022-04-22 23:23:20.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955480925278208[0;39m <==    Updates: 0
2022-04-22 23:23:20.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955480925278208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:23:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955501867438080[0;39m 生成今日电子书快照开始
2022-04-22 23:23:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955501867438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955501867438080[0;39m ==> Parameters: 
2022-04-22 23:23:25.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955501867438080[0;39m <==    Updates: 0
2022-04-22 23:23:25.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955501867438080[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:23:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955522859929600[0;39m 生成今日电子书快照开始
2022-04-22 23:23:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955522859929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:30.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955522859929600[0;39m ==> Parameters: 
2022-04-22 23:23:30.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955522859929600[0;39m <==    Updates: 0
2022-04-22 23:23:30.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955522859929600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:23:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955543839838208[0;39m 生成今日电子书快照开始
2022-04-22 23:23:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955543839838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:35.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955543839838208[0;39m ==> Parameters: 
2022-04-22 23:23:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955543839838208[0;39m <==    Updates: 0
2022-04-22 23:23:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955543839838208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:23:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955544099885056[0;39m start updating Ebook doc
2022-04-22 23:23:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955544099885056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:23:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955544099885056[0;39m ==> Parameters: 
2022-04-22 23:23:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955544099885056[0;39m <==    Updates: 1
2022-04-22 23:23:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955544099885056[0;39m update ends, take 40 millisecs
2022-04-22 23:23:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955564807163904[0;39m 生成今日电子书快照开始
2022-04-22 23:23:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955564807163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955564807163904[0;39m ==> Parameters: 
2022-04-22 23:23:40.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955564807163904[0;39m <==    Updates: 0
2022-04-22 23:23:40.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955564807163904[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:23:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955585770295296[0;39m 生成今日电子书快照开始
2022-04-22 23:23:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955585770295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955585770295296[0;39m ==> Parameters: 
2022-04-22 23:23:45.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955585770295296[0;39m <==    Updates: 0
2022-04-22 23:23:45.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955585770295296[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:23:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955606750203904[0;39m 生成今日电子书快照开始
2022-04-22 23:23:50.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955606750203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955606750203904[0;39m ==> Parameters: 
2022-04-22 23:23:50.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955606750203904[0;39m <==    Updates: 0
2022-04-22 23:23:50.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955606750203904[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:23:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955627692363776[0;39m 生成今日电子书快照开始
2022-04-22 23:23:55.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955627692363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:23:55.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955627692363776[0;39m ==> Parameters: 
2022-04-22 23:23:55.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955627692363776[0;39m <==    Updates: 0
2022-04-22 23:23:55.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955627692363776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:24:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955648680660992[0;39m 生成今日电子书快照开始
2022-04-22 23:24:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955648680660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955648680660992[0;39m ==> Parameters: 
2022-04-22 23:24:00.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955648680660992[0;39m <==    Updates: 0
2022-04-22 23:24:00.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955648680660992[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:24:05.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955669673152512[0;39m 生成今日电子书快照开始
2022-04-22 23:24:05.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955669673152512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:05.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955669673152512[0;39m ==> Parameters: 
2022-04-22 23:24:05.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955669673152512[0;39m <==    Updates: 0
2022-04-22 23:24:05.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955669673152512[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:24:05.082 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955669970948096[0;39m start updating Ebook doc
2022-04-22 23:24:05.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955669970948096[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:24:05.083 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955669970948096[0;39m ==> Parameters: 
2022-04-22 23:24:05.126 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955669970948096[0;39m <==    Updates: 1
2022-04-22 23:24:05.126 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955669970948096[0;39m update ends, take 44 millisecs
2022-04-22 23:24:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955690632089600[0;39m 生成今日电子书快照开始
2022-04-22 23:24:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955690632089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955690632089600[0;39m ==> Parameters: 
2022-04-22 23:24:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955690632089600[0;39m <==    Updates: 0
2022-04-22 23:24:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955690632089600[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:24:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955711591026688[0;39m 生成今日电子书快照开始
2022-04-22 23:24:15.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955711591026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:15.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955711591026688[0;39m ==> Parameters: 
2022-04-22 23:24:15.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955711591026688[0;39m <==    Updates: 0
2022-04-22 23:24:15.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955711591026688[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:24:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955732545769472[0;39m 生成今日电子书快照开始
2022-04-22 23:24:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955732545769472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955732545769472[0;39m ==> Parameters: 
2022-04-22 23:24:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955732545769472[0;39m <==    Updates: 0
2022-04-22 23:24:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955732545769472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:24:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955753534066688[0;39m 生成今日电子书快照开始
2022-04-22 23:24:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955753534066688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955753534066688[0;39m ==> Parameters: 
2022-04-22 23:24:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955753534066688[0;39m <==    Updates: 0
2022-04-22 23:24:25.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955753534066688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:24:30.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955774493003776[0;39m 生成今日电子书快照开始
2022-04-22 23:24:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955774493003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955774493003776[0;39m ==> Parameters: 
2022-04-22 23:24:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955774493003776[0;39m <==    Updates: 0
2022-04-22 23:24:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955774493003776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:24:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955795489689600[0;39m 生成今日电子书快照开始
2022-04-22 23:24:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955795489689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955795489689600[0;39m ==> Parameters: 
2022-04-22 23:24:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955795489689600[0;39m <==    Updates: 0
2022-04-22 23:24:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955795489689600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:24:35.077 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955795779096576[0;39m start updating Ebook doc
2022-04-22 23:24:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955795779096576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:24:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955795779096576[0;39m ==> Parameters: 
2022-04-22 23:24:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955795779096576[0;39m <==    Updates: 1
2022-04-22 23:24:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955795779096576[0;39m update ends, take 35 millisecs
2022-04-22 23:24:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955816461209600[0;39m 生成今日电子书快照开始
2022-04-22 23:24:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955816461209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955816461209600[0;39m ==> Parameters: 
2022-04-22 23:24:40.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955816461209600[0;39m <==    Updates: 0
2022-04-22 23:24:40.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955816461209600[0;39m 生成今日电子书快照结束，耗时：87毫秒
2022-04-22 23:24:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955837441118208[0;39m 生成今日电子书快照开始
2022-04-22 23:24:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955837441118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955837441118208[0;39m ==> Parameters: 
2022-04-22 23:24:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955837441118208[0;39m <==    Updates: 0
2022-04-22 23:24:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955837441118208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:24:50.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955858370695168[0;39m 生成今日电子书快照开始
2022-04-22 23:24:50.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955858370695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:50.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955858370695168[0;39m ==> Parameters: 
2022-04-22 23:24:50.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955858370695168[0;39m <==    Updates: 0
2022-04-22 23:24:50.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955858370695168[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:24:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955879379963904[0;39m 生成今日电子书快照开始
2022-04-22 23:24:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955879379963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:24:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955879379963904[0;39m ==> Parameters: 
2022-04-22 23:24:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955879379963904[0;39m <==    Updates: 0
2022-04-22 23:24:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955879379963904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:25:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955900343095296[0;39m 生成今日电子书快照开始
2022-04-22 23:25:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955900343095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955900343095296[0;39m ==> Parameters: 
2022-04-22 23:25:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955900343095296[0;39m <==    Updates: 0
2022-04-22 23:25:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955900343095296[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:25:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955921327198208[0;39m 生成今日电子书快照开始
2022-04-22 23:25:05.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955921327198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:05.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955921327198208[0;39m ==> Parameters: 
2022-04-22 23:25:05.254 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955921327198208[0;39m <==    Updates: 0
2022-04-22 23:25:05.254 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955921327198208[0;39m 生成今日电子书快照结束，耗时：243毫秒
2022-04-22 23:25:05.254 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172955922350608384[0;39m start updating Ebook doc
2022-04-22 23:25:05.254 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955922350608384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:25:05.255 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955922350608384[0;39m ==> Parameters: 
2022-04-22 23:25:05.291 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172955922350608384[0;39m <==    Updates: 1
2022-04-22 23:25:05.292 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172955922350608384[0;39m update ends, take 38 millisecs
2022-04-22 23:25:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955942298718208[0;39m 生成今日电子书快照开始
2022-04-22 23:25:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955942298718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955942298718208[0;39m ==> Parameters: 
2022-04-22 23:25:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955942298718208[0;39m <==    Updates: 0
2022-04-22 23:25:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955942298718208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:25:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955963232489472[0;39m 生成今日电子书快照开始
2022-04-22 23:25:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955963232489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955963232489472[0;39m ==> Parameters: 
2022-04-22 23:25:15.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955963232489472[0;39m <==    Updates: 0
2022-04-22 23:25:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955963232489472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:25:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172955984237563904[0;39m 生成今日电子书快照开始
2022-04-22 23:25:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955984237563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955984237563904[0;39m ==> Parameters: 
2022-04-22 23:25:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172955984237563904[0;39m <==    Updates: 0
2022-04-22 23:25:20.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172955984237563904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:25:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956005213278208[0;39m 生成今日电子书快照开始
2022-04-22 23:25:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956005213278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956005213278208[0;39m ==> Parameters: 
2022-04-22 23:25:25.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956005213278208[0;39m <==    Updates: 0
2022-04-22 23:25:25.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956005213278208[0;39m 生成今日电子书快照结束，耗时：91毫秒
2022-04-22 23:25:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956026172215296[0;39m 生成今日电子书快照开始
2022-04-22 23:25:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956026172215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956026172215296[0;39m ==> Parameters: 
2022-04-22 23:25:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956026172215296[0;39m <==    Updates: 0
2022-04-22 23:25:30.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956026172215296[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:25:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956047139540992[0;39m 生成今日电子书快照开始
2022-04-22 23:25:35.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956047139540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:35.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956047139540992[0;39m ==> Parameters: 
2022-04-22 23:25:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956047139540992[0;39m <==    Updates: 0
2022-04-22 23:25:35.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956047139540992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:25:35.073 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956047420559360[0;39m start updating Ebook doc
2022-04-22 23:25:35.073 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956047420559360[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:25:35.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956047420559360[0;39m ==> Parameters: 
2022-04-22 23:25:35.117 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956047420559360[0;39m <==    Updates: 1
2022-04-22 23:25:35.117 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956047420559360[0;39m update ends, take 44 millisecs
2022-04-22 23:25:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956068094283776[0;39m 生成今日电子书快照开始
2022-04-22 23:25:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956068094283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956068094283776[0;39m ==> Parameters: 
2022-04-22 23:25:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956068094283776[0;39m <==    Updates: 0
2022-04-22 23:25:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956068094283776[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:25:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956089074192384[0;39m 生成今日电子书快照开始
2022-04-22 23:25:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956089074192384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956089074192384[0;39m ==> Parameters: 
2022-04-22 23:25:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956089074192384[0;39m <==    Updates: 0
2022-04-22 23:25:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956089074192384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:25:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956110058295296[0;39m 生成今日电子书快照开始
2022-04-22 23:25:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956110058295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956110058295296[0;39m ==> Parameters: 
2022-04-22 23:25:50.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956110058295296[0;39m <==    Updates: 0
2022-04-22 23:25:50.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956110058295296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:25:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956131029815296[0;39m 生成今日电子书快照开始
2022-04-22 23:25:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956131029815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:25:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956131029815296[0;39m ==> Parameters: 
2022-04-22 23:25:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956131029815296[0;39m <==    Updates: 0
2022-04-22 23:25:55.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956131029815296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:26:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956151980363776[0;39m 生成今日电子书快照开始
2022-04-22 23:26:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956151980363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956151980363776[0;39m ==> Parameters: 
2022-04-22 23:26:00.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956151980363776[0;39m <==    Updates: 0
2022-04-22 23:26:00.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956151980363776[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:26:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956172968660992[0;39m 生成今日电子书快照开始
2022-04-22 23:26:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956172968660992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956172968660992[0;39m ==> Parameters: 
2022-04-22 23:26:05.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956172968660992[0;39m <==    Updates: 0
2022-04-22 23:26:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956172968660992[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:26:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956173228707840[0;39m start updating Ebook doc
2022-04-22 23:26:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956173228707840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:26:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956173228707840[0;39m ==> Parameters: 
2022-04-22 23:26:05.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956173228707840[0;39m <==    Updates: 1
2022-04-22 23:26:05.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956173228707840[0;39m update ends, take 33 millisecs
2022-04-22 23:26:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956193931792384[0;39m 生成今日电子书快照开始
2022-04-22 23:26:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956193931792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956193931792384[0;39m ==> Parameters: 
2022-04-22 23:26:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956193931792384[0;39m <==    Updates: 0
2022-04-22 23:26:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956193931792384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:26:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956214911700992[0;39m 生成今日电子书快照开始
2022-04-22 23:26:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956214911700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956214911700992[0;39m ==> Parameters: 
2022-04-22 23:26:15.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956214911700992[0;39m <==    Updates: 0
2022-04-22 23:26:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956214911700992[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:26:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956235899998208[0;39m 生成今日电子书快照开始
2022-04-22 23:26:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956235899998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956235899998208[0;39m ==> Parameters: 
2022-04-22 23:26:20.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956235899998208[0;39m <==    Updates: 0
2022-04-22 23:26:20.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956235899998208[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:26:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956256837963776[0;39m 生成今日电子书快照开始
2022-04-22 23:26:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956256837963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956256837963776[0;39m ==> Parameters: 
2022-04-22 23:26:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956256837963776[0;39m <==    Updates: 0
2022-04-22 23:26:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956256837963776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:26:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956277838843904[0;39m 生成今日电子书快照开始
2022-04-22 23:26:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956277838843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956277838843904[0;39m ==> Parameters: 
2022-04-22 23:26:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956277838843904[0;39m <==    Updates: 0
2022-04-22 23:26:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956277838843904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:26:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956298810363904[0;39m start updating Ebook doc
2022-04-22 23:26:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956298810363904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:26:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956298810363904[0;39m ==> Parameters: 
2022-04-22 23:26:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956298810363904[0;39m <==    Updates: 1
2022-04-22 23:26:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956298810363904[0;39m update ends, take 66 millisecs
2022-04-22 23:26:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956299087187968[0;39m 生成今日电子书快照开始
2022-04-22 23:26:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956299087187968[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956299087187968[0;39m ==> Parameters: 
2022-04-22 23:26:35.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956299087187968[0;39m <==    Updates: 0
2022-04-22 23:26:35.114 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956299087187968[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:26:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956319781883904[0;39m 生成今日电子书快照开始
2022-04-22 23:26:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956319781883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956319781883904[0;39m ==> Parameters: 
2022-04-22 23:26:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956319781883904[0;39m <==    Updates: 0
2022-04-22 23:26:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956319781883904[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:26:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956340715655168[0;39m 生成今日电子书快照开始
2022-04-22 23:26:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956340715655168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956340715655168[0;39m ==> Parameters: 
2022-04-22 23:26:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956340715655168[0;39m <==    Updates: 0
2022-04-22 23:26:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956340715655168[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:26:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956361720729600[0;39m 生成今日电子书快照开始
2022-04-22 23:26:50.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956361720729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:50.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956361720729600[0;39m ==> Parameters: 
2022-04-22 23:26:50.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956361720729600[0;39m <==    Updates: 0
2022-04-22 23:26:50.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956361720729600[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-22 23:26:55.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956382658695168[0;39m 生成今日电子书快照开始
2022-04-22 23:26:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956382658695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:26:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956382658695168[0;39m ==> Parameters: 
2022-04-22 23:26:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956382658695168[0;39m <==    Updates: 0
2022-04-22 23:26:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956382658695168[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:27:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956403655380992[0;39m 生成今日电子书快照开始
2022-04-22 23:27:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956403655380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956403655380992[0;39m ==> Parameters: 
2022-04-22 23:27:00.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956403655380992[0;39m <==    Updates: 0
2022-04-22 23:27:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956403655380992[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:27:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956424618512384[0;39m 生成今日电子书快照开始
2022-04-22 23:27:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956424618512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956424618512384[0;39m ==> Parameters: 
2022-04-22 23:27:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956424618512384[0;39m <==    Updates: 0
2022-04-22 23:27:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956424618512384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:27:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956424920502272[0;39m start updating Ebook doc
2022-04-22 23:27:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956424920502272[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:27:05.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956424920502272[0;39m ==> Parameters: 
2022-04-22 23:27:05.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956424920502272[0;39m <==    Updates: 1
2022-04-22 23:27:05.119 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956424920502272[0;39m update ends, take 43 millisecs
2022-04-22 23:27:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956445577449472[0;39m 生成今日电子书快照开始
2022-04-22 23:27:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956445577449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956445577449472[0;39m ==> Parameters: 
2022-04-22 23:27:10.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956445577449472[0;39m <==    Updates: 0
2022-04-22 23:27:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956445577449472[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:27:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956466565746688[0;39m 生成今日电子书快照开始
2022-04-22 23:27:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956466565746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956466565746688[0;39m ==> Parameters: 
2022-04-22 23:27:15.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956466565746688[0;39m <==    Updates: 0
2022-04-22 23:27:15.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956466565746688[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:27:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956487524683776[0;39m 生成今日电子书快照开始
2022-04-22 23:27:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956487524683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956487524683776[0;39m ==> Parameters: 
2022-04-22 23:27:20.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956487524683776[0;39m <==    Updates: 0
2022-04-22 23:27:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956487524683776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:27:25.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956508487815168[0;39m 生成今日电子书快照开始
2022-04-22 23:27:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956508487815168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956508487815168[0;39m ==> Parameters: 
2022-04-22 23:27:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956508487815168[0;39m <==    Updates: 0
2022-04-22 23:27:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956508487815168[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:27:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956529480306688[0;39m 生成今日电子书快照开始
2022-04-22 23:27:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956529480306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956529480306688[0;39m ==> Parameters: 
2022-04-22 23:27:30.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956529480306688[0;39m <==    Updates: 0
2022-04-22 23:27:30.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956529480306688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:27:35.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956550447632384[0;39m 生成今日电子书快照开始
2022-04-22 23:27:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956550447632384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956550447632384[0;39m ==> Parameters: 
2022-04-22 23:27:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956550447632384[0;39m <==    Updates: 0
2022-04-22 23:27:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956550447632384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:27:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956550711873536[0;39m start updating Ebook doc
2022-04-22 23:27:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956550711873536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:27:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956550711873536[0;39m ==> Parameters: 
2022-04-22 23:27:35.111 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956550711873536[0;39m <==    Updates: 1
2022-04-22 23:27:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956550711873536[0;39m update ends, take 45 millisecs
2022-04-22 23:27:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956571444318208[0;39m 生成今日电子书快照开始
2022-04-22 23:27:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956571444318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:40.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956571444318208[0;39m ==> Parameters: 
2022-04-22 23:27:40.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956571444318208[0;39m <==    Updates: 0
2022-04-22 23:27:40.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956571444318208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:27:45.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956592373895168[0;39m 生成今日电子书快照开始
2022-04-22 23:27:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956592373895168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956592373895168[0;39m ==> Parameters: 
2022-04-22 23:27:45.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956592373895168[0;39m <==    Updates: 0
2022-04-22 23:27:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956592373895168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:27:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956613378969600[0;39m 生成今日电子书快照开始
2022-04-22 23:27:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956613378969600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956613378969600[0;39m ==> Parameters: 
2022-04-22 23:27:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956613378969600[0;39m <==    Updates: 0
2022-04-22 23:27:50.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956613378969600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:27:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956634350489600[0;39m 生成今日电子书快照开始
2022-04-22 23:27:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956634350489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:27:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956634350489600[0;39m ==> Parameters: 
2022-04-22 23:27:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956634350489600[0;39m <==    Updates: 0
2022-04-22 23:27:55.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956634350489600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:28:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956655301038080[0;39m 生成今日电子书快照开始
2022-04-22 23:28:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956655301038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956655301038080[0;39m ==> Parameters: 
2022-04-22 23:28:00.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956655301038080[0;39m <==    Updates: 0
2022-04-22 23:28:00.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956655301038080[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:28:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956676280946688[0;39m start updating Ebook doc
2022-04-22 23:28:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956676280946688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:28:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956676280946688[0;39m ==> Parameters: 
2022-04-22 23:28:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956676280946688[0;39m <==    Updates: 1
2022-04-22 23:28:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956676280946688[0;39m update ends, take 61 millisecs
2022-04-22 23:28:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956676536799232[0;39m 生成今日电子书快照开始
2022-04-22 23:28:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956676536799232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956676536799232[0;39m ==> Parameters: 
2022-04-22 23:28:05.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956676536799232[0;39m <==    Updates: 0
2022-04-22 23:28:05.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956676536799232[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-22 23:28:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956697244078080[0;39m 生成今日电子书快照开始
2022-04-22 23:28:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956697244078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956697244078080[0;39m ==> Parameters: 
2022-04-22 23:28:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956697244078080[0;39m <==    Updates: 0
2022-04-22 23:28:10.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956697244078080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:28:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956718232375296[0;39m 生成今日电子书快照开始
2022-04-22 23:28:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956718232375296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956718232375296[0;39m ==> Parameters: 
2022-04-22 23:28:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956718232375296[0;39m <==    Updates: 0
2022-04-22 23:28:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956718232375296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:28:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956739191312384[0;39m 生成今日电子书快照开始
2022-04-22 23:28:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956739191312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956739191312384[0;39m ==> Parameters: 
2022-04-22 23:28:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956739191312384[0;39m <==    Updates: 0
2022-04-22 23:28:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956739191312384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:28:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956760183803904[0;39m 生成今日电子书快照开始
2022-04-22 23:28:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956760183803904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956760183803904[0;39m ==> Parameters: 
2022-04-22 23:28:25.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956760183803904[0;39m <==    Updates: 0
2022-04-22 23:28:25.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956760183803904[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:28:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956781155323904[0;39m 生成今日电子书快照开始
2022-04-22 23:28:30.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956781155323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:30.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956781155323904[0;39m ==> Parameters: 
2022-04-22 23:28:30.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956781155323904[0;39m <==    Updates: 0
2022-04-22 23:28:30.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956781155323904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:28:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956802131038208[0;39m 生成今日电子书快照开始
2022-04-22 23:28:35.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956802131038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:35.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956802131038208[0;39m ==> Parameters: 
2022-04-22 23:28:35.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956802131038208[0;39m <==    Updates: 0
2022-04-22 23:28:35.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956802131038208[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:28:35.085 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956802445611008[0;39m start updating Ebook doc
2022-04-22 23:28:35.085 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956802445611008[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:28:35.086 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956802445611008[0;39m ==> Parameters: 
2022-04-22 23:28:35.122 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956802445611008[0;39m <==    Updates: 1
2022-04-22 23:28:35.122 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956802445611008[0;39m update ends, take 37 millisecs
2022-04-22 23:28:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956823073198080[0;39m 生成今日电子书快照开始
2022-04-22 23:28:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956823073198080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956823073198080[0;39m ==> Parameters: 
2022-04-22 23:28:40.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956823073198080[0;39m <==    Updates: 0
2022-04-22 23:28:40.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956823073198080[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 23:28:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956844069883904[0;39m 生成今日电子书快照开始
2022-04-22 23:28:45.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956844069883904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:45.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956844069883904[0;39m ==> Parameters: 
2022-04-22 23:28:45.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956844069883904[0;39m <==    Updates: 0
2022-04-22 23:28:45.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956844069883904[0;39m 生成今日电子书快照结束，耗时：91毫秒
2022-04-22 23:28:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956865024626688[0;39m 生成今日电子书快照开始
2022-04-22 23:28:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956865024626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956865024626688[0;39m ==> Parameters: 
2022-04-22 23:28:50.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956865024626688[0;39m <==    Updates: 0
2022-04-22 23:28:50.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956865024626688[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:28:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956885983563776[0;39m 生成今日电子书快照开始
2022-04-22 23:28:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956885983563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:28:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956885983563776[0;39m ==> Parameters: 
2022-04-22 23:28:55.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956885983563776[0;39m <==    Updates: 0
2022-04-22 23:28:55.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956885983563776[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:29:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956906955083776[0;39m 生成今日电子书快照开始
2022-04-22 23:29:00.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956906955083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956906955083776[0;39m ==> Parameters: 
2022-04-22 23:29:00.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956906955083776[0;39m <==    Updates: 0
2022-04-22 23:29:00.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956906955083776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:29:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956927951769600[0;39m 生成今日电子书快照开始
2022-04-22 23:29:05.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956927951769600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:05.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956927951769600[0;39m ==> Parameters: 
2022-04-22 23:29:05.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956927951769600[0;39m <==    Updates: 0
2022-04-22 23:29:05.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956927951769600[0;39m 生成今日电子书快照结束，耗时：84毫秒
2022-04-22 23:29:05.092 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172956928304091136[0;39m start updating Ebook doc
2022-04-22 23:29:05.092 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956928304091136[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:29:05.092 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956928304091136[0;39m ==> Parameters: 
2022-04-22 23:29:05.131 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172956928304091136[0;39m <==    Updates: 1
2022-04-22 23:29:05.131 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172956928304091136[0;39m update ends, take 39 millisecs
2022-04-22 23:29:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956948910706688[0;39m 生成今日电子书快照开始
2022-04-22 23:29:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956948910706688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956948910706688[0;39m ==> Parameters: 
2022-04-22 23:29:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956948910706688[0;39m <==    Updates: 0
2022-04-22 23:29:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956948910706688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:29:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956969890615296[0;39m 生成今日电子书快照开始
2022-04-22 23:29:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956969890615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956969890615296[0;39m ==> Parameters: 
2022-04-22 23:29:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956969890615296[0;39m <==    Updates: 0
2022-04-22 23:29:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956969890615296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:29:20.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172956990845358080[0;39m 生成今日电子书快照开始
2022-04-22 23:29:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956990845358080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956990845358080[0;39m ==> Parameters: 
2022-04-22 23:29:20.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172956990845358080[0;39m <==    Updates: 0
2022-04-22 23:29:20.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172956990845358080[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:29:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957011812683776[0;39m 生成今日电子书快照开始
2022-04-22 23:29:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957011812683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957011812683776[0;39m ==> Parameters: 
2022-04-22 23:29:25.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957011812683776[0;39m <==    Updates: 0
2022-04-22 23:29:25.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957011812683776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:29:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957032788398080[0;39m 生成今日电子书快照开始
2022-04-22 23:29:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957032788398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957032788398080[0;39m ==> Parameters: 
2022-04-22 23:29:30.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957032788398080[0;39m <==    Updates: 0
2022-04-22 23:29:30.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957032788398080[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:29:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957053776695296[0;39m start updating Ebook doc
2022-04-22 23:29:35.040 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957053776695296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:29:35.040 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957053776695296[0;39m ==> Parameters: 
2022-04-22 23:29:35.086 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957053776695296[0;39m <==    Updates: 1
2022-04-22 23:29:35.086 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957053776695296[0;39m update ends, take 78 millisecs
2022-04-22 23:29:35.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957054108045312[0;39m 生成今日电子书快照开始
2022-04-22 23:29:35.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957054108045312[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:35.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957054108045312[0;39m ==> Parameters: 
2022-04-22 23:29:35.125 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957054108045312[0;39m <==    Updates: 0
2022-04-22 23:29:35.125 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957054108045312[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-22 23:29:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957074718855168[0;39m 生成今日电子书快照开始
2022-04-22 23:29:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957074718855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957074718855168[0;39m ==> Parameters: 
2022-04-22 23:29:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957074718855168[0;39m <==    Updates: 0
2022-04-22 23:29:40.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957074718855168[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:29:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957095698763776[0;39m 生成今日电子书快照开始
2022-04-22 23:29:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957095698763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:45.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957095698763776[0;39m ==> Parameters: 
2022-04-22 23:29:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957095698763776[0;39m <==    Updates: 0
2022-04-22 23:29:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957095698763776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:29:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957116687060992[0;39m 生成今日电子书快照开始
2022-04-22 23:29:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957116687060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957116687060992[0;39m ==> Parameters: 
2022-04-22 23:29:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957116687060992[0;39m <==    Updates: 0
2022-04-22 23:29:50.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957116687060992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:29:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957137645998080[0;39m 生成今日电子书快照开始
2022-04-22 23:29:55.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957137645998080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:29:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957137645998080[0;39m ==> Parameters: 
2022-04-22 23:29:55.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957137645998080[0;39m <==    Updates: 0
2022-04-22 23:29:55.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957137645998080[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:30:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957158613323776[0;39m 生成今日电子书快照开始
2022-04-22 23:30:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957158613323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957158613323776[0;39m ==> Parameters: 
2022-04-22 23:30:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957158613323776[0;39m <==    Updates: 0
2022-04-22 23:30:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957158613323776[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:30:05.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957179610009600[0;39m 生成今日电子书快照开始
2022-04-22 23:30:05.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957179610009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:05.143 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957179610009600[0;39m ==> Parameters: 
2022-04-22 23:30:05.333 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957179610009600[0;39m <==    Updates: 0
2022-04-22 23:30:05.333 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957179610009600[0;39m 生成今日电子书快照结束，耗时：324毫秒
2022-04-22 23:30:05.333 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957180973158400[0;39m start updating Ebook doc
2022-04-22 23:30:05.334 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957180973158400[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:30:05.334 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957180973158400[0;39m ==> Parameters: 
2022-04-22 23:30:05.500 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957180973158400[0;39m <==    Updates: 1
2022-04-22 23:30:05.500 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957180973158400[0;39m update ends, take 166 millisecs
2022-04-22 23:30:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957200581529600[0;39m 生成今日电子书快照开始
2022-04-22 23:30:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957200581529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957200581529600[0;39m ==> Parameters: 
2022-04-22 23:30:10.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957200581529600[0;39m <==    Updates: 0
2022-04-22 23:30:10.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957200581529600[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:30:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957221553049600[0;39m 生成今日电子书快照开始
2022-04-22 23:30:15.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957221553049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:15.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957221553049600[0;39m ==> Parameters: 
2022-04-22 23:30:15.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957221553049600[0;39m <==    Updates: 0
2022-04-22 23:30:15.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957221553049600[0;39m 生成今日电子书快照结束，耗时：93毫秒
2022-04-22 23:30:20.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957242491015168[0;39m 生成今日电子书快照开始
2022-04-22 23:30:20.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957242491015168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957242491015168[0;39m ==> Parameters: 
2022-04-22 23:30:20.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957242491015168[0;39m <==    Updates: 0
2022-04-22 23:30:20.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957242491015168[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:30:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957263496089600[0;39m 生成今日电子书快照开始
2022-04-22 23:30:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957263496089600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957263496089600[0;39m ==> Parameters: 
2022-04-22 23:30:25.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957263496089600[0;39m <==    Updates: 0
2022-04-22 23:30:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957263496089600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:30:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957284434055168[0;39m 生成今日电子书快照开始
2022-04-22 23:30:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957284434055168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957284434055168[0;39m ==> Parameters: 
2022-04-22 23:30:30.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957284434055168[0;39m <==    Updates: 0
2022-04-22 23:30:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957284434055168[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:30:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957305439129600[0;39m 生成今日电子书快照开始
2022-04-22 23:30:35.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957305439129600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:35.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957305439129600[0;39m ==> Parameters: 
2022-04-22 23:30:35.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957305439129600[0;39m <==    Updates: 0
2022-04-22 23:30:35.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957305439129600[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:30:35.081 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957305745313792[0;39m start updating Ebook doc
2022-04-22 23:30:35.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957305745313792[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:30:35.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957305745313792[0;39m ==> Parameters: 
2022-04-22 23:30:35.126 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957305745313792[0;39m <==    Updates: 1
2022-04-22 23:30:35.127 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957305745313792[0;39m update ends, take 46 millisecs
2022-04-22 23:30:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957326414843904[0;39m 生成今日电子书快照开始
2022-04-22 23:30:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957326414843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957326414843904[0;39m ==> Parameters: 
2022-04-22 23:30:40.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957326414843904[0;39m <==    Updates: 0
2022-04-22 23:30:40.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957326414843904[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-22 23:30:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957347357003776[0;39m 生成今日电子书快照开始
2022-04-22 23:30:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957347357003776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957347357003776[0;39m ==> Parameters: 
2022-04-22 23:30:45.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957347357003776[0;39m <==    Updates: 0
2022-04-22 23:30:45.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957347357003776[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 23:30:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957368362078208[0;39m 生成今日电子书快照开始
2022-04-22 23:30:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957368362078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957368362078208[0;39m ==> Parameters: 
2022-04-22 23:30:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957368362078208[0;39m <==    Updates: 0
2022-04-22 23:30:50.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957368362078208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:30:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957389312626688[0;39m 生成今日电子书快照开始
2022-04-22 23:30:55.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957389312626688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:30:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957389312626688[0;39m ==> Parameters: 
2022-04-22 23:30:55.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957389312626688[0;39m <==    Updates: 0
2022-04-22 23:30:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957389312626688[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:31:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957410288340992[0;39m 生成今日电子书快照开始
2022-04-22 23:31:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957410288340992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957410288340992[0;39m ==> Parameters: 
2022-04-22 23:31:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957410288340992[0;39m <==    Updates: 0
2022-04-22 23:31:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957410288340992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:31:05.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957431238889472[0;39m 生成今日电子书快照开始
2022-04-22 23:31:05.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957431238889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:05.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957431238889472[0;39m ==> Parameters: 
2022-04-22 23:31:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957431238889472[0;39m <==    Updates: 0
2022-04-22 23:31:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957431238889472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:31:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957431519907840[0;39m start updating Ebook doc
2022-04-22 23:31:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957431519907840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:31:05.069 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957431519907840[0;39m ==> Parameters: 
2022-04-22 23:31:05.116 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957431519907840[0;39m <==    Updates: 1
2022-04-22 23:31:05.116 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957431519907840[0;39m update ends, take 48 millisecs
2022-04-22 23:31:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957452248158208[0;39m 生成今日电子书快照开始
2022-04-22 23:31:10.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957452248158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:10.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957452248158208[0;39m ==> Parameters: 
2022-04-22 23:31:10.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957452248158208[0;39m <==    Updates: 0
2022-04-22 23:31:10.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957452248158208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:31:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957473219678208[0;39m 生成今日电子书快照开始
2022-04-22 23:31:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957473219678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:15.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957473219678208[0;39m ==> Parameters: 
2022-04-22 23:31:15.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957473219678208[0;39m <==    Updates: 0
2022-04-22 23:31:15.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957473219678208[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:31:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957494187003904[0;39m 生成今日电子书快照开始
2022-04-22 23:31:20.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957494187003904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:20.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957494187003904[0;39m ==> Parameters: 
2022-04-22 23:31:20.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957494187003904[0;39m <==    Updates: 0
2022-04-22 23:31:20.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957494187003904[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:31:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957515162718208[0;39m 生成今日电子书快照开始
2022-04-22 23:31:25.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957515162718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957515162718208[0;39m ==> Parameters: 
2022-04-22 23:31:25.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957515162718208[0;39m <==    Updates: 0
2022-04-22 23:31:25.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957515162718208[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:31:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957536117460992[0;39m 生成今日电子书快照开始
2022-04-22 23:31:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957536117460992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957536117460992[0;39m ==> Parameters: 
2022-04-22 23:31:30.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957536117460992[0;39m <==    Updates: 0
2022-04-22 23:31:30.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957536117460992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:31:35.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957557084786688[0;39m start updating Ebook doc
2022-04-22 23:31:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957557084786688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:31:35.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957557084786688[0;39m ==> Parameters: 
2022-04-22 23:31:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957557084786688[0;39m <==    Updates: 1
2022-04-22 23:31:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957557084786688[0;39m update ends, take 62 millisecs
2022-04-22 23:31:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957557344833536[0;39m 生成今日电子书快照开始
2022-04-22 23:31:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957557344833536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957557344833536[0;39m ==> Parameters: 
2022-04-22 23:31:35.114 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957557344833536[0;39m <==    Updates: 0
2022-04-22 23:31:35.114 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957557344833536[0;39m 生成今日电子书快照结束，耗时：47毫秒
2022-04-22 23:31:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957578039529472[0;39m 生成今日电子书快照开始
2022-04-22 23:31:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957578039529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:40.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957578039529472[0;39m ==> Parameters: 
2022-04-22 23:31:40.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957578039529472[0;39m <==    Updates: 0
2022-04-22 23:31:40.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957578039529472[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:31:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957599048798208[0;39m 生成今日电子书快照开始
2022-04-22 23:31:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957599048798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:45.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957599048798208[0;39m ==> Parameters: 
2022-04-22 23:31:45.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957599048798208[0;39m <==    Updates: 0
2022-04-22 23:31:45.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957599048798208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:31:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957620003540992[0;39m 生成今日电子书快照开始
2022-04-22 23:31:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957620003540992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957620003540992[0;39m ==> Parameters: 
2022-04-22 23:31:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957620003540992[0;39m <==    Updates: 0
2022-04-22 23:31:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957620003540992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:31:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957640991838208[0;39m 生成今日电子书快照开始
2022-04-22 23:31:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957640991838208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:31:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957640991838208[0;39m ==> Parameters: 
2022-04-22 23:31:55.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957640991838208[0;39m <==    Updates: 0
2022-04-22 23:31:55.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957640991838208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:32:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957661950775296[0;39m 生成今日电子书快照开始
2022-04-22 23:32:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957661950775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957661950775296[0;39m ==> Parameters: 
2022-04-22 23:32:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957661950775296[0;39m <==    Updates: 0
2022-04-22 23:32:00.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957661950775296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:32:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957682934878208[0;39m 生成今日电子书快照开始
2022-04-22 23:32:05.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957682934878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:05.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957682934878208[0;39m ==> Parameters: 
2022-04-22 23:32:05.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957682934878208[0;39m <==    Updates: 0
2022-04-22 23:32:05.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957682934878208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:32:05.084 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957683245256704[0;39m start updating Ebook doc
2022-04-22 23:32:05.084 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957683245256704[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:32:05.084 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957683245256704[0;39m ==> Parameters: 
2022-04-22 23:32:05.126 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957683245256704[0;39m <==    Updates: 1
2022-04-22 23:32:05.126 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957683245256704[0;39m update ends, take 42 millisecs
2022-04-22 23:32:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957703902203904[0;39m 生成今日电子书快照开始
2022-04-22 23:32:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957703902203904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957703902203904[0;39m ==> Parameters: 
2022-04-22 23:32:10.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957703902203904[0;39m <==    Updates: 0
2022-04-22 23:32:10.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957703902203904[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:32:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957724844363776[0;39m 生成今日电子书快照开始
2022-04-22 23:32:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957724844363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957724844363776[0;39m ==> Parameters: 
2022-04-22 23:32:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957724844363776[0;39m <==    Updates: 0
2022-04-22 23:32:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957724844363776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:32:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957745815883776[0;39m 生成今日电子书快照开始
2022-04-22 23:32:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957745815883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957745815883776[0;39m ==> Parameters: 
2022-04-22 23:32:20.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957745815883776[0;39m <==    Updates: 0
2022-04-22 23:32:20.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957745815883776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:32:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957766799986688[0;39m 生成今日电子书快照开始
2022-04-22 23:32:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957766799986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957766799986688[0;39m ==> Parameters: 
2022-04-22 23:32:25.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957766799986688[0;39m <==    Updates: 0
2022-04-22 23:32:25.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957766799986688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:32:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957787767312384[0;39m 生成今日电子书快照开始
2022-04-22 23:32:30.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957787767312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957787767312384[0;39m ==> Parameters: 
2022-04-22 23:32:30.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957787767312384[0;39m <==    Updates: 0
2022-04-22 23:32:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957787767312384[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:32:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957808734638080[0;39m 生成今日电子书快照开始
2022-04-22 23:32:35.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957808734638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:35.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957808734638080[0;39m ==> Parameters: 
2022-04-22 23:32:35.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957808734638080[0;39m <==    Updates: 0
2022-04-22 23:32:35.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957808734638080[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-22 23:32:35.087 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957809086959616[0;39m start updating Ebook doc
2022-04-22 23:32:35.087 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957809086959616[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:32:35.087 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957809086959616[0;39m ==> Parameters: 
2022-04-22 23:32:35.123 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957809086959616[0;39m <==    Updates: 1
2022-04-22 23:32:35.123 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957809086959616[0;39m update ends, take 36 millisecs
2022-04-22 23:32:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957829706158080[0;39m 生成今日电子书快照开始
2022-04-22 23:32:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957829706158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957829706158080[0;39m ==> Parameters: 
2022-04-22 23:32:40.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957829706158080[0;39m <==    Updates: 0
2022-04-22 23:32:40.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957829706158080[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 23:32:45.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957850694455296[0;39m 生成今日电子书快照开始
2022-04-22 23:32:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957850694455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957850694455296[0;39m ==> Parameters: 
2022-04-22 23:32:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957850694455296[0;39m <==    Updates: 0
2022-04-22 23:32:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957850694455296[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:32:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957871678558208[0;39m 生成今日电子书快照开始
2022-04-22 23:32:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957871678558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957871678558208[0;39m ==> Parameters: 
2022-04-22 23:32:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957871678558208[0;39m <==    Updates: 0
2022-04-22 23:32:50.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957871678558208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:32:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957892650078208[0;39m 生成今日电子书快照开始
2022-04-22 23:32:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957892650078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:32:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957892650078208[0;39m ==> Parameters: 
2022-04-22 23:32:55.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957892650078208[0;39m <==    Updates: 0
2022-04-22 23:32:55.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957892650078208[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:33:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957913588043776[0;39m 生成今日电子书快照开始
2022-04-22 23:33:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957913588043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957913588043776[0;39m ==> Parameters: 
2022-04-22 23:33:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957913588043776[0;39m <==    Updates: 0
2022-04-22 23:33:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957913588043776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:33:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957934593118208[0;39m 生成今日电子书快照开始
2022-04-22 23:33:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957934593118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957934593118208[0;39m ==> Parameters: 
2022-04-22 23:33:05.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957934593118208[0;39m <==    Updates: 0
2022-04-22 23:33:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957934593118208[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:33:05.071 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172957934848970752[0;39m start updating Ebook doc
2022-04-22 23:33:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957934848970752[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:33:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957934848970752[0;39m ==> Parameters: 
2022-04-22 23:33:05.113 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172957934848970752[0;39m <==    Updates: 1
2022-04-22 23:33:05.114 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172957934848970752[0;39m update ends, take 43 millisecs
2022-04-22 23:33:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957955556249600[0;39m 生成今日电子书快照开始
2022-04-22 23:33:10.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957955556249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:10.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957955556249600[0;39m ==> Parameters: 
2022-04-22 23:33:10.090 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957955556249600[0;39m <==    Updates: 0
2022-04-22 23:33:10.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957955556249600[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 23:33:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957976519380992[0;39m 生成今日电子书快照开始
2022-04-22 23:33:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957976519380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957976519380992[0;39m ==> Parameters: 
2022-04-22 23:33:15.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957976519380992[0;39m <==    Updates: 0
2022-04-22 23:33:15.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957976519380992[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:33:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172957997495095296[0;39m 生成今日电子书快照开始
2022-04-22 23:33:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957997495095296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957997495095296[0;39m ==> Parameters: 
2022-04-22 23:33:20.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172957997495095296[0;39m <==    Updates: 0
2022-04-22 23:33:20.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172957997495095296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:33:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958018449838080[0;39m 生成今日电子书快照开始
2022-04-22 23:33:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958018449838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958018449838080[0;39m ==> Parameters: 
2022-04-22 23:33:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958018449838080[0;39m <==    Updates: 0
2022-04-22 23:33:25.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958018449838080[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:33:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958039450718208[0;39m 生成今日电子书快照开始
2022-04-22 23:33:30.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958039450718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:30.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958039450718208[0;39m ==> Parameters: 
2022-04-22 23:33:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958039450718208[0;39m <==    Updates: 0
2022-04-22 23:33:30.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958039450718208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:33:35.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958060397072384[0;39m start updating Ebook doc
2022-04-22 23:33:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958060397072384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:33:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958060397072384[0;39m ==> Parameters: 
2022-04-22 23:33:35.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958060397072384[0;39m <==    Updates: 1
2022-04-22 23:33:35.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958060397072384[0;39m update ends, take 61 millisecs
2022-04-22 23:33:35.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958060657119232[0;39m 生成今日电子书快照开始
2022-04-22 23:33:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958060657119232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958060657119232[0;39m ==> Parameters: 
2022-04-22 23:33:35.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958060657119232[0;39m <==    Updates: 0
2022-04-22 23:33:35.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958060657119232[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-22 23:33:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958081360203776[0;39m 生成今日电子书快照开始
2022-04-22 23:33:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958081360203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958081360203776[0;39m ==> Parameters: 
2022-04-22 23:33:40.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958081360203776[0;39m <==    Updates: 0
2022-04-22 23:33:40.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958081360203776[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:33:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958102344306688[0;39m 生成今日电子书快照开始
2022-04-22 23:33:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958102344306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958102344306688[0;39m ==> Parameters: 
2022-04-22 23:33:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958102344306688[0;39m <==    Updates: 0
2022-04-22 23:33:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958102344306688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:33:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958123320020992[0;39m 生成今日电子书快照开始
2022-04-22 23:33:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958123320020992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958123320020992[0;39m ==> Parameters: 
2022-04-22 23:33:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958123320020992[0;39m <==    Updates: 0
2022-04-22 23:33:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958123320020992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:33:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958144308318208[0;39m 生成今日电子书快照开始
2022-04-22 23:33:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958144308318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:33:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958144308318208[0;39m ==> Parameters: 
2022-04-22 23:33:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958144308318208[0;39m <==    Updates: 0
2022-04-22 23:33:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958144308318208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:34:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958165246283776[0;39m 生成今日电子书快照开始
2022-04-22 23:34:00.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958165246283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:00.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958165246283776[0;39m ==> Parameters: 
2022-04-22 23:34:00.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958165246283776[0;39m <==    Updates: 0
2022-04-22 23:34:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958165246283776[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:34:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958186251358208[0;39m start updating Ebook doc
2022-04-22 23:34:05.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958186251358208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:34:05.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958186251358208[0;39m ==> Parameters: 
2022-04-22 23:34:05.074 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958186251358208[0;39m <==    Updates: 1
2022-04-22 23:34:05.074 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958186251358208[0;39m update ends, take 64 millisecs
2022-04-22 23:34:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958186523987968[0;39m 生成今日电子书快照开始
2022-04-22 23:34:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958186523987968[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:05.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958186523987968[0;39m ==> Parameters: 
2022-04-22 23:34:05.118 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958186523987968[0;39m <==    Updates: 0
2022-04-22 23:34:05.119 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958186523987968[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-22 23:34:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958207201906688[0;39m 生成今日电子书快照开始
2022-04-22 23:34:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958207201906688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958207201906688[0;39m ==> Parameters: 
2022-04-22 23:34:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958207201906688[0;39m <==    Updates: 0
2022-04-22 23:34:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958207201906688[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:34:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958228181815296[0;39m 生成今日电子书快照开始
2022-04-22 23:34:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958228181815296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958228181815296[0;39m ==> Parameters: 
2022-04-22 23:34:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958228181815296[0;39m <==    Updates: 0
2022-04-22 23:34:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958228181815296[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:34:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958249161723904[0;39m 生成今日电子书快照开始
2022-04-22 23:34:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958249161723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958249161723904[0;39m ==> Parameters: 
2022-04-22 23:34:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958249161723904[0;39m <==    Updates: 0
2022-04-22 23:34:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958249161723904[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:34:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958270133243904[0;39m 生成今日电子书快照开始
2022-04-22 23:34:25.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958270133243904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:25.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958270133243904[0;39m ==> Parameters: 
2022-04-22 23:34:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958270133243904[0;39m <==    Updates: 0
2022-04-22 23:34:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958270133243904[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:34:30.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958291100569600[0;39m 生成今日电子书快照开始
2022-04-22 23:34:30.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958291100569600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:30.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958291100569600[0;39m ==> Parameters: 
2022-04-22 23:34:30.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958291100569600[0;39m <==    Updates: 0
2022-04-22 23:34:30.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958291100569600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:34:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958312046923776[0;39m start updating Ebook doc
2022-04-22 23:34:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958312046923776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:34:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958312046923776[0;39m ==> Parameters: 
2022-04-22 23:34:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958312046923776[0;39m <==    Updates: 1
2022-04-22 23:34:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958312046923776[0;39m update ends, take 67 millisecs
2022-04-22 23:34:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958312332136448[0;39m 生成今日电子书快照开始
2022-04-22 23:34:35.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958312332136448[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958312332136448[0;39m ==> Parameters: 
2022-04-22 23:34:35.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958312332136448[0;39m <==    Updates: 0
2022-04-22 23:34:35.111 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958312332136448[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 23:34:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958333051998208[0;39m 生成今日电子书快照开始
2022-04-22 23:34:40.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958333051998208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:40.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958333051998208[0;39m ==> Parameters: 
2022-04-22 23:34:40.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958333051998208[0;39m <==    Updates: 0
2022-04-22 23:34:40.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958333051998208[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 23:34:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958354006740992[0;39m 生成今日电子书快照开始
2022-04-22 23:34:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958354006740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958354006740992[0;39m ==> Parameters: 
2022-04-22 23:34:45.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958354006740992[0;39m <==    Updates: 0
2022-04-22 23:34:45.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958354006740992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:34:50.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958374982455296[0;39m 生成今日电子书快照开始
2022-04-22 23:34:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958374982455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958374982455296[0;39m ==> Parameters: 
2022-04-22 23:34:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958374982455296[0;39m <==    Updates: 0
2022-04-22 23:34:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958374982455296[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:34:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958395966558208[0;39m 生成今日电子书快照开始
2022-04-22 23:34:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958395966558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:34:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958395966558208[0;39m ==> Parameters: 
2022-04-22 23:34:55.198 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958395966558208[0;39m <==    Updates: 0
2022-04-22 23:34:55.199 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958395966558208[0;39m 生成今日电子书快照结束，耗时：189毫秒
2022-04-22 23:35:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958416929689600[0;39m 生成今日电子书快照开始
2022-04-22 23:35:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958416929689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958416929689600[0;39m ==> Parameters: 
2022-04-22 23:35:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958416929689600[0;39m <==    Updates: 0
2022-04-22 23:35:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958416929689600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:35:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958437909598208[0;39m start updating Ebook doc
2022-04-22 23:35:05.118 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958437909598208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:35:05.119 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958437909598208[0;39m ==> Parameters: 
2022-04-22 23:35:05.282 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958437909598208[0;39m <==    Updates: 1
2022-04-22 23:35:05.282 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958437909598208[0;39m update ends, take 272 millisecs
2022-04-22 23:35:05.282 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958439050448896[0;39m 生成今日电子书快照开始
2022-04-22 23:35:05.283 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958439050448896[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:05.283 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958439050448896[0;39m ==> Parameters: 
2022-04-22 23:35:05.320 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958439050448896[0;39m <==    Updates: 0
2022-04-22 23:35:05.321 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958439050448896[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:35:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958458872729600[0;39m 生成今日电子书快照开始
2022-04-22 23:35:10.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958458872729600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958458872729600[0;39m ==> Parameters: 
2022-04-22 23:35:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958458872729600[0;39m <==    Updates: 0
2022-04-22 23:35:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958458872729600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:35:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958479844249600[0;39m 生成今日电子书快照开始
2022-04-22 23:35:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958479844249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958479844249600[0;39m ==> Parameters: 
2022-04-22 23:35:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958479844249600[0;39m <==    Updates: 0
2022-04-22 23:35:15.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958479844249600[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:35:20.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958500807380992[0;39m 生成今日电子书快照开始
2022-04-22 23:35:20.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958500807380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:20.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958500807380992[0;39m ==> Parameters: 
2022-04-22 23:35:20.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958500807380992[0;39m <==    Updates: 0
2022-04-22 23:35:20.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958500807380992[0;39m 生成今日电子书快照结束，耗时：86毫秒
2022-04-22 23:35:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958521791483904[0;39m 生成今日电子书快照开始
2022-04-22 23:35:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958521791483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958521791483904[0;39m ==> Parameters: 
2022-04-22 23:35:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958521791483904[0;39m <==    Updates: 0
2022-04-22 23:35:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958521791483904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:35:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958542729449472[0;39m 生成今日电子书快照开始
2022-04-22 23:35:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958542729449472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958542729449472[0;39m ==> Parameters: 
2022-04-22 23:35:30.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958542729449472[0;39m <==    Updates: 0
2022-04-22 23:35:30.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958542729449472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:35:35.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958563696775168[0;39m 生成今日电子书快照开始
2022-04-22 23:35:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958563696775168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958563696775168[0;39m ==> Parameters: 
2022-04-22 23:35:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958563696775168[0;39m <==    Updates: 0
2022-04-22 23:35:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958563696775168[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:35:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958563956822016[0;39m start updating Ebook doc
2022-04-22 23:35:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958563956822016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:35:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958563956822016[0;39m ==> Parameters: 
2022-04-22 23:35:35.102 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958563956822016[0;39m <==    Updates: 1
2022-04-22 23:35:35.102 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958563956822016[0;39m update ends, take 39 millisecs
2022-04-22 23:35:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958584676683776[0;39m 生成今日电子书快照开始
2022-04-22 23:35:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958584676683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958584676683776[0;39m ==> Parameters: 
2022-04-22 23:35:40.093 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958584676683776[0;39m <==    Updates: 0
2022-04-22 23:35:40.094 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958584676683776[0;39m 生成今日电子书快照结束，耗时：91毫秒
2022-04-22 23:35:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958605660786688[0;39m 生成今日电子书快照开始
2022-04-22 23:35:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958605660786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958605660786688[0;39m ==> Parameters: 
2022-04-22 23:35:45.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958605660786688[0;39m <==    Updates: 0
2022-04-22 23:35:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958605660786688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:35:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958626653278208[0;39m 生成今日电子书快照开始
2022-04-22 23:35:50.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958626653278208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:50.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958626653278208[0;39m ==> Parameters: 
2022-04-22 23:35:50.132 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958626653278208[0;39m <==    Updates: 0
2022-04-22 23:35:50.132 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958626653278208[0;39m 生成今日电子书快照结束，耗时：121毫秒
2022-04-22 23:35:55.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958647603826688[0;39m 生成今日电子书快照开始
2022-04-22 23:35:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958647603826688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:35:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958647603826688[0;39m ==> Parameters: 
2022-04-22 23:35:55.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958647603826688[0;39m <==    Updates: 0
2022-04-22 23:35:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958647603826688[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:36:00.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958668566958080[0;39m 生成今日电子书快照开始
2022-04-22 23:36:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958668566958080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958668566958080[0;39m ==> Parameters: 
2022-04-22 23:36:00.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958668566958080[0;39m <==    Updates: 0
2022-04-22 23:36:00.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958668566958080[0;39m 生成今日电子书快照结束，耗时：85毫秒
2022-04-22 23:36:05.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958689534283776[0;39m start updating Ebook doc
2022-04-22 23:36:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958689534283776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:36:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958689534283776[0;39m ==> Parameters: 
2022-04-22 23:36:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958689534283776[0;39m <==    Updates: 1
2022-04-22 23:36:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958689534283776[0;39m update ends, take 62 millisecs
2022-04-22 23:36:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958689794330624[0;39m 生成今日电子书快照开始
2022-04-22 23:36:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958689794330624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958689794330624[0;39m ==> Parameters: 
2022-04-22 23:36:05.101 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958689794330624[0;39m <==    Updates: 0
2022-04-22 23:36:05.101 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958689794330624[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 23:36:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958710505803776[0;39m 生成今日电子书快照开始
2022-04-22 23:36:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958710505803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958710505803776[0;39m ==> Parameters: 
2022-04-22 23:36:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958710505803776[0;39m <==    Updates: 0
2022-04-22 23:36:10.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958710505803776[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:36:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958731510878208[0;39m 生成今日电子书快照开始
2022-04-22 23:36:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958731510878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958731510878208[0;39m ==> Parameters: 
2022-04-22 23:36:15.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958731510878208[0;39m <==    Updates: 0
2022-04-22 23:36:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958731510878208[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:36:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958752457232384[0;39m 生成今日电子书快照开始
2022-04-22 23:36:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958752457232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:20.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958752457232384[0;39m ==> Parameters: 
2022-04-22 23:36:20.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958752457232384[0;39m <==    Updates: 0
2022-04-22 23:36:20.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958752457232384[0;39m 生成今日电子书快照结束，耗时：98毫秒
2022-04-22 23:36:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958773453918208[0;39m 生成今日电子书快照开始
2022-04-22 23:36:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958773453918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958773453918208[0;39m ==> Parameters: 
2022-04-22 23:36:25.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958773453918208[0;39m <==    Updates: 0
2022-04-22 23:36:25.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958773453918208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:36:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958794425438208[0;39m 生成今日电子书快照开始
2022-04-22 23:36:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958794425438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958794425438208[0;39m ==> Parameters: 
2022-04-22 23:36:30.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958794425438208[0;39m <==    Updates: 0
2022-04-22 23:36:30.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958794425438208[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:36:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958815363403776[0;39m 生成今日电子书快照开始
2022-04-22 23:36:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958815363403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958815363403776[0;39m ==> Parameters: 
2022-04-22 23:36:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958815363403776[0;39m <==    Updates: 0
2022-04-22 23:36:35.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958815363403776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:36:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958815648616448[0;39m start updating Ebook doc
2022-04-22 23:36:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958815648616448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:36:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958815648616448[0;39m ==> Parameters: 
2022-04-22 23:36:35.111 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958815648616448[0;39m <==    Updates: 1
2022-04-22 23:36:35.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958815648616448[0;39m update ends, take 41 millisecs
2022-04-22 23:36:40.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958836368478208[0;39m 生成今日电子书快照开始
2022-04-22 23:36:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958836368478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958836368478208[0;39m ==> Parameters: 
2022-04-22 23:36:40.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958836368478208[0;39m <==    Updates: 0
2022-04-22 23:36:40.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958836368478208[0;39m 生成今日电子书快照结束，耗时：96毫秒
2022-04-22 23:36:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958857314832384[0;39m 生成今日电子书快照开始
2022-04-22 23:36:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958857314832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958857314832384[0;39m ==> Parameters: 
2022-04-22 23:36:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958857314832384[0;39m <==    Updates: 0
2022-04-22 23:36:45.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958857314832384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:36:50.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958878282158080[0;39m 生成今日电子书快照开始
2022-04-22 23:36:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958878282158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958878282158080[0;39m ==> Parameters: 
2022-04-22 23:36:50.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958878282158080[0;39m <==    Updates: 0
2022-04-22 23:36:50.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958878282158080[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:36:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958899253678080[0;39m 生成今日电子书快照开始
2022-04-22 23:36:55.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958899253678080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:36:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958899253678080[0;39m ==> Parameters: 
2022-04-22 23:36:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958899253678080[0;39m <==    Updates: 0
2022-04-22 23:36:55.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958899253678080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:37:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958920246169600[0;39m 生成今日电子书快照开始
2022-04-22 23:37:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958920246169600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958920246169600[0;39m ==> Parameters: 
2022-04-22 23:37:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958920246169600[0;39m <==    Updates: 0
2022-04-22 23:37:00.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958920246169600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:37:05.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958941184135168[0;39m 生成今日电子书快照开始
2022-04-22 23:37:05.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958941184135168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:05.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958941184135168[0;39m ==> Parameters: 
2022-04-22 23:37:05.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958941184135168[0;39m <==    Updates: 0
2022-04-22 23:37:05.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958941184135168[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:37:05.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172958941498707968[0;39m start updating Ebook doc
2022-04-22 23:37:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958941498707968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:37:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958941498707968[0;39m ==> Parameters: 
2022-04-22 23:37:05.107 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172958941498707968[0;39m <==    Updates: 1
2022-04-22 23:37:05.107 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172958941498707968[0;39m update ends, take 32 millisecs
2022-04-22 23:37:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958962197598208[0;39m 生成今日电子书快照开始
2022-04-22 23:37:10.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958962197598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958962197598208[0;39m ==> Parameters: 
2022-04-22 23:37:10.089 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958962197598208[0;39m <==    Updates: 0
2022-04-22 23:37:10.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958962197598208[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:37:15.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172958983173312512[0;39m 生成今日电子书快照开始
2022-04-22 23:37:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958983173312512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958983173312512[0;39m ==> Parameters: 
2022-04-22 23:37:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172958983173312512[0;39m <==    Updates: 0
2022-04-22 23:37:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172958983173312512[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:37:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959004119666688[0;39m 生成今日电子书快照开始
2022-04-22 23:37:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959004119666688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959004119666688[0;39m ==> Parameters: 
2022-04-22 23:37:20.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959004119666688[0;39m <==    Updates: 0
2022-04-22 23:37:20.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959004119666688[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:37:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959025078603776[0;39m 生成今日电子书快照开始
2022-04-22 23:37:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959025078603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959025078603776[0;39m ==> Parameters: 
2022-04-22 23:37:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959025078603776[0;39m <==    Updates: 0
2022-04-22 23:37:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959025078603776[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:37:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959046058512384[0;39m 生成今日电子书快照开始
2022-04-22 23:37:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959046058512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959046058512384[0;39m ==> Parameters: 
2022-04-22 23:37:30.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959046058512384[0;39m <==    Updates: 0
2022-04-22 23:37:30.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959046058512384[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:37:35.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959067038420992[0;39m 生成今日电子书快照开始
2022-04-22 23:37:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959067038420992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:35.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959067038420992[0;39m ==> Parameters: 
2022-04-22 23:37:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959067038420992[0;39m <==    Updates: 0
2022-04-22 23:37:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959067038420992[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:37:35.061 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959067269107712[0;39m start updating Ebook doc
2022-04-22 23:37:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959067269107712[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:37:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959067269107712[0;39m ==> Parameters: 
2022-04-22 23:37:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959067269107712[0;39m <==    Updates: 1
2022-04-22 23:37:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959067269107712[0;39m update ends, take 45 millisecs
2022-04-22 23:37:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959088005746688[0;39m 生成今日电子书快照开始
2022-04-22 23:37:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959088005746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959088005746688[0;39m ==> Parameters: 
2022-04-22 23:37:40.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959088005746688[0;39m <==    Updates: 0
2022-04-22 23:37:40.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959088005746688[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 23:37:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959108977266688[0;39m 生成今日电子书快照开始
2022-04-22 23:37:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959108977266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959108977266688[0;39m ==> Parameters: 
2022-04-22 23:37:45.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959108977266688[0;39m <==    Updates: 0
2022-04-22 23:37:45.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959108977266688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:37:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959129944592384[0;39m 生成今日电子书快照开始
2022-04-22 23:37:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959129944592384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:50.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959129944592384[0;39m ==> Parameters: 
2022-04-22 23:37:50.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959129944592384[0;39m <==    Updates: 0
2022-04-22 23:37:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959129944592384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:37:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959150928695296[0;39m 生成今日电子书快照开始
2022-04-22 23:37:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959150928695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:37:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959150928695296[0;39m ==> Parameters: 
2022-04-22 23:37:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959150928695296[0;39m <==    Updates: 0
2022-04-22 23:37:55.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959150928695296[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:38:00.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959171904409600[0;39m 生成今日电子书快照开始
2022-04-22 23:38:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959171904409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959171904409600[0;39m ==> Parameters: 
2022-04-22 23:38:00.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959171904409600[0;39m <==    Updates: 0
2022-04-22 23:38:00.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959171904409600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:38:05.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959192863346688[0;39m 生成今日电子书快照开始
2022-04-22 23:38:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959192863346688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:05.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959192863346688[0;39m ==> Parameters: 
2022-04-22 23:38:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959192863346688[0;39m <==    Updates: 0
2022-04-22 23:38:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959192863346688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:38:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959193135976448[0;39m start updating Ebook doc
2022-04-22 23:38:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959193135976448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:38:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959193135976448[0;39m ==> Parameters: 
2022-04-22 23:38:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959193135976448[0;39m <==    Updates: 1
2022-04-22 23:38:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959193135976448[0;39m update ends, take 42 millisecs
2022-04-22 23:38:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959213822283776[0;39m 生成今日电子书快照开始
2022-04-22 23:38:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959213822283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:10.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959213822283776[0;39m ==> Parameters: 
2022-04-22 23:38:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959213822283776[0;39m <==    Updates: 0
2022-04-22 23:38:10.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959213822283776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:38:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959234827358208[0;39m 生成今日电子书快照开始
2022-04-22 23:38:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959234827358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959234827358208[0;39m ==> Parameters: 
2022-04-22 23:38:15.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959234827358208[0;39m <==    Updates: 0
2022-04-22 23:38:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959234827358208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:38:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959255798878208[0;39m 生成今日电子书快照开始
2022-04-22 23:38:20.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959255798878208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:20.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959255798878208[0;39m ==> Parameters: 
2022-04-22 23:38:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959255798878208[0;39m <==    Updates: 0
2022-04-22 23:38:20.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959255798878208[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:38:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959276770398208[0;39m 生成今日电子书快照开始
2022-04-22 23:38:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959276770398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959276770398208[0;39m ==> Parameters: 
2022-04-22 23:38:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959276770398208[0;39m <==    Updates: 0
2022-04-22 23:38:25.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959276770398208[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:38:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959297741918208[0;39m 生成今日电子书快照开始
2022-04-22 23:38:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959297741918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959297741918208[0;39m ==> Parameters: 
2022-04-22 23:38:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959297741918208[0;39m <==    Updates: 0
2022-04-22 23:38:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959297741918208[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:38:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959318684078080[0;39m start updating Ebook doc
2022-04-22 23:38:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959318684078080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:38:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959318684078080[0;39m ==> Parameters: 
2022-04-22 23:38:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959318684078080[0;39m <==    Updates: 1
2022-04-22 23:38:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959318684078080[0;39m update ends, take 72 millisecs
2022-04-22 23:38:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959318986067968[0;39m 生成今日电子书快照开始
2022-04-22 23:38:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959318986067968[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959318986067968[0;39m ==> Parameters: 
2022-04-22 23:38:35.118 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959318986067968[0;39m <==    Updates: 0
2022-04-22 23:38:35.119 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959318986067968[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 23:38:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959339651403776[0;39m 生成今日电子书快照开始
2022-04-22 23:38:40.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959339651403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:40.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959339651403776[0;39m ==> Parameters: 
2022-04-22 23:38:40.121 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959339651403776[0;39m <==    Updates: 0
2022-04-22 23:38:40.121 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959339651403776[0;39m 生成今日电子书快照结束，耗时：119毫秒
2022-04-22 23:38:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959360639700992[0;39m 生成今日电子书快照开始
2022-04-22 23:38:45.248 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959360639700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:45.248 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959360639700992[0;39m ==> Parameters: 
2022-04-22 23:38:45.287 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959360639700992[0;39m <==    Updates: 0
2022-04-22 23:38:45.288 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959360639700992[0;39m 生成今日电子书快照结束，耗时：282毫秒
2022-04-22 23:38:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959381590249472[0;39m 生成今日电子书快照开始
2022-04-22 23:38:50.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959381590249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:50.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959381590249472[0;39m ==> Parameters: 
2022-04-22 23:38:50.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959381590249472[0;39m <==    Updates: 0
2022-04-22 23:38:50.102 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959381590249472[0;39m 生成今日电子书快照结束，耗时：101毫秒
2022-04-22 23:38:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959402582740992[0;39m 生成今日电子书快照开始
2022-04-22 23:38:55.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959402582740992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:38:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959402582740992[0;39m ==> Parameters: 
2022-04-22 23:38:55.110 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959402582740992[0;39m <==    Updates: 0
2022-04-22 23:38:55.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959402582740992[0;39m 生成今日电子书快照结束，耗时：103毫秒
2022-04-22 23:39:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959423566843904[0;39m 生成今日电子书快照开始
2022-04-22 23:39:00.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959423566843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:00.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959423566843904[0;39m ==> Parameters: 
2022-04-22 23:39:00.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959423566843904[0;39m <==    Updates: 0
2022-04-22 23:39:00.095 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959423566843904[0;39m 生成今日电子书快照结束，耗时：86毫秒
2022-04-22 23:39:05.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959444517392384[0;39m 生成今日电子书快照开始
2022-04-22 23:39:05.163 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959444517392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:05.164 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959444517392384[0;39m ==> Parameters: 
2022-04-22 23:39:05.201 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959444517392384[0;39m <==    Updates: 0
2022-04-22 23:39:05.201 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959444517392384[0;39m 生成今日电子书快照结束，耗时：197毫秒
2022-04-22 23:39:05.202 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959445347864576[0;39m start updating Ebook doc
2022-04-22 23:39:05.202 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959445347864576[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:39:05.202 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959445347864576[0;39m ==> Parameters: 
2022-04-22 23:39:05.242 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959445347864576[0;39m <==    Updates: 1
2022-04-22 23:39:05.243 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959445347864576[0;39m update ends, take 41 millisecs
2022-04-22 23:39:10.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959465493106688[0;39m 生成今日电子书快照开始
2022-04-22 23:39:10.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959465493106688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:10.046 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959465493106688[0;39m ==> Parameters: 
2022-04-22 23:39:10.092 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959465493106688[0;39m <==    Updates: 0
2022-04-22 23:39:10.093 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959465493106688[0;39m 生成今日电子书快照结束，耗时：88毫秒
2022-04-22 23:39:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959486460432384[0;39m 生成今日电子书快照开始
2022-04-22 23:39:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959486460432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959486460432384[0;39m ==> Parameters: 
2022-04-22 23:39:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959486460432384[0;39m <==    Updates: 0
2022-04-22 23:39:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959486460432384[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:39:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959507436146688[0;39m 生成今日电子书快照开始
2022-04-22 23:39:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959507436146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959507436146688[0;39m ==> Parameters: 
2022-04-22 23:39:20.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959507436146688[0;39m <==    Updates: 0
2022-04-22 23:39:20.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959507436146688[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:39:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959528420249600[0;39m 生成今日电子书快照开始
2022-04-22 23:39:25.119 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959528420249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:25.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959528420249600[0;39m ==> Parameters: 
2022-04-22 23:39:25.161 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959528420249600[0;39m <==    Updates: 0
2022-04-22 23:39:25.161 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959528420249600[0;39m 生成今日电子书快照结束，耗时：153毫秒
2022-04-22 23:39:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959549400158208[0;39m 生成今日电子书快照开始
2022-04-22 23:39:30.258 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959549400158208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:30.259 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959549400158208[0;39m ==> Parameters: 
2022-04-22 23:39:30.319 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959549400158208[0;39m <==    Updates: 0
2022-04-22 23:39:30.320 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959549400158208[0;39m 生成今日电子书快照结束，耗时：310毫秒
2022-04-22 23:39:35.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959570359095296[0;39m start updating Ebook doc
2022-04-22 23:39:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959570359095296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:39:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959570359095296[0;39m ==> Parameters: 
2022-04-22 23:39:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959570359095296[0;39m <==    Updates: 1
2022-04-22 23:39:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959570359095296[0;39m update ends, take 63 millisecs
2022-04-22 23:39:35.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959570627530752[0;39m 生成今日电子书快照开始
2022-04-22 23:39:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959570627530752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959570627530752[0;39m ==> Parameters: 
2022-04-22 23:39:35.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959570627530752[0;39m <==    Updates: 0
2022-04-22 23:39:35.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959570627530752[0;39m 生成今日电子书快照结束，耗时：35毫秒
2022-04-22 23:39:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959591318032384[0;39m 生成今日电子书快照开始
2022-04-22 23:39:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959591318032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959591318032384[0;39m ==> Parameters: 
2022-04-22 23:39:40.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959591318032384[0;39m <==    Updates: 0
2022-04-22 23:39:40.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959591318032384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:39:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959612289552384[0;39m 生成今日电子书快照开始
2022-04-22 23:39:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959612289552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959612289552384[0;39m ==> Parameters: 
2022-04-22 23:39:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959612289552384[0;39m <==    Updates: 0
2022-04-22 23:39:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959612289552384[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:39:50.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959633265266688[0;39m 生成今日电子书快照开始
2022-04-22 23:39:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959633265266688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959633265266688[0;39m ==> Parameters: 
2022-04-22 23:39:50.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959633265266688[0;39m <==    Updates: 0
2022-04-22 23:39:50.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959633265266688[0;39m 生成今日电子书快照结束，耗时：80毫秒
2022-04-22 23:39:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959654257758208[0;39m 生成今日电子书快照开始
2022-04-22 23:39:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959654257758208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:39:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959654257758208[0;39m ==> Parameters: 
2022-04-22 23:39:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959654257758208[0;39m <==    Updates: 0
2022-04-22 23:39:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959654257758208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:40:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959675195723776[0;39m 生成今日电子书快照开始
2022-04-22 23:40:00.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959675195723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:00.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959675195723776[0;39m ==> Parameters: 
2022-04-22 23:40:00.090 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959675195723776[0;39m <==    Updates: 0
2022-04-22 23:40:00.090 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959675195723776[0;39m 生成今日电子书快照结束，耗时：88毫秒
2022-04-22 23:40:05.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959696192409600[0;39m start updating Ebook doc
2022-04-22 23:40:05.081 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959696192409600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:40:05.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959696192409600[0;39m ==> Parameters: 
2022-04-22 23:40:05.239 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959696192409600[0;39m <==    Updates: 1
2022-04-22 23:40:05.239 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959696192409600[0;39m update ends, take 230 millisecs
2022-04-22 23:40:05.240 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959697165488128[0;39m 生成今日电子书快照开始
2022-04-22 23:40:05.240 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959697165488128[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:05.240 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959697165488128[0;39m ==> Parameters: 
2022-04-22 23:40:05.279 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959697165488128[0;39m <==    Updates: 0
2022-04-22 23:40:05.280 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959697165488128[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:40:10.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959717163929600[0;39m 生成今日电子书快照开始
2022-04-22 23:40:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959717163929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959717163929600[0;39m ==> Parameters: 
2022-04-22 23:40:10.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959717163929600[0;39m <==    Updates: 0
2022-04-22 23:40:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959717163929600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:40:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959738110283776[0;39m 生成今日电子书快照开始
2022-04-22 23:40:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959738110283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959738110283776[0;39m ==> Parameters: 
2022-04-22 23:40:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959738110283776[0;39m <==    Updates: 0
2022-04-22 23:40:15.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959738110283776[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:40:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959759115358208[0;39m 生成今日电子书快照开始
2022-04-22 23:40:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959759115358208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959759115358208[0;39m ==> Parameters: 
2022-04-22 23:40:20.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959759115358208[0;39m <==    Updates: 0
2022-04-22 23:40:20.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959759115358208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:40:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959780053323776[0;39m 生成今日电子书快照开始
2022-04-22 23:40:25.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959780053323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:25.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959780053323776[0;39m ==> Parameters: 
2022-04-22 23:40:25.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959780053323776[0;39m <==    Updates: 0
2022-04-22 23:40:25.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959780053323776[0;39m 生成今日电子书快照结束，耗时：100毫秒
2022-04-22 23:40:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959801058398208[0;39m 生成今日电子书快照开始
2022-04-22 23:40:30.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959801058398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:30.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959801058398208[0;39m ==> Parameters: 
2022-04-22 23:40:30.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959801058398208[0;39m <==    Updates: 0
2022-04-22 23:40:30.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959801058398208[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:40:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959821996363776[0;39m start updating Ebook doc
2022-04-22 23:40:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959821996363776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:40:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959821996363776[0;39m ==> Parameters: 
2022-04-22 23:40:35.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959821996363776[0;39m <==    Updates: 1
2022-04-22 23:40:35.068 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959821996363776[0;39m update ends, take 65 millisecs
2022-04-22 23:40:35.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959822273187840[0;39m 生成今日电子书快照开始
2022-04-22 23:40:35.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959822273187840[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959822273187840[0;39m ==> Parameters: 
2022-04-22 23:40:35.113 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959822273187840[0;39m <==    Updates: 0
2022-04-22 23:40:35.113 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959822273187840[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 23:40:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959842993049600[0;39m 生成今日电子书快照开始
2022-04-22 23:40:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959842993049600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959842993049600[0;39m ==> Parameters: 
2022-04-22 23:40:40.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959842993049600[0;39m <==    Updates: 0
2022-04-22 23:40:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959842993049600[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:40:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959863935209472[0;39m 生成今日电子书快照开始
2022-04-22 23:40:45.213 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959863935209472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:45.214 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959863935209472[0;39m ==> Parameters: 
2022-04-22 23:40:45.253 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959863935209472[0;39m <==    Updates: 0
2022-04-22 23:40:45.253 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959863935209472[0;39m 生成今日电子书快照结束，耗时：251毫秒
2022-04-22 23:40:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959884944478208[0;39m 生成今日电子书快照开始
2022-04-22 23:40:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959884944478208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:50.056 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959884944478208[0;39m ==> Parameters: 
2022-04-22 23:40:50.098 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959884944478208[0;39m <==    Updates: 0
2022-04-22 23:40:50.099 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959884944478208[0;39m 生成今日电子书快照结束，耗时：89毫秒
2022-04-22 23:40:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959905890832384[0;39m 生成今日电子书快照开始
2022-04-22 23:40:55.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959905890832384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:40:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959905890832384[0;39m ==> Parameters: 
2022-04-22 23:40:55.152 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959905890832384[0;39m <==    Updates: 0
2022-04-22 23:40:55.153 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959905890832384[0;39m 生成今日电子书快照结束，耗时：149毫秒
2022-04-22 23:41:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959926883323904[0;39m 生成今日电子书快照开始
2022-04-22 23:41:00.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959926883323904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:00.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959926883323904[0;39m ==> Parameters: 
2022-04-22 23:41:00.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959926883323904[0;39m <==    Updates: 0
2022-04-22 23:41:00.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959926883323904[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 23:41:05.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959947842260992[0;39m 生成今日电子书快照开始
2022-04-22 23:41:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959947842260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959947842260992[0;39m ==> Parameters: 
2022-04-22 23:41:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959947842260992[0;39m <==    Updates: 0
2022-04-22 23:41:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959947842260992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:41:05.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172959948098113536[0;39m start updating Ebook doc
2022-04-22 23:41:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959948098113536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:41:05.067 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959948098113536[0;39m ==> Parameters: 
2022-04-22 23:41:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172959948098113536[0;39m <==    Updates: 1
2022-04-22 23:41:05.111 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172959948098113536[0;39m update ends, take 44 millisecs
2022-04-22 23:41:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959968805392384[0;39m 生成今日电子书快照开始
2022-04-22 23:41:10.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959968805392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959968805392384[0;39m ==> Parameters: 
2022-04-22 23:41:10.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959968805392384[0;39m <==    Updates: 0
2022-04-22 23:41:10.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959968805392384[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:41:15.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172959989772718080[0;39m 生成今日电子书快照开始
2022-04-22 23:41:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959989772718080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959989772718080[0;39m ==> Parameters: 
2022-04-22 23:41:15.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172959989772718080[0;39m <==    Updates: 0
2022-04-22 23:41:15.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172959989772718080[0;39m 生成今日电子书快照结束，耗时：81毫秒
2022-04-22 23:41:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960010773598208[0;39m 生成今日电子书快照开始
2022-04-22 23:41:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960010773598208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960010773598208[0;39m ==> Parameters: 
2022-04-22 23:41:20.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960010773598208[0;39m <==    Updates: 0
2022-04-22 23:41:20.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960010773598208[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:41:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960031728340992[0;39m 生成今日电子书快照开始
2022-04-22 23:41:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960031728340992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960031728340992[0;39m ==> Parameters: 
2022-04-22 23:41:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960031728340992[0;39m <==    Updates: 0
2022-04-22 23:41:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960031728340992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:41:30.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960052699860992[0;39m 生成今日电子书快照开始
2022-04-22 23:41:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960052699860992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960052699860992[0;39m ==> Parameters: 
2022-04-22 23:41:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960052699860992[0;39m <==    Updates: 0
2022-04-22 23:41:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960052699860992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:41:35.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960073654603776[0;39m 生成今日电子书快照开始
2022-04-22 23:41:35.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960073654603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:35.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960073654603776[0;39m ==> Parameters: 
2022-04-22 23:41:35.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960073654603776[0;39m <==    Updates: 0
2022-04-22 23:41:35.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960073654603776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:41:35.067 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960073927233536[0;39m start updating Ebook doc
2022-04-22 23:41:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960073927233536[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:41:35.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960073927233536[0;39m ==> Parameters: 
2022-04-22 23:41:35.106 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960073927233536[0;39m <==    Updates: 1
2022-04-22 23:41:35.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960073927233536[0;39m update ends, take 39 millisecs
2022-04-22 23:41:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960094634512384[0;39m 生成今日电子书快照开始
2022-04-22 23:41:40.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960094634512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:40.100 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960094634512384[0;39m ==> Parameters: 
2022-04-22 23:41:40.208 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960094634512384[0;39m <==    Updates: 0
2022-04-22 23:41:40.208 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960094634512384[0;39m 生成今日电子书快照结束，耗时：204毫秒
2022-04-22 23:41:45.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960115597643776[0;39m 生成今日电子书快照开始
2022-04-22 23:41:45.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960115597643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960115597643776[0;39m ==> Parameters: 
2022-04-22 23:41:45.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960115597643776[0;39m <==    Updates: 0
2022-04-22 23:41:45.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960115597643776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:41:50.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960136564969472[0;39m 生成今日电子书快照开始
2022-04-22 23:41:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960136564969472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960136564969472[0;39m ==> Parameters: 
2022-04-22 23:41:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960136564969472[0;39m <==    Updates: 0
2022-04-22 23:41:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960136564969472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:41:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960157540683776[0;39m 生成今日电子书快照开始
2022-04-22 23:41:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960157540683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:41:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960157540683776[0;39m ==> Parameters: 
2022-04-22 23:41:55.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960157540683776[0;39m <==    Updates: 0
2022-04-22 23:41:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960157540683776[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:42:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960178512203776[0;39m 生成今日电子书快照开始
2022-04-22 23:42:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960178512203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960178512203776[0;39m ==> Parameters: 
2022-04-22 23:42:00.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960178512203776[0;39m <==    Updates: 0
2022-04-22 23:42:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960178512203776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:42:05.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960199513083904[0;39m start updating Ebook doc
2022-04-22 23:42:05.042 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960199513083904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:42:05.042 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960199513083904[0;39m ==> Parameters: 
2022-04-22 23:42:05.082 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960199513083904[0;39m <==    Updates: 1
2022-04-22 23:42:05.083 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960199513083904[0;39m update ends, take 74 millisecs
2022-04-22 23:42:05.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960199823462400[0;39m 生成今日电子书快照开始
2022-04-22 23:42:05.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960199823462400[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:05.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960199823462400[0;39m ==> Parameters: 
2022-04-22 23:42:05.124 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960199823462400[0;39m <==    Updates: 0
2022-04-22 23:42:05.124 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960199823462400[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 23:42:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960220459438080[0;39m 生成今日电子书快照开始
2022-04-22 23:42:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960220459438080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960220459438080[0;39m ==> Parameters: 
2022-04-22 23:42:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960220459438080[0;39m <==    Updates: 0
2022-04-22 23:42:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960220459438080[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:42:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960241426763776[0;39m 生成今日电子书快照开始
2022-04-22 23:42:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960241426763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:15.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960241426763776[0;39m ==> Parameters: 
2022-04-22 23:42:15.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960241426763776[0;39m <==    Updates: 0
2022-04-22 23:42:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960241426763776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:42:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960262410866688[0;39m 生成今日电子书快照开始
2022-04-22 23:42:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960262410866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960262410866688[0;39m ==> Parameters: 
2022-04-22 23:42:20.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960262410866688[0;39m <==    Updates: 0
2022-04-22 23:42:20.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960262410866688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:42:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960283365609472[0;39m 生成今日电子书快照开始
2022-04-22 23:42:25.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960283365609472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960283365609472[0;39m ==> Parameters: 
2022-04-22 23:42:25.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960283365609472[0;39m <==    Updates: 0
2022-04-22 23:42:25.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960283365609472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:42:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960304370683904[0;39m 生成今日电子书快照开始
2022-04-22 23:42:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960304370683904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960304370683904[0;39m ==> Parameters: 
2022-04-22 23:42:30.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960304370683904[0;39m <==    Updates: 0
2022-04-22 23:42:30.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960304370683904[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:42:35.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960325317038080[0;39m 生成今日电子书快照开始
2022-04-22 23:42:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960325317038080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960325317038080[0;39m ==> Parameters: 
2022-04-22 23:42:35.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960325317038080[0;39m <==    Updates: 0
2022-04-22 23:42:35.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960325317038080[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:42:35.075 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960325619027968[0;39m start updating Ebook doc
2022-04-22 23:42:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960325619027968[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:42:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960325619027968[0;39m ==> Parameters: 
2022-04-22 23:42:35.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960325619027968[0;39m <==    Updates: 1
2022-04-22 23:42:35.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960325619027968[0;39m update ends, take 36 millisecs
2022-04-22 23:42:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960346296946688[0;39m 生成今日电子书快照开始
2022-04-22 23:42:40.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960346296946688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:40.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960346296946688[0;39m ==> Parameters: 
2022-04-22 23:42:40.096 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960346296946688[0;39m <==    Updates: 0
2022-04-22 23:42:40.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960346296946688[0;39m 生成今日电子书快照结束，耗时：91毫秒
2022-04-22 23:42:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960367260078080[0;39m 生成今日电子书快照开始
2022-04-22 23:42:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960367260078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960367260078080[0;39m ==> Parameters: 
2022-04-22 23:42:45.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960367260078080[0;39m <==    Updates: 0
2022-04-22 23:42:45.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960367260078080[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 23:42:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960388227403776[0;39m 生成今日电子书快照开始
2022-04-22 23:42:50.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960388227403776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:50.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960388227403776[0;39m ==> Parameters: 
2022-04-22 23:42:50.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960388227403776[0;39m <==    Updates: 0
2022-04-22 23:42:50.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960388227403776[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-22 23:42:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960409215700992[0;39m 生成今日电子书快照开始
2022-04-22 23:42:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960409215700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:42:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960409215700992[0;39m ==> Parameters: 
2022-04-22 23:42:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960409215700992[0;39m <==    Updates: 0
2022-04-22 23:42:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960409215700992[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:43:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960430170443776[0;39m 生成今日电子书快照开始
2022-04-22 23:43:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960430170443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960430170443776[0;39m ==> Parameters: 
2022-04-22 23:43:00.059 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960430170443776[0;39m <==    Updates: 0
2022-04-22 23:43:00.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960430170443776[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:43:05.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960451175518208[0;39m 生成今日电子书快照开始
2022-04-22 23:43:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960451175518208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:05.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960451175518208[0;39m ==> Parameters: 
2022-04-22 23:43:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960451175518208[0;39m <==    Updates: 0
2022-04-22 23:43:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960451175518208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:43:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960451410399232[0;39m start updating Ebook doc
2022-04-22 23:43:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960451410399232[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:43:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960451410399232[0;39m ==> Parameters: 
2022-04-22 23:43:05.105 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960451410399232[0;39m <==    Updates: 1
2022-04-22 23:43:05.106 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960451410399232[0;39m update ends, take 40 millisecs
2022-04-22 23:43:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960472121872384[0;39m 生成今日电子书快照开始
2022-04-22 23:43:10.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960472121872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:10.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960472121872384[0;39m ==> Parameters: 
2022-04-22 23:43:10.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960472121872384[0;39m <==    Updates: 0
2022-04-22 23:43:10.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960472121872384[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:43:15.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960493101780992[0;39m 生成今日电子书快照开始
2022-04-22 23:43:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960493101780992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960493101780992[0;39m ==> Parameters: 
2022-04-22 23:43:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960493101780992[0;39m <==    Updates: 0
2022-04-22 23:43:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960493101780992[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:43:20.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960514052329472[0;39m 生成今日电子书快照开始
2022-04-22 23:43:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960514052329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960514052329472[0;39m ==> Parameters: 
2022-04-22 23:43:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960514052329472[0;39m <==    Updates: 0
2022-04-22 23:43:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960514052329472[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:43:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960535057403904[0;39m 生成今日电子书快照开始
2022-04-22 23:43:25.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960535057403904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960535057403904[0;39m ==> Parameters: 
2022-04-22 23:43:25.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960535057403904[0;39m <==    Updates: 0
2022-04-22 23:43:25.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960535057403904[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:43:30.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960556037312512[0;39m 生成今日电子书快照开始
2022-04-22 23:43:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960556037312512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960556037312512[0;39m ==> Parameters: 
2022-04-22 23:43:30.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960556037312512[0;39m <==    Updates: 0
2022-04-22 23:43:30.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960556037312512[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:43:35.006 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960576987860992[0;39m start updating Ebook doc
2022-04-22 23:43:35.040 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960576987860992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:43:35.041 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960576987860992[0;39m ==> Parameters: 
2022-04-22 23:43:35.076 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960576987860992[0;39m <==    Updates: 1
2022-04-22 23:43:35.077 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960576987860992[0;39m update ends, take 71 millisecs
2022-04-22 23:43:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960577285656576[0;39m 生成今日电子书快照开始
2022-04-22 23:43:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960577285656576[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960577285656576[0;39m ==> Parameters: 
2022-04-22 23:43:35.122 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960577285656576[0;39m <==    Updates: 0
2022-04-22 23:43:35.122 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960577285656576[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 23:43:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960597959380992[0;39m 生成今日电子书快照开始
2022-04-22 23:43:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960597959380992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960597959380992[0;39m ==> Parameters: 
2022-04-22 23:43:40.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960597959380992[0;39m <==    Updates: 0
2022-04-22 23:43:40.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960597959380992[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:43:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960618930900992[0;39m 生成今日电子书快照开始
2022-04-22 23:43:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960618930900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960618930900992[0;39m ==> Parameters: 
2022-04-22 23:43:45.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960618930900992[0;39m <==    Updates: 0
2022-04-22 23:43:45.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960618930900992[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:43:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960639894032384[0;39m 生成今日电子书快照开始
2022-04-22 23:43:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960639894032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960639894032384[0;39m ==> Parameters: 
2022-04-22 23:43:50.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960639894032384[0;39m <==    Updates: 0
2022-04-22 23:43:50.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960639894032384[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:43:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960660878135296[0;39m 生成今日电子书快照开始
2022-04-22 23:43:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960660878135296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:43:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960660878135296[0;39m ==> Parameters: 
2022-04-22 23:43:55.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960660878135296[0;39m <==    Updates: 0
2022-04-22 23:43:55.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960660878135296[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:44:00.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960681862238208[0;39m 生成今日电子书快照开始
2022-04-22 23:44:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960681862238208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960681862238208[0;39m ==> Parameters: 
2022-04-22 23:44:00.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960681862238208[0;39m <==    Updates: 0
2022-04-22 23:44:00.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960681862238208[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:44:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960702800203776[0;39m 生成今日电子书快照开始
2022-04-22 23:44:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960702800203776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:05.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960702800203776[0;39m ==> Parameters: 
2022-04-22 23:44:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960702800203776[0;39m <==    Updates: 0
2022-04-22 23:44:05.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960702800203776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:44:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960703064444928[0;39m start updating Ebook doc
2022-04-22 23:44:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960703064444928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:44:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960703064444928[0;39m ==> Parameters: 
2022-04-22 23:44:05.104 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960703064444928[0;39m <==    Updates: 1
2022-04-22 23:44:05.104 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960703064444928[0;39m update ends, take 39 millisecs
2022-04-22 23:44:10.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960723792695296[0;39m 生成今日电子书快照开始
2022-04-22 23:44:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960723792695296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960723792695296[0;39m ==> Parameters: 
2022-04-22 23:44:10.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960723792695296[0;39m <==    Updates: 0
2022-04-22 23:44:10.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960723792695296[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:44:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960744768409600[0;39m 生成今日电子书快照开始
2022-04-22 23:44:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960744768409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960744768409600[0;39m ==> Parameters: 
2022-04-22 23:44:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960744768409600[0;39m <==    Updates: 0
2022-04-22 23:44:15.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960744768409600[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 23:44:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960765748318208[0;39m 生成今日电子书快照开始
2022-04-22 23:44:20.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960765748318208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:20.043 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960765748318208[0;39m ==> Parameters: 
2022-04-22 23:44:20.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960765748318208[0;39m <==    Updates: 0
2022-04-22 23:44:20.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960765748318208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:44:25.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960786703060992[0;39m 生成今日电子书快照开始
2022-04-22 23:44:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960786703060992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:25.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960786703060992[0;39m ==> Parameters: 
2022-04-22 23:44:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960786703060992[0;39m <==    Updates: 0
2022-04-22 23:44:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960786703060992[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:44:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960807678775296[0;39m 生成今日电子书快照开始
2022-04-22 23:44:30.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960807678775296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:30.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960807678775296[0;39m ==> Parameters: 
2022-04-22 23:44:30.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960807678775296[0;39m <==    Updates: 0
2022-04-22 23:44:30.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960807678775296[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:44:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960828654489600[0;39m 生成今日电子书快照开始
2022-04-22 23:44:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960828654489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:35.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960828654489600[0;39m ==> Parameters: 
2022-04-22 23:44:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960828654489600[0;39m <==    Updates: 0
2022-04-22 23:44:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960828654489600[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:44:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960828880982016[0;39m start updating Ebook doc
2022-04-22 23:44:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960828880982016[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:44:35.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960828880982016[0;39m ==> Parameters: 
2022-04-22 23:44:35.101 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960828880982016[0;39m <==    Updates: 1
2022-04-22 23:44:35.101 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960828880982016[0;39m update ends, take 38 millisecs
2022-04-22 23:44:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960849596649472[0;39m 生成今日电子书快照开始
2022-04-22 23:44:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960849596649472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:40.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960849596649472[0;39m ==> Parameters: 
2022-04-22 23:44:40.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960849596649472[0;39m <==    Updates: 0
2022-04-22 23:44:40.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960849596649472[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:44:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960870601723904[0;39m 生成今日电子书快照开始
2022-04-22 23:44:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960870601723904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960870601723904[0;39m ==> Parameters: 
2022-04-22 23:44:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960870601723904[0;39m <==    Updates: 0
2022-04-22 23:44:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960870601723904[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:44:50.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960891581632512[0;39m 生成今日电子书快照开始
2022-04-22 23:44:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960891581632512[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960891581632512[0;39m ==> Parameters: 
2022-04-22 23:44:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960891581632512[0;39m <==    Updates: 0
2022-04-22 23:44:50.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960891581632512[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:44:55.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960912532180992[0;39m 生成今日电子书快照开始
2022-04-22 23:44:55.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960912532180992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:44:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960912532180992[0;39m ==> Parameters: 
2022-04-22 23:44:55.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960912532180992[0;39m <==    Updates: 0
2022-04-22 23:44:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960912532180992[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:45:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960933503700992[0;39m 生成今日电子书快照开始
2022-04-22 23:45:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960933503700992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960933503700992[0;39m ==> Parameters: 
2022-04-22 23:45:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960933503700992[0;39m <==    Updates: 0
2022-04-22 23:45:00.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960933503700992[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:45:05.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960954479415296[0;39m 生成今日电子书快照开始
2022-04-22 23:45:05.134 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960954479415296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:05.134 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960954479415296[0;39m ==> Parameters: 
2022-04-22 23:45:05.298 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960954479415296[0;39m <==    Updates: 0
2022-04-22 23:45:05.299 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960954479415296[0;39m 生成今日电子书快照结束，耗时：292毫秒
2022-04-22 23:45:05.299 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172960955704152064[0;39m start updating Ebook doc
2022-04-22 23:45:05.300 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960955704152064[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:45:05.300 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960955704152064[0;39m ==> Parameters: 
2022-04-22 23:45:05.477 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172960955704152064[0;39m <==    Updates: 1
2022-04-22 23:45:05.477 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172960955704152064[0;39m update ends, take 178 millisecs
2022-04-22 23:45:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960975429963776[0;39m 生成今日电子书快照开始
2022-04-22 23:45:10.017 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960975429963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:10.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960975429963776[0;39m ==> Parameters: 
2022-04-22 23:45:10.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960975429963776[0;39m <==    Updates: 0
2022-04-22 23:45:10.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960975429963776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:45:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172960996401483776[0;39m 生成今日电子书快照开始
2022-04-22 23:45:15.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960996401483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960996401483776[0;39m ==> Parameters: 
2022-04-22 23:45:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172960996401483776[0;39m <==    Updates: 0
2022-04-22 23:45:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172960996401483776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:45:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961017406558208[0;39m 生成今日电子书快照开始
2022-04-22 23:45:20.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961017406558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961017406558208[0;39m ==> Parameters: 
2022-04-22 23:45:20.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961017406558208[0;39m <==    Updates: 0
2022-04-22 23:45:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961017406558208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:45:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961038340329472[0;39m 生成今日电子书快照开始
2022-04-22 23:45:25.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961038340329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:25.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961038340329472[0;39m ==> Parameters: 
2022-04-22 23:45:25.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961038340329472[0;39m <==    Updates: 0
2022-04-22 23:45:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961038340329472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:45:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961059337015296[0;39m 生成今日电子书快照开始
2022-04-22 23:45:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961059337015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961059337015296[0;39m ==> Parameters: 
2022-04-22 23:45:30.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961059337015296[0;39m <==    Updates: 0
2022-04-22 23:45:30.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961059337015296[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:45:35.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961080321118208[0;39m 生成今日电子书快照开始
2022-04-22 23:45:35.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961080321118208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:35.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961080321118208[0;39m ==> Parameters: 
2022-04-22 23:45:35.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961080321118208[0;39m <==    Updates: 0
2022-04-22 23:45:35.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961080321118208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:45:35.087 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961080644079616[0;39m start updating Ebook doc
2022-04-22 23:45:35.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961080644079616[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:45:35.088 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961080644079616[0;39m ==> Parameters: 
2022-04-22 23:45:35.128 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961080644079616[0;39m <==    Updates: 1
2022-04-22 23:45:35.129 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961080644079616[0;39m update ends, take 42 millisecs
2022-04-22 23:45:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961101259083776[0;39m 生成今日电子书快照开始
2022-04-22 23:45:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961101259083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:40.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961101259083776[0;39m ==> Parameters: 
2022-04-22 23:45:40.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961101259083776[0;39m <==    Updates: 0
2022-04-22 23:45:40.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961101259083776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:45:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961122238992384[0;39m 生成今日电子书快照开始
2022-04-22 23:45:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961122238992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:45.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961122238992384[0;39m ==> Parameters: 
2022-04-22 23:45:45.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961122238992384[0;39m <==    Updates: 0
2022-04-22 23:45:45.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961122238992384[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:45:50.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961143227289600[0;39m 生成今日电子书快照开始
2022-04-22 23:45:50.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961143227289600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:50.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961143227289600[0;39m ==> Parameters: 
2022-04-22 23:45:50.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961143227289600[0;39m <==    Updates: 0
2022-04-22 23:45:50.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961143227289600[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:45:55.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961164207198208[0;39m 生成今日电子书快照开始
2022-04-22 23:45:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961164207198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:45:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961164207198208[0;39m ==> Parameters: 
2022-04-22 23:45:55.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961164207198208[0;39m <==    Updates: 0
2022-04-22 23:45:55.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961164207198208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:46:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961185174523904[0;39m 生成今日电子书快照开始
2022-04-22 23:46:00.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961185174523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:00.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961185174523904[0;39m ==> Parameters: 
2022-04-22 23:46:00.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961185174523904[0;39m <==    Updates: 0
2022-04-22 23:46:00.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961185174523904[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:46:05.005 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961206129266688[0;39m start updating Ebook doc
2022-04-22 23:46:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961206129266688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:46:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961206129266688[0;39m ==> Parameters: 
2022-04-22 23:46:05.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961206129266688[0;39m <==    Updates: 1
2022-04-22 23:46:05.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961206129266688[0;39m update ends, take 71 millisecs
2022-04-22 23:46:05.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961206427062272[0;39m 生成今日电子书快照开始
2022-04-22 23:46:05.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961206427062272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:05.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961206427062272[0;39m ==> Parameters: 
2022-04-22 23:46:05.121 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961206427062272[0;39m <==    Updates: 0
2022-04-22 23:46:05.121 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961206427062272[0;39m 生成今日电子书快照结束，耗时：45毫秒
2022-04-22 23:46:10.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961227113369600[0;39m 生成今日电子书快照开始
2022-04-22 23:46:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961227113369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961227113369600[0;39m ==> Parameters: 
2022-04-22 23:46:10.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961227113369600[0;39m <==    Updates: 0
2022-04-22 23:46:10.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961227113369600[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:46:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961248072306688[0;39m 生成今日电子书快照开始
2022-04-22 23:46:15.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961248072306688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:15.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961248072306688[0;39m ==> Parameters: 
2022-04-22 23:46:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961248072306688[0;39m <==    Updates: 0
2022-04-22 23:46:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961248072306688[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:46:20.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961269056409600[0;39m 生成今日电子书快照开始
2022-04-22 23:46:20.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961269056409600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:20.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961269056409600[0;39m ==> Parameters: 
2022-04-22 23:46:20.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961269056409600[0;39m <==    Updates: 0
2022-04-22 23:46:20.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961269056409600[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:46:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961290027929600[0;39m 生成今日电子书快照开始
2022-04-22 23:46:25.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961290027929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961290027929600[0;39m ==> Parameters: 
2022-04-22 23:46:25.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961290027929600[0;39m <==    Updates: 0
2022-04-22 23:46:25.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961290027929600[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:46:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961310978478080[0;39m 生成今日电子书快照开始
2022-04-22 23:46:30.053 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961310978478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:30.054 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961310978478080[0;39m ==> Parameters: 
2022-04-22 23:46:30.120 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961310978478080[0;39m <==    Updates: 0
2022-04-22 23:46:30.121 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961310978478080[0;39m 生成今日电子书快照结束，耗时：117毫秒
2022-04-22 23:46:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961331975163904[0;39m start updating Ebook doc
2022-04-22 23:46:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961331975163904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:46:35.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961331975163904[0;39m ==> Parameters: 
2022-04-22 23:46:35.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961331975163904[0;39m <==    Updates: 1
2022-04-22 23:46:35.079 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961331975163904[0;39m update ends, take 70 millisecs
2022-04-22 23:46:35.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961332268765184[0;39m 生成今日电子书快照开始
2022-04-22 23:46:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961332268765184[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:35.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961332268765184[0;39m ==> Parameters: 
2022-04-22 23:46:35.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961332268765184[0;39m <==    Updates: 0
2022-04-22 23:46:35.118 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961332268765184[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-22 23:46:40.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961352934100992[0;39m 生成今日电子书快照开始
2022-04-22 23:46:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961352934100992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:40.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961352934100992[0;39m ==> Parameters: 
2022-04-22 23:46:40.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961352934100992[0;39m <==    Updates: 0
2022-04-22 23:46:40.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961352934100992[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:46:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961373914009600[0;39m 生成今日电子书快照开始
2022-04-22 23:46:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961373914009600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961373914009600[0;39m ==> Parameters: 
2022-04-22 23:46:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961373914009600[0;39m <==    Updates: 0
2022-04-22 23:46:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961373914009600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:46:50.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961394877140992[0;39m 生成今日电子书快照开始
2022-04-22 23:46:50.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961394877140992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961394877140992[0;39m ==> Parameters: 
2022-04-22 23:46:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961394877140992[0;39m <==    Updates: 0
2022-04-22 23:46:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961394877140992[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:46:55.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961415836078080[0;39m 生成今日电子书快照开始
2022-04-22 23:46:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961415836078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:46:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961415836078080[0;39m ==> Parameters: 
2022-04-22 23:46:55.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961415836078080[0;39m <==    Updates: 0
2022-04-22 23:46:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961415836078080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:47:00.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961436832763904[0;39m 生成今日电子书快照开始
2022-04-22 23:47:00.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961436832763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961436832763904[0;39m ==> Parameters: 
2022-04-22 23:47:00.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961436832763904[0;39m <==    Updates: 0
2022-04-22 23:47:00.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961436832763904[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:47:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961457808478208[0;39m start updating Ebook doc
2022-04-22 23:47:05.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961457808478208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:47:05.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961457808478208[0;39m ==> Parameters: 
2022-04-22 23:47:05.084 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961457808478208[0;39m <==    Updates: 1
2022-04-22 23:47:05.084 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961457808478208[0;39m update ends, take 74 millisecs
2022-04-22 23:47:05.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961458118856704[0;39m 生成今日电子书快照开始
2022-04-22 23:47:05.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961458118856704[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:05.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961458118856704[0;39m ==> Parameters: 
2022-04-22 23:47:05.128 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961458118856704[0;39m <==    Updates: 0
2022-04-22 23:47:05.128 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961458118856704[0;39m 生成今日电子书快照结束，耗时：44毫秒
2022-04-22 23:47:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961478746443776[0;39m 生成今日电子书快照开始
2022-04-22 23:47:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961478746443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961478746443776[0;39m ==> Parameters: 
2022-04-22 23:47:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961478746443776[0;39m <==    Updates: 0
2022-04-22 23:47:10.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961478746443776[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:47:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961499730546688[0;39m 生成今日电子书快照开始
2022-04-22 23:47:15.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961499730546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:15.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961499730546688[0;39m ==> Parameters: 
2022-04-22 23:47:15.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961499730546688[0;39m <==    Updates: 0
2022-04-22 23:47:15.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961499730546688[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:47:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961520710455296[0;39m 生成今日电子书快照开始
2022-04-22 23:47:20.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961520710455296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:20.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961520710455296[0;39m ==> Parameters: 
2022-04-22 23:47:20.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961520710455296[0;39m <==    Updates: 0
2022-04-22 23:47:20.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961520710455296[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:47:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961541690363904[0;39m 生成今日电子书快照开始
2022-04-22 23:47:25.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961541690363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:25.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961541690363904[0;39m ==> Parameters: 
2022-04-22 23:47:25.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961541690363904[0;39m <==    Updates: 0
2022-04-22 23:47:25.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961541690363904[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:47:30.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961562640912384[0;39m 生成今日电子书快照开始
2022-04-22 23:47:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961562640912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961562640912384[0;39m ==> Parameters: 
2022-04-22 23:47:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961562640912384[0;39m <==    Updates: 0
2022-04-22 23:47:30.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961562640912384[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:47:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961583604043776[0;39m start updating Ebook doc
2022-04-22 23:47:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961583604043776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:47:35.021 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961583604043776[0;39m ==> Parameters: 
2022-04-22 23:47:35.061 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961583604043776[0;39m <==    Updates: 1
2022-04-22 23:47:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961583604043776[0;39m update ends, take 60 millisecs
2022-04-22 23:47:35.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961583855702016[0;39m 生成今日电子书快照开始
2022-04-22 23:47:35.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961583855702016[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961583855702016[0;39m ==> Parameters: 
2022-04-22 23:47:35.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961583855702016[0;39m <==    Updates: 0
2022-04-22 23:47:35.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961583855702016[0;39m 生成今日电子书快照结束，耗时：42毫秒
2022-04-22 23:47:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961604575563776[0;39m 生成今日电子书快照开始
2022-04-22 23:47:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961604575563776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:40.049 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961604575563776[0;39m ==> Parameters: 
2022-04-22 23:47:40.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961604575563776[0;39m <==    Updates: 0
2022-04-22 23:47:40.097 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961604575563776[0;39m 生成今日电子书快照结束，耗时：95毫秒
2022-04-22 23:47:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961625572249600[0;39m 生成今日电子书快照开始
2022-04-22 23:47:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961625572249600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961625572249600[0;39m ==> Parameters: 
2022-04-22 23:47:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961625572249600[0;39m <==    Updates: 0
2022-04-22 23:47:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961625572249600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:47:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961646526992384[0;39m 生成今日电子书快照开始
2022-04-22 23:47:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961646526992384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961646526992384[0;39m ==> Parameters: 
2022-04-22 23:47:50.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961646526992384[0;39m <==    Updates: 0
2022-04-22 23:47:50.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961646526992384[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:47:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961667523678208[0;39m 生成今日电子书快照开始
2022-04-22 23:47:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961667523678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:47:55.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961667523678208[0;39m ==> Parameters: 
2022-04-22 23:47:55.083 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961667523678208[0;39m <==    Updates: 0
2022-04-22 23:47:55.083 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961667523678208[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:48:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961688461643776[0;39m 生成今日电子书快照开始
2022-04-22 23:48:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961688461643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961688461643776[0;39m ==> Parameters: 
2022-04-22 23:48:00.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961688461643776[0;39m <==    Updates: 0
2022-04-22 23:48:00.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961688461643776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:48:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961709433163776[0;39m 生成今日电子书快照开始
2022-04-22 23:48:05.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961709433163776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:05.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961709433163776[0;39m ==> Parameters: 
2022-04-22 23:48:05.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961709433163776[0;39m <==    Updates: 0
2022-04-22 23:48:05.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961709433163776[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:48:05.080 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961709760319488[0;39m start updating Ebook doc
2022-04-22 23:48:05.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961709760319488[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:48:05.080 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961709760319488[0;39m ==> Parameters: 
2022-04-22 23:48:05.121 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961709760319488[0;39m <==    Updates: 1
2022-04-22 23:48:05.121 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961709760319488[0;39m update ends, take 41 millisecs
2022-04-22 23:48:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961730404683776[0;39m 生成今日电子书快照开始
2022-04-22 23:48:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961730404683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961730404683776[0;39m ==> Parameters: 
2022-04-22 23:48:10.088 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961730404683776[0;39m <==    Updates: 0
2022-04-22 23:48:10.089 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961730404683776[0;39m 生成今日电子书快照结束，耗时：87毫秒
2022-04-22 23:48:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961751388786688[0;39m 生成今日电子书快照开始
2022-04-22 23:48:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961751388786688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961751388786688[0;39m ==> Parameters: 
2022-04-22 23:48:15.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961751388786688[0;39m <==    Updates: 0
2022-04-22 23:48:15.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961751388786688[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:48:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961772347723776[0;39m 生成今日电子书快照开始
2022-04-22 23:48:20.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961772347723776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:20.020 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961772347723776[0;39m ==> Parameters: 
2022-04-22 23:48:20.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961772347723776[0;39m <==    Updates: 0
2022-04-22 23:48:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961772347723776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:48:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961793348603904[0;39m 生成今日电子书快照开始
2022-04-22 23:48:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961793348603904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:25.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961793348603904[0;39m ==> Parameters: 
2022-04-22 23:48:25.082 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961793348603904[0;39m <==    Updates: 0
2022-04-22 23:48:25.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961793348603904[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:48:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961814282375168[0;39m 生成今日电子书快照开始
2022-04-22 23:48:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961814282375168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:30.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961814282375168[0;39m ==> Parameters: 
2022-04-22 23:48:30.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961814282375168[0;39m <==    Updates: 0
2022-04-22 23:48:30.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961814282375168[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 23:48:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961835262283776[0;39m start updating Ebook doc
2022-04-22 23:48:35.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961835262283776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:48:35.032 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961835262283776[0;39m ==> Parameters: 
2022-04-22 23:48:35.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961835262283776[0;39m <==    Updates: 1
2022-04-22 23:48:35.071 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961835262283776[0;39m update ends, take 69 millisecs
2022-04-22 23:48:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961835555885056[0;39m 生成今日电子书快照开始
2022-04-22 23:48:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961835555885056[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:35.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961835555885056[0;39m ==> Parameters: 
2022-04-22 23:48:35.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961835555885056[0;39m <==    Updates: 0
2022-04-22 23:48:35.109 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961835555885056[0;39m 生成今日电子书快照结束，耗时：37毫秒
2022-04-22 23:48:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961856263163904[0;39m 生成今日电子书快照开始
2022-04-22 23:48:40.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961856263163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:40.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961856263163904[0;39m ==> Parameters: 
2022-04-22 23:48:40.095 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961856263163904[0;39m <==    Updates: 0
2022-04-22 23:48:40.096 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961856263163904[0;39m 生成今日电子书快照结束，耗时：87毫秒
2022-04-22 23:48:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961877230489600[0;39m 生成今日电子书快照开始
2022-04-22 23:48:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961877230489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961877230489600[0;39m ==> Parameters: 
2022-04-22 23:48:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961877230489600[0;39m <==    Updates: 0
2022-04-22 23:48:45.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961877230489600[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:48:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961898210398208[0;39m 生成今日电子书快照开始
2022-04-22 23:48:50.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961898210398208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:50.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961898210398208[0;39m ==> Parameters: 
2022-04-22 23:48:50.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961898210398208[0;39m <==    Updates: 0
2022-04-22 23:48:50.085 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961898210398208[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:48:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961919173529600[0;39m 生成今日电子书快照开始
2022-04-22 23:48:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961919173529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:48:55.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961919173529600[0;39m ==> Parameters: 
2022-04-22 23:48:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961919173529600[0;39m <==    Updates: 0
2022-04-22 23:48:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961919173529600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:49:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961940119883776[0;39m 生成今日电子书快照开始
2022-04-22 23:49:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961940119883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:00.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961940119883776[0;39m ==> Parameters: 
2022-04-22 23:49:00.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961940119883776[0;39m <==    Updates: 0
2022-04-22 23:49:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961940119883776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:49:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961961120763904[0;39m 生成今日电子书快照开始
2022-04-22 23:49:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961961120763904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:05.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961961120763904[0;39m ==> Parameters: 
2022-04-22 23:49:05.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961961120763904[0;39m <==    Updates: 0
2022-04-22 23:49:05.055 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961961120763904[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-22 23:49:05.056 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172961961317896192[0;39m start updating Ebook doc
2022-04-22 23:49:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961961317896192[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:49:05.056 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961961317896192[0;39m ==> Parameters: 
2022-04-22 23:49:05.097 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172961961317896192[0;39m <==    Updates: 1
2022-04-22 23:49:05.098 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172961961317896192[0;39m update ends, take 42 millisecs
2022-04-22 23:49:10.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172961982058729472[0;39m 生成今日电子书快照开始
2022-04-22 23:49:10.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961982058729472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961982058729472[0;39m ==> Parameters: 
2022-04-22 23:49:10.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172961982058729472[0;39m <==    Updates: 0
2022-04-22 23:49:10.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172961982058729472[0;39m 生成今日电子书快照结束，耗时：71毫秒
2022-04-22 23:49:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962003030249472[0;39m 生成今日电子书快照开始
2022-04-22 23:49:15.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962003030249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962003030249472[0;39m ==> Parameters: 
2022-04-22 23:49:15.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962003030249472[0;39m <==    Updates: 0
2022-04-22 23:49:15.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962003030249472[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:49:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962024005963776[0;39m 生成今日电子书快照开始
2022-04-22 23:49:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962024005963776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:20.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962024005963776[0;39m ==> Parameters: 
2022-04-22 23:49:20.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962024005963776[0;39m <==    Updates: 0
2022-04-22 23:49:20.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962024005963776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:49:25.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962044977483776[0;39m 生成今日电子书快照开始
2022-04-22 23:49:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962044977483776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:25.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962044977483776[0;39m ==> Parameters: 
2022-04-22 23:49:25.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962044977483776[0;39m <==    Updates: 0
2022-04-22 23:49:25.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962044977483776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:49:30.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962065982558208[0;39m 生成今日电子书快照开始
2022-04-22 23:49:30.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962065982558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:30.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962065982558208[0;39m ==> Parameters: 
2022-04-22 23:49:30.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962065982558208[0;39m <==    Updates: 0
2022-04-22 23:49:30.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962065982558208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:49:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962086954078208[0;39m start updating Ebook doc
2022-04-22 23:49:35.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962086954078208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:49:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962086954078208[0;39m ==> Parameters: 
2022-04-22 23:49:35.078 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962086954078208[0;39m <==    Updates: 1
2022-04-22 23:49:35.078 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962086954078208[0;39m update ends, take 68 millisecs
2022-04-22 23:49:35.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962087239290880[0;39m 生成今日电子书快照开始
2022-04-22 23:49:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962087239290880[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:35.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962087239290880[0;39m ==> Parameters: 
2022-04-22 23:49:35.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962087239290880[0;39m <==    Updates: 0
2022-04-22 23:49:35.116 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962087239290880[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:49:40.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962107917209600[0;39m 生成今日电子书快照开始
2022-04-22 23:49:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962107917209600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962107917209600[0;39m ==> Parameters: 
2022-04-22 23:49:40.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962107917209600[0;39m <==    Updates: 0
2022-04-22 23:49:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962107917209600[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:49:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962128876146688[0;39m 生成今日电子书快照开始
2022-04-22 23:49:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962128876146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:45.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962128876146688[0;39m ==> Parameters: 
2022-04-22 23:49:45.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962128876146688[0;39m <==    Updates: 0
2022-04-22 23:49:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962128876146688[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:49:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962149864443904[0;39m 生成今日电子书快照开始
2022-04-22 23:49:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962149864443904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:50.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962149864443904[0;39m ==> Parameters: 
2022-04-22 23:49:50.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962149864443904[0;39m <==    Updates: 0
2022-04-22 23:49:50.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962149864443904[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:49:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962170835963904[0;39m 生成今日电子书快照开始
2022-04-22 23:49:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962170835963904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:49:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962170835963904[0;39m ==> Parameters: 
2022-04-22 23:49:55.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962170835963904[0;39m <==    Updates: 0
2022-04-22 23:49:55.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962170835963904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:50:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962191778123776[0;39m 生成今日电子书快照开始
2022-04-22 23:50:00.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962191778123776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:00.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962191778123776[0;39m ==> Parameters: 
2022-04-22 23:50:00.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962191778123776[0;39m <==    Updates: 0
2022-04-22 23:50:00.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962191778123776[0;39m 生成今日电子书快照结束，耗时：82毫秒
2022-04-22 23:50:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962212749643776[0;39m 生成今日电子书快照开始
2022-04-22 23:50:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962212749643776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:05.104 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962212749643776[0;39m ==> Parameters: 
2022-04-22 23:50:05.268 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962212749643776[0;39m <==    Updates: 0
2022-04-22 23:50:05.269 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962212749643776[0;39m 生成今日电子书快照结束，耗时：266毫秒
2022-04-22 23:50:05.269 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962213869522944[0;39m start updating Ebook doc
2022-04-22 23:50:05.269 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962213869522944[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:50:05.269 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962213869522944[0;39m ==> Parameters: 
2022-04-22 23:50:05.307 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962213869522944[0;39m <==    Updates: 1
2022-04-22 23:50:05.308 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962213869522944[0;39m update ends, take 39 millisecs
2022-04-22 23:50:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962233729552384[0;39m 生成今日电子书快照开始
2022-04-22 23:50:10.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962233729552384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:10.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962233729552384[0;39m ==> Parameters: 
2022-04-22 23:50:10.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962233729552384[0;39m <==    Updates: 0
2022-04-22 23:50:10.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962233729552384[0;39m 生成今日电子书快照结束，耗时：58毫秒
2022-04-22 23:50:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962254713655296[0;39m 生成今日电子书快照开始
2022-04-22 23:50:15.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962254713655296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962254713655296[0;39m ==> Parameters: 
2022-04-22 23:50:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962254713655296[0;39m <==    Updates: 0
2022-04-22 23:50:15.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962254713655296[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:50:20.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962275693563904[0;39m 生成今日电子书快照开始
2022-04-22 23:50:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962275693563904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962275693563904[0;39m ==> Parameters: 
2022-04-22 23:50:20.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962275693563904[0;39m <==    Updates: 0
2022-04-22 23:50:20.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962275693563904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:50:25.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962296665083904[0;39m 生成今日电子书快照开始
2022-04-22 23:50:25.044 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962296665083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:25.045 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962296665083904[0;39m ==> Parameters: 
2022-04-22 23:50:25.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962296665083904[0;39m <==    Updates: 0
2022-04-22 23:50:25.086 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962296665083904[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:50:30.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962317598855168[0;39m 生成今日电子书快照开始
2022-04-22 23:50:30.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962317598855168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962317598855168[0;39m ==> Parameters: 
2022-04-22 23:50:30.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962317598855168[0;39m <==    Updates: 0
2022-04-22 23:50:30.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962317598855168[0;39m 生成今日电子书快照结束，耗时：78毫秒
2022-04-22 23:50:35.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962338603929600[0;39m 生成今日电子书快照开始
2022-04-22 23:50:35.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962338603929600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:35.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962338603929600[0;39m ==> Parameters: 
2022-04-22 23:50:35.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962338603929600[0;39m <==    Updates: 0
2022-04-22 23:50:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962338603929600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:50:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962338872365056[0;39m start updating Ebook doc
2022-04-22 23:50:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962338872365056[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:50:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962338872365056[0;39m ==> Parameters: 
2022-04-22 23:50:35.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962338872365056[0;39m <==    Updates: 1
2022-04-22 23:50:35.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962338872365056[0;39m update ends, take 37 millisecs
2022-04-22 23:50:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962359554478080[0;39m 生成今日电子书快照开始
2022-04-22 23:50:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962359554478080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962359554478080[0;39m ==> Parameters: 
2022-04-22 23:50:40.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962359554478080[0;39m <==    Updates: 0
2022-04-22 23:50:40.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962359554478080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:50:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962380534386688[0;39m 生成今日电子书快照开始
2022-04-22 23:50:45.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962380534386688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962380534386688[0;39m ==> Parameters: 
2022-04-22 23:50:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962380534386688[0;39m <==    Updates: 0
2022-04-22 23:50:45.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962380534386688[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:50:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962401493323776[0;39m 生成今日电子书快照开始
2022-04-22 23:50:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962401493323776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962401493323776[0;39m ==> Parameters: 
2022-04-22 23:50:50.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962401493323776[0;39m <==    Updates: 0
2022-04-22 23:50:50.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962401493323776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:50:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962422464843776[0;39m 生成今日电子书快照开始
2022-04-22 23:50:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962422464843776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:50:55.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962422464843776[0;39m ==> Parameters: 
2022-04-22 23:50:55.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962422464843776[0;39m <==    Updates: 0
2022-04-22 23:50:55.091 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962422464843776[0;39m 生成今日电子书快照结束，耗时：89毫秒
2022-04-22 23:51:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962443436363776[0;39m 生成今日电子书快照开始
2022-04-22 23:51:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962443436363776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962443436363776[0;39m ==> Parameters: 
2022-04-22 23:51:00.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962443436363776[0;39m <==    Updates: 0
2022-04-22 23:51:00.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962443436363776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:51:05.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962464407883776[0;39m 生成今日电子书快照开始
2022-04-22 23:51:05.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962464407883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:05.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962464407883776[0;39m ==> Parameters: 
2022-04-22 23:51:05.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962464407883776[0;39m <==    Updates: 0
2022-04-22 23:51:05.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962464407883776[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:51:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962464693096448[0;39m start updating Ebook doc
2022-04-22 23:51:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962464693096448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:51:05.071 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962464693096448[0;39m ==> Parameters: 
2022-04-22 23:51:05.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962464693096448[0;39m <==    Updates: 1
2022-04-22 23:51:05.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962464693096448[0;39m update ends, take 40 millisecs
2022-04-22 23:51:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962485387792384[0;39m 生成今日电子书快照开始
2022-04-22 23:51:10.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962485387792384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:10.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962485387792384[0;39m ==> Parameters: 
2022-04-22 23:51:10.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962485387792384[0;39m <==    Updates: 0
2022-04-22 23:51:10.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962485387792384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:51:15.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962506350923776[0;39m 生成今日电子书快照开始
2022-04-22 23:51:15.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962506350923776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:15.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962506350923776[0;39m ==> Parameters: 
2022-04-22 23:51:15.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962506350923776[0;39m <==    Updates: 0
2022-04-22 23:51:15.074 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962506350923776[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:51:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962527335026688[0;39m 生成今日电子书快照开始
2022-04-22 23:51:20.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962527335026688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:20.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962527335026688[0;39m ==> Parameters: 
2022-04-22 23:51:20.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962527335026688[0;39m <==    Updates: 0
2022-04-22 23:51:20.082 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962527335026688[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:51:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962548298158080[0;39m 生成今日电子书快照开始
2022-04-22 23:51:25.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962548298158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:25.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962548298158080[0;39m ==> Parameters: 
2022-04-22 23:51:25.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962548298158080[0;39m <==    Updates: 0
2022-04-22 23:51:25.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962548298158080[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:51:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962569294843904[0;39m 生成今日电子书快照开始
2022-04-22 23:51:30.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962569294843904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:30.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962569294843904[0;39m ==> Parameters: 
2022-04-22 23:51:30.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962569294843904[0;39m <==    Updates: 0
2022-04-22 23:51:30.061 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962569294843904[0;39m 生成今日电子书快照结束，耗时：52毫秒
2022-04-22 23:51:35.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962590249586688[0;39m 生成今日电子书快照开始
2022-04-22 23:51:35.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962590249586688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:35.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962590249586688[0;39m ==> Parameters: 
2022-04-22 23:51:35.069 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962590249586688[0;39m <==    Updates: 0
2022-04-22 23:51:35.070 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962590249586688[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:51:35.070 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962590522216448[0;39m start updating Ebook doc
2022-04-22 23:51:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962590522216448[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:51:35.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962590522216448[0;39m ==> Parameters: 
2022-04-22 23:51:35.110 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962590522216448[0;39m <==    Updates: 1
2022-04-22 23:51:35.110 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962590522216448[0;39m update ends, take 40 millisecs
2022-04-22 23:51:40.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962611204329472[0;39m 生成今日电子书快照开始
2022-04-22 23:51:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962611204329472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:40.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962611204329472[0;39m ==> Parameters: 
2022-04-22 23:51:40.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962611204329472[0;39m <==    Updates: 0
2022-04-22 23:51:40.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962611204329472[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:51:45.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962632188432384[0;39m 生成今日电子书快照开始
2022-04-22 23:51:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962632188432384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962632188432384[0;39m ==> Parameters: 
2022-04-22 23:51:45.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962632188432384[0;39m <==    Updates: 0
2022-04-22 23:51:45.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962632188432384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:51:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962653180923904[0;39m 生成今日电子书快照开始
2022-04-22 23:51:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962653180923904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:50.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962653180923904[0;39m ==> Parameters: 
2022-04-22 23:51:50.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962653180923904[0;39m <==    Updates: 0
2022-04-22 23:51:50.088 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962653180923904[0;39m 生成今日电子书快照结束，耗时：79毫秒
2022-04-22 23:51:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962674118889472[0;39m 生成今日电子书快照开始
2022-04-22 23:51:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962674118889472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:51:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962674118889472[0;39m ==> Parameters: 
2022-04-22 23:51:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962674118889472[0;39m <==    Updates: 0
2022-04-22 23:51:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962674118889472[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:52:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962695107186688[0;39m 生成今日电子书快照开始
2022-04-22 23:52:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962695107186688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962695107186688[0;39m ==> Parameters: 
2022-04-22 23:52:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962695107186688[0;39m <==    Updates: 0
2022-04-22 23:52:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962695107186688[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:52:05.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962716095483904[0;39m 生成今日电子书快照开始
2022-04-22 23:52:05.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962716095483904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:05.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962716095483904[0;39m ==> Parameters: 
2022-04-22 23:52:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962716095483904[0;39m <==    Updates: 0
2022-04-22 23:52:05.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962716095483904[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-04-22 23:52:05.068 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962716342947840[0;39m start updating Ebook doc
2022-04-22 23:52:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962716342947840[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:52:05.068 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962716342947840[0;39m ==> Parameters: 
2022-04-22 23:52:05.112 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962716342947840[0;39m <==    Updates: 1
2022-04-22 23:52:05.112 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962716342947840[0;39m update ends, take 44 millisecs
2022-04-22 23:52:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962737071198208[0;39m 生成今日电子书快照开始
2022-04-22 23:52:10.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962737071198208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:10.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962737071198208[0;39m ==> Parameters: 
2022-04-22 23:52:10.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962737071198208[0;39m <==    Updates: 0
2022-04-22 23:52:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962737071198208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:52:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962758034329600[0;39m 生成今日电子书快照开始
2022-04-22 23:52:15.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962758034329600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:15.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962758034329600[0;39m ==> Parameters: 
2022-04-22 23:52:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962758034329600[0;39m <==    Updates: 0
2022-04-22 23:52:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962758034329600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:52:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962778980683776[0;39m 生成今日电子书快照开始
2022-04-22 23:52:20.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962778980683776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:20.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962778980683776[0;39m ==> Parameters: 
2022-04-22 23:52:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962778980683776[0;39m <==    Updates: 0
2022-04-22 23:52:20.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962778980683776[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:52:25.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962799977369600[0;39m 生成今日电子书快照开始
2022-04-22 23:52:25.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962799977369600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962799977369600[0;39m ==> Parameters: 
2022-04-22 23:52:25.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962799977369600[0;39m <==    Updates: 0
2022-04-22 23:52:25.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962799977369600[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:52:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962820953083904[0;39m 生成今日电子书快照开始
2022-04-22 23:52:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962820953083904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:30.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962820953083904[0;39m ==> Parameters: 
2022-04-22 23:52:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962820953083904[0;39m <==    Updates: 0
2022-04-22 23:52:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962820953083904[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:52:35.008 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962841920409600[0;39m start updating Ebook doc
2022-04-22 23:52:35.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962841920409600[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:52:35.038 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962841920409600[0;39m ==> Parameters: 
2022-04-22 23:52:35.079 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962841920409600[0;39m <==    Updates: 1
2022-04-22 23:52:35.080 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962841920409600[0;39m update ends, take 71 millisecs
2022-04-22 23:52:35.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962842222399488[0;39m 生成今日电子书快照开始
2022-04-22 23:52:35.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962842222399488[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:35.081 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962842222399488[0;39m ==> Parameters: 
2022-04-22 23:52:35.119 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962842222399488[0;39m <==    Updates: 0
2022-04-22 23:52:35.119 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962842222399488[0;39m 生成今日电子书快照结束，耗时：39毫秒
2022-04-22 23:52:40.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962862896123904[0;39m 生成今日电子书快照开始
2022-04-22 23:52:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962862896123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:40.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962862896123904[0;39m ==> Parameters: 
2022-04-22 23:52:40.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962862896123904[0;39m <==    Updates: 0
2022-04-22 23:52:40.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962862896123904[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:52:45.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962883850866688[0;39m 生成今日电子书快照开始
2022-04-22 23:52:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962883850866688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:45.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962883850866688[0;39m ==> Parameters: 
2022-04-22 23:52:45.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962883850866688[0;39m <==    Updates: 0
2022-04-22 23:52:45.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962883850866688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:52:50.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962904839163904[0;39m 生成今日电子书快照开始
2022-04-22 23:52:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962904839163904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962904839163904[0;39m ==> Parameters: 
2022-04-22 23:52:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962904839163904[0;39m <==    Updates: 0
2022-04-22 23:52:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962904839163904[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:52:55.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962925806489600[0;39m 生成今日电子书快照开始
2022-04-22 23:52:55.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962925806489600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:52:55.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962925806489600[0;39m ==> Parameters: 
2022-04-22 23:52:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962925806489600[0;39m <==    Updates: 0
2022-04-22 23:52:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962925806489600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:53:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962946744455168[0;39m 生成今日电子书快照开始
2022-04-22 23:53:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962946744455168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:00.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962946744455168[0;39m ==> Parameters: 
2022-04-22 23:53:00.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962946744455168[0;39m <==    Updates: 0
2022-04-22 23:53:00.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962946744455168[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:53:05.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962967728558080[0;39m 生成今日电子书快照开始
2022-04-22 23:53:05.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962967728558080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:05.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962967728558080[0;39m ==> Parameters: 
2022-04-22 23:53:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962967728558080[0;39m <==    Updates: 0
2022-04-22 23:53:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962967728558080[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:53:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172962967988604928[0;39m start updating Ebook doc
2022-04-22 23:53:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962967988604928[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:53:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962967988604928[0;39m ==> Parameters: 
2022-04-22 23:53:05.109 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172962967988604928[0;39m <==    Updates: 1
2022-04-22 23:53:05.109 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172962967988604928[0;39m update ends, take 44 millisecs
2022-04-22 23:53:10.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172962988700078080[0;39m 生成今日电子书快照开始
2022-04-22 23:53:10.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962988700078080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962988700078080[0;39m ==> Parameters: 
2022-04-22 23:53:10.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172962988700078080[0;39m <==    Updates: 0
2022-04-22 23:53:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172962988700078080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:53:15.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963009700958208[0;39m 生成今日电子书快照开始
2022-04-22 23:53:15.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963009700958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:15.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963009700958208[0;39m ==> Parameters: 
2022-04-22 23:53:15.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963009700958208[0;39m <==    Updates: 0
2022-04-22 23:53:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963009700958208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:53:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963030647312384[0;39m 生成今日电子书快照开始
2022-04-22 23:53:20.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963030647312384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963030647312384[0;39m ==> Parameters: 
2022-04-22 23:53:20.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963030647312384[0;39m <==    Updates: 0
2022-04-22 23:53:20.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963030647312384[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:53:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963051614638080[0;39m 生成今日电子书快照开始
2022-04-22 23:53:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963051614638080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:25.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963051614638080[0;39m ==> Parameters: 
2022-04-22 23:53:25.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963051614638080[0;39m <==    Updates: 0
2022-04-22 23:53:25.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963051614638080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:53:30.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963072602935296[0;39m 生成今日电子书快照开始
2022-04-22 23:53:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963072602935296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963072602935296[0;39m ==> Parameters: 
2022-04-22 23:53:30.079 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963072602935296[0;39m <==    Updates: 0
2022-04-22 23:53:30.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963072602935296[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:53:35.002 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963093553483776[0;39m start updating Ebook doc
2022-04-22 23:53:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963093553483776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:53:35.034 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963093553483776[0;39m ==> Parameters: 
2022-04-22 23:53:35.083 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963093553483776[0;39m <==    Updates: 1
2022-04-22 23:53:35.084 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963093553483776[0;39m update ends, take 82 millisecs
2022-04-22 23:53:35.084 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963093897416704[0;39m 生成今日电子书快照开始
2022-04-22 23:53:35.084 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963093897416704[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:35.085 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963093897416704[0;39m ==> Parameters: 
2022-04-22 23:53:35.131 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963093897416704[0;39m <==    Updates: 0
2022-04-22 23:53:35.132 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963093897416704[0;39m 生成今日电子书快照结束，耗时：48毫秒
2022-04-22 23:53:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963114533392384[0;39m 生成今日电子书快照开始
2022-04-22 23:53:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963114533392384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963114533392384[0;39m ==> Parameters: 
2022-04-22 23:53:40.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963114533392384[0;39m <==    Updates: 0
2022-04-22 23:53:40.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963114533392384[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:53:45.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963135521689600[0;39m 生成今日电子书快照开始
2022-04-22 23:53:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963135521689600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:45.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963135521689600[0;39m ==> Parameters: 
2022-04-22 23:53:45.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963135521689600[0;39m <==    Updates: 0
2022-04-22 23:53:45.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963135521689600[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:53:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963156468043776[0;39m 生成今日电子书快照开始
2022-04-22 23:53:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963156468043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:50.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963156468043776[0;39m ==> Parameters: 
2022-04-22 23:53:50.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963156468043776[0;39m <==    Updates: 0
2022-04-22 23:53:50.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963156468043776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:53:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963177460535296[0;39m 生成今日电子书快照开始
2022-04-22 23:53:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963177460535296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:53:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963177460535296[0;39m ==> Parameters: 
2022-04-22 23:53:55.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963177460535296[0;39m <==    Updates: 0
2022-04-22 23:53:55.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963177460535296[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:54:00.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963198402695168[0;39m 生成今日电子书快照开始
2022-04-22 23:54:00.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963198402695168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:00.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963198402695168[0;39m ==> Parameters: 
2022-04-22 23:54:00.052 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963198402695168[0;39m <==    Updates: 0
2022-04-22 23:54:00.053 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963198402695168[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:54:04.995 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963219353243648[0;39m start updating Ebook doc
2022-04-22 23:54:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963219353243648[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:54:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963219353243648[0;39m ==> Parameters: 
2022-04-22 23:54:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963219353243648[0;39m <==    Updates: 1
2022-04-22 23:54:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963219353243648[0;39m update ends, take 69 millisecs
2022-04-22 23:54:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963219642650624[0;39m 生成今日电子书快照开始
2022-04-22 23:54:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963219642650624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:05.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963219642650624[0;39m ==> Parameters: 
2022-04-22 23:54:05.105 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963219642650624[0;39m <==    Updates: 0
2022-04-22 23:54:05.105 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963219642650624[0;39m 生成今日电子书快照结束，耗时：41毫秒
2022-04-22 23:54:10.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963240370900992[0;39m 生成今日电子书快照开始
2022-04-22 23:54:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963240370900992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:10.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963240370900992[0;39m ==> Parameters: 
2022-04-22 23:54:10.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963240370900992[0;39m <==    Updates: 0
2022-04-22 23:54:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963240370900992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:54:15.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963261334032384[0;39m 生成今日电子书快照开始
2022-04-22 23:54:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963261334032384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963261334032384[0;39m ==> Parameters: 
2022-04-22 23:54:15.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963261334032384[0;39m <==    Updates: 0
2022-04-22 23:54:15.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963261334032384[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:54:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963282330718208[0;39m 生成今日电子书快照开始
2022-04-22 23:54:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963282330718208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:20.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963282330718208[0;39m ==> Parameters: 
2022-04-22 23:54:20.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963282330718208[0;39m <==    Updates: 0
2022-04-22 23:54:20.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963282330718208[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:54:25.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963303264489472[0;39m 生成今日电子书快照开始
2022-04-22 23:54:25.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963303264489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:25.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963303264489472[0;39m ==> Parameters: 
2022-04-22 23:54:25.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963303264489472[0;39m <==    Updates: 0
2022-04-22 23:54:25.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963303264489472[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:54:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963324244398080[0;39m 生成今日电子书快照开始
2022-04-22 23:54:30.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963324244398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:30.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963324244398080[0;39m ==> Parameters: 
2022-04-22 23:54:30.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963324244398080[0;39m <==    Updates: 0
2022-04-22 23:54:30.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963324244398080[0;39m 生成今日电子书快照结束，耗时：62毫秒
2022-04-22 23:54:35.003 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963345215918080[0;39m start updating Ebook doc
2022-04-22 23:54:35.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963345215918080[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:54:35.025 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963345215918080[0;39m ==> Parameters: 
2022-04-22 23:54:35.062 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963345215918080[0;39m <==    Updates: 1
2022-04-22 23:54:35.062 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963345215918080[0;39m update ends, take 58 millisecs
2022-04-22 23:54:35.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963345467576320[0;39m 生成今日电子书快照开始
2022-04-22 23:54:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963345467576320[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:35.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963345467576320[0;39m ==> Parameters: 
2022-04-22 23:54:35.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963345467576320[0;39m <==    Updates: 0
2022-04-22 23:54:35.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963345467576320[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:54:40.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963366204215296[0;39m 生成今日电子书快照开始
2022-04-22 23:54:40.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963366204215296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:40.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963366204215296[0;39m ==> Parameters: 
2022-04-22 23:54:40.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963366204215296[0;39m <==    Updates: 0
2022-04-22 23:54:40.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963366204215296[0;39m 生成今日电子书快照结束，耗时：55毫秒
2022-04-22 23:54:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963387150569472[0;39m 生成今日电子书快照开始
2022-04-22 23:54:45.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963387150569472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:45.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963387150569472[0;39m ==> Parameters: 
2022-04-22 23:54:45.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963387150569472[0;39m <==    Updates: 0
2022-04-22 23:54:45.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963387150569472[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:54:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963408126283776[0;39m 生成今日电子书快照开始
2022-04-22 23:54:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963408126283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963408126283776[0;39m ==> Parameters: 
2022-04-22 23:54:50.065 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963408126283776[0;39m <==    Updates: 0
2022-04-22 23:54:50.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963408126283776[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:54:55.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963429097803776[0;39m 生成今日电子书快照开始
2022-04-22 23:54:55.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963429097803776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:54:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963429097803776[0;39m ==> Parameters: 
2022-04-22 23:54:55.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963429097803776[0;39m <==    Updates: 0
2022-04-22 23:54:55.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963429097803776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:55:00.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963450090295296[0;39m 生成今日电子书快照开始
2022-04-22 23:55:00.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963450090295296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:00.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963450090295296[0;39m ==> Parameters: 
2022-04-22 23:55:00.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963450090295296[0;39m <==    Updates: 0
2022-04-22 23:55:00.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963450090295296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:55:05.004 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963471049232384[0;39m start updating Ebook doc
2022-04-22 23:55:05.045 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963471049232384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:55:05.045 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963471049232384[0;39m ==> Parameters: 
2022-04-22 23:55:05.213 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963471049232384[0;39m <==    Updates: 1
2022-04-22 23:55:05.214 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963471049232384[0;39m update ends, take 209 millisecs
2022-04-22 23:55:05.214 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963471930036224[0;39m 生成今日电子书快照开始
2022-04-22 23:55:05.214 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963471930036224[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:05.214 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963471930036224[0;39m ==> Parameters: 
2022-04-22 23:55:05.389 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963471930036224[0;39m <==    Updates: 0
2022-04-22 23:55:05.389 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963471930036224[0;39m 生成今日电子书快照结束，耗时：175毫秒
2022-04-22 23:55:10.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963492045918208[0;39m 生成今日电子书快照开始
2022-04-22 23:55:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963492045918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:10.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963492045918208[0;39m ==> Parameters: 
2022-04-22 23:55:10.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963492045918208[0;39m <==    Updates: 0
2022-04-22 23:55:10.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963492045918208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:55:15.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963513004855296[0;39m 生成今日电子书快照开始
2022-04-22 23:55:15.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963513004855296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963513004855296[0;39m ==> Parameters: 
2022-04-22 23:55:15.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963513004855296[0;39m <==    Updates: 0
2022-04-22 23:55:15.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963513004855296[0;39m 生成今日电子书快照结束，耗时：65毫秒
2022-04-22 23:55:20.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963533967986688[0;39m 生成今日电子书快照开始
2022-04-22 23:55:20.269 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963533967986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:20.270 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963533967986688[0;39m ==> Parameters: 
2022-04-22 23:55:20.324 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963533967986688[0;39m <==    Updates: 0
2022-04-22 23:55:20.325 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963533967986688[0;39m 生成今日电子书快照结束，耗时：320毫秒
2022-04-22 23:55:25.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963554947895296[0;39m 生成今日电子书快照开始
2022-04-22 23:55:25.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963554947895296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:25.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963554947895296[0;39m ==> Parameters: 
2022-04-22 23:55:25.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963554947895296[0;39m <==    Updates: 0
2022-04-22 23:55:25.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963554947895296[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:55:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963575894249472[0;39m 生成今日电子书快照开始
2022-04-22 23:55:30.018 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963575894249472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:30.019 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963575894249472[0;39m ==> Parameters: 
2022-04-22 23:55:30.055 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963575894249472[0;39m <==    Updates: 0
2022-04-22 23:55:30.056 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963575894249472[0;39m 生成今日电子书快照结束，耗时：54毫秒
2022-04-22 23:55:35.001 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963596865769472[0;39m start updating Ebook doc
2022-04-22 23:55:35.027 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963596865769472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:55:35.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963596865769472[0;39m ==> Parameters: 
2022-04-22 23:55:35.064 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963596865769472[0;39m <==    Updates: 1
2022-04-22 23:55:35.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963596865769472[0;39m update ends, take 64 millisecs
2022-04-22 23:55:35.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963597134204928[0;39m 生成今日电子书快照开始
2022-04-22 23:55:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963597134204928[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:35.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963597134204928[0;39m ==> Parameters: 
2022-04-22 23:55:35.102 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963597134204928[0;39m <==    Updates: 0
2022-04-22 23:55:35.103 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963597134204928[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:55:40.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963617849872384[0;39m 生成今日电子书快照开始
2022-04-22 23:55:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963617849872384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:40.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963617849872384[0;39m ==> Parameters: 
2022-04-22 23:55:40.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963617849872384[0;39m <==    Updates: 0
2022-04-22 23:55:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963617849872384[0;39m 生成今日电子书快照结束，耗时：73毫秒
2022-04-22 23:55:45.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963638842363904[0;39m 生成今日电子书快照开始
2022-04-22 23:55:45.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963638842363904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:45.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963638842363904[0;39m ==> Parameters: 
2022-04-22 23:55:45.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963638842363904[0;39m <==    Updates: 0
2022-04-22 23:55:45.079 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963638842363904[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:55:50.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963659792912384[0;39m 生成今日电子书快照开始
2022-04-22 23:55:50.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963659792912384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:50.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963659792912384[0;39m ==> Parameters: 
2022-04-22 23:55:50.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963659792912384[0;39m <==    Updates: 0
2022-04-22 23:55:50.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963659792912384[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:55:55.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963680777015296[0;39m 生成今日电子书快照开始
2022-04-22 23:55:55.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963680777015296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:55:55.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963680777015296[0;39m ==> Parameters: 
2022-04-22 23:55:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963680777015296[0;39m <==    Updates: 0
2022-04-22 23:55:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963680777015296[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:56:00.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963701740146688[0;39m 生成今日电子书快照开始
2022-04-22 23:56:00.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963701740146688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:00.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963701740146688[0;39m ==> Parameters: 
2022-04-22 23:56:00.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963701740146688[0;39m <==    Updates: 0
2022-04-22 23:56:00.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963701740146688[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:56:05.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963722690695168[0;39m start updating Ebook doc
2022-04-22 23:56:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963722690695168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:56:05.024 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963722690695168[0;39m ==> Parameters: 
2022-04-22 23:56:05.063 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963722690695168[0;39m <==    Updates: 1
2022-04-22 23:56:05.064 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963722690695168[0;39m update ends, take 63 millisecs
2022-04-22 23:56:05.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963722959130624[0;39m 生成今日电子书快照开始
2022-04-22 23:56:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963722959130624[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:05.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963722959130624[0;39m ==> Parameters: 
2022-04-22 23:56:05.103 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963722959130624[0;39m <==    Updates: 0
2022-04-22 23:56:05.104 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963722959130624[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:56:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963743670603776[0;39m 生成今日电子书快照开始
2022-04-22 23:56:10.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963743670603776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:10.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963743670603776[0;39m ==> Parameters: 
2022-04-22 23:56:10.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963743670603776[0;39m <==    Updates: 0
2022-04-22 23:56:10.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963743670603776[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:56:15.011 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963764675678208[0;39m 生成今日电子书快照开始
2022-04-22 23:56:15.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963764675678208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:15.042 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963764675678208[0;39m ==> Parameters: 
2022-04-22 23:56:15.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963764675678208[0;39m <==    Updates: 0
2022-04-22 23:56:15.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963764675678208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:56:20.007 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963785634615296[0;39m 生成今日电子书快照开始
2022-04-22 23:56:20.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963785634615296[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:20.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963785634615296[0;39m ==> Parameters: 
2022-04-22 23:56:20.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963785634615296[0;39m <==    Updates: 0
2022-04-22 23:56:20.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963785634615296[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:56:25.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963806597746688[0;39m 生成今日电子书快照开始
2022-04-22 23:56:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963806597746688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:25.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963806597746688[0;39m ==> Parameters: 
2022-04-22 23:56:25.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963806597746688[0;39m <==    Updates: 0
2022-04-22 23:56:25.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963806597746688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:56:30.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963827552489472[0;39m 生成今日电子书快照开始
2022-04-22 23:56:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963827552489472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963827552489472[0;39m ==> Parameters: 
2022-04-22 23:56:30.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963827552489472[0;39m <==    Updates: 0
2022-04-22 23:56:30.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963827552489472[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:56:35.000 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963848519815168[0;39m start updating Ebook doc
2022-04-22 23:56:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963848519815168[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:56:35.020 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963848519815168[0;39m ==> Parameters: 
2022-04-22 23:56:35.059 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963848519815168[0;39m <==    Updates: 1
2022-04-22 23:56:35.059 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963848519815168[0;39m update ends, take 58 millisecs
2022-04-22 23:56:35.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963848771473408[0;39m 生成今日电子书快照开始
2022-04-22 23:56:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963848771473408[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:35.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963848771473408[0;39m ==> Parameters: 
2022-04-22 23:56:35.097 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963848771473408[0;39m <==    Updates: 0
2022-04-22 23:56:35.098 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963848771473408[0;39m 生成今日电子书快照结束，耗时：38毫秒
2022-04-22 23:56:40.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963869491335168[0;39m 生成今日电子书快照开始
2022-04-22 23:56:40.021 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963869491335168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:40.022 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963869491335168[0;39m ==> Parameters: 
2022-04-22 23:56:40.057 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963869491335168[0;39m <==    Updates: 0
2022-04-22 23:56:40.057 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963869491335168[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-04-22 23:56:45.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963890504798208[0;39m 生成今日电子书快照开始
2022-04-22 23:56:45.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963890504798208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:45.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963890504798208[0;39m ==> Parameters: 
2022-04-22 23:56:45.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963890504798208[0;39m <==    Updates: 0
2022-04-22 23:56:45.064 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963890504798208[0;39m 生成今日电子书快照结束，耗时：53毫秒
2022-04-22 23:56:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963911442763776[0;39m 生成今日电子书快照开始
2022-04-22 23:56:50.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963911442763776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:50.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963911442763776[0;39m ==> Parameters: 
2022-04-22 23:56:50.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963911442763776[0;39m <==    Updates: 0
2022-04-22 23:56:50.069 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963911442763776[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:56:55.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963932422672384[0;39m 生成今日电子书快照开始
2022-04-22 23:56:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963932422672384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:56:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963932422672384[0;39m ==> Parameters: 
2022-04-22 23:56:55.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963932422672384[0;39m <==    Updates: 0
2022-04-22 23:56:55.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963932422672384[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:57:00.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963953402580992[0;39m 生成今日电子书快照开始
2022-04-22 23:57:00.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963953402580992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963953402580992[0;39m ==> Parameters: 
2022-04-22 23:57:00.142 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963953402580992[0;39m <==    Updates: 0
2022-04-22 23:57:00.142 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963953402580992[0;39m 生成今日电子书快照结束，耗时：136毫秒
2022-04-22 23:57:05.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172963974378295296[0;39m start updating Ebook doc
2022-04-22 23:57:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963974378295296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:57:05.033 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963974378295296[0;39m ==> Parameters: 
2022-04-22 23:57:05.070 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172963974378295296[0;39m <==    Updates: 1
2022-04-22 23:57:05.070 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172963974378295296[0;39m update ends, take 62 millisecs
2022-04-22 23:57:05.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963974646730752[0;39m 生成今日电子书快照开始
2022-04-22 23:57:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963974646730752[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:05.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963974646730752[0;39m ==> Parameters: 
2022-04-22 23:57:05.117 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963974646730752[0;39m <==    Updates: 0
2022-04-22 23:57:05.117 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963974646730752[0;39m 生成今日电子书快照结束，耗时：46毫秒
2022-04-22 23:57:10.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172963995337232384[0;39m 生成今日电子书快照开始
2022-04-22 23:57:10.040 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963995337232384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:10.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963995337232384[0;39m ==> Parameters: 
2022-04-22 23:57:10.091 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172963995337232384[0;39m <==    Updates: 0
2022-04-22 23:57:10.092 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172963995337232384[0;39m 生成今日电子书快照结束，耗时：88毫秒
2022-04-22 23:57:15.008 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964016325529600[0;39m 生成今日电子书快照开始
2022-04-22 23:57:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964016325529600[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:15.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964016325529600[0;39m ==> Parameters: 
2022-04-22 23:57:15.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964016325529600[0;39m <==    Updates: 0
2022-04-22 23:57:15.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964016325529600[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:57:20.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964037271883776[0;39m 生成今日电子书快照开始
2022-04-22 23:57:20.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964037271883776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:20.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964037271883776[0;39m ==> Parameters: 
2022-04-22 23:57:20.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964037271883776[0;39m <==    Updates: 0
2022-04-22 23:57:20.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964037271883776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:57:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964058276958208[0;39m 生成今日电子书快照开始
2022-04-22 23:57:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964058276958208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:25.041 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964058276958208[0;39m ==> Parameters: 
2022-04-22 23:57:25.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964058276958208[0;39m <==    Updates: 0
2022-04-22 23:57:25.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964058276958208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:57:30.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964079219118080[0;39m 生成今日电子书快照开始
2022-04-22 23:57:30.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964079219118080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:30.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964079219118080[0;39m ==> Parameters: 
2022-04-22 23:57:30.070 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964079219118080[0;39m <==    Updates: 0
2022-04-22 23:57:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964079219118080[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:57:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172964100215803904[0;39m start updating Ebook doc
2022-04-22 23:57:35.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964100215803904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:57:35.037 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964100215803904[0;39m ==> Parameters: 
2022-04-22 23:57:35.077 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964100215803904[0;39m <==    Updates: 1
2022-04-22 23:57:35.077 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172964100215803904[0;39m update ends, take 68 millisecs
2022-04-22 23:57:35.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964100501016576[0;39m 生成今日电子书快照开始
2022-04-22 23:57:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964100501016576[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:35.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964100501016576[0;39m ==> Parameters: 
2022-04-22 23:57:35.116 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964100501016576[0;39m <==    Updates: 0
2022-04-22 23:57:35.117 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964100501016576[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:57:40.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964121170546688[0;39m 生成今日电子书快照开始
2022-04-22 23:57:40.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964121170546688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:40.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964121170546688[0;39m ==> Parameters: 
2022-04-22 23:57:40.078 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964121170546688[0;39m <==    Updates: 0
2022-04-22 23:57:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964121170546688[0;39m 生成今日电子书快照结束，耗时：72毫秒
2022-04-22 23:57:45.006 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964142146260992[0;39m 生成今日电子书快照开始
2022-04-22 23:57:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964142146260992[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:45.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964142146260992[0;39m ==> Parameters: 
2022-04-22 23:57:45.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964142146260992[0;39m <==    Updates: 0
2022-04-22 23:57:45.073 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964142146260992[0;39m 生成今日电子书快照结束，耗时：67毫秒
2022-04-22 23:57:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964163134558208[0;39m 生成今日电子书快照开始
2022-04-22 23:57:50.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964163134558208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964163134558208[0;39m ==> Parameters: 
2022-04-22 23:57:50.075 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964163134558208[0;39m <==    Updates: 0
2022-04-22 23:57:50.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964163134558208[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:57:55.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964184106078208[0;39m 生成今日电子书快照开始
2022-04-22 23:57:55.036 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964184106078208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:57:55.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964184106078208[0;39m ==> Parameters: 
2022-04-22 23:57:55.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964184106078208[0;39m <==    Updates: 0
2022-04-22 23:57:55.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964184106078208[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:58:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964205044043776[0;39m 生成今日电子书快照开始
2022-04-22 23:58:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964205044043776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:00.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964205044043776[0;39m ==> Parameters: 
2022-04-22 23:58:00.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964205044043776[0;39m <==    Updates: 0
2022-04-22 23:58:00.077 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964205044043776[0;39m 生成今日电子书快照结束，耗时：75毫秒
2022-04-22 23:58:05.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172964226049118208[0;39m start updating Ebook doc
2022-04-22 23:58:05.030 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964226049118208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:58:05.031 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964226049118208[0;39m ==> Parameters: 
2022-04-22 23:58:05.066 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964226049118208[0;39m <==    Updates: 1
2022-04-22 23:58:05.066 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172964226049118208[0;39m update ends, take 56 millisecs
2022-04-22 23:58:05.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964226288193536[0;39m 生成今日电子书快照开始
2022-04-22 23:58:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964226288193536[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:05.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964226288193536[0;39m ==> Parameters: 
2022-04-22 23:58:05.109 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964226288193536[0;39m <==    Updates: 0
2022-04-22 23:58:05.110 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964226288193536[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 23:58:10.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964246987083776[0;39m 生成今日电子书快照开始
2022-04-22 23:58:10.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964246987083776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:10.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964246987083776[0;39m ==> Parameters: 
2022-04-22 23:58:10.064 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964246987083776[0;39m <==    Updates: 0
2022-04-22 23:58:10.065 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964246987083776[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:58:15.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964267954409472[0;39m 生成今日电子书快照开始
2022-04-22 23:58:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964267954409472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:15.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964267954409472[0;39m ==> Parameters: 
2022-04-22 23:58:15.058 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964267954409472[0;39m <==    Updates: 0
2022-04-22 23:58:15.059 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964267954409472[0;39m 生成今日电子书快照结束，耗时：57毫秒
2022-04-22 23:58:20.004 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964288938512384[0;39m 生成今日电子书快照开始
2022-04-22 23:58:20.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964288938512384[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:20.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964288938512384[0;39m ==> Parameters: 
2022-04-22 23:58:20.086 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964288938512384[0;39m <==    Updates: 0
2022-04-22 23:58:20.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964288938512384[0;39m 生成今日电子书快照结束，耗时：83毫秒
2022-04-22 23:58:25.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964309905838080[0;39m 生成今日电子书快照开始
2022-04-22 23:58:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964309905838080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:25.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964309905838080[0;39m ==> Parameters: 
2022-04-22 23:58:25.063 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964309905838080[0;39m <==    Updates: 0
2022-04-22 23:58:25.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964309905838080[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:58:30.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964330902523904[0;39m 生成今日电子书快照开始
2022-04-22 23:58:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964330902523904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:30.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964330902523904[0;39m ==> Parameters: 
2022-04-22 23:58:30.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964330902523904[0;39m <==    Updates: 0
2022-04-22 23:58:30.071 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964330902523904[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:58:35.009 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172964351874043904[0;39m start updating Ebook doc
2022-04-22 23:58:35.040 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964351874043904[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:58:35.041 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964351874043904[0;39m ==> Parameters: 
2022-04-22 23:58:35.075 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964351874043904[0;39m <==    Updates: 1
2022-04-22 23:58:35.076 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172964351874043904[0;39m update ends, take 66 millisecs
2022-04-22 23:58:35.076 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964352155062272[0;39m 生成今日电子书快照开始
2022-04-22 23:58:35.076 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964352155062272[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:35.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964352155062272[0;39m ==> Parameters: 
2022-04-22 23:58:35.107 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964352155062272[0;39m <==    Updates: 0
2022-04-22 23:58:35.108 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964352155062272[0;39m 生成今日电子书快照结束，耗时：32毫秒
2022-04-22 23:58:40.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964372820398080[0;39m 生成今日电子书快照开始
2022-04-22 23:58:40.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964372820398080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964372820398080[0;39m ==> Parameters: 
2022-04-22 23:58:40.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964372820398080[0;39m <==    Updates: 0
2022-04-22 23:58:40.067 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964372820398080[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-04-22 23:58:45.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964393783529472[0;39m 生成今日电子书快照开始
2022-04-22 23:58:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964393783529472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964393783529472[0;39m ==> Parameters: 
2022-04-22 23:58:45.074 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964393783529472[0;39m <==    Updates: 0
2022-04-22 23:58:45.075 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964393783529472[0;39m 生成今日电子书快照结束，耗时：74毫秒
2022-04-22 23:58:50.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964414759243776[0;39m 生成今日电子书快照开始
2022-04-22 23:58:50.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964414759243776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:50.026 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964414759243776[0;39m ==> Parameters: 
2022-04-22 23:58:50.061 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964414759243776[0;39m <==    Updates: 0
2022-04-22 23:58:50.062 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964414759243776[0;39m 生成今日电子书快照结束，耗时：60毫秒
2022-04-22 23:58:55.009 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964435760123904[0;39m 生成今日电子书快照开始
2022-04-22 23:58:55.027 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964435760123904[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:58:55.028 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964435760123904[0;39m ==> Parameters: 
2022-04-22 23:58:55.060 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964435760123904[0;39m <==    Updates: 0
2022-04-22 23:58:55.060 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964435760123904[0;39m 生成今日电子书快照结束，耗时：50毫秒
2022-04-22 23:59:00.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964456702283776[0;39m 生成今日电子书快照开始
2022-04-22 23:59:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964456702283776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:00.023 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964456702283776[0;39m ==> Parameters: 
2022-04-22 23:59:00.062 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964456702283776[0;39m <==    Updates: 0
2022-04-22 23:59:00.063 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964456702283776[0;39m 生成今日电子书快照结束，耗时：61毫秒
2022-04-22 23:59:05.007 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172964477694775296[0;39m start updating Ebook doc
2022-04-22 23:59:05.028 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964477694775296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:59:05.029 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964477694775296[0;39m ==> Parameters: 
2022-04-22 23:59:05.065 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964477694775296[0;39m <==    Updates: 1
2022-04-22 23:59:05.065 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172964477694775296[0;39m update ends, take 58 millisecs
2022-04-22 23:59:05.066 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964477942239232[0;39m 生成今日电子书快照开始
2022-04-22 23:59:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964477942239232[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:05.066 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964477942239232[0;39m ==> Parameters: 
2022-04-22 23:59:05.106 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964477942239232[0;39m <==    Updates: 0
2022-04-22 23:59:05.106 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964477942239232[0;39m 生成今日电子书快照结束，耗时：40毫秒
2022-04-22 23:59:10.000 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964498636935168[0;39m 生成今日电子书快照开始
2022-04-22 23:59:10.024 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964498636935168[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:10.025 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964498636935168[0;39m ==> Parameters: 
2022-04-22 23:59:10.067 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964498636935168[0;39m <==    Updates: 0
2022-04-22 23:59:10.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964498636935168[0;39m 生成今日电子书快照结束，耗时：68毫秒
2022-04-22 23:59:15.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964519629426688[0;39m 生成今日电子书快照开始
2022-04-22 23:59:15.029 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964519629426688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:15.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964519629426688[0;39m ==> Parameters: 
2022-04-22 23:59:15.068 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964519629426688[0;39m <==    Updates: 0
2022-04-22 23:59:15.068 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964519629426688[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-04-22 23:59:20.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964540621918208[0;39m 生成今日电子书快照开始
2022-04-22 23:59:20.038 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964540621918208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:20.039 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964540621918208[0;39m ==> Parameters: 
2022-04-22 23:59:20.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964540621918208[0;39m <==    Updates: 0
2022-04-22 23:59:20.080 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964540621918208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:59:25.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964561593438208[0;39m 生成今日电子书快照开始
2022-04-22 23:59:25.050 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964561593438208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:25.051 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964561593438208[0;39m ==> Parameters: 
2022-04-22 23:59:25.087 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964561593438208[0;39m <==    Updates: 0
2022-04-22 23:59:25.087 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964561593438208[0;39m 生成今日电子书快照结束，耗时：77毫秒
2022-04-22 23:59:30.005 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964582543986688[0;39m 生成今日电子书快照开始
2022-04-22 23:59:30.033 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964582543986688[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:30.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964582543986688[0;39m ==> Parameters: 
2022-04-22 23:59:30.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964582543986688[0;39m <==    Updates: 0
2022-04-22 23:59:30.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964582543986688[0;39m 生成今日电子书快照结束，耗时：66毫秒
2022-04-22 23:59:35.010 INFO  com.ameliawiki.wiki.job.DocJob                    :33   [32m172964603536478208[0;39m start updating Ebook doc
2022-04-22 23:59:35.035 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964603536478208[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-04-22 23:59:35.036 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964603536478208[0;39m ==> Parameters: 
2022-04-22 23:59:35.072 DEBUG c.a.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m172964603536478208[0;39m <==    Updates: 1
2022-04-22 23:59:35.072 INFO  com.ameliawiki.wiki.job.DocJob                    :36   [32m172964603536478208[0;39m update ends, take 62 millisecs
2022-04-22 23:59:35.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964603796525056[0;39m 生成今日电子书快照开始
2022-04-22 23:59:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964603796525056[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:35.073 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964603796525056[0;39m ==> Parameters: 
2022-04-22 23:59:35.115 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964603796525056[0;39m <==    Updates: 0
2022-04-22 23:59:35.115 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964603796525056[0;39m 生成今日电子书快照结束，耗时：43毫秒
2022-04-22 23:59:40.002 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964624474443776[0;39m 生成今日电子书快照开始
2022-04-22 23:59:40.030 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964624474443776[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:40.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964624474443776[0;39m ==> Parameters: 
2022-04-22 23:59:40.077 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964624474443776[0;39m <==    Updates: 0
2022-04-22 23:59:40.078 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964624474443776[0;39m 生成今日电子书快照结束，耗时：76毫秒
2022-04-22 23:59:45.003 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964645450158080[0;39m 生成今日电子书快照开始
2022-04-22 23:59:45.031 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964645450158080[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:45.032 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964645450158080[0;39m ==> Parameters: 
2022-04-22 23:59:45.071 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964645450158080[0;39m <==    Updates: 0
2022-04-22 23:59:45.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964645450158080[0;39m 生成今日电子书快照结束，耗时：69毫秒
2022-04-22 23:59:50.010 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964666451038208[0;39m 生成今日电子书快照开始
2022-04-22 23:59:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964666451038208[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:50.037 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964666451038208[0;39m ==> Parameters: 
2022-04-22 23:59:50.080 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964666451038208[0;39m <==    Updates: 0
2022-04-22 23:59:50.081 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964666451038208[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-04-22 23:59:55.001 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :33   [32m172964687384809472[0;39m 生成今日电子书快照开始
2022-04-22 23:59:55.034 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964687384809472[0;39m ==>  Preparing: insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1, ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-04-22 23:59:55.035 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964687384809472[0;39m ==> Parameters: 
2022-04-22 23:59:55.072 DEBUG c.a.w.mapper.EbookSnapshotMapperCust.getSnapshot  :137  [32m172964687384809472[0;39m <==    Updates: 0
2022-04-22 23:59:55.072 INFO  com.ameliawiki.wiki.job.EbookSnapshotJob          :36   [32m172964687384809472[0;39m 生成今日电子书快照结束，耗时：71毫秒
